<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Expressì—ì„œ ê²Œì„ í–‰ë™ë ¥ êµ¬í˜„ í•´ë³´ê¸°</title>
      <link href="/2020/11/01/nodejs-game-active-point/"/>
      <url>/2020/11/01/nodejs-game-active-point/</url>
      
        <content type="html"><![CDATA[<p>ì˜ˆë¡œ ì• ë‹ˆíŒ¡ ê°™ì€ ê²Œì„ì˜ í•˜íŠ¸ ë“± í–‰ë™ë ¥ ì±„ìš°ê¸° ë¡œì§ êµ¬í˜„ ì •ë¦¬</p><h2 id="ì„œë²„"><a href="#ì„œë²„" class="headerlink" title="ì„œë²„"></a>ì„œë²„</h2><ol><li><p>í´ë¼ì—ì„œ ì†Œëª¨ë¥¼ ìš”ì²­ ì‹œ ê·¸ ë‹¹ì‹œì˜ ì‹œê°„(í´ë¼ì—ì„œ ì†Œëª¨í•œ ì‹œê°„, ë‹¨ìœ„ëŠ” ms)ì„ ê¸°ë¡í•´ ë‘”ë‹¤.</p></li><li><p>ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ ìš”ì²­ì´ë‚˜ ë¦¬ìŠ¤íŠ¸ í†µì‹ ì´ ì˜¬ ì‹œ (í˜„ì¬ ì‹œê°„ - ì´ì „ì— ê¸°ë¡í•œ ì‹œê°„) / ì¶©ì „ ì¿¨íƒ€ì„ ìœ¼ë¡œ ì¶©ì „í•´ì¤˜ì•¼ í•˜ëŠ” ê°œìˆ˜ë¥¼ êµ¬í•œë‹¤.</p></li><li><p>ì¶©ì „í•  ê°œìˆ˜ê°€ ìˆìœ¼ë©´ ì¶©ì „ í•´ì£¼ê³  ì‹œê°„ì€ ì„œë²„ì—ì„œ ì¶©ì „í•´ì¤€ ì‹œê°„ìœ¼ë¡œ ê°±ì‹ ì„ í•œë‹¤ ì¶©ì „ë˜ì§€ ì•Šì„ ì‹œì—ëŠ” íŒ¨ìŠ¤.</p></li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&quot;mysql2&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&quot;cors&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">app.use(cors());</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">  host: <span class="string">&quot;localhost&quot;</span>,</span><br><span class="line">  user: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">  database: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> USER_ID = <span class="string">&quot;1q2w3e&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> GET_USER_QUERY = <span class="string">&quot;SELECT * FROM UserActivePoint WHERE user_id = ?&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> UPDATE_USER_QUERY =</span><br><span class="line">  <span class="string">&quot;UPDATE UserActivePoint SET last_update_ts = ?, active_point = ? WHERE user_id = ?&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> CHARGE_TIME = <span class="number">60</span> * <span class="number">1000</span>; <span class="comment">// ì¶©ì „ ì¿¨íƒ€ì„ ë‹¨ìœ„ëŠ” ms</span></span><br><span class="line"><span class="keyword">const</span> MAX_ACTIVE_POINT = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> now = <span class="built_in">Date</span>.now();</span><br><span class="line">  connection.query(GET_USER_QUERY, [USER_ID], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="keyword">if</span> (results.length === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> connection.query(</span><br><span class="line">        <span class="string">&quot;INSERT INTO UserActivePoint(user_id, last_update_ts, active_point) VALUES (?, ?, ?)&quot;</span>,</span><br><span class="line">        [USER_ID, <span class="number">0</span>, <span class="number">5</span>],</span><br><span class="line">        (err) =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">          <span class="keyword">return</span> res.send(</span><br><span class="line">            <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">              code: <span class="number">200</span>,</span><br><span class="line">              active_point: <span class="number">5</span>,</span><br><span class="line">              last_update_ts: <span class="number">0</span>,</span><br><span class="line">              server_ts: now,</span><br><span class="line">            &#125;)</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> activePointCalculate = activePointMiddleWare(</span><br><span class="line">      results[<span class="number">0</span>].active_point,</span><br><span class="line">      results[<span class="number">0</span>].last_update_ts</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> connection.query(</span><br><span class="line">      UPDATE_USER_QUERY,</span><br><span class="line">      [</span><br><span class="line">        activePointCalculate.last_update_ts,</span><br><span class="line">        activePointCalculate.active_point,</span><br><span class="line">        USER_ID,</span><br><span class="line">      ],</span><br><span class="line">      (err) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="keyword">const</span> now = <span class="built_in">Date</span>.now();</span><br><span class="line">        <span class="keyword">return</span> res.send(</span><br><span class="line">          <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            code: <span class="number">200</span>,</span><br><span class="line">            active_point: activePointCalculate.active_point,</span><br><span class="line">            last_update_ts: activePointCalculate.last_update_ts,</span><br><span class="line">            server_ts: now,</span><br><span class="line">          &#125;)</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/use&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  connection.query(GET_USER_QUERY, [USER_ID], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="keyword">if</span> (results[<span class="number">0</span>].active_point === <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> res.send(<span class="built_in">JSON</span>.stringify(&#123; <span class="attr">code</span>: <span class="number">400</span> &#125;));</span><br><span class="line">    <span class="keyword">const</span> now = <span class="built_in">Date</span>.now();</span><br><span class="line">    <span class="keyword">const</span> activePointCalculate = activePointMiddleWare(</span><br><span class="line">      results[<span class="number">0</span>].active_point,</span><br><span class="line">      results[<span class="number">0</span>].last_update_ts &gt; <span class="number">0</span> ? results[<span class="number">0</span>].last_update_ts : now</span><br><span class="line">    );</span><br><span class="line">    connection.query(</span><br><span class="line">      UPDATE_USER_QUERY,</span><br><span class="line">      [</span><br><span class="line">        activePointCalculate.last_update_ts,</span><br><span class="line">        activePointCalculate.active_point - <span class="number">1</span>,</span><br><span class="line">        USER_ID,</span><br><span class="line">      ],</span><br><span class="line">      (err) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="keyword">return</span> res.send(</span><br><span class="line">          <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">            code: <span class="number">200</span>,</span><br><span class="line">            active_point: activePointCalculate.active_point - <span class="number">1</span>,</span><br><span class="line">            last_update_ts: activePointCalculate.last_update_ts,</span><br><span class="line">            server_ts: now,</span><br><span class="line">          &#125;)</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ì„œë²„ì—ì„œ ì¶©ì „í•œ ì‹œê°„ ë˜ëŠ” í´ë¼ì—ì„œ ì‚¬ìš©í•œ ì‹œê°„ì„ ì´ìš©í•˜ì—¬ ì¶©ì „í•´ì¤˜ì•¼ í•  í–‰ë™ë ¥ì„ ê³„ì‚°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>active_point ë³´ìœ í•œ í–‰ë™ë ¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Number&#125;</span> </span>last_update_ts ì‚¬ìš©í–ˆì—ˆë˜ ì‹œê°„ ë˜ëŠ” ì¶©ì „í•´ì¤¬ì—ˆë˜ ì‹œê°„ (=ë‹¨ìœ„ëŠ” ms)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">activePointMiddleWare</span>(<span class="params">active_point, last_update_ts</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> now = <span class="built_in">Date</span>.now();</span><br><span class="line">  <span class="keyword">const</span> results = &#123;</span><br><span class="line">    active_point,</span><br><span class="line">    last_update_ts,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> chargeActionCount = <span class="built_in">Math</span>.floor(</span><br><span class="line">    (now - results.last_update_ts) / CHARGE_TIME</span><br><span class="line">  ); <span class="comment">// ì¶©ì „ í•´ì¤˜ì•¼ í•˜ëŠ” í–‰ë™ë ¥ ê°œìˆ˜</span></span><br><span class="line">  <span class="keyword">if</span> (chargeActionCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    results.active_point += chargeActionCount;</span><br><span class="line">    results.last_update_ts += chargeActionCount * CHARGE_TIME;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (chargeActionCount &gt; <span class="number">0</span> &amp;&amp; results.active_point &gt;= MAX_ACTIVE_POINT) &#123;</span><br><span class="line">    <span class="comment">// ì¶©ì „í–ˆì„ ì‹œ ìµœëŒ€ ê°œìˆ˜ê°€ ë„˜ìœ¼ë©´</span></span><br><span class="line">    results.active_point = MAX_ACTIVE_POINT;</span><br><span class="line">    results.last_update_ts = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// console.log(&quot;results&quot;, results);</span></span><br><span class="line">  <span class="keyword">return</span> results;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;ì„œë²„ ë™ì‘ì¤‘&quot;</span>));</span><br></pre></td></tr></table></figure><h2 id="í´ë¼ì´ì–¸íŠ¸"><a href="#í´ë¼ì´ì–¸íŠ¸" class="headerlink" title="í´ë¼ì´ì–¸íŠ¸"></a>í´ë¼ì´ì–¸íŠ¸</h2><p>ì´ì „ì— êµ¬í˜„ì„ í–ˆì„ ë•Œ ê²Œì„ í´ë¼ì´ì–¸íŠ¸ í”„ë¡œê·¸ë˜ë¨¸ê°€ ì–´ë–»ê²Œ êµ¬í˜„í–ˆëŠ”ì§€ëŠ” ì˜ ëª¨ë¥´ê² ìœ¼ë‚˜</p><p>ë‚˜ëŠ” ìœ ë‹ˆí‹°ëŠ” ëª¨ë¥´ë‹ˆ.. ì¼ë‹¨ ìƒê° í•´ë³¸ëŒ€ë¡œ HTMLì—ì„œ êµ¬í˜„ì„ í•´ ë³´ì•˜ë‹¤ ğŸ˜¨</p><ol><li><p>ì„œë²„ì— í˜„ì¬ ìœ ì €ê°€ ë³´ìœ í•œ í–‰ë™ë ¥, í´ë¼ì—ì„œ ì†Œëª¨í•œ ì‹œê°„ ë˜ëŠ” ì„œë²„ì—ì„œ ì¶©ì „í•œ ì‹œê°„ì„ ë°›ëŠ”ë‹¤.</p></li><li><p>í™”ë©´ì— ê·¸ë¦¬ê³  ë°›ì€ ì‹œê°„ì„ ê¸°ë°˜ìœ¼ë¡œ ë¶„, ì´ˆë¡œ ë³€í™˜í•œ ë‹¤ìŒì— loopë¥¼ í†µí•´ ì‹œê°„ì„ ê³„ì† -</p></li><li><p>í•œ ê°œì˜ ì¶©ì „ ì‹œê°„ì´ ì§€ë‚˜ë©´ í™”ë©´ì—ì„œë§Œ í–‰ë™ë ¥ì„ + í•´ì¤€ë‹¤.</p></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>í–‰ë™ë ¥ êµ¬í˜„ í˜ì´ì§€<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/milligram/1.3.0/milligram.min.css&quot;</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>ìœ ì € ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>í–‰ë™ë ¥ ê°œìˆ˜<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>ë‚¨ì€ ì¶©ì „ ì‹œê°„<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">&quot;userId&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">&quot;actionCount&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">&quot;lastUpdateTime&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button button-outline&quot;</span> <span class="attr">id</span>=<span class="string">&quot;use&quot;</span>&gt;</span>ì†Œëª¨<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> min = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> sec = <span class="number">60</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> maxActionCount = <span class="number">5</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> charge_time = <span class="number">60</span> * <span class="number">1000</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> userId = <span class="string">&quot;1q2w3e&quot;</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> intervalVar;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// ì§„ì… ì‹œ ì„œë²„ì—ì„œ í˜„ì¬ ë³´ìœ í•œ í–‰ë™ë ¥ê³¼ ì„œë²„ì—ì„œ ì¶©ì „í•œ ì‹œê°„(ë˜ëŠ” í´ë¼ì—ì„œ ì†Œëª¨í•œ ì‹œê°„)ì„ ê°€ì§€ê³  ì˜´.</span></span></span><br><span class="line"><span class="javascript">          url: <span class="string">&quot;http://localhost:3000&quot;</span>,</span></span><br><span class="line"><span class="javascript">          type: <span class="string">&quot;get&quot;</span>,</span></span><br><span class="line"><span class="javascript">          success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(data);</span></span><br><span class="line"><span class="javascript">            data = <span class="built_in">JSON</span>.parse(data);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#userId&quot;</span>).html(userId);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#actionCount&quot;</span>).html(data.active_point);</span></span><br><span class="line">            if (data.last_update_ts === 0) &#123;</span><br><span class="line"><span class="javascript">              <span class="comment">// 0ì¸ ê²½ìš° í’€ í–‰ë™ë ¥ì´ë¼ X</span></span></span><br><span class="line"><span class="javascript">              $(<span class="string">&quot;#lastUpdateTime&quot;</span>).html(<span class="string">&quot;0:00&quot;</span>);</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">              init(data.server_ts, data.last_update_ts, <span class="function"><span class="keyword">function</span> (<span class="params">isRun</span>) </span>&#123;</span></span><br><span class="line">                if (isRun) actionCoolTimeLoop();</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line"><span class="javascript">          error: <span class="function"><span class="keyword">function</span> (<span class="params">request, status, error</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(</span></span><br><span class="line"><span class="javascript">              <span class="string">&quot;code:&quot;</span> +</span></span><br><span class="line">                request.status +</span><br><span class="line"><span class="javascript">                <span class="string">&quot;\n&quot;</span> +</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;message:&quot;</span> +</span></span><br><span class="line">                request.responseText +</span><br><span class="line"><span class="javascript">                <span class="string">&quot;\n&quot;</span> +</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;error:&quot;</span> +</span></span><br><span class="line">                error</span><br><span class="line">            );</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#use&quot;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line">          e.preventDefault();</span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (<span class="built_in">parseInt</span>($(<span class="string">&quot;#actionCount&quot;</span>).html()) &lt;= <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">&quot;í–‰ë™ë ¥ì„ ëª¨ë‘ ì†Œì§„í•˜ì˜€ìŠµë‹ˆë‹¤!&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">              url: <span class="string">&quot;http://localhost:3000/use&quot;</span>,</span></span><br><span class="line"><span class="javascript">              type: <span class="string">&quot;get&quot;</span>,</span></span><br><span class="line"><span class="javascript">              success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">&quot;data&quot;</span>, data);</span></span><br><span class="line"><span class="javascript">                data = <span class="built_in">JSON</span>.parse(data);</span></span><br><span class="line"><span class="javascript">                $(<span class="string">&quot;#actionCount&quot;</span>).html(data.active_point);</span></span><br><span class="line">                stopInterval();</span><br><span class="line">                actionCoolTimeLoop();</span><br><span class="line">              &#125;,</span><br><span class="line"><span class="javascript">              error: <span class="function"><span class="keyword">function</span> (<span class="params">request, status, error</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(</span></span><br><span class="line"><span class="javascript">                  <span class="string">&quot;code:&quot;</span> +</span></span><br><span class="line">                    request.status +</span><br><span class="line"><span class="javascript">                    <span class="string">&quot;\n&quot;</span> +</span></span><br><span class="line"><span class="javascript">                    <span class="string">&quot;message:&quot;</span> +</span></span><br><span class="line">                    request.responseText +</span><br><span class="line"><span class="javascript">                    <span class="string">&quot;\n&quot;</span> +</span></span><br><span class="line"><span class="javascript">                    <span class="string">&quot;error:&quot;</span> +</span></span><br><span class="line">                    error</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      /**</span><br><span class="line">       * ì‹¤í–‰ ì´ˆê¸° í•¨ìˆ˜</span><br><span class="line"><span class="javascript">       * @param &#123;<span class="built_in">Number</span>&#125; serverTime ì„œë²„ì—ì„œ ì£¼ëŠ” í˜„ì¬ ì‹œê°„</span></span><br><span class="line"><span class="javascript">       * @param &#123;<span class="built_in">Number</span>&#125; lastUpdateTime ì„œë²„ì—ì„œ ì¶©ì „í•œ ì‹œê°„ ë˜ëŠ” í´ë¼ì—ì„œ ì†Œëª¨í–ˆì—ˆë˜ ì‹œê°„(ë‹¨ìœ„ëŠ” ms)</span></span><br><span class="line">       */</span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">serverTime, lastUpdateTime, callback</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> remainMs = lastUpdateTime + charge_time - serverTime; <span class="comment">// ë‚¨ì€ ì‹œê°„</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (remainMs &lt; <span class="number">0</span>) <span class="keyword">return</span> callback(<span class="literal">false</span>);</span></span><br><span class="line">        if (remainMs &gt; 0) &#123;</span><br><span class="line"><span class="javascript">          <span class="comment">// ms to min, sec ê³„ì‚°ë²•ì€ ìŠ¤íƒì˜¤ë¸Œí”Œë¡œìš°ì—ì„œ ì°¸ê³ í•¨</span></span></span><br><span class="line"><span class="javascript">          min = <span class="built_in">Math</span>.floor(remainMs / <span class="number">60000</span>);</span></span><br><span class="line">          sec = ((remainMs % 60000) / 1000).toFixed(0);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> result;</span></span><br><span class="line">        if (sec === 60) &#123;</span><br><span class="line"><span class="javascript">          result = min + <span class="string">&quot;:&quot;</span> + <span class="string">&quot;00&quot;</span>;</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">          result = min + <span class="string">&quot;:&quot;</span> + (sec &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> : <span class="string">&quot;&quot;</span>) + sec;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#lastUpdateTime&quot;</span>).html(result);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> callback(<span class="literal">true</span>);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">actionCoolTimeLoop</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        intervalVar = <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line">          loop();</span><br><span class="line">        &#125;, 1000);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">loop</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line">        sec--;</span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> result;</span></span><br><span class="line">        if (sec === 0 &amp;&amp; min &gt; 0) &#123;</span><br><span class="line">          min = min - 1;</span><br><span class="line">          sec = 60;</span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span></span><br><span class="line">          sec === 0 &amp;&amp;</span><br><span class="line">          min === 0 &amp;&amp;</span><br><span class="line"><span class="javascript">          maxActionCount !== <span class="built_in">parseInt</span>($(<span class="string">&quot;#actionCount&quot;</span>).html())</span></span><br><span class="line">        ) &#123;</span><br><span class="line"><span class="javascript">          $(<span class="string">&quot;#actionCount&quot;</span>).html(<span class="built_in">parseInt</span>($(<span class="string">&quot;#actionCount&quot;</span>).html()) + <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">          <span class="keyword">if</span> (maxActionCount === <span class="built_in">parseInt</span>($(<span class="string">&quot;#actionCount&quot;</span>).html())) &#123;</span></span><br><span class="line">            sec = 0;</span><br><span class="line">            min = 0;</span><br><span class="line">            stopInterval();</span><br><span class="line"><span class="javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line">            sec = 60;</span><br><span class="line">            min = 0;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (sec === 60 &amp;&amp; min === 0) &#123;</span><br><span class="line"><span class="javascript">          result = <span class="number">1</span> + <span class="string">&quot;:&quot;</span> + <span class="string">&quot;00&quot;</span>;</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sec === <span class="number">60</span> &amp;&amp; min === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          result = <span class="number">1</span> + <span class="string">&quot;:&quot;</span> + <span class="string">&quot;00&quot;</span>;</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sec === <span class="number">60</span> &amp;&amp; min &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          result = min + <span class="number">1</span> + <span class="string">&quot;:&quot;</span> + <span class="string">&quot;00&quot;</span>;</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">          result = min + <span class="string">&quot;:&quot;</span> + (sec &lt; <span class="number">10</span> ? <span class="string">&quot;0&quot;</span> : <span class="string">&quot;&quot;</span>) + sec;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        $(<span class="string">&quot;#lastUpdateTime&quot;</span>).html(result);</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">stopInterval</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">clearInterval</span>(intervalVar);</span></span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ì¼ë‹¨ ì¶©ì „ ì¿¨íƒ€ì„ì„ 1ë¶„ìœ¼ë¡œ ì£¼ê³  ëª‡ ë²ˆ ëŒë ¤ë´¤ì„ ë•Œ ì‹œê°„ì´ ë­”ê°€ ì–´ê¸‹ë‚˜ê±°ë‚˜ ê·¸ëŸ¬ì§„ ì•Šì•˜ë‹¤.</p><p>ì„œë²„ìª½ì€ ì´ì „ì— ëª‡ ë²ˆ í•´ë´¤ì—ˆë˜ ì‘ì—…ì¸ë° ë§‰ìƒ ë‹¤ì‹œ ì§œë³¼ë¼ë‹ˆ ìƒê°ì´ ì¢€ ë§ì´ ì•ˆ ë“¤ì—ˆê³ ..</p><p>í´ë¼ì´ì–¸íŠ¸ìª½ì€ ì¿¨íƒ€ì„ ë‚¨ì€ ì‹œê°„ì´ ë­”ê°€ ê³„ì† ì•ˆ ë§ì•„ì„œ ì‚½ì§ˆì„ ì¢€ í•œ ê±° ê°™ë‹¤.</p><p>ì—­ì‹œ ë­”ê°€ë¥¼ í–ˆì„ ë•Œ ê¸°ë¡ì„ í•´ë‘¬ì•¼ í•˜ëŠ”ê±¸ ë˜ í•œ ë²ˆ ëŠë¼ëŠ” í•˜ë£¨ì˜€ë‹¤.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Game </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js luxon ëª¨ë“ˆ ì‚¬ìš© í•´ë³´ê¸°</title>
      <link href="/2020/10/05/nodejs-luxon/"/>
      <url>/2020/10/05/nodejs-luxon/</url>
      
        <content type="html"><![CDATA[<p>ì´ì „ì— í˜ì´ìŠ¤ë¶ ê·¸ë£¹ì—ì„œ Moment í”„ë¡œì íŠ¸ê°€ ë” ì´ìƒ ìœ ì§€ ë³´ìˆ˜ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê¸€ì„ ë´¤ì—ˆë‹¤.</p><p>ì‹¤ì œ í”„ë¡œì íŠ¸ ìƒíƒœì— ì í˜€ ìˆì—ˆê³  ì‹ ê·œ í”„ë¡œì íŠ¸ì—ì„œ ëŒ€ì²´í•  ëª¨ë“ˆì„ ì œì‹œë¥¼ í•˜ëŠ”ë° ë‚˜ëŠ” ê·¸ ì¤‘ì—</p><p>ë§¨ ì²˜ìŒì— ì í˜€ìˆëŠ” luxonì„ ì‚¬ìš©í•´ë³´ê¸°ë¡œ í–ˆë‹¤.</p><h2 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i luxon -S</span><br></pre></td></tr></table></figure><h2 id="mtì™€-ë¹„êµ"><a href="#mtì™€-ë¹„êµ" class="headerlink" title="mtì™€ ë¹„êµ"></a>mtì™€ ë¹„êµ</h2><p>ê°€ì¥ í° ì°¨ì´ì ì€ Momentì˜ ê²½ìš° ì²˜ìŒ ê°ì²´ë¥¼ ìƒì„± í•˜ê³  ì´í›„ì— ì¶”ê°€ì ì¸ ì—°ì‚° ë“±ì˜ í–‰ìœ„ë¥¼</p><p>í•˜ì˜€ì„ ë•Œ ì›ë³¸ ê°ì²´ë„ ë°”ë€Œê¸° ë•Œë¬¸ì— ë³„ë„ë¡œ cloneì„ í•´ì„œ ì‚¬ìš©ì„ í•´ì•¼ ë˜ëŠ”ë° ì¸ì§€ë¥¼ ëª» í•´ì„œ</p><p>ì‹¤ìˆ˜ë¥¼ í–ˆë˜ ê²½í—˜ì´ ìˆëŠ”ë° luxonì˜ ê²½ìš° ìƒì„± ê°ì²´ê°€ ë¶ˆë³€ì´ê¸° ë•Œë¬¸ì— ë³„ë„ ì‘ì—…ì´ í•„ìš”ê°€ ì—†ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; DateTime &#125; = <span class="built_in">require</span>(<span class="string">&quot;luxon&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MomentTimezone = <span class="built_in">require</span>(<span class="string">&quot;moment-timezone&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> date = &#123;</span><br><span class="line">  mt: MomentTimezone().tz(<span class="string">&quot;America/New_York&quot;</span>),</span><br><span class="line">  luxon: DateTime.fromObject(&#123; <span class="attr">zone</span>: <span class="string">&quot;America/New_York&quot;</span> &#125;),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mt1 = date.mt.format(<span class="string">&quot;YYYY-MM-DD&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mt2 = date.mt.add(<span class="number">1</span>, <span class="string">&quot;days&quot;</span>).format(<span class="string">&quot;YYYY-MM-DD&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  <span class="string">`mt: <span class="subst">$&#123;mt1&#125;</span>`</span>,</span><br><span class="line">  <span class="string">`mt2: <span class="subst">$&#123;mt2&#125;</span>`</span>,</span><br><span class="line">  <span class="string">`ì›ë³¸: <span class="subst">$&#123;date.mt.format(<span class="string">&quot;YYYY-MM-DD&quot;</span>)&#125;</span>`</span></span><br><span class="line">); <span class="comment">// mt: 2020-10-05 mt2: 2020-10-06 ì›ë³¸: 2020-10-06</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> luxon1 = date.luxon.toFormat(<span class="string">&quot;yyyy-LL-dd&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> luxon2 = date.luxon.plus(&#123; <span class="attr">days</span>: <span class="number">1</span> &#125;).toFormat(<span class="string">&quot;yyyy-LL-dd&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  <span class="string">`luxon1: <span class="subst">$&#123;luxon1&#125;</span>`</span>,</span><br><span class="line">  <span class="string">`luxon2: <span class="subst">$&#123;luxon2&#125;</span>`</span>,</span><br><span class="line">  <span class="string">`ì›ë³¸: <span class="subst">$&#123;date.luxon.toFormat(<span class="string">&quot;yyyy-LL-dd&quot;</span>)&#125;</span>`</span></span><br><span class="line">); <span class="comment">// luxon1: 2020-10-05 luxon2: 2020-10-06 ì›ë³¸: 2020-10-05</span></span><br></pre></td></tr></table></figure><h2 id="ê¸°ì¡´ì—-ì¨-ë´¤ë˜-mt-ëŒ€ì²´-ì‹¤ìŠµ"><a href="#ê¸°ì¡´ì—-ì¨-ë´¤ë˜-mt-ëŒ€ì²´-ì‹¤ìŠµ" class="headerlink" title="ê¸°ì¡´ì— ì¨ ë´¤ë˜ mt ëŒ€ì²´ ì‹¤ìŠµ"></a>ê¸°ì¡´ì— ì¨ ë´¤ë˜ mt ëŒ€ì²´ ì‹¤ìŠµ</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; DateTime &#125; = <span class="built_in">require</span>(<span class="string">&quot;luxon&quot;</span>); <span class="comment">// luxon load</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MomentTimezone = <span class="built_in">require</span>(<span class="string">&quot;moment-timezone&quot;</span>); <span class="comment">// moment-timezone load</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> date = &#123;</span><br><span class="line">  mt: MomentTimezone().tz(<span class="string">&quot;America/New_York&quot;</span>),</span><br><span class="line">  luxon: DateTime.fromObject(&#123; <span class="attr">zone</span>: <span class="string">&quot;America/New_York&quot;</span> &#125;),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`mtë¥¼ í†µí•œ ë‰´ìš• ì‹œê°„: <span class="subst">$&#123;date.mt.format(<span class="string">&quot;YYYY-MM-DD HH:mm&quot;</span>)&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// mtë¥¼ í†µí•œ ë‰´ìš• ì‹œê°„: 2020-10-05 10:10</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  <span class="string">`luxonì„ í†µí•œ ë‰´ìš• ì‹œê°„: <span class="subst">$&#123;date.luxon.toFormat(<span class="string">&quot;yyyy-LL-dd HH:mm&quot;</span>)&#125;</span>`</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// luxonì„ í†µí•œ ë‰´ìš• ì‹œê°„: 2020-10-05 10:10</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`mtë¡œ ë³´ëŠ” ì£¼ì°¨(ë…„ ê¸°ì¤€): <span class="subst">$&#123;date.mt.week()&#125;</span>`</span>); <span class="comment">// 41</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`luxonìœ¼ë¡œ ë³´ëŠ” ì£¼ì°¨(ë…„ ê¸°ì¤€): <span class="subst">$&#123;date.luxon.weekNumber&#125;</span>`</span>); <span class="comment">// 41</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> weekOfMonth = &#123;</span><br><span class="line">  mt:</span><br><span class="line">    MomentTimezone().tz(<span class="string">&quot;America/New_York&quot;</span>).week() -</span><br><span class="line">    MomentTimezone().tz(<span class="string">&quot;America/New_York&quot;</span>).startOf(<span class="string">&quot;month&quot;</span>).week() +</span><br><span class="line">    <span class="number">1</span>,</span><br><span class="line">  luxon: date.luxon.weekNumber - date.luxon.startOf(<span class="string">&quot;month&quot;</span>).weekNumber + <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`mtë¡œ ë³´ëŠ” ì£¼ì°¨(ì›” ê¸°ì¤€): <span class="subst">$&#123;weekOfMonth.mt&#125;</span>`</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`luxonìœ¼ë¡œ ë³´ëŠ” ì£¼ì°¨(ì›” ê¸°ì¤€): <span class="subst">$&#123;weekOfMonth.luxon&#125;</span>`</span>); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> diff = &#123;</span><br><span class="line">  mt: MomentTimezone.tz(<span class="string">&quot;Asia/Seoul&quot;</span>).diff(</span><br><span class="line">    MomentTimezone(<span class="string">&quot;2020-10-05 00:00:00&quot;</span>).tz(<span class="string">&quot;Asia/Seoul&quot;</span>)</span><br><span class="line">  ),</span><br><span class="line">  luxon: DateTime.fromObject(&#123; <span class="attr">zone</span>: <span class="string">&quot;Asia/Seoul&quot;</span> &#125;).diff(</span><br><span class="line">    DateTime.fromObject(&#123;</span><br><span class="line">      zone: <span class="string">&quot;Asia/Seoul&quot;</span>,</span><br><span class="line">      year: <span class="number">2020</span>,</span><br><span class="line">      month: <span class="number">10</span>,</span><br><span class="line">      day: <span class="number">5</span>,</span><br><span class="line">      hour: <span class="number">0</span>,</span><br><span class="line">      minute: <span class="number">0</span>,</span><br><span class="line">      second: <span class="number">0</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  ).toObject(),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`mtë¡œ ë³´ëŠ” í˜„ì¬ - ì§€ì •ëœ ë‚  = ts: <span class="subst">$&#123;diff.mt&#125;</span>`</span>); <span class="comment">// 87448000</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`luxonìœ¼ë¡œ ë³´ëŠ” í˜„ì¬ - ì§€ì •ëœ ë‚  = ts: <span class="subst">$&#123;diff.luxon.milliseconds&#125;</span>`</span>); <span class="comment">// 87448004</span></span><br></pre></td></tr></table></figure><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://momentjs.com/docs/?fbclid=IwAR18PnJT5jAcBBeQZwHgaKVdyR_tba3WCzoo2oXzXrJb2vNY-xxV2iedB1c#/-project-status/">Moment í”„ë¡œì íŠ¸ ìƒíƒœ</a></li><li><a href="https://moment.github.io/luxon/docs/identifiers.html">luxon ë¬¸ì„œ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Date </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueì—ì„œ ì„œë²„ ì‚¬ì´ë“œ ë Œë”ë§ ì•Œì•„ë³´ê¸°</title>
      <link href="/2020/09/17/nodejs-vue-ssr/"/>
      <url>/2020/09/17/nodejs-vue-ssr/</url>
      
        <content type="html"><![CDATA[<h2 id="ì„œë²„ì‚¬ì´ë“œë Œë”ë§-SSR-ì´ë€"><a href="#ì„œë²„ì‚¬ì´ë“œë Œë”ë§-SSR-ì´ë€" class="headerlink" title="ì„œë²„ì‚¬ì´ë“œë Œë”ë§(SSR)ì´ë€"></a>ì„œë²„ì‚¬ì´ë“œë Œë”ë§(SSR)ì´ë€</h2><p>Vue ì»´í¬ë„ŒíŠ¸ë¥¼ ì„œë²„ì—ì„œ HTML ë¬¸ìì—´ë¡œ ë¸Œë¼ìš°ì €ì— ì „ì†¡ì„ í•˜ëŠ” ë°©ì‹</p><h2 id="ì‚¬ìš©-ì‹œ-ì¥ì "><a href="#ì‚¬ìš©-ì‹œ-ì¥ì " class="headerlink" title="ì‚¬ìš© ì‹œ ì¥ì "></a>ì‚¬ìš© ì‹œ ì¥ì </h2><ul><li>ê²€ìƒ‰ ì—”ì§„ í¬ë¡¤ëŸ¬ê°€ ì™„ì„±ëœ í˜ì´ì§€ë¥¼ ë³¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ SEO í–¥ìƒ</li><li>í´ë¼ì´ì–¸íŠ¸ì—ì„œ í™”ë©´ì„ ê·¸ë¦¬ëŠ” ì‘ì—…ì´ ì¤„ì–´ë“œë¯€ë¡œ ë¡œë”© ì†ë„ í–¥ìƒ</li></ul><h2 id="ì‚¬ìš©-ì‹œ-ì£¼ì˜ì "><a href="#ì‚¬ìš©-ì‹œ-ì£¼ì˜ì " class="headerlink" title="ì‚¬ìš© ì‹œ ì£¼ì˜ì "></a>ì‚¬ìš© ì‹œ ì£¼ì˜ì </h2><ul><li>ì„œë²„ì—ì„œ ë°›ì•„ì™€ì•¼ í•˜ë‹ˆê¹Œ ì„œë²„ê°€ ê¼­ í•„ìš” (ì •ì  íŒŒì¼ -&gt; index.html ë¶ˆê°€)</li><li>ì„œë²„ì™€ì˜ í†µì‹ ì´ ìì£¼ ì¼ì–´ë‚œë‹¤ê³  í•˜ë‹ˆ ì£¼ì˜</li></ul><p>ì˜ˆë¡œ ë¬¸ì„œì—ì„œëŠ” ì‚¬ë‚´ ëŒ€ì‹œë³´ë“œ ì´ëŸ° ê±° ë§Œë“¤ ë•ŒëŠ” SSRì€ ì˜¤ë°”ë¼ê³  í•¨.</p><h2 id="ì‚¬ìš©ë²•"><a href="#ì‚¬ìš©ë²•" class="headerlink" title="ì‚¬ìš©ë²•"></a>ì‚¬ìš©ë²•</h2><p>ë¬¸ì„œì—ëŠ” Expressë¡œ ì´ìš©í•˜ëŠ” ë°©ë²•ê³¼ <a href="https://ko.nuxtjs.org/">Nuxt.js</a>ë¼ëŠ” í”„ë ˆì„ì›Œí¬ë¥¼ ì“°ë¼ê³  ì œì‹œ í•œë‹¤.</p><p>Express ê°€ì´ë“œë¥¼ ë³´ê³  ì½”ë“œë¥¼ ì‘ì„±í•´ ë³´ì•˜ë‹¤. </p><h3 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express vue vue-server-renderer -S</span><br></pre></td></tr></table></figure><p>ë Œë”ë§ ê´€ë ¨ ëª¨ë“ˆì„ ì œê³µì„ í•œë‹¤</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Vue = <span class="built_in">require</span>(<span class="string">&quot;vue&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> renderer = <span class="built_in">require</span>(<span class="string">&quot;vue-server-renderer&quot;</span>).createRenderer(); <span class="comment">// init</span></span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)();</span><br><span class="line"></span><br><span class="line">server.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123; <span class="comment">// ë·° ì¸ìŠ¤í„´ìŠ¤ ìƒì„±</span></span><br><span class="line">    data: &#123; <span class="comment">// ë°ì´í„°</span></span><br><span class="line">      year: date.getFullYear(),</span><br><span class="line">      month: date.getMonth() + <span class="number">1</span>,</span><br><span class="line">      day: date.getDate(),</span><br><span class="line">    &#125;,</span><br><span class="line">    template: <span class="string">`&lt;div&gt;ì˜¤ëŠ˜ì€ &#123;&#123; year &#125;&#125;ë…„ &#123;&#123; month &#125;&#125;ì›” &#123;&#123; day &#125;&#125;ì¼ ì…ë‹ˆë‹¤.&lt;/div&gt;`</span>,</span><br><span class="line">  &#125;); <span class="comment">// Vue ì¸ìŠ¤í„´ìŠ¤</span></span><br><span class="line">  renderer.renderToString(app, <span class="function">(<span class="params">err, html</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> res.status(<span class="number">500</span>).end(err);</span><br><span class="line">    <span class="keyword">return</span> res.end(<span class="string">`</span></span><br><span class="line"><span class="string">      &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">      &lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;<span class="subst">$&#123;html&#125;</span>&lt;/body&gt;</span></span><br><span class="line"><span class="string">      &lt;/html&gt;</span></span><br><span class="line"><span class="string">    `</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;express is running&quot;</span>));</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1600326954/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-09-17_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.12.07_cdprkl.png"></p><p>ì†ŒìŠ¤ ë³´ê¸°ë¡œ ë³´ë‹ˆ íŠ¹ì´ì ì€ data-server-renderedë¼ëŠ” í•­ëª©ì´ ìƒê²¼ë‹¤ ì‹ ê¸° í•˜ë‹¤.</p><p>ë³´í†µì€ Nuxt.js í”„ë ˆì„ì›Œí¬ë¥¼ ì“°ëŠ” ê±° ê°™ì€ë° ë‚˜ë„ ì¨ ë³´ë©´ì„œ ê³µë¶€ë¥¼ í•´ë´ì•¼ ê² ë‹¤.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://ssr.vuejs.org/#what-is-server-side-rendering-ssr">Vue SSR ê°€ì´ë“œ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vuex ì •ë¦¬</title>
      <link href="/2020/09/14/nodejs-vue-vuex-study/"/>
      <url>/2020/09/14/nodejs-vue-vuex-study/</url>
      
        <content type="html"><![CDATA[<h2 id="Vuexë€"><a href="#Vuexë€" class="headerlink" title="Vuexë€"></a>Vuexë€</h2><p>VuexëŠ” ì „ì—­ ì €ì¥ì†Œ(data)ë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœ ê´€ë¦¬ë¥¼ í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬</p><h2 id="ì‚¬ìš©-ì´ìœ "><a href="#ì‚¬ìš©-ì´ìœ " class="headerlink" title="ì‚¬ìš© ì´ìœ "></a>ì‚¬ìš© ì´ìœ </h2><p>ê·œëª¨ê°€ ìˆëŠ” appì—ì„œ ê°™ì€ ìƒíƒœë¥¼ ê°€ì§„ ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸(ë¶€ëª¨/ìì‹ ë˜ëŠ” ê°™ì€ ë ˆë²¨)ë¼ë¦¬</p><p>ë°ì´í„°ë¥¼ ê´€ë¦¬ ë¥¼ í•˜ê²Œ ë  ë•Œ ê¸°ì¡´ì˜ propsë‚˜ $emitìœ¼ë¡œ í•˜ê²Œ ë˜ë©´ ì½”ë“œê°€ ë³µì¡í•´ì ¸ì„œ</p><p>ìœ ì§€ ë³´ìˆ˜ í•˜ê¸°ê°€ í˜ë“¤ì–´ ì§€ê¸° ë•Œë¬¸ì— ì‚¬ìš© í•œë‹¤ê³  í•œë‹¤.</p><h2 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vuex -S</span><br></pre></td></tr></table></figure><h2 id="ì €ì¥ì†Œ"><a href="#ì €ì¥ì†Œ" class="headerlink" title="ì €ì¥ì†Œ"></a>ì €ì¥ì†Œ</h2><p>ì‹œì‘ì€ src/store</p><p><strong>MyStore.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>; <span class="comment">// vuex import</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex); <span class="comment">// vuex ì‚¬ìš©</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> state = &#123;</span><br><span class="line">  <span class="comment">// ë°ì´í„°</span></span><br><span class="line">  msg: <span class="string">&quot;Hello! Vuex&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mutations = &#123;</span><br><span class="line">  <span class="comment">// ë°ì´í„°ë¥¼ ì¡°ì‘í•  í•¨ìˆ˜</span></span><br><span class="line">  changeMessage(state, msg) &#123;</span><br><span class="line">    state.msg = msg;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ì‹¤ìŠµ"><a href="#ì‹¤ìŠµ" class="headerlink" title="ì‹¤ìŠµ"></a>ì‹¤ìŠµ</h2><p>webpack-simple ë²„ì „ìœ¼ë¡œ ë§Œë“¤ì–´ì„œ ì‹¤ìŠµì„ í•´ ë³¸ë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vue init webpack-simple vuex_study</span><br></pre></td></tr></table></figure><p><strong>Message.vue</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- ë°ì´í„° í‘œì‹œ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    computed: &#123;</span><br><span class="line">      msg() &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">this</span>.$store.state.msg; <span class="comment">// this.$store.@@ìœ¼ë¡œ ì €ì¥ì†Œ ë°ì´í„° ì ‘ê·¼</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Input.vue</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> @<span class="attr">keyup</span>=<span class="string">&quot;changeMsg&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- í‚¤ë³´ë“œ ëˆ„ë¥¼ë•Œë§ˆë‹¤ ì´ë²¤íŠ¸ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    methods: &#123;</span><br><span class="line">      changeMsg(event) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$store.commit(<span class="string">&quot;changeMessage&quot;</span>, event.target.value); <span class="comment">// this.$store.commit(&quot;ì‘ì„±í•œ ë°ì´í„° ì¡°ì‘ í•¨ìˆ˜&quot;, ê°’)</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>App.vue</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;./assets/logo.png&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">MessageComponent</span>&gt;</span><span class="tag">&lt;/<span class="name">MessageComponent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">InputComponent</span>&gt;</span><span class="tag">&lt;/<span class="name">InputComponent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> MessageComponent <span class="keyword">from</span> <span class="string">&quot;./components/Message&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> InputComponent <span class="keyword">from</span> <span class="string">&quot;./components/Input&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Store <span class="keyword">from</span> <span class="string">&quot;./store/MyStore&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;app&quot;</span>,</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      MessageComponent,</span><br><span class="line">      InputComponent,</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    store: Store, <span class="comment">// store init</span></span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a>Getter</h3><p>ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë˜‘ê°™ì€ ë°©ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¡°ì‘í•´ì•¼í•  ê²½ìš° copy/pasteí•´ë„ ë˜ì§€ë§Œ ìœ ì§€</p><p>ê´€ë¦¬í•  ë•Œ ê³¨ì¹˜ ì•„í”„ë¯€ë¡œ ì´ëŸ¬í•œ ì¼€ì´ìŠ¤ë¥¼ ìœ„í•´ Getterë¥¼ ì§€ì›ì„ í•œë‹¤.</p><p><strong>MyStore.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">const</span> getters = &#123;</span><br><span class="line">  lowerCase(state) &#123;</span><br><span class="line">    <span class="keyword">return</span> state.msg.toLowerCase(); <span class="comment">// ë°ì´í„°ë¥¼ ëª¨ë‘ ì†Œë¬¸ìë¡œ ë°”ê¿ˆ</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state,</span><br><span class="line">  mutations,</span><br><span class="line">  getters,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    computed: &#123;</span><br><span class="line">      msg() &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// return this.$store.state.msg;</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">this</span>.$store.getters.lowerCase; <span class="comment">// getter í˜¸ì¶œ</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ë˜ëŠ”</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; mapGetters &#125; <span class="keyword">from</span> <span class="string">&quot;vuex&quot;</span>; <span class="comment">// helper, ë‚´ê°€ ë§Œë“  getter ë“¤ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    computed: &#123;</span><br><span class="line">      ...mapGetters(&#123;</span><br><span class="line"><span class="javascript">        msg: <span class="string">&quot;lowerCase&quot;</span>,</span></span><br><span class="line">      &#125;),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ì´ëŸ¬ë©´ inputì— ëŒ€ë¬¸ìë¡œ ì…ë ¥í•´ë„ ìë™ìœ¼ë¡œ ì†Œë¬¸ìë¡œ ë°”ë€Œì–´ì„œ ë³¼ ìˆ˜ ìˆë‹¤.</p><p>ì‘ì€ ê·œëª¨ë¼ë„ ê¸°ì¡´ì— ì•Œê³  ìˆëŠ” props, $emit ë³´ë‹¤ Vuexê°€ ë” ê¹”ë”í•œ ëŠë‚Œì´ ë“ ë‹¤.</p><p>ë‹¤ìŒ ì—°ìŠµ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì¨ë´ì•¼ê² ë‹¤.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://vuex.vuejs.org/kr/">Vuex ë¬¸ì„œ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueë¡œ ë‚˜ë§Œì˜ ìº˜ë¦°ë” ë§Œë“¤ì–´ë³´ê¸° - 3</title>
      <link href="/2020/09/11/nodejs-vue-study-4/"/>
      <url>/2020/09/11/nodejs-vue-study-4/</url>
      
        <content type="html"><![CDATA[<h2 id="ë‚´ê°€-ë“±ë¡í•œ-ì¼ì •-ë¦¬ìŠ¤íŠ¸-ë§Œë“¤ê¸°"><a href="#ë‚´ê°€-ë“±ë¡í•œ-ì¼ì •-ë¦¬ìŠ¤íŠ¸-ë§Œë“¤ê¸°" class="headerlink" title="ë‚´ê°€ ë“±ë¡í•œ ì¼ì • ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°"></a>ë‚´ê°€ ë“±ë¡í•œ ì¼ì • ë¦¬ìŠ¤íŠ¸ ë§Œë“¤ê¸°</h2><p><strong>Main.vue</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ Calendar.vue</span><br><span class="line">â”‚   â”œâ”€â”€ Modal.Vue</span><br><span class="line">â”œâ”€â”€ TodoList.vue</span><br></pre></td></tr></table></figure><p>TodoList ì»´í¬ë„ŒíŠ¸ë¥¼ ìƒì„± í•˜ì˜€ê³  ì´ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì„œë²„ì— ì €ì¥ëœ ì¼ì •ì„ ê°€ì§€ê³  ì˜¤ë ¤ê³ </p><p>í•˜ì˜€ìœ¼ë‚˜ ê²€ìƒ‰í•  ì¡°ê±´ì˜ ë°ì´í„°(ë…„,ì›”)ë¥¼ ê°€ì§€ê³  ìˆì§€ ì•Šì•„ì„œ ê²€ìƒ‰ì„ í•  ìˆ˜ê°€ ì—†ì—ˆë‹¤.</p><p>ê·¸ë˜ì„œ ë…„,ì›”ì˜ ë°ì´í„°ë¥¼ Calendar -&gt; Main -&gt; TodoListì˜ ë°©ì‹ìœ¼ë¡œ ì§„í–‰ì„ í•˜ì˜€ëŠ”ë°</p><p>Mainì—ì„œëŠ” mounted ë‹¨ê³„ì—ì„œ $emití•œ ë°ì´í„°ì— ì ‘ê·¼ì´ ê°€ëŠ¥ í–ˆì§€ë§Œ TodoListì—ì„œëŠ”</p><p>propsì— ë°ì´í„°ê°€ ë“¤ì–´ì˜¤ëŠ” ê±¸ ë·° ê°œë°œì ë„êµ¬ë¥¼ í†µí•´ í™•ì¸ í–ˆì§€ë§Œ mounted ì´ì „ì— ë°ì´í„° ì ‘ê·¼</p><p>ì´ ì•ˆ ë˜ëŠ” ê±¸ ì•Œì•˜ê³  Mainì—ì„œ ì„œë²„ì— ë°ì´í„°ë¥¼ ìš”ì²­í•œ ë‹¤ìŒ TodoListì— ì¤˜ì•¼ ëœë‹¤ê³  ëŠê¼ˆë‹¤.</p><p>ì˜ˆìƒí•œëŒ€ë¡œ Mainì—ì„œ $emitì„ ë°›ì•„ì˜¤ëŠ” ë¶€ë¶„ì— axiosë¡œ ì„œë²„ ë°ì´í„°ë¥¼ ë°›ì•„ ì˜¤ë‹ˆ ë·° ë°˜ì‘ì„±ë„</p><p>ì ìš© ë˜ê³  ì›í•˜ëŠ” ê·¸ë¦¼ìœ¼ë¡œ ë°ì´í„°ê°€ ì¶œë ¥ì´ ë˜ì—ˆë‹¤.</p><h3 id="ê¸€-ë“±ë¡-ì‹œ-TodoListì—-ì¶œë ¥"><a href="#ê¸€-ë“±ë¡-ì‹œ-TodoListì—-ì¶œë ¥" class="headerlink" title="ê¸€ ë“±ë¡ ì‹œ TodoListì— ì¶œë ¥"></a>ê¸€ ë“±ë¡ ì‹œ TodoListì— ì¶œë ¥</h3><p>Modalì°½ì—ì„œ ê¸€ì„ ë“±ë¡ ì‹œ ì„œë²„ì— ì „ì†¡ì„ í•˜ë©´ì„œ í™”ë©´ì— ë°”ë¡œ ê·¸ë¦¬ë ¤ë©´ Main ì»´í¬ë„ŒíŠ¸ì—</p><p>ë°ì´í„°ë¥¼ ì „ì†¡ í•´ì•¼ í•˜ëŠ”ë° Modalì€ ìµœí•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—¬ì„œ ê±°ì³ ê°€ê¸°ì—” ë¶ˆí¸ í•˜ë¯€ë¡œ ì´ëŸ¬í•œ ë°©ë²•ì„</p><p>í•´ê²° í•˜ê¸° ìœ„í•´ì„œ ë³„ê°œì˜ ì»´í¬ë„ŒíŠ¸ to ì»´í¬ë„ŒíŠ¸ë¡œ í†µì‹ ì´ ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ ë²„ìŠ¤ë¥¼ ì´ìš© í•´ë´¤ë‹¤.</p><p><strong>middleware/eventbus.js</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> eventBus = <span class="keyword">new</span> Vue();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> eventBus;</span><br></pre></td></tr></table></figure><p><strong>modal.vue</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> eventBus <span class="keyword">from</span> <span class="string">&quot;../../middleware/eventbus&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ...</span></span></span><br><span class="line">    methods: &#123;</span><br><span class="line">      save() &#123;</span><br><span class="line"><span class="javascript">        <span class="comment">// ...  ì„œë²„ì— ì „ì†¡ í›„</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> data = &#123;</span></span><br><span class="line"><span class="javascript">          year: <span class="built_in">this</span>.year,</span></span><br><span class="line"><span class="javascript">          month: <span class="built_in">this</span>.month,</span></span><br><span class="line"><span class="javascript">          day: <span class="built_in">this</span>.clickDay,</span></span><br><span class="line"><span class="javascript">          message: <span class="built_in">this</span>.message,</span></span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        eventBus.$emit(<span class="string">&quot;addList&quot;</span>, data);</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Main.vue</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// ...</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> eventBus <span class="keyword">from</span> <span class="string">&quot;../../middleware/eventbus&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ...</span></span></span><br><span class="line">    created() &#123;</span><br><span class="line"><span class="javascript">      eventBus.$on(<span class="string">&quot;addList&quot;</span>, <span class="function">(<span class="params">payload</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="built_in">this</span>.list.length === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.list.push([payload]);</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.list[<span class="built_in">this</span>.list.length - <span class="number">1</span>].length &gt; <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.list.push([payload]);</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">this</span>.list[<span class="built_in">this</span>.list.length - <span class="number">1</span>].push(payload);</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ì´ë²¤íŠ¸ë²„ìŠ¤ë¥¼ í†µí•´ Modalì—ì„œ Mainì— ë°ì´í„°ë¥¼ ì „ì†¡í•˜ì—¬ ì¼ì • ë¦¬ìŠ¤íŠ¸ê°€ ë°”ë€Œë¯€ë¡œ ë°˜ì‘ì„±ìœ¼ë¡œ ì¸í•´</p><p>í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ TodoListì— ì˜ ë…¸ì¶œì´ ë˜ì—ˆë‹¤.</p><h2 id="ì¼ì •-ì‚­ì œ"><a href="#ì¼ì •-ì‚­ì œ" class="headerlink" title="ì¼ì • ì‚­ì œ"></a>ì¼ì • ì‚­ì œ</h2><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ì§€ë‚œ ì¼ì •ì„ ì‚­ì œí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ê³  í•œë‹¤.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;columns&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(items, idx) in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;idx&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;column&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item, subIdx) in items&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;subIdx&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;card-header&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;card-header-title&quot;</span>&gt;</span></span><br><span class="line">          &#123;&#123; item.year &#125;&#125;ë…„ &#123;&#123; item.month &#125;&#125;ì›” &#123;&#123; item.day &#125;&#125;ì¼</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;card-content&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span>&#123;&#123; item.message &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;card-footer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span></span></span><br><span class="line"><span class="tag">          <span class="attr">class</span>=<span class="string">&quot;card-footer-item button is-primary is-light&quot;</span></span></span><br><span class="line"><span class="tag">          @<span class="attr">click</span>=<span class="string">&quot;removeItem(idx, subIdx)&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br><span class="line">          ì‚­ì œ</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&quot;axios&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> eventBus <span class="keyword">from</span> <span class="string">&quot;../../middleware/eventbus&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;TodoList&quot;</span>,</span></span><br><span class="line"><span class="javascript">    props: [<span class="string">&quot;year&quot;</span>, <span class="string">&quot;month&quot;</span>, <span class="string">&quot;list&quot;</span>],</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        title: <span class="string">&quot;ë‚´ê°€ ë“±ë¡í•œ ì¼ì • ë¦¬ìŠ¤íŠ¸&quot;</span>,</span></span><br><span class="line"><span class="javascript">        datas: <span class="literal">null</span>,</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      removeItem(idx, subIdx) &#123;</span><br><span class="line">        axios</span><br><span class="line"><span class="javascript">          .delete(<span class="string">&quot;http://localhost:3000/remove&quot;</span>, &#123;</span></span><br><span class="line">            data: &#123;</span><br><span class="line"><span class="javascript">              <span class="comment">// eslint-disable-next-line no-underscore-dangle</span></span></span><br><span class="line"><span class="javascript">              id: <span class="built_in">this</span>.list[idx][subIdx]._id,</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;)</span><br><span class="line"><span class="javascript">          .then(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            eventBus.$emit(<span class="string">&quot;removeList&quot;</span>, &#123; idx, subIdx &#125;);</span></span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ë¨¼ì € ì„œë²„ì— ì‚­ì œë¥¼ ìš”ì²­í•œ ë‹¤ìŒ ì™„ë£Œê°€ ë˜ë©´ ì´ë²¤íŠ¸ ë²„ìŠ¤ë¡œ ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ê´€í•˜ê³  ìˆëŠ” Mainì—</p><p>í†µì‹ ì„ í•˜ì—¬ í•´ë‹¹ ìœ„ì¹˜ì˜ ê°’ì„ ë°°ì—´ì—ì„œ ì‚­ì œë¥¼ í•´ì£¼ì—ˆë”ë‹ˆ í™”ë©´ì— ì ìš©ì´ ì˜ ë˜ì—ˆë‹¤.</p><p>ì´ë¡œì„œ Vue ì°ë¨¹? í•´ ë³¸ ëŠë‚Œì¸ë° ì•„ì§ì€ jQueryë‚˜ EJSì— ë¹„í•´ ìµìˆ™í•˜ì§€ ì•Šë‹¤ ë³´ë‹ˆ.. ğŸ˜“</p><p>ë‹¤ìŒ í”„ë¡œì íŠ¸ì—ì„œ Vue-Router &amp; Vuexë¥¼ ê³µë¶€í•´ì„œ ì—°ìŠµ í•´ë´ì•¼ê² ë‹¤!</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://webruden.tistory.com/109">vue.js Event Busë¥¼ í†µí•´ ì»´í¬ë„ŒíŠ¸ê°„ í†µì‹ í•˜ê¸° - ë² ì´ìŠ¤ìº í”„</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueë¡œ ë‚˜ë§Œì˜ ìº˜ë¦°ë” ë§Œë“¤ì–´ë³´ê¸° - 2</title>
      <link href="/2020/09/04/nodejs-vue-study-3/"/>
      <url>/2020/09/04/nodejs-vue-study-3/</url>
      
        <content type="html"><![CDATA[<h2 id="ì¼ì •-ë“±ë¡"><a href="#ì¼ì •-ë“±ë¡" class="headerlink" title="ì¼ì • ë“±ë¡"></a>ì¼ì • ë“±ë¡</h2><p>ì¼ì • ë“±ë¡ì€ ë‹¬ë ¥ì˜ ë‚ ì§œë¥¼ í´ë¦­ ì‹œ modalì°½ì´ ë‚˜ì™€ì„œ ì…ë ¥ì„ í•˜ê²Œë” ë§Œë“¤ê³  ì‹¶ì–´ì¡Œë‹¤.</p><p>css í”„ë ˆì„ì›Œí¬ì— modal exampleì´ ë‚˜ì™€ ìˆëŠ”ë° classì˜ ê°’ë§Œ ì£¼ë©´ ë˜ëŠ” ìƒí™© ì´ì˜€ë‹¤.</p><p><strong>Model.vue</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-background&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-card&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;modal-card-head&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;modal-card-title&quot;</span>&gt;</span>ë‚ ì§œ<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;delete&quot;</span> <span class="attr">aria-label</span>=<span class="string">&quot;close&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;modal-card-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">class</span>=<span class="string">&quot;textarea&quot;</span> <span class="attr">:placeholder</span>=<span class="string">&quot;placeholder&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;modal-card-foot&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button is-success&quot;</span>&gt;</span>&#123;&#123; buttonMessage[0] &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span>&gt;</span>&#123;&#123; buttonMessage[1] &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        placeholder: <span class="string">&quot;ì˜¤ëŠ˜ í•  ì¼ì„ ì ì–´ì£¼ì„¸ìš”&quot;</span>,</span></span><br><span class="line"><span class="javascript">        buttonMessage: [<span class="string">&quot;ì €ì¥&quot;</span>, <span class="string">&quot;ì·¨ì†Œ&quot;</span>],</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ì–´ì œ ì‘ì„± í–ˆì—ˆë˜ Calendar.vueì— Modal.vueë¥¼ import ì‹œì¼œì„œ Modal.vueëŠ” í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ê°€ ë˜ì—ˆìœ¼ë¯€ë¡œ</p><p>ìƒìœ„ ì»´í¬ë„ŒíŠ¸(Calendar.vue)ì—ì„œ modalì˜ ì˜¤í”ˆ ìƒíƒœë¥¼ ê°€ì§€ê³  ìˆì–´ì•¼ í–ˆìœ¼ë©°, modalì„ ì—´ê¸° ìœ„í•´</p><p>í•˜ìœ„ ì»´í¬ë„ŒíŠ¸(Modal.vue)ì— ë°ì´í„°ë¥¼ ë³´ë‚¼ë ¤ë©´ propsë¥¼ ì´ìš© í•´ì•¼ í–ˆê³ , ê·¸ ë°˜ëŒ€ë¡œ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ</p><p>modal ì°½ì„ ë‹«ìœ¼ë©´ ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì— modalì´ ë‹«í˜”ë‹¤ë¡œ ìƒíƒœë¥¼ ë³€ê²½ì„ í•´ì£¼ê¸° ìœ„í•´ì„œ $emitì„ ì‚¬ìš© í–ˆë‹¤.</p><p><strong>Calendar.vue</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-for</span>=<span class="string">&quot;(day, secondIdx) in date&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">&quot;secondIdx&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:class</span>=<span class="string">&quot;&#123;</span></span></span><br><span class="line"><span class="tag"><span class="string">                &#x27;has-text-grey&#x27;: idx === 0 &amp;&amp; day &gt;= lastMonthStart,</span></span></span><br><span class="line"><span class="tag"><span class="string">                &#x27;has-text-danger&#x27;:</span></span></span><br><span class="line"><span class="tag"><span class="string">                  dates.length - 1 === idx &amp;&amp; nextMonthStart &gt; day,</span></span></span><br><span class="line"><span class="tag"><span class="string">                &#x27;has-text-primary&#x27;:</span></span></span><br><span class="line"><span class="tag"><span class="string">                  day === today &amp;&amp;</span></span></span><br><span class="line"><span class="tag"><span class="string">                  month === currentMonth &amp;&amp;</span></span></span><br><span class="line"><span class="tag"><span class="string">                  year === currentYear,</span></span></span><br><span class="line"><span class="tag"><span class="string">              &#125;&quot;</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">&quot;showModal&quot;</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    &#123;&#123; day &#125;&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">Modal</span> <span class="attr">v-bind:modalOpen</span>=<span class="string">&quot;modalOpen&quot;</span> <span class="attr">v-on:closeModal</span>=<span class="string">&quot;closeModal&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">Modal</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Modal <span class="keyword">from</span> <span class="string">&#x27;./Modal&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    ...</span><br><span class="line">    components: &#123;</span><br><span class="line">      Modal,</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      ...</span><br><span class="line"><span class="javascript">      modalOpen: <span class="literal">false</span>,</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      ...</span><br><span class="line">      showModal() &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.modalOpen = <span class="literal">true</span>;</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      closeModal(event) &#123; <span class="comment">// eventëŠ” $emitì˜ value</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.modalOpen = event;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>Modal.vue</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;&#x27;is-active&#x27;: modalOpen&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;modal-background&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;closeModal&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;Modal&quot;</span>,</span></span><br><span class="line"><span class="javascript">    props: [<span class="string">&quot;modalOpen&quot;</span>],</span></span><br><span class="line">    data() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        placeholder: <span class="string">&quot;ì˜¤ëŠ˜ í•  ì¼ì„ ì ì–´ì£¼ì„¸ìš”&quot;</span>,</span></span><br><span class="line"><span class="javascript">        buttonMessage: [<span class="string">&quot;ì €ì¥&quot;</span>, <span class="string">&quot;ì·¨ì†Œ&quot;</span>],</span></span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      closeModal() &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$emit(<span class="string">&quot;closeModal&quot;</span>, <span class="literal">false</span>); <span class="comment">// $emit(&#x27;ì´ë²¤íŠ¸ëª…&#x27;, value)</span></span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ê¸€-ë“±ë¡"><a href="#ê¸€-ë“±ë¡" class="headerlink" title="ê¸€ ë“±ë¡"></a>ê¸€ ë“±ë¡</h2><p>v-model ì§€ì‹œìë¥¼ ì¨ì„œ ê¸€ì„ ì‘ì„± í•´ë´¤ìœ¼ë‚˜ í•œê¸€ì€ ë ë‹¨ì–´ ë°”ì¸ë”©ì´ ì •ìƒì ìœ¼ë¡œ ë˜ì§ˆ ì•Šì•„ì„œ</p><p>ê²€ìƒ‰ì„ í•´ ë´¤ë”ë‹ˆ Vue ê³µì‹ë¬¸ì„œì—ë„ ë‚˜ì™€ ìˆëŠ” ì‚¬ì–‘ì´ë¼ê³  í•œë‹¤.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;modal-card-body&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">textarea</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;textarea&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:placeholder</span>=<span class="string">&quot;placeholder&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">input</span>=<span class="string">&quot;typing&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:value</span>=<span class="string">&quot;message&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- v-input(@input), v-bind(:) ì§€ì‹œìë¥¼ í†µí•´ ê°€ëŠ¥ --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    ...</span><br><span class="line">    methods: &#123;</span><br><span class="line">      typing(event) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.message = event.target.value;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      ...</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ì‘ì„±í•œ ê¸€ì„ ì„œë²„ì— ë³´ë‚´ì„œ DBì— ì €ì¥ì„ í•˜ë ¤ê³  í•˜ë©´ í†µì‹ ì„ ë³´ë‚´ì•¼ í•˜ëŠ”ë°</p><p>Vueì—ì„œëŠ” axiosë¥¼ ì“´ë‹¤ê³  í•˜ê¸¸ë˜ ë‚˜ëŠ” ê¸°ì¡´ì—ë„ ìì£¼ ì‚¬ìš©í•˜ë˜ HTTP í´ë¼ì´ì–¸íŠ¸ë¼ ì¢‹ì•˜ë‹¤.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line">  <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;modal-card-foot&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button is-primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;save&quot;</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- ì €ì¥ í´ë¦­ ì´ë²¤íŠ¸ --&gt;</span></span><br><span class="line">      &#123;&#123; buttonMessage[0] &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;closeModal&quot;</span>&gt;</span>&#123;&#123; buttonMessage[1] &#125;&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">    ...</span><br><span class="line">     methods: &#123;</span><br><span class="line">      ...</span><br><span class="line">      save() &#123;</span><br><span class="line"><span class="javascript">        axios.post(<span class="string">&#x27;http://localhost:3000/save&#x27;</span>, &#123;</span></span><br><span class="line"><span class="javascript">          message: <span class="built_in">this</span>.message,</span></span><br><span class="line"><span class="javascript">          date: <span class="string">`<span class="subst">$&#123;<span class="built_in">this</span>.year&#125;</span>-<span class="subst">$&#123;<span class="built_in">this</span>.month&#125;</span>-<span class="subst">$&#123;<span class="built_in">this</span>.clickDay&#125;</span>`</span>,</span></span><br><span class="line"><span class="javascript">        &#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&#x27;result&#x27;</span>, result.data);</span></span><br><span class="line"><span class="javascript">        &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(<span class="string">&#x27;e&#x27;</span>, e);</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ë‹¤ìŒì—ëŠ” ì €ì¥ëœ ì¼ì •ì„ ë³¼ ìˆ˜ ìˆëŠ” ë¦¬ìŠ¤íŠ¸ë¥¼ ë§Œë“¤ì–´ì•¼ê² ë‹¤.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://medium.com/js-dojo/how-to-build-a-reusable-vuejs-modal-component-fc8d7f3b4735">How to build a Reusable Vuejs modal component</a></li><li><a href="https://solcode.tistory.com/31">vue.js - v-modelì˜ í•œê¸€ ì‚¬ìš© ë¬¸ì œë¥¼ v-onì„ ì‚¬ìš©í•œ í•´ê²°ë²•</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueë¡œ ë‚˜ë§Œì˜ ìº˜ë¦°ë” ë§Œë“¤ì–´ë³´ê¸° - 1</title>
      <link href="/2020/09/03/nodejs-vue-study-2/"/>
      <url>/2020/09/03/nodejs-vue-study-2/</url>
      
        <content type="html"><![CDATA[<h2 id="Project-ìƒì„±"><a href="#Project-ìƒì„±" class="headerlink" title="Project ìƒì„±"></a>Project ìƒì„±</h2><p>ì±…ì—ì„œ ë³´ê³  ì„¤ì¹˜ í–ˆì—ˆë˜ CLIê°€ í˜„ì¬ ë²„ì „ë³´ë‹¤ ê½¤ ë§ì´ ë‚®ì•„ì„œ ìƒˆë¡œìš´ ë²„ì „ìœ¼ë¡œ êµì²´ë¥¼ í•˜ì˜€ë‹¤.</p><p>ìƒˆ ë²„ì „ì€ vue createë¡œ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì—ˆëŠ”ë° ì•„ì§ ì´ì „ ë²„ì „ë„ ì•ˆ ì¨ë´¤ìœ¼ë¯€ë¡œ</p><p>ì´ì „ ë²„ì „ì—ì„œ ì œê³µí•˜ëŠ” ê±¸ë¡œ ì§„í–‰ì„ í–ˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall vue-cli -g</span><br><span class="line">npm i @vue/cli -g</span><br><span class="line">npm i @vue/cli-init <span class="comment"># ì´ì „ 2.x í…œí”Œë¦¿ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•¨</span></span><br><span class="line">vue init webpack my_calendar_app</span><br></pre></td></tr></table></figure><h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2><p>CSS í”„ë ˆì„ì›Œí¬ë¥¼ ì“°ê³  ì‹¶ì–´ì„œ <a href="https://bulma.io/">bulma</a>ë¥¼ ì„¤ì¹˜ í–ˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i bulma -S</span><br></pre></td></tr></table></figure><p>ê¸€ë¡œë²Œ CSSëŠ” src/App.vueì— importë¥¼ í•˜ë©´ ë˜ì—ˆë‹¤.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> <span class="string">&quot;bulma/css/bulma.css&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;App&quot;</span>,</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="prettierrc-js"><a href="#prettierrc-js" class="headerlink" title=".prettierrc.js"></a>.prettierrc.js</h2><p>ìë™ ì¤„ë§ì¶¤ìœ¼ë¡œ prettierë¥¼ ì“°ê³  ìˆëŠ”ë° ì¤„ë§ì¶¤í•  ë•Œë§ˆë‹¤ scriptì— â€˜ê°€ â€œë¡œ ë³€í™˜ ë˜ê³ </p><p>ë§ˆì§€ë§‰ ,ê°€ ì‚¬ë¼ì ¸ì„œ lintì— ê±¸ë ¤ ê°€ì§€ê³  ê³ í†µ ë°›ë‹¤ê°€ ê²€ìƒ‰ì„ í†µí•´ í•´ê²°ë²•ì„ ì°¾ìŒ</p><p><strong>.prettierrc.js</strong> ìƒì„±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  singleQuote: <span class="literal">true</span>,</span><br><span class="line">  trailingComma: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ë‹¬ë ¥-ë§Œë“¤ê¸°"><a href="#ë‹¬ë ¥-ë§Œë“¤ê¸°" class="headerlink" title="ë‹¬ë ¥ ë§Œë“¤ê¸°"></a>ë‹¬ë ¥ ë§Œë“¤ê¸°</h2><p>ì´ì „ì— date-pickerë“±ì€ ìì£¼ ì¨ë´¤ìœ¼ë‚˜ ë‹¬ë ¥ êµ¬í˜„ì€ ì´ë²ˆì´ ì²˜ìŒì´ì˜€ë‹¤.</p><p>ë¨¼ì € ìš”ì¼ì„ ê³ ì •ì´ë‹ˆ ë°˜ë³µë¬¸ì´ í•„ìš” í–ˆëŠ”ë° v-for ì§€ì‹œìë¥¼ í†µí•´ í…Œì´ë¸”ì˜ í—¤ë”ì— ì‚½ì… í•˜ì˜€ë‹¤.</p><p>ì±…ì—ì„œ í•™ìŠµ í•  ë•ŒëŠ” v-forë§Œ ì ì—ˆì—ˆëŠ”ë° keyë¼ëŠ” ì†ì„±ì„ ì•ˆ ë„£ì–´ì£¼ë©´ lint ì˜¤ë¥˜ê°€ ë–´ì—ˆë‹¤.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table has-text-centered is-fullwidth&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">th</span> <span class="attr">v-for</span>=<span class="string">&quot;day in days&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;day&quot;</span>&gt;</span>&#123;&#123; day &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      days: [</span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ì¼ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ì›”ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;í™”ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ìˆ˜ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ëª©ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ê¸ˆìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;í† ìš”ì¼&#x27;</span>,</span></span><br><span class="line">      ],</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ë‹¬ë ¥ì˜ ë‚ ì§œë“¤ì„ ì–´ë–»ê²Œ êµ¬í• ì§€ ê³ ë¯¼ì„ í•˜ë‹¤ê°€ ì´ì°¨ì› ë°°ì—´ì— 1ì°¨ ë°°ì—´ì€ ì£¼ë¡œ ì¡ê³  2ì°¨ ë°°ì—´ì€</p><p>ë‚ ì§œë“¤ì„ ë‹´ìœ¼ë©´ ë˜ê² ë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆê³  ë‹¤ë¥¸ ìº˜ë¦°ë”ë¥¼ ë³´ë‹ˆ í…Œì´ë¸”ì— ê·¸ë¦´ ë•Œ 1ì¼ì´ </p><p>ì–´ëŠ ìš”ì¼ì—ì„œ ì‹œì‘ í•˜ëŠ”ì§€ ì•Œì•„ì•¼ í–ˆìœ¼ë©° ê·¸ ì „ì— ë‚¨ì€ ì…€ì´ ìˆë‹¤ë©´ ì €ë²ˆ ë‹¬ì˜ ë‚ ì§œë“¤ì„ </p><p>ì±„ì› ì–´ì•¼ í–ˆê³  ë§ˆì§€ë§‰ ì£¼ì— ë‚¨ì€ ì…€ì´ ìˆìœ¼ë©´ ë‹¤ìŒ ë‹¬ì˜ ë‚ ì§œë¥¼ ì±„ì› ì–´ì•¼ í–ˆë‹¤.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;subtitle has-text-centered&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; year &#125;&#125;ë…„ &#123;&#123; month &#125;&#125;ì›” <span class="comment">&lt;!-- í˜„ì¬ ë‹¬ë ¥ì˜ ë…„, ì›” í‘œì‹œ --&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table has-text-centered is-fullwidth&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">v-for</span>=<span class="string">&quot;day in days&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;day&quot;</span>&gt;</span>&#123;&#123; day &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;(date, idx) in dates&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;idx&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-for</span>=<span class="string">&quot;(day, secondIdx) in date&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;secondIdx&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">              &#123;&#123; day &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      days: [</span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ì¼ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ì›”ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;í™”ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ìˆ˜ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ëª©ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ê¸ˆìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;í† ìš”ì¼&#x27;</span>,</span></span><br><span class="line">      ],</span><br><span class="line">      dates: [],</span><br><span class="line">      currentYear: 0,</span><br><span class="line">      currentMonth: 0,</span><br><span class="line">      year: 0,</span><br><span class="line">      month: 0,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="javascript">  created() &#123; <span class="comment">// ë°ì´í„°ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•œ ì²« ë²ˆì§¸ ë¼ì´í”„ ì‚¬ì´í´</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span></span><br><span class="line"><span class="javascript">    <span class="built_in">this</span>.year = date.getFullYear();</span></span><br><span class="line"><span class="javascript">    <span class="built_in">this</span>.month = date.getMonth() + <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">this</span>.calendarData();</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    calendarData() &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> [</span></span><br><span class="line">        monthFirstDay,</span><br><span class="line">        monthLastDate,</span><br><span class="line">        lastMonthLastDate,</span><br><span class="line"><span class="javascript">      ] = <span class="built_in">this</span>.getFirstDayLastDate(<span class="built_in">this</span>.year, <span class="built_in">this</span>.month);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.dates = <span class="built_in">this</span>.getMonthOfDays(</span></span><br><span class="line">        monthFirstDay,</span><br><span class="line">        monthLastDate,</span><br><span class="line">        lastMonthLastDate,</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    getFirstDayLastDate(year, month) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> firstDay = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month - <span class="number">1</span>, <span class="number">1</span>).getDay(); <span class="comment">// ì´ë²ˆ ë‹¬ ì‹œì‘ ìš”ì¼</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> lastDate = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">0</span>).getDate(); <span class="comment">// ì´ë²ˆ ë‹¬ ë§ˆì§€ë§‰ ë‚ ì§œ</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> lastYear = year;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> lastMonth = month - <span class="number">1</span>;</span></span><br><span class="line">      if (month === 1) &#123;</span><br><span class="line">        lastMonth = 12;</span><br><span class="line">        lastYear -= 1;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> prevLastDate = <span class="keyword">new</span> <span class="built_in">Date</span>(lastYear, lastMonth, <span class="number">0</span>).getDate(); <span class="comment">// ì§€ë‚œ ë‹¬ ë§ˆì§€ë§‰ ë‚ ì§œ</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> [firstDay, lastDate, prevLastDate];</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getMonthOfDays(</span><br><span class="line">      monthFirstDay,</span><br><span class="line">      monthLastDate,</span><br><span class="line">      prevMonthLastDate,</span><br><span class="line">    ) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> day = <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> prevDay = (prevMonthLastDate - monthFirstDay) + <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> dates = [];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> weekOfDays = [];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">while</span> (day &lt;= monthLastDate) &#123;</span></span><br><span class="line">        if (day === 1) &#123;</span><br><span class="line"><span class="javascript">          <span class="comment">// 1ì¼ì´ ì–´ëŠ ìš”ì¼ì¸ì§€ì— ë”°ë¼ í…Œì´ë¸”ì— ê·¸ë¦¬ê¸° ìœ„í•œ ì§€ë‚œ ì…€ì˜ ë‚ ì§œë“¤ì„ êµ¬í•  í•„ìš”ê°€ ìˆë‹¤.</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; monthFirstDay; j += <span class="number">1</span>) &#123;</span></span><br><span class="line">            weekOfDays.push(prevDay);</span><br><span class="line">            prevDay += 1;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        weekOfDays.push(day);</span><br><span class="line">        if (weekOfDays.length === 7) &#123;</span><br><span class="line"><span class="javascript">          <span class="comment">// ì¼ì£¼ì¼ ì±„ìš°ë©´</span></span></span><br><span class="line">          dates.push(weekOfDays);</span><br><span class="line"><span class="javascript">          weekOfDays = []; <span class="comment">// ì´ˆê¸°í™”</span></span></span><br><span class="line">        &#125;</span><br><span class="line">        day += 1;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> len = weekOfDays.length;</span></span><br><span class="line">      if (len &gt; 0 &amp;&amp; len &lt; 7) &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">1</span>; k &lt;= <span class="number">7</span> - len; k += <span class="number">1</span>) &#123;</span></span><br><span class="line">          weekOfDays.push(k);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (weekOfDays.length &gt; <span class="number">0</span>) dates.push(weekOfDays); <span class="comment">// ë‚¨ì€ ë‚ ì§œ ì¶”ê°€</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> dates;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>íŠ¹ë³„í•  ê±° ì—†ì´ ì—¬ì „íˆ v-forë§Œì„ ì´ìš©í•´ì„œ ë‹¬ë ¥ì„ ê·¸ë¦¬ê¸°ê¹Œì§€ ì™„ì„± í•˜ì˜€ë‹¤.</p><p>ì´í›„ì—ëŠ” ë²„íŠ¼ì„ í†µí•´ ì´ì „ ë‹¬, ë‹¤ìŒ ë‹¬ì˜ ìº˜ë¦°ë”, ê·¸ë¦¬ê³  í˜„ì¬ ë‹¬ë ¥ì˜ ì˜¤ëŠ˜ ë‚ ì§œ, ì§€ë‚œ ë‹¬ì˜</p><p>ë‚ ì§œ, ë‹¤ìŒ ë‹¬ì˜ ë‚ ì§œë“¤ì€ ìƒ‰ê¹”ì„ ì£¼ê³  ì‹¶ì–´ì„œ ì‹œë„ë¥¼ í•´ ë³´ì•˜ë‹¤.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;section&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;subtitle has-text-centered&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button is-small is-primary is-outlined mr-5&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;calendarData(-1)&quot;</span>&gt;</span><span class="symbol">&amp;lt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        &#123;&#123; year &#125;&#125;ë…„ &#123;&#123; month &#125;&#125;ì›”</span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button is-small is-primary is-outlined ml-5&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;calendarData(1)&quot;</span>&gt;</span><span class="symbol">&amp;gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table has-text-centered is-fullwidth&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span> <span class="attr">v-for</span>=<span class="string">&quot;day in days&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;day&quot;</span>&gt;</span>&#123;&#123; day &#125;&#125;<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;(date, idx) in dates&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;idx&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span></span></span><br><span class="line"><span class="tag">              <span class="attr">v-for</span>=<span class="string">&quot;(day, secondIdx) in date&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:key</span>=<span class="string">&quot;secondIdx&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">:class</span>=<span class="string">&quot;&#123; &#x27;has-text-info-dark&#x27;: idx === 0 &amp;&amp; day &gt;= lastMonthStart,</span></span></span><br><span class="line"><span class="tag"><span class="string">              &#x27;has-text-danger&#x27;: dates.length - 1 === idx &amp;&amp; nextMonthStart &gt; day,</span></span></span><br><span class="line"><span class="tag"><span class="string">              &#x27;has-text-primary&#x27;: day === today &amp;&amp; month === currentMonth &amp;&amp; year === currentYear</span></span></span><br><span class="line"><span class="tag"><span class="string">              &#125;&quot;</span></span></span><br><span class="line"><span class="tag">            &gt;</span></span><br><span class="line">              &#123;&#123; day &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line">  data() &#123;</span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line">      days: [</span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ì¼ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ì›”ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;í™”ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ìˆ˜ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ëª©ìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;ê¸ˆìš”ì¼&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="string">&#x27;í† ìš”ì¼&#x27;</span>,</span></span><br><span class="line">      ],</span><br><span class="line">      dates: [],</span><br><span class="line">      currentYear: 0,</span><br><span class="line">      currentMonth: 0,</span><br><span class="line">      year: 0,</span><br><span class="line">      month: 0,</span><br><span class="line">      lastMonthStart: 0,</span><br><span class="line">      nextMonthStart: 0,</span><br><span class="line">      today: 0,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line"><span class="javascript">  created() &#123; <span class="comment">// ë°ì´í„°ì— ì ‘ê·¼ì´ ê°€ëŠ¥í•œ ì²« ë²ˆì§¸ ë¼ì´í”„ ì‚¬ì´í´</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span></span><br><span class="line"><span class="javascript">    <span class="built_in">this</span>.currentYear = date.getFullYear(); <span class="comment">// ì´í•˜ í˜„ì¬ ë…„, ì›” ê°€ì§€ê³  ìˆê¸°</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">this</span>.currentMonth = date.getMonth() + <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">this</span>.year = <span class="built_in">this</span>.currentYear;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">this</span>.month = <span class="built_in">this</span>.currentMonth;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">this</span>.today = date.getDate(); <span class="comment">// ì˜¤ëŠ˜ ë‚ ì§œ</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">this</span>.calendarData();</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line"><span class="javascript">    calendarData(arg) &#123; <span class="comment">// ì¸ìë¥¼ ì¶”ê°€</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (arg &lt; <span class="number">0</span>) &#123; <span class="comment">// -1ì´ ë“¤ì–´ì˜¤ë©´ ì§€ë‚œ ë‹¬ ë‹¬ë ¥ìœ¼ë¡œ ì´ë™</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.month -= <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arg === <span class="number">1</span>) &#123; <span class="comment">// 1ì´ ë“¤ì–´ì˜¤ë©´ ë‹¤ìŒ ë‹¬ ë‹¬ë ¥ìœ¼ë¡œ ì´ë™</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.month += <span class="number">1</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="built_in">this</span>.month === <span class="number">0</span>) &#123; <span class="comment">// ì‘ë…„ 12ì›”</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.year -= <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.month = <span class="number">12</span>;</span></span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.month &gt; <span class="number">12</span>) &#123; <span class="comment">// ë‚´ë…„ 1ì›”</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.year += <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.month = <span class="number">1</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> [</span></span><br><span class="line">        monthFirstDay,</span><br><span class="line">        monthLastDate,</span><br><span class="line">        lastMonthLastDate,</span><br><span class="line"><span class="javascript">      ] = <span class="built_in">this</span>.getFirstDayLastDate(<span class="built_in">this</span>.year, <span class="built_in">this</span>.month);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.dates = <span class="built_in">this</span>.getMonthOfDays(</span></span><br><span class="line">        monthFirstDay,</span><br><span class="line">        monthLastDate,</span><br><span class="line">        lastMonthLastDate,</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    getFirstDayLastDate(year, month) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> firstDay = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month - <span class="number">1</span>, <span class="number">1</span>).getDay(); <span class="comment">// ì´ë²ˆ ë‹¬ ì‹œì‘ ìš”ì¼</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> lastDate = <span class="keyword">new</span> <span class="built_in">Date</span>(year, month, <span class="number">0</span>).getDate(); <span class="comment">// ì´ë²ˆ ë‹¬ ë§ˆì§€ë§‰ ë‚ ì§œ</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> lastYear = year;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> lastMonth = month - <span class="number">1</span>;</span></span><br><span class="line">      if (month === 1) &#123;</span><br><span class="line">        lastMonth = 12;</span><br><span class="line">        lastYear -= 1;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> prevLastDate = <span class="keyword">new</span> <span class="built_in">Date</span>(lastYear, lastMonth, <span class="number">0</span>).getDate(); <span class="comment">// ì§€ë‚œ ë‹¬ ë§ˆì§€ë§‰ ë‚ ì§œ</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> [firstDay, lastDate, prevLastDate];</span></span><br><span class="line">    &#125;,</span><br><span class="line">    getMonthOfDays(</span><br><span class="line">      monthFirstDay,</span><br><span class="line">      monthLastDate,</span><br><span class="line">      prevMonthLastDate,</span><br><span class="line">    ) &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> day = <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> prevDay = (prevMonthLastDate - monthFirstDay) + <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> dates = [];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> weekOfDays = [];</span></span><br><span class="line"><span class="javascript">      <span class="keyword">while</span> (day &lt;= monthLastDate) &#123;</span></span><br><span class="line">        if (day === 1) &#123;</span><br><span class="line"><span class="javascript">          <span class="comment">// 1ì¼ì´ ì–´ëŠ ìš”ì¼ì¸ì§€ì— ë”°ë¼ í…Œì´ë¸”ì— ê·¸ë¦¬ê¸° ìœ„í•œ ì§€ë‚œ ì…€ì˜ ë‚ ì§œë“¤ì„ êµ¬í•  í•„ìš”ê°€ ìˆë‹¤.</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; monthFirstDay; j += <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (j === <span class="number">0</span>) <span class="built_in">this</span>.lastMonthStart = prevDay; <span class="comment">// ì§€ë‚œ ë‹¬ì—ì„œ ì œì¼ ì‘ì€ ë‚ ì§œ</span></span></span><br><span class="line">            weekOfDays.push(prevDay);</span><br><span class="line">            prevDay += 1;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        weekOfDays.push(day);</span><br><span class="line">        if (weekOfDays.length === 7) &#123;</span><br><span class="line"><span class="javascript">          <span class="comment">// ì¼ì£¼ì¼ ì±„ìš°ë©´</span></span></span><br><span class="line">          dates.push(weekOfDays);</span><br><span class="line"><span class="javascript">          weekOfDays = []; <span class="comment">// ì´ˆê¸°í™”</span></span></span><br><span class="line">        &#125;</span><br><span class="line">        day += 1;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> len = weekOfDays.length;</span></span><br><span class="line">      if (len &gt; 0 &amp;&amp; len &lt; 7) &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">let</span> k = <span class="number">1</span>; k &lt;= <span class="number">7</span> - len; k += <span class="number">1</span>) &#123;</span></span><br><span class="line">          weekOfDays.push(k);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (weekOfDays.length &gt; <span class="number">0</span>) dates.push(weekOfDays); <span class="comment">// ë‚¨ì€ ë‚ ì§œ ì¶”ê°€</span></span></span><br><span class="line"><span class="javascript">      <span class="built_in">this</span>.nextMonthStart = weekOfDays[<span class="number">0</span>]; <span class="comment">// ì´ë²ˆ ë‹¬ ë§ˆì§€ë§‰ ì£¼ì—ì„œ ì œì¼ ì‘ì€ ë‚ ì§œ</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> dates;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>í´ë˜ìŠ¤ë¥¼ ì œì–´í•˜ê¸° ìœ„í•´ì„œëŠ” :class ì§€ì‹œìë¥¼ ì‚¬ìš© í–ˆë‹¤.</p><p>ì˜¤ëŠ˜ ë‚ ì§œëŠ” ë³„ë„ë¡œ ê°€ì§€ê³  ìˆë‹¤ê°€ í•´ë‹¹ ì¡°ê±´ì¼ ë•Œë§Œ ìƒ‰ì„ ë³€ê²½ í•˜ì˜€ê³ , í˜„ì¬ ë‹¬ë ¥ì—ì„œ ì§€ë‚œ ë‹¬ì˜</p><p>ë‚ ì§œëŠ” ì²« ì£¼ì—ì„œë§Œ ê°€ì§€ê³  ìˆìœ¼ë‹ˆ ì²« ì£¼ì˜ ì œì¼ ì‘ì€ ìˆ˜ë¥¼ ê°€ì§€ê³  ìˆë‹¤ê°€ ê·¸ ìˆ˜ë³´ë‹¤ í° ê²½ìš°ì—ë§Œ</p><p>ìƒ‰ì„ ë³€ê²½í•´ ì£¼ì—ˆê³  ë§ˆì°¬ê°€ì§€ë¡œ í˜„ì¬ ë‹¬ë ¥ì—ì„œ ë‹¤ìŒ ë‹¬ì˜ ë‚ ì§œëŠ” ë§ˆì§€ë§‰ ì£¼ì—ì„œ 0ë²ˆì§¸ì˜ ë‚ ì§œë¥¼</p><p>ê°€ì§€ê³  ìˆë‹¤ê°€ ê·¸ ìˆ˜ë³´ë‹¤ ì‘ì€ ê²½ìš°ì—ë§Œ ìƒ‰ì„ ë³€ê²½í•´ ì£¼ì—ˆë‹¤.</p><p>ë‹¤ìŒ ëª©í‘œë¡œëŠ” ì¼ì •ì„ ì¶”ê°€ í•˜ê³  ë³¼ ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ ë´ì•¼ ê² ë‹¤.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><p><a href="https://kdydesign.github.io/2019/04/22/vue-cli3-tutorial/">[Vue.JS] Vue-CLI 3 ì‹œì‘í•˜ê¸°</a><br><a href="https://github.com/vuejs/vetur/issues/986">Single quotes are being replaced with double quotes</a></p><pre><code></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.js ê¸°ë³¸ ê°œë… ì •ë¦¬</title>
      <link href="/2020/09/01/nodejs-vue-study-1/"/>
      <url>/2020/09/01/nodejs-vue-study-1/</url>
      
        <content type="html"><![CDATA[<p><a href="http://www.easyspub.co.kr/20_Menu/BookView/PUB/185/PUB">Do it! Vue.js ì…ë¬¸</a>ì„ ì½ì–´ë³´ë©´ì„œ ì •ë¦¬í•œ ê¸€</p><h2 id="Vue-jsë€"><a href="#Vue-jsë€" class="headerlink" title="Vue.jsë€"></a>Vue.jsë€</h2><p>ì›¹ í˜ì´ì§€ í™”ë©´ì„ ê°œë°œí•˜ê¸° ìœ„í•œ í”„ë¡ íŠ¸ì—”ë“œ í”„ë ˆì„ì›Œí¬</p><h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><p>í”„ë¡ íŠ¸ì—”ë“œì˜ í™”ë©´ ë™ì‘ê³¼ ê´€ë ¨ëœ ë¡œì§ê³¼ ë°±ì—”ë“œì˜ ë°ì´í„° ì²˜ë¦¬ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬</p><p>ê°œë°œí•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ë””ìì¸ íŒ¨í„´</p><p>MVVMì€ Model, View, ViewModelë¡œ êµ¬ì„± ë˜ì–´ ìˆë‹¤.</p><ul><li>Modelì€ ì„œë²„ì—ì„œ ê°€ì§€ê³  ì˜¨ ë°ì´í„°ë¥¼ ë³´ê´€</li><li>ViewëŠ” ì‚¬ìš©ìì—ê²Œ ë³´ì´ëŠ” í™”ë©´</li><li>ViewModelì€ ë°ì´í„° ë°”ì¸ë”©(Viewì— í‘œì‹œí•  ë‚´ìš©ê³¼ Modelì˜ ë°ì´í„°ë¥¼ ë™ê¸°í™”), ë” ë¦¬ìŠ¤ë„ˆ(Viewì˜ ë³€ê²½ ë‚´ì—­ì— ë°˜ì‘í•˜ì—¬ íŠ¹ì • ë¡œì§ ìˆ˜í–‰)ì˜ ì—­í• ì„ í•˜ë©° Vue ê°™ì€ í”„ë ˆì„ì›Œí¬ê°€ ë§¡ëŠ” ì—­í• </li></ul><h2 id="ë·°-ì¸ìŠ¤í„´ìŠ¤"><a href="#ë·°-ì¸ìŠ¤í„´ìŠ¤" class="headerlink" title="ë·° ì¸ìŠ¤í„´ìŠ¤"></a>ë·° ì¸ìŠ¤í„´ìŠ¤</h2><p>Vueë¡œ í™”ë©´ì„ ê°œë°œí•˜ê¸° ìœ„í•´ í•„ìˆ˜ì ìœ¼ë¡œ ìƒì„±í•´ì•¼ í•˜ëŠ” ê¸°ë³¸ ë‹¨ìœ„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Vue(&#123; <span class="comment">// &lt;- ì¸ìŠ¤í„´ìŠ¤</span></span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>, <span class="comment">// ì¸ìŠ¤í„´ìŠ¤ ë²”ìœ„ ì§€ì •</span></span><br><span class="line">  ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="ì¸ìŠ¤í„´ìŠ¤-ë¼ì´í”„-ì‚¬ì´í´"><a href="#ì¸ìŠ¤í„´ìŠ¤-ë¼ì´í”„-ì‚¬ì´í´" class="headerlink" title="ì¸ìŠ¤í„´ìŠ¤ ë¼ì´í”„ ì‚¬ì´í´"></a>ì¸ìŠ¤í„´ìŠ¤ ë¼ì´í”„ ì‚¬ì´í´</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±</span><br><span class="line">|â”€â”€â”€â”€ ì´ë²¤íŠ¸ ë° ë¼ì´í”„ ì‚¬ì´í´ ì´ˆê¸°í™”</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€ beforeCreate</span><br><span class="line">|â”€â”€â”€â”€ í™”ë©´ì— ë°˜ì‘ì„± ì£¼ì…</span><br><span class="line">|â”€â”€â”€â”€â”€â”€â”€â”€ created</span><br><span class="line">|â”€â”€â”€â”€ el, template ì†ì„± í™•ì¸</span><br><span class="line">|â”€â”€â”€â”€ template ì†ì„± ë‚´ìš©ì„ render()ë¡œ ë³€í™˜</span><br><span class="line">|â”€â”€â”€â”€â”€â”€â”€â”€ beforeMount</span><br><span class="line">|â”€â”€â”€â”€ $el ìƒì„± í›„ el ì†ì„± ê°’ì„ ëŒ€ì…</span><br><span class="line">|â”€â”€â”€â”€â”€â”€â”€â”€ mounted</span><br><span class="line">|â”€â”€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í™”ë©´ì— ë¶€ì°©</span><br><span class="line">|â”€â”€â”€â”€ ì¸ìŠ¤í„´ìŠ¤ì˜ ë°ì´í„° ë³€ê²½ (ì—¬ê¸°ë¶€í„°ëŠ” ë°ì´í„°ê°€ ë³€ê²½ë˜ëŠ” ê²½ìš°ì—ë§Œ)</span><br><span class="line">|â”€â”€â”€â”€â”€â”€â”€â”€ beforeUpdate</span><br><span class="line">|â”€â”€â”€â”€ í™”ë©´ ì¬ ë Œë”ë§ ë° ë°ì´í„° ê°±ì‹ </span><br><span class="line">|â”€â”€â”€â”€â”€â”€â”€â”€ updated (ì—¬ê¸°ê¹Œì§€)</span><br><span class="line">â”œâ”€â”€ ì¸ìŠ¤í„´ìŠ¤ ë‚´ìš© ê°±ì‹ </span><br><span class="line">|â”€â”€â”€â”€ ì¸ìŠ¤í„´ìŠ¤ ì ‘ê·¼ ê°€ëŠ¥</span><br><span class="line">|â”€â”€â”€â”€â”€â”€â”€â”€ beforeDestroy</span><br><span class="line">|â”€â”€â”€â”€ ì»´í¬ë„ŒíŠ¸, ì¸ìŠ¤í„´ìŠ¤, ë””ë ‰í‹°ë¸Œë“± ëª¨ë‘ í•´ì œ</span><br><span class="line">|â”€â”€â”€â”€â”€â”€â”€â”€ destroyed</span><br><span class="line">â”œâ”€â”€ ì¸ìŠ¤í„´ìŠ¤ ì†Œë©¸</span><br></pre></td></tr></table></figure><h3 id="beforeCreate"><a href="#beforeCreate" class="headerlink" title="beforeCreate"></a>beforeCreate</h3><p>ê°€ì • ì²˜ìŒ ì‹¤í–‰ë˜ëŠ” ë¼ì´í”„ ì‚¬ì´í´ ë‹¨ê³„ì´ë©° ì¸ìŠ¤í„´ìŠ¤ì˜ ì†ì„±ê³¼ í™”ë©´ ìš”ì†Œì— ì ‘ê·¼ ë¶ˆê°€</p><h3 id="created"><a href="#created" class="headerlink" title="created"></a>created</h3><p>ì¸ìŠ¤í„´ìŠ¤ì˜ ì†ì„±ì—ëŠ” ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‚˜, í™”ë©´ ìš”ì†Œì—ëŠ” ì ‘ê·¼ ë¶ˆê°€</p><p>ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ìš”ì²­í•  ë•Œ ì‚¬ìš©</p><h3 id="beforeMount"><a href="#beforeMount" class="headerlink" title="beforeMount"></a>beforeMount</h3><p>ì¸ìŠ¤í„´ìŠ¤ê°€ í™”ë©´ì— ë¶€ì°©í•˜ê¸° ì „ ë‹¨ê³„ì´ë©° renderí•¨ìˆ˜(ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ í™”ë©´ì˜ domì„ ê·¸ë¦¬ëŠ”)</p><p>í˜¸ì¶œë˜ê¸° ì§ì „ì˜ ë¡œì§ ì²˜ë¦¬ ìš©ë„ë¡œ ì‚¬ìš©</p><h3 id="mounted"><a href="#mounted" class="headerlink" title="mounted"></a>mounted</h3><p>í™”ë©´ ìš”ì†Œì— ì¸ìŠ¤í„´ìŠ¤ê°€ ë¶€ì°©ë˜ê³  ë‚˜ë©´ í˜¸ì¶œë˜ëŠ” ë‹¨ê³„ë¡œ </p><p>í™”ë©´ ìš”ì†Œë¥¼ ì œì–´í•˜ëŠ” ë¡œì§ì„ ì‚¬ìš©í•  ë•Œ ì‚¬ìš©</p><h3 id="beforeUpdate"><a href="#beforeUpdate" class="headerlink" title="beforeUpdate"></a>beforeUpdate</h3><p>ê´€ì°°í•˜ê³  ìˆëŠ” ë°ì´í„°ê°€ ë³€ê²½ ë˜ë©´ ê°€ìƒ ë”ìœ¼ë¡œ í™”ë©´ì„ ë‹¤ì‹œ ê·¸ë¦¬ê¸° ì „ì— í˜¸ì¶œë˜ëŠ” ë‹¨ê³„</p><p>ë³€ê²½ ì˜ˆì •ì¸ ìƒˆ ë°ì´í„°ì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì„œ ê´€ë ¨ëœ ë¡œì§ì„ ì²˜ë¦¬í•˜ëŠ”ë° ì‚¬ìš©</p><h3 id="updated"><a href="#updated" class="headerlink" title="updated"></a>updated</h3><p>ë°ì´í„°ê°€ ë³€ê²½ë˜ê³  ë‚˜ì„œ ê°€ìƒ ë”ìœ¼ë¡œ í™”ë©´ì„ ê·¸ë¦¬ê³ ë‚˜ë©´ ì‹¤í–‰í•˜ëŠ” ë‹¨ê³„</p><p>ë³€ê²½ ë°ì´í„°ì˜ í™”ë©´ ìš”ì†Œì™€ ê´€ë ¨ëœ ë¡œì§ì„ ì¶”ê°€í•˜ëŠ”ë° ì‚¬ìš©</p><h3 id="beforeDestroy"><a href="#beforeDestroy" class="headerlink" title="beforeDestroy"></a>beforeDestroy</h3><p>ë·° ì¸ìŠ¤í„´ìŠ¤ê°€ íŒŒê´´ë˜ê¸° ì „ì— í˜¸ì¶œë˜ëŠ” ë‹¨ê³„ë¡œ ì¸ìŠ¤í„´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê¸° ì¢‹ì€ ë‹¨ê³„</p><h3 id="destroyed"><a href="#destroyed" class="headerlink" title="destroyed"></a>destroyed</h3><p>ë·° ì¸ìŠ¤í„´ìŠ¤ê°€ íŒŒê´´ë˜ê³  ë‚˜ì„œ í˜¸ì¶œë˜ëŠ” ë‹¨ê³„</p><h2 id="ì»´í¬ë„ŒíŠ¸"><a href="#ì»´í¬ë„ŒíŠ¸" class="headerlink" title="ì»´í¬ë„ŒíŠ¸"></a>ì»´í¬ë„ŒíŠ¸</h2><p>ì»´í¬ë„ŒíŠ¸ë€ ì¡°í•©í•˜ì—¬ í™”ë©´ì„ êµ¬ì„±í•  ìˆ˜ ìˆëŠ” ë¸”ë¡(í™”ë©´ì˜ íŠ¹ì • ì˜ì—­)ì„ ì˜ë¯¸ í•œë‹¤.</p><h3 id="ì»´í¬ë„ŒíŠ¸-ì¢…ë¥˜"><a href="#ì»´í¬ë„ŒíŠ¸-ì¢…ë¥˜" class="headerlink" title="ì»´í¬ë„ŒíŠ¸ ì¢…ë¥˜"></a>ì»´í¬ë„ŒíŠ¸ ì¢…ë¥˜</h3><p>ì „ì—­ ì»´í¬ë„ŒíŠ¸ì™€ ì§€ì—­ ì»´í¬ë„ŒíŠ¸ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ì„ ì–¸ì„ í•  ìˆ˜ ìˆëŠ”ë° </p><p>ë§ ê·¸ëŒ€ë¡œ ì „ìëŠ” ì–´ë””ì„œë‚˜ ì‚¬ìš©í•  ìˆ˜ ìˆê±°ë‚˜ í›„ìëŠ” ì§€ì •ëœ ë²”ìœ„ì—ì„œë§Œ ì‚¬ìš© í•œë‹¤.</p><h3 id="ì»´í¬ë„ŒíŠ¸-í†µì‹ "><a href="#ì»´í¬ë„ŒíŠ¸-í†µì‹ " class="headerlink" title="ì»´í¬ë„ŒíŠ¸ í†µì‹ "></a>ì»´í¬ë„ŒíŠ¸ í†µì‹ </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ ë·° ì¸ìŠ¤í„´ìŠ¤ (ìµœìƒìœ„ ì»´í¬ë„ŒíŠ¸)</span><br><span class="line">|â”€â”€â”€â”€ ì²« ë²ˆì§¸ë¡œ í˜¸ì¶œëœ ì»´í¬ë„ŒíŠ¸(ë·° ì¸ìŠ¤í„´ìŠ¤ì˜ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸, ë‘ ë²ˆì§¸ ì»´í¬ë„ŒíŠ¸ì˜ ìƒìœ„)</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€ ë‘ ë²ˆì§¸ë¡œ í˜¸ì¶œëœ ì»´í¬ë„ŒíŠ¸(ìœ„ì˜ ì»´í¬ë„ŒíŠ¸ë“¤ì˜ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸)</span><br></pre></td></tr></table></figure><p>ìƒìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ ê°„ì˜ ë°ì´í„° ì „ë‹¬ì€ propsë¥¼ í†µí•´ ê°€ëŠ¥ í•˜ê³ </p><p>í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ìƒìœ„ ì»´í¬ë„ŒíŠ¸ ê°„ì˜ ë°ì´í„° ì „ë‹¬ì€ $emitì„ í†µí•´ ê°€ëŠ¥ í•˜ë‹¤.</p><h2 id="ë·°-ë¼ìš°í„°"><a href="#ë·°-ë¼ìš°í„°" class="headerlink" title="ë·° ë¼ìš°í„°"></a>ë·° ë¼ìš°í„°</h2><p>ë·°ì—ì„œ ë¼ìš°íŒ…ì„ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ê³µì‹ ë¼ì´ë¸ŒëŸ¬ë¦¬</p><p>ë¼ìš°íŒ…ì´ë€ ì›¹ í˜ì´ì§€ ê°„ì˜ ì´ë™ ë°©ë²•ì„ ëœ» í•˜ë©° SPA(ì‹±ê¸€ í˜ì´ì§€ ì–´í”Œë¦¬ì¼€ì´ì…˜)ì— </p><p>ì£¼ë¡œ ì‚¬ìš©ë˜ë©° ì¥ì ì€ ê¹œë¹¡ê±°ë¦¼(ìƒˆë¡œê³ ì¹¨ ê°™ì€?)ì´ ì—†ì–´ì ¸ì„œ ì‚¬ìš©ì ê²½í—˜ì´ í–¥ìƒ ëœë‹¤.</p><h3 id="SPA"><a href="#SPA" class="headerlink" title="SPA"></a>SPA</h3><p>í˜ì´ì§€ ì´ë™ ì‹œ ì„œë²„ì— ìš”ì²­í•˜ì—¬ ìƒˆë¡œ í˜ì´ì§€ë¥¼ ê°±ì‹ í•˜ëŠ” ê²Œ ì•„ë‹ˆê³  ë¯¸ë¦¬ í•´ë‹¹ í˜ì´ì§€ ë°ì´í„°ë¥¼</p><p>ë°›ì•„ì„œ ì´ë™ ì‹œ í´ë¼ì´ì–¸íŠ¸ ë¼ìš°íŒ…ì„ ì´ìš©í•˜ì—¬ í™”ë©´ì„ ê°±ì‹ í•˜ëŠ” íŒ¨í„´ì„ ì ìš©í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜</p><h2 id="í”„ë¡œì íŠ¸-ìƒì„±"><a href="#í”„ë¡œì íŠ¸-ìƒì„±" class="headerlink" title="í”„ë¡œì íŠ¸ ìƒì„±"></a>í”„ë¡œì íŠ¸ ìƒì„±</h2><p>Vue CLIë¥¼ í†µí•´ í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm i vue-cli -g <span class="comment"># vue cli ì „ì—­ ì„¤ì¹˜</span></span><br><span class="line">mkdir í”„ë¡œì íŠ¸í´ë”</span><br><span class="line"><span class="built_in">cd</span> í”„ë¡œì íŠ¸í´ë”</span><br><span class="line">vue init webpack-simple <span class="comment"># ì—¬ê¸°ì— ì„¤ì¹˜í•  ê²ƒì¸ê°€, ì´ë¦„ ë“±ë“± ì›í•˜ëŠ”ëŒ€ë¡œ ì„¤ì •</span></span><br><span class="line">npm i <span class="comment"># ì˜ì¡´ì„± ëª¨ë“ˆ ë‹¤ìš´ë¡œë“œ</span></span><br><span class="line">npm run dev <span class="comment"># ì‹¤í–‰</span></span><br></pre></td></tr></table></figure><ul><li>simpleì€ ì›¹íŒ© ìµœì†Œ ê¸°ëŠ¥ì„ í™œìš©í•œ í”„ë¡œì íŠ¸ êµ¬ì„± ë°©ì‹, í”„ë¡œí† íƒ€ì…ìš©</li><li>vue init webpackìœ¼ë¡œ í•˜ë©´ ì›¹íŒ©ì˜ ê³ ê¸‰ ê¸°ëŠ¥ì„ í™œìš©í•œ í”„ë¡œì íŠ¸ êµ¬ì„±</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js app logë¥¼ Fluentdì— ì €ì¥í•˜ê¸°</title>
      <link href="/2020/05/09/etc-fluentd-2/"/>
      <url>/2020/05/09/etc-fluentd-2/</url>
      
        <content type="html"><![CDATA[<h2 id="ì„¤ì •"><a href="#ì„¤ì •" class="headerlink" title="ì„¤ì •"></a>ì„¤ì •</h2><p>ì˜ˆì œ ê°€ì´ë“œëŒ€ë¡œ td-agent.confë¥¼ ë°”ê¿”ë³¸ë‹¤.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;match fluentd.test.**&gt;</span><br><span class="line">  @type stdout</span><br><span class="line">&lt;&#x2F;match&gt;</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1589013864/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-09_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.43.33_mklnlf.png" alt="ì„¤ì •ì¶”ê°€"></p><p>ê·¸ë¦¬ê³  ë‚˜ì„œ td-agentë¥¼ ì¢…ë£Œ í›„ ë‹¤ì‹œ ì¼œ ì£¼ë©´ ëœë‹¤. ê·¼ë° matchë‘ sourceê°€ ë­”ì§€ ë³´ê³  ê°€ì.</p><h2 id="match"><a href="#match" class="headerlink" title="match"></a>match</h2><blockquote><p>â€œmatchâ€ ì§€ì‹œë¬¸ì€ ì¼ì¹˜í•˜ëŠ” íƒœê·¸ê°€ ìˆëŠ” ì´ë²¤íŠ¸ë¥¼ ì°¾ì•„ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤, ì¼ì¹˜í•˜ëŠ” íƒœê·¸ê°€ ìˆëŠ” ì´ë²¤íŠ¸ë¥¼ ì°¾ì•„ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤</p></blockquote><p>ê³µí™ˆì˜ ë‚´ìš©ì„ ë²ˆì—­ê¸°ë¡œ ëŒë ¸ë”ë‹ˆ ì•„ ë­”ê°€ ì¹´í…Œê³ ë¦¬ë‚˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì¸ê°€? ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤.</p><h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><blockquote><p>ì…ë ¥ ì†ŒìŠ¤ëŠ” ì†ŒìŠ¤ ì§€ì‹œë¬¸ì„ ì‚¬ìš©í•˜ì—¬ ì›í•˜ëŠ” ì…ë ¥ í”ŒëŸ¬ê·¸ì¸ì„ ì„ íƒí•˜ê³  êµ¬ì„±í•˜ì—¬ í™œì„±í™”ë©ë‹ˆë‹¤.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;source&gt;</span><br><span class="line">  @type forward</span><br><span class="line">  @id input_forward</span><br><span class="line">&lt;&#x2F;source&gt;</span><br><span class="line">&lt;source&gt;</span><br><span class="line">  @type http</span><br><span class="line">  @id input_http</span><br><span class="line">  port 8888</span><br><span class="line">&lt;&#x2F;source&gt;</span><br></pre></td></tr></table></figure><p>ì•„ ì—¬ê¸°ë¡œ ë¡œê·¸ë¥¼ ë³´ë‚´ëŠ”ê±´ê°€ ë³´êµ°! ì´ë€ ìƒê°ì´ ë“¤ì—ˆìŒ. ì—¬ëŸ¬ ê°œ ì¶”ê°€ ëœë‹¤ê³  í•œë‹¤.</p><h2 id="ì „ì†¡í•˜ê¸°"><a href="#ì „ì†¡í•˜ê¸°" class="headerlink" title="ì „ì†¡í•˜ê¸°"></a>ì „ì†¡í•˜ê¸°</h2><p>ì˜ˆì œ ì½”ë“œë¥¼ ë”°ë¼ê°€ ë³´ë©° í•´ ë³¸ë‹¤.</p><h3 id="íŒ¨í‚¤ì§€-ì„¤ì¹˜"><a href="#íŒ¨í‚¤ì§€-ì„¤ì¹˜" class="headerlink" title="íŒ¨í‚¤ì§€ ì„¤ì¹˜"></a>íŒ¨í‚¤ì§€ ì„¤ì¹˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i fluent-logger -S</span><br></pre></td></tr></table></figure><h3 id="ì½”ë“œ"><a href="#ì½”ë“œ" class="headerlink" title="ì½”ë“œ"></a>ì½”ë“œ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;fluent-logger&#x27;</span>);</span><br><span class="line"></span><br><span class="line">logger.configure(<span class="string">&#x27;fluentd.test&#x27;</span>, &#123; <span class="comment">// <span class="doctag">NOTE:</span> tag</span></span><br><span class="line">  host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  port: <span class="number">24224</span>, <span class="comment">// <span class="doctag">NOTE:</span> td-agent ì‹¤í–‰ ì‹œ logì— port 24224ë¡œ ëœ¸.</span></span><br><span class="line">  timeout: <span class="number">3.0</span>,</span><br><span class="line">  reconnectInterval: <span class="number">600000</span>, <span class="comment">// 10 minutes, <span class="doctag">NOTE:</span> ì—°ê²° ì‹¤íŒ¨ ì‹œ ì¬ì—°ê²° ì¿¨ íƒ€ì„</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">logger.emit(<span class="string">&#x27;join&#x27;</span>, &#123;<span class="attr">id</span>: <span class="string">&#x27;a&#x27;</span>, <span class="attr">name</span>: <span class="string">&#x27;delryn&#x27;</span>, <span class="attr">age</span>: <span class="number">32</span>&#125;);</span><br></pre></td></tr></table></figure><p>ì‹¤í–‰ ê²°ê³¼ëŠ” ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì³ ë³´ë©´ ë‚˜ì˜¨ë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tail -n 1 /var/<span class="built_in">log</span>/td-agent/td-agent.log</span><br><span class="line">2020-05-09 17:45:47.000000000 +0900 fluentd.test.join: &#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;a&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;delryn&quot;</span>,<span class="string">&quot;age&quot;</span>:32&#125;</span><br></pre></td></tr></table></figure><p>ì–´í”Œë¦¬ì¼€ì´ì…˜ -&gt; agent ì—°ê²°ëœ ìƒíƒœì´ê¸° ë•Œë¬¸ì— agentë¥¼ ì¢…ë£Œí•˜ë©´ ì—°ê²°ì´ ëŠê¸°ëŠ” ë©”ì„¸ì§€ë¥¼ ë³¼ìˆ˜ ìˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Fluentd error &#123; Error: connect ECONNREFUSED 127.0.0.1:24224</span><br><span class="line">    at TCPConnectWrap.afterConnect [as oncomplete] (net.js:1106:14)</span><br><span class="line">  errno: <span class="string">&#x27;ECONNREFUSED&#x27;</span>,</span><br><span class="line">  code: <span class="string">&#x27;ECONNREFUSED&#x27;</span>,</span><br><span class="line">  syscall: <span class="string">&#x27;connect&#x27;</span>,</span><br><span class="line">  address: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">  port: 24224 &#125;</span><br><span class="line">Fluentd will reconnect after 600 seconds</span><br></pre></td></tr></table></figure><h2 id="winston-morganìœ¼ë¡œ-ì—°ë™"><a href="#winston-morganìœ¼ë¡œ-ì—°ë™" class="headerlink" title="winston, morganìœ¼ë¡œ ì—°ë™"></a>winston, morganìœ¼ë¡œ ì—°ë™</h2><p>ì´ì „ì— í•´ë³¸ winston + morgan ë¡œê·¸ë¥¼ fluentdë¡œ ë³´ë‚´ì„œ íŒŒì¼ì„ ìƒì„±í•˜ê²Œ í•´ ë³´ì.</p><h3 id="ì„¤ì •-ì¶”ê°€"><a href="#ì„¤ì •-ì¶”ê°€" class="headerlink" title="ì„¤ì • ì¶”ê°€"></a>ì„¤ì • ì¶”ê°€</h3><p>ê¸°ì¡´ confë¥¼ ì°¸ì¡°í•´ì„œ í•œë²ˆ ì¶”ê°€ í•´ë³´ì•˜ë‹¤.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;match myproject.app.**&gt;</span><br><span class="line"> @type file</span><br><span class="line"> path &#x2F;var&#x2F;log&#x2F;td-agent&#x2F;myproject&#x2F;app</span><br><span class="line">&lt;&#x2F;match&gt;</span><br><span class="line"></span><br><span class="line">&lt;match myproject.http.**&gt;</span><br><span class="line"> @type file</span><br><span class="line"> path &#x2F;var&#x2F;log&#x2F;td-agent&#x2F;myproject&#x2F;http</span><br><span class="line">&lt;&#x2F;match&gt;</span><br></pre></td></tr></table></figure><h3 id="ì½”ë“œ-ì‘ì„±"><a href="#ì½”ë“œ-ì‘ì„±" class="headerlink" title="ì½”ë“œ ì‘ì„±"></a>ì½”ë“œ ì‘ì„±</h3><p><a href="https://github.com/hidelryn/morgan-winston-example">ì´ì „</a>ì— ì‘ì„±í•œ ì½”ë“œì— ì¶”ê°€ í•´ ë³¸ë‹¤.</p><h4 id="logger-js"><a href="#logger-js" class="headerlink" title="logger.js"></a><strong><code>logger.js</code></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createLogger, format, transports &#125; = <span class="built_in">require</span>(<span class="string">&#x27;winston&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fluentTransport = <span class="built_in">require</span>(<span class="string">&#x27;fluent-logger&#x27;</span>).support.winstonTransport();</span><br><span class="line"><span class="keyword">const</span> mt = <span class="built_in">require</span>(<span class="string">&#x27;moment-timezone&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; combine, label, printf &#125; = format;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> date = mt().tz(<span class="string">&#x27;Asia/Seoul&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> myFormat = printf(<span class="function"><span class="params">info</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;info.timestamp&#125;</span> [<span class="subst">$&#123;info.level&#125;</span>]: <span class="subst">$&#123;info.label&#125;</span> - <span class="subst">$&#123;info.message&#125;</span>`</span>);</span><br><span class="line"><span class="keyword">const</span> koreaTime = format(<span class="function">(<span class="params">info</span>) =&gt;</span> &#123;</span><br><span class="line">  info.timestamp = date.format();</span><br><span class="line">  <span class="keyword">return</span> info;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fluentConfig = &#123;</span><br><span class="line">  host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  port: <span class="number">24224</span>,</span><br><span class="line">  timeout: <span class="number">3.0</span>,</span><br><span class="line">  requireAckResponse: <span class="literal">false</span>, <span class="comment">// <span class="doctag">NOTE:</span> trueë¡œ ì„¤ì¡í•˜ë©´ fluentdì˜ ì‘ë‹µì„ ê¸°ë‹¤ë¦°ë‹¤ë¼ê³  ë²ˆì—­ê¸°ë¡œ ë‚˜ì˜¤ëŠ”ë° ë‚œ falseë¡œ í•´ë´¤ë‹¤.</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fluentInit = <span class="function">(<span class="params">tag</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> init = <span class="keyword">new</span> fluentTransport(tag, fluentConfig);</span><br><span class="line">  <span class="keyword">return</span> init;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> appLogger = <span class="function">(<span class="params">category</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> init = createLogger(&#123;</span><br><span class="line">    format: combine(</span><br><span class="line">      label(&#123; <span class="attr">label</span>: category &#125;),</span><br><span class="line">      koreaTime(),</span><br><span class="line">      myFormat,</span><br><span class="line">    ),</span><br><span class="line">    transports: [fluentInit(<span class="string">&#x27;myproject.app&#x27;</span>)],</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> init;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> httpLogger = createLogger(&#123;</span><br><span class="line">  format: combine(</span><br><span class="line">    label(&#123; <span class="attr">label</span>: <span class="string">&#x27;http&#x27;</span> &#125;),</span><br><span class="line">    koreaTime(),</span><br><span class="line">    myFormat,</span><br><span class="line">  ),</span><br><span class="line">  transports: [fluentInit(<span class="string">&#x27;myproject.http&#x27;</span>)],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> httpLogStream = &#123;</span><br><span class="line">  write: <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">    httpLogger.log(&#123;</span><br><span class="line">      level: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">      message: message,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.appLogger = appLogger;</span><br><span class="line"><span class="built_in">exports</span>.httpLogStream = httpLogStream;</span><br></pre></td></tr></table></figure><h4 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a><strong><code>index.js</code></strong></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">&quot;morgan&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;./logger&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> morganFormat = process.env.NODE_ENV !== <span class="string">&quot;production&quot;</span> ? <span class="string">&quot;dev&quot;</span> : <span class="string">&quot;combined&quot;</span>;</span><br><span class="line"></span><br><span class="line">app.use(morgan(morganFormat, &#123; <span class="attr">stream</span>: logger.httpLogStream &#125;));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;hihi&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/set-item&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id, name, item_id &#125; = req.query;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> id === <span class="string">&#x27;undefined&#x27;</span> || <span class="keyword">typeof</span> name === <span class="string">&#x27;undefined&#x27;</span> || <span class="keyword">typeof</span> item_id === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    logger.appLogger(<span class="string">&#x27;spend_item&#x27;</span>).log(&#123;</span><br><span class="line">      level: <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">      message: <span class="string">&#x27;íŒŒë¼ë¯¸í„° ëˆ„ë½&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">200</span>).json(&#123; <span class="attr">statusCode</span>: <span class="number">403</span>, <span class="attr">message</span>: <span class="string">&#x27;íŒŒë¼ë¯¸í„° ëˆ„ë½&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> item_id !== <span class="string">&#x27;string&#x27;</span> || !item_id.includes(<span class="string">&#x27;item_&#x27;</span>)) &#123;</span><br><span class="line">    logger.appLogger(<span class="string">&#x27;spend_item&#x27;</span>).log(&#123;</span><br><span class="line">      level: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      message: <span class="string">&#x27;ì˜ëª»ëœ ì•„ì´í…œ íƒ€ì…&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">200</span>).json(&#123; <span class="attr">statusCode</span>: <span class="number">500</span>, <span class="attr">message</span>: <span class="string">&#x27;ì˜ëª»ëœ ì•„ì´í…œ íƒ€ì…&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  logger.appLogger(<span class="string">&#x27;spend_item&#x27;</span>).log(&#123;</span><br><span class="line">    level: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">    message: <span class="string">`user_id: <span class="subst">$&#123;id&#125;</span>, name: <span class="subst">$&#123;name&#125;</span>, íšë“ ì•„ì´í…œ: <span class="subst">$&#123;item_id&#125;</span>`</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> res.status(<span class="number">200</span>).json(&#123; <span class="attr">statusCode</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">&#x27;ì²˜ë¦¬ ì„±ê³µ&#x27;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`app listening on port <span class="subst">$&#123;PORT&#125;</span>`</span>));</span><br></pre></td></tr></table></figure><p>ì‹¤í–‰ì„ í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê³  ë‚´ê°€ ì„¤ì •í•œ ê²½ë¡œì—ì„œ ë¡œê·¸ë¥¼ ì°¾ì•„ë³´ë©´ ê¸°ë¡ì´ ë‚¨ì•„ ìˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2020-05-09T19:35:19+09:00       myproject.app   &#123;<span class="string">&quot;level&quot;</span>:<span class="string">&quot;info&quot;</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;user_id: abc, name: 123, íšë“ ì•„ì´í…œ: item_123&quot;</span>,<span class="string">&quot;label&quot;</span>:<span class="string">&quot;spend_item&quot;</span>,<span class="string">&quot;timestamp&quot;</span>:<span class="string">&quot;2020-05-09T19:35:17+09:00&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">2020-05-09T19:35:19+09:00       myproject.http  &#123;<span class="string">&quot;level&quot;</span>:<span class="string">&quot;info&quot;</span>,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;\u001B[0mGET /set-item?id=abc&amp;name=123&amp;item_id=item_123 \u001B[32m200\u001B[0m 8.309 ms - 44\u001B[0m\n&quot;</span>,<span class="string">&quot;label&quot;</span>:<span class="string">&quot;http&quot;</span>,<span class="string">&quot;timestamp&quot;</span>:<span class="string">&quot;2020-05-09T19:35:17+09:00&quot;</span>&#125;</span><br></pre></td></tr></table></figure><h2 id="s3-ì—°ë™"><a href="#s3-ì—°ë™" class="headerlink" title="s3 ì—°ë™"></a>s3 ì—°ë™</h2><p>ë¡œì»¬ íŒŒì¼ì´ ì•„ë‹Œ s3ì— íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë„ë¡ ë°”ê¿”ë³´ì</p><h3 id="ì„¤ì •-ë³€ê²½"><a href="#ì„¤ì •-ë³€ê²½" class="headerlink" title="ì„¤ì • ë³€ê²½"></a>ì„¤ì • ë³€ê²½</h3><p>ì´ì „ ì„¤ì •ì€ ì£¼ì„ìœ¼ë¡œ í•´ë‘ê³  ìƒˆ ì„¤ì •ì„ ì¶”ê°€ í•˜ì.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;match myproject.app.**&gt;</span><br><span class="line">  @type s3</span><br><span class="line"></span><br><span class="line">  aws_key_id AWS í‚¤</span><br><span class="line">  aws_sec_key AWS ì‹œí¬ë¦¿ í‚¤</span><br><span class="line">  s3_bucket s3 ë²„ì¼“ëª…</span><br><span class="line">  s3_region ë¦¬ì „</span><br><span class="line">  path logs&#x2F;$&#123;tag&#125;&#x2F;%Y&#x2F;%m&#x2F;%d&#x2F; # ì €ì¥í•  s3 ë””ë ‰í† ë¦¬</span><br><span class="line">  &lt;buffer tag,time&gt;</span><br><span class="line">    @type file</span><br><span class="line">    path &#x2F;var&#x2F;log&#x2F;fluent&#x2F;s3&#x2F;app # ë²„í¼ë¡œ ê°–ê³  ìˆì„ ë””í…í† ë¦¬ ì„¤ì •</span><br><span class="line">    timekey 0 # timekeyëŠ” ì‹œê°„</span><br><span class="line">    timekey_wait 10s # timekey_waitëŠ” ì´ˆ ë˜ëŠ” ë¶„ (s, m)</span><br><span class="line">    timekey_use_utc true # use utc</span><br><span class="line">    chunk_limit_size 256m # ë²„í¼ íŒŒì¼ í¬ê¸° ì§€ì •</span><br><span class="line">  &lt;&#x2F;buffer&gt;</span><br><span class="line">&lt;&#x2F;match&gt;</span><br><span class="line"></span><br><span class="line">&lt;match myproject.http.**&gt;</span><br><span class="line">  @type s3</span><br><span class="line"></span><br><span class="line">  aws_key_id AWS í‚¤</span><br><span class="line">  aws_sec_key AWS ì‹œí¬ë¦¿ í‚¤</span><br><span class="line">  s3_bucket s3 ë²„ì¼“ëª…</span><br><span class="line">  s3_region ë¦¬ì „</span><br><span class="line">  path logs&#x2F;$&#123;tag&#125;&#x2F;%Y&#x2F;%m&#x2F;%d&#x2F;</span><br><span class="line">  &lt;buffer tag,time&gt;</span><br><span class="line">    @type file</span><br><span class="line">    path &#x2F;var&#x2F;log&#x2F;fluent&#x2F;s3&#x2F;http</span><br><span class="line">    timekey 0</span><br><span class="line">    timekey_wait 10s</span><br><span class="line">    timekey_use_utc true</span><br><span class="line">    chunk_limit_size 256m </span><br><span class="line">  &lt;&#x2F;buffer&gt;</span><br><span class="line">&lt;&#x2F;match&gt;</span><br></pre></td></tr></table></figure><p>timekey, timekey_waitì— ì„¤ì •í•œ ì‹œê°„ë‹¨ìœ„ ë³„ë¡œ ë²„í¼ì— ë‹´ì•„ë‘” ë¡œê·¸ë¥¼ s3ì— ì—…ë¡œë“œí•œë‹¤.</p><p>ì§€ê¸ˆì€ 10ì´ˆë§ˆë‹¤ ì—…ë¡œë“œí•´ë†“ê²Œë” í•´ë†¨ê³  ì‹¤ì œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë´¤ì„ ì‹œ</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1589191562/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-11_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.05.35_nkj3cy.png" alt="s3ì—…ë¡œë“œ"></p><p>gzipìœ¼ë¡œ ì••ì¶• ë˜ì„œ ì˜¬ë¼ ê°„ë‹¤.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Fluentd </tag>
            
            <tag> Log </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fluentd ì„¤ì¹˜í•´ë³´ê¸°</title>
      <link href="/2020/05/08/etc-fluentd-1/"/>
      <url>/2020/05/08/etc-fluentd-1/</url>
      
        <content type="html"><![CDATA[<h2 id="Fluentdë€"><a href="#Fluentdë€" class="headerlink" title="Fluentdë€?"></a>Fluentdë€?</h2><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1589008820/fluentd-architecture_xltsg7.png" alt="ì•„í‚¤í…ì²˜"></p><blockquote><p>FluentdëŠ” í†µí•© ë¡œê¹… ê³„ì¸µì„ ìœ„í•œ ì˜¤í”ˆ ì†ŒìŠ¤ ë°ì´í„° ìˆ˜ì§‘ê¸°ì…ë‹ˆë‹¤. Fluentdë¥¼ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ë¥¼ ë³´ë‹¤ ì˜ ì‚¬ìš©í•˜ê³  ì´í•´í•˜ê¸° ìœ„í•´ ë°ì´í„° ìˆ˜ì§‘ ë° ì†Œë¹„ë¥¼ í†µí•© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></blockquote><p>ê³µí™ˆì— ìˆëŠ” ì„¤ëª… ê¸€ì„ ë²ˆì—­ê¸°ë¡œ ëŒë ¤ë³´ë‹ˆ ëŒ€ì¶© ë­” ë§ì¸ì§€ ì´í•´í•¨.</p><h2 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h2><p>ë¡œì»¬ì—ì„œ í•™ìŠµì„ í• êº¼ë‹ˆ OSì— ë§ëŠ” ë²„ì „ì„ ê³µí™ˆì—ì„œ ë‹¤ìš´ ë°›ëŠ”ë‹¤. (í˜„ì¬ëŠ” macì´ë¯€ë¡œ dmg)</p><p>dmgë¥¼ ì—´ì–´ì„œ ì‹¤í–‰ì„ í•´ë³´ë©´ td-agentë¼ëŠ” ê±¸ ì„¤ì¹˜ë¥¼ í•œë‹¤ ì¼ë‹¨ í•˜ì.</p><p>ê³µí™ˆ ê°€ì´ë“œëŒ€ë¡œ í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰ì„ í•´ë³¸ë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo launchctl load /Library/LaunchDaemons/td-agent.plist <span class="comment"># ì‹¤í–‰ ëª…ë ¹ì–´, ì•„ë¬´ ë°˜ì‘ì´ ì—†ìŒ, ë°±ê·¸ë¼ìš´ë“œë¡œ ê³„ì† ì‹¤í–‰ì´ ëœë‹¤.</span></span><br><span class="line">less /var/<span class="built_in">log</span>/td-agent/td-agent.log <span class="comment"># td-agent ì‹¤í–‰ ë¡œê·¸, ë°‘ìœ¼ë¡œ ë‚´ë¦¬ë©´ ë‚˜ì˜´.</span></span><br><span class="line">sudo launchctl unload /Library/LaunchDaemons/td-agent.plist <span class="comment"># ì¢…ë£Œ ëª…ë ¹ì–´, ì‹¤í–‰ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì•„ë¬´ ë°˜ì‘ì´ ì—†ìŒ.</span></span><br></pre></td></tr></table></figure><p>ì¶œë ¥ëœ td-agent ì‹¤í–‰, ì¢…ë£Œì˜ ë¡œê·¸</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1588933829/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.29.39_j57zdq.png" alt="ì‹¤í–‰, ì¢…ë£Œì˜ ë¡œê·¸ ì´ë¯¸ì§€"></p><h2 id="ì„¤ì •-íŒŒì¼"><a href="#ì„¤ì •-íŒŒì¼" class="headerlink" title="ì„¤ì • íŒŒì¼"></a>ì„¤ì • íŒŒì¼</h2><p>ë¦¬ëˆ…ìŠ¤ë‚˜ ë§¥ì—ì„œëŠ” ë‹¤ìŒì˜ ëª…ë ¹ì–´ë¡œ ì„¤ì • íŒŒì¼ì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/td-agent/td-agent.conf</span><br></pre></td></tr></table></figure><p>í˜„ì¬ëŠ” ë‚´ìš©ì„ ëª¨ë¥´ë¯€ë¡œ ë“¤ì–´ê°€ëŠ” ë²•ë§Œ ì•Œì•„ë‘ê³  ì¶”í›„ì— <a href="https://docs.fluentd.org/configuration/config-file">ë§í¬</a>ë¥¼ ë³´ì.</p><h2 id="ë¼ì´ë¸Œ-ì„œë¹„ìŠ¤-ì‹œ-í•´ì•¼í•˜ëŠ”-ì„¤ì •"><a href="#ë¼ì´ë¸Œ-ì„œë¹„ìŠ¤-ì‹œ-í•´ì•¼í•˜ëŠ”-ì„¤ì •" class="headerlink" title="ë¼ì´ë¸Œ ì„œë¹„ìŠ¤ ì‹œ í•´ì•¼í•˜ëŠ” ì„¤ì •"></a>ë¼ì´ë¸Œ ì„œë¹„ìŠ¤ ì‹œ í•´ì•¼í•˜ëŠ” ì„¤ì •</h2><p><a href="https://docs.fluentd.org/installation/before-install">ë§í¬</a>ì—ì„œ ë³´ì.</p><p>ë‚˜ì¤‘ì— AWSì—ì„œ í•  ë•Œ í•´ë´ì•¼ ê² ë‹¤.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Fluentd </tag>
            
            <tag> Log </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js Mocha ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2020/05/01/nodejs-mocha/"/>
      <url>/2020/05/01/nodejs-mocha/</url>
      
        <content type="html"><![CDATA[<h2 id="ì‹¤ìŠµ"><a href="#ì‹¤ìŠµ" class="headerlink" title="ì‹¤ìŠµ"></a>ì‹¤ìŠµ</h2><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1588304659/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-01_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.43.52_anr1ua.png" alt="êµ¬ì¡°"></p><p>ë³´í†µ ê°œë°œ ë²„ì „ì—ì„œë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì¹˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mocha -D</span><br></pre></td></tr></table></figure><p>í…ŒìŠ¤íŠ¸í•  í´ë˜ìŠ¤ë¥¼ ê°„ë‹¨í•˜ê²Œ ì‘ì„±ì„ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="keyword">const</span> year = date.getFullYear();</span><br><span class="line"><span class="keyword">const</span> month = <span class="string">`<span class="subst">$&#123;date.getMonth() + <span class="number">1</span>&#125;</span>`</span>.padStart(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> day = <span class="string">`<span class="subst">$&#123;date.getDate()&#125;</span>`</span>.padStart(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> today = <span class="string">`<span class="subst">$&#123;year&#125;</span>-<span class="subst">$&#123;month&#125;</span>-<span class="subst">$&#123;day&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(id) &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">    <span class="built_in">this</span>.loginDate = today;</span><br><span class="line">    <span class="built_in">this</span>.loginCount = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> <span class="title">setLoginDate</span>(<span class="params">loginDate</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.loginDate = loginDate;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">getLoginDate</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.loginDate;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">set</span> <span class="title">setLoginCount</span>(<span class="params">count</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.loginCount += count;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">getLoginCount</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.loginCount;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = User;</span><br></pre></td></tr></table></figure><p>í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸° ìœ„í•œ ì½”ë“œ, testë€ í´ë”ì— ì‘ì„±ì„ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>); <span class="comment">// nodejs ë‚´ì¥ ëª¨ë“ˆ </span></span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">&#x27;../user&#x27;</span>);</span><br><span class="line"></span><br><span class="line">describe(<span class="string">&#x27;User&#x27;</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// <span class="doctag">NOTE:</span> description</span></span><br><span class="line">  it(<span class="string">&#x27;#init&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">new</span> User(<span class="string">&#x27;abc&#x27;</span>);</span><br><span class="line">    assert.equal(user.getLoginDate, <span class="string">&#x27;2020-03-21&#x27;</span>, <span class="string">&#x27;ë‚ ì§œê°€ ë‹¤ë¥´ë„¤?&#x27;</span>); <span class="comment">// <span class="doctag">NOTE:</span> ì²« ì¸ìì™€ ë‘ë²ˆì§¸ ì¸ì ë¹„êµ, í‹€ë¦¬ë©´ ì„¸ë²ˆì¨° ë©”ì„¸ì§€ ì¶œë ¥.</span></span><br><span class="line">  &#125;);</span><br><span class="line">  it(<span class="string">&#x27;#setLoginCount&#x27;</span>, <span class="function">(<span class="params">done</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.timeout(<span class="number">3000</span>);  <span class="comment">// <span class="doctag">NOTE:</span> ì‹œê°„ ì œí•œ ì„¤ì •.</span></span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">new</span> User(<span class="string">&#x27;qwe&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> rnd = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>) + <span class="number">1</span>;</span><br><span class="line">    user.setLoginCount = rnd;</span><br><span class="line">    <span class="keyword">if</span> (user.getLoginCount &gt;= <span class="number">1</span> &amp;&amp; user.getLoginCount &lt;= <span class="number">50</span>) <span class="keyword">return</span> done(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;ë²”ìœ„ë³´ë‹¤ í¬ë‹¤.&#x27;</span>));</span><br><span class="line">    <span class="keyword">return</span> done();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì‹¤í–‰ì€ package.jsonì—ì„œ script -&gt;test í‚¤ì›Œë“œì— mochaë¡œ ì‘ì„±í•´ë‘ë©´ </p><p>test í´ë” ì•ˆì— ìˆëŠ” íŒŒì¼ ì „ë¶€ë¥¼ ì‹¤í–‰ í•œë‹¤.</p><p>ê°œë³„ë¡œ ì‹¤í–‰ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” test í´ë”ì—ì„œ ì•„ë˜ì™€ ê°™ì€ ëª…ë ¹ì–´ë¡œ ì‹¤í–‰ì„ í•˜ë©´ ëœë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../node_modules/.bin/mocha íŒŒì¼ëª….js</span><br></pre></td></tr></table></figure><p>ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1588305203/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-01_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.53.02_by7dw9.png" alt="ê²°ê³¼"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS SES ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2020/04/26/etc-aws-ses/"/>
      <url>/2020/04/26/etc-aws-ses/</url>
      
        <content type="html"><![CDATA[<h2 id="SESë€"><a href="#SESë€" class="headerlink" title="SESë€?"></a>SESë€?</h2><p>ì´ë©”ì¼ì„ ë³´ë‚¼ ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤</p><h2 id="ì‚¬ìš©í•˜ë©´ì„œ-ëŠë‚€-ì¥ì "><a href="#ì‚¬ìš©í•˜ë©´ì„œ-ëŠë‚€-ì¥ì " class="headerlink" title="ì‚¬ìš©í•˜ë©´ì„œ ëŠë‚€ ì¥ì "></a>ì‚¬ìš©í•˜ë©´ì„œ ëŠë‚€ ì¥ì </h2><ul><li>ë­”ê°€ë¥¼ ì„¤ì¹˜í•˜ê±°ë‚˜ ë³µì¡í•œ ì„¤ì •ì´ í•„ìš” ì—†ì´ ì‰½ê²Œ ì´ë©”ì¼ ì „ì†¡í•  ìˆ˜ ìˆë‹¤.</li><li>ì‚¬ìš©í•œë§Œí¼ ìš”ê¸ˆ ë¶€ê³¼</li></ul><h2 id="ì‚¬ìš©í•˜ë©´ì„œ-ëŠë‚€-ë‹¨ì "><a href="#ì‚¬ìš©í•˜ë©´ì„œ-ëŠë‚€-ë‹¨ì " class="headerlink" title="ì‚¬ìš©í•˜ë©´ì„œ ëŠë‚€ ë‹¨ì "></a>ì‚¬ìš©í•˜ë©´ì„œ ëŠë‚€ ë‹¨ì </h2><ul><li>ì‹¤ ì‚¬ìš©ì„ í• ë ¤ë©´ ë³„ë„ë¡œ ì‹ ì²­ì„ í•´ì•¼ í•˜ëŠ”ë° 1~2ì¼ ê¸°ê°„ì´ ì†Œìš” ëœë‹¤.</li><li>ì„œìš¸ ë¦¬ì „ì—ì„œëŠ” ì„œë¹„ìŠ¤ë¥¼ í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì§€ì›í•˜ëŠ” ë¦¬ì „ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥</li></ul><h2 id="ì‹¤ìŠµ"><a href="#ì‹¤ìŠµ" class="headerlink" title="ì‹¤ìŠµ"></a>ì‹¤ìŠµ</h2><p>í…ŒìŠ¤íŠ¸ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ” ë°œì†¡í•  ì´ë©”ì¼, ìˆ˜ì‹ í•  ì´ë©”ì¼ì„ ë“±ë¡ì„ í•´ì•¼ í•œë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1587883505/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.24.05_gubhva.png" alt="í…ŒìŠ¤í„° ë“±ë¡"></p><p>ì½”ë“œëŠ” ê°„ë‹¨ í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;&#x27;</span>, <span class="comment">// ses ë§Œë“  region</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;&#x27;</span>, <span class="comment">// IAM</span></span><br><span class="line">  secretAccessKey: <span class="string">&#x27;&#x27;</span>, <span class="comment">// IAM</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ses = <span class="keyword">new</span> AWS.SESV2();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> html = <span class="string">&#x27;&lt;h1 style=&quot;color:aqua;&quot;&gt;ë°˜ê°‘ìŠµë‹ˆë‹¤&lt;/h1&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> text = <span class="string">&#x27;ì•ˆë…•í•˜ì„¸ìš”?&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  Content: &#123;</span><br><span class="line">    Simple: &#123;</span><br><span class="line">      Body: &#123; <span class="comment">// <span class="doctag">NOTE:</span> ë©”ì¼ ë³¸ë¬¸</span></span><br><span class="line">        <span class="comment">// Html: &#123; // <span class="doctag">NOTE:</span> HTMLì¸ ê²½ìš°</span></span><br><span class="line">        <span class="comment">//   Data: html,</span></span><br><span class="line">        <span class="comment">//   Charset: &#x27;utf-8&#x27;, // ì¸ì½”ë”©</span></span><br><span class="line">        <span class="comment">// &#125;,</span></span><br><span class="line">        Text: &#123; <span class="comment">// <span class="doctag">NOTE:</span> ì¼ë°˜ í…ìŠ¤íŠ¸ì˜ ê²½ìš°</span></span><br><span class="line">          Data: text,</span><br><span class="line">          Charset: <span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      Subject: &#123; <span class="comment">// <span class="doctag">NOTE:</span> ë©”ì¼ ì œëª©</span></span><br><span class="line">        Data: <span class="string">&#x27;ê¸°íšì•ˆ ì „ë‹¬ ë“œë¦½ë‹ˆë‹¤.&#x27;</span>,</span><br><span class="line">        Charset: <span class="string">&#x27;utf-8&#x27;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  Destination: &#123;</span><br><span class="line">    BccAddresses: [], <span class="comment">// <span class="doctag">NOTE:</span> ìˆ¨ì€ ì°¸ì¡° ë¦¬ìŠ¤íŠ¸</span></span><br><span class="line">    CcAddresses: [], <span class="comment">// <span class="doctag">NOTE:</span> ì°¸ì¡° ë¦¬ìŠ¤íŠ¸</span></span><br><span class="line">    ToAddresses: [<span class="string">&#x27;delryn@naver.com&#x27;</span>], <span class="comment">// <span class="doctag">NOTE:</span> ìˆ˜ì‹  í•  ë©”ì¼ ì£¼ì†Œ ë¦¬ìŠ¤íŠ¸</span></span><br><span class="line">  &#125;,</span><br><span class="line">  FromEmailAddress: <span class="string">&#x27;&quot;delryn&quot; &lt;hidelryn@gmail.com&gt;&#x27;</span>, <span class="comment">// <span class="doctag">NOTE:</span> ë°œì†¡ í•˜ëŠ” ë©”ì¼ ì£¼ì†Œ</span></span><br><span class="line">  ReplyToAddresses: [], <span class="comment">// ë‹µì¥ ë°›ì„ ì´ë©”ì¼ ì£¼ì†Œ</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ses.sendEmail(params, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;ë©”ì¼ ì „ì†¡ ì„±ê³µ!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="ì‹¤í–‰-ê²°ê³¼"><a href="#ì‹¤í–‰-ê²°ê³¼" class="headerlink" title="ì‹¤í–‰ ê²°ê³¼"></a>ì‹¤í–‰ ê²°ê³¼</h3><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1587883589/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.33.50_vikyqt.png" alt="html"></p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1587883592/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.34.20_dorhdw.png" alt="text"></p><h2 id="ì‹¤ì„œë¹„ìŠ¤"><a href="#ì‹¤ì„œë¹„ìŠ¤" class="headerlink" title="ì‹¤ì„œë¹„ìŠ¤"></a>ì‹¤ì„œë¹„ìŠ¤</h2><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1587883639/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.24.14_u0pyl7.png" alt="ë„ë©”ì¸ë“±ë¡"></p><p>ë„ë©”ì¸ì„ ë“±ë¡í•´ì¤˜ì•¼ ë°œì†¡ìë¥¼ ë©ë©@ë„ë©”ì¸ìœ¼ë¡œ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1587883719/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.24.27_gwwurq.png" alt="ì‹ ì²­"></p><p>íŒŒë‘ìƒ‰ ë¦¬í€˜ìŠ¤íŠ¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ AWS ì„œí¬íŠ¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ëŠ” ë° ê±°ê¸°ì„œ í•´ë‹¹ ì§ˆë¬¸ì— ê°ê°</p><p>ë‹µë³€ì„ ì‘ì„±ì„ í•´ì•¼ ìˆ˜ë½ì´ ë˜ì•¼ ì‹¤ì œ ì„œë¹„ìŠ¤ë¡œ ì“¸ ìˆ˜ ìˆë‹¤ ê¸°ê°„ì€ 1~2ì¼ ì†Œìš”</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/SESV2.html#sendEmail-property">aws ë¬¸ì„œ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js Morgan, Winston ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2020/04/12/nodejs-morgan-winston-example/"/>
      <url>/2020/04/12/nodejs-morgan-winston-example/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.npmjs.com/package/winston">winston</a>ì„ ì¡°ê¸ˆë§Œ ì„¤ì • í•˜ë©´ express ë‚´ ë¡œê·¸ë¥¼ í¸í•˜ê²Œ ë‚¨ê¸¸ ìˆ˜ ìˆë‹¤.</p><h2 id="ë¡œê·¸-ì‘ì„±"><a href="#ë¡œê·¸-ì‘ì„±" class="headerlink" title="ë¡œê·¸ ì‘ì„±"></a>ë¡œê·¸ ì‘ì„±</h2><p>app, http ë¡œê·¸ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ëª¨ë“ˆë¡œ loggerë¼ëŠ” íŒŒì¼ì„ ìƒì„± í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; createLogger, format, transports &#125; = <span class="built_in">require</span>(<span class="string">&#x27;winston&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; combine, label, printf &#125; = format;</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> mt = <span class="built_in">require</span>(<span class="string">&#x27;moment-timezone&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> date = mt().tz(<span class="string">&#x27;Asia/Seoul&#x27;</span>); <span class="comment">// <span class="doctag">NOTE:</span> ë‚ ì§œëŠ” í•œêµ­ ì‹œê°„ìœ¼ë¡œ í•˜ê³  ì‹¶ë‹¤.</span></span><br><span class="line"><span class="keyword">const</span> myFormat = printf(<span class="function"><span class="params">info</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;info.timestamp&#125;</span> [<span class="subst">$&#123;info.level&#125;</span>]: <span class="subst">$&#123;info.label&#125;</span> - <span class="subst">$&#123;info.message&#125;</span>`</span>); <span class="comment">// <span class="doctag">NOTE:</span> ë¡œê·¸ í˜•ì‹ ì„¤ì •</span></span><br><span class="line"><span class="keyword">const</span> koreaTime = format(<span class="function">(<span class="params">info</span>) =&gt;</span> &#123; <span class="comment">// <span class="doctag">NOTE:</span> í•œêµ­ ì‹œê°„ìœ¼ë¡œ í•˜ê¸° ìœ„í•´.. ì„¤ì •ì„ ì•ˆ í•  ì‹œ ì—ëŠ” UTC 0ì´ defaultë‹¤.</span></span><br><span class="line">  info.timestamp = date.format();</span><br><span class="line">  <span class="keyword">return</span> info;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logType = &#123; <span class="comment">// ê± ë§Œë“¤ì–´ë³¸ ì„œë¹„ìŠ¤ enum</span></span><br><span class="line">  <span class="number">1</span>: <span class="string">&#x27;join&#x27;</span>,</span><br><span class="line">  <span class="number">2</span>: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">  <span class="number">3</span>: <span class="string">&#x27;spend_item&#x27;</span>,</span><br><span class="line">  <span class="number">4</span>: <span class="string">&#x27;system&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> appLogger = <span class="function">(<span class="params">type</span>) =&gt;</span> &#123; <span class="comment">// <span class="doctag">NOTE:</span> application logë¥¼ ë‚¨ê¸°ê¸° ìœ„í•¨.</span></span><br><span class="line">  <span class="keyword">const</span> init = createLogger(&#123;</span><br><span class="line">    format: combine(</span><br><span class="line">      label(&#123; <span class="attr">label</span>: logType[type] &#125;), <span class="comment">// <span class="doctag">NOTE:</span> ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ì§€ ì•Œê¸° ìœ„í•¨</span></span><br><span class="line">      koreaTime(),</span><br><span class="line">      myFormat,</span><br><span class="line">    ),</span><br><span class="line">    transports: [</span><br><span class="line">      <span class="keyword">new</span> transports.File(&#123; <span class="attr">filename</span>: path.join(__dirname, <span class="string">&#x27;logs&#x27;</span>, <span class="string">&#x27;app-error.log&#x27;</span>), <span class="attr">level</span>: <span class="string">&#x27;error&#x27;</span> &#125;), <span class="comment">// <span class="doctag">NOTE:</span> ì—ëŸ¬ëŠ” ë³„ë„ë¡œ ë³´ê¸° ìœ„í•¨</span></span><br><span class="line">      <span class="keyword">new</span> transports.File(&#123; <span class="attr">filename</span>: path.join(__dirname, <span class="string">`logs`</span>, date.format(<span class="string">&#x27;YYYY-MM-DD&#x27;</span>), <span class="string">&#x27;app.log&#x27;</span>) &#125;), <span class="comment">// <span class="doctag">NOTE:</span> ëª¨ë“  ë¡œê·¸ (ì—ëŸ¬ í¬í•¨)</span></span><br><span class="line">    ],</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123; <span class="comment">// <span class="doctag">NOTE:</span> ì‹¤ì œ ì„œë¹„ìŠ¤ í™˜ê²½ì´ ì•„ë‹ ì‹œì—ëŠ” ì¶œë ¥ì„ í•´ì•¼ ë°”ë¡œ ë°”ë¡œ ë³´ê¸° í¸í•¨.</span></span><br><span class="line">    init.add(<span class="keyword">new</span> transports.Console());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> init;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> httpLogger = createLogger(&#123; <span class="comment">// <span class="doctag">NOTE:</span> http status ë¡œê·¸ë¥¼ ë‚¨ê¸°ê¸° ìœ„í•¨.</span></span><br><span class="line">  format: combine(</span><br><span class="line">    label(&#123; <span class="attr">label</span>: <span class="string">&#x27;http&#x27;</span> &#125;),</span><br><span class="line">    koreaTime(),</span><br><span class="line">    myFormat,</span><br><span class="line">  ),</span><br><span class="line">  transports: [</span><br><span class="line">    <span class="keyword">new</span> transports.File(&#123; <span class="attr">filename</span>: path.join(__dirname, <span class="string">&#x27;logs&#x27;</span>, date.format(<span class="string">&#x27;YYYY-MM-DD&#x27;</span>), <span class="string">&#x27;http.log&#x27;</span>) &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> httpLogStream = &#123;</span><br><span class="line">  write: <span class="function">(<span class="params">message</span>) =&gt;</span> &#123; <span class="comment">// <span class="doctag">NOTE:</span> morganì—ì„œ ì“°ê¸° ìœ„í•´ ì´ í˜•íƒœë¡œ fix ë˜ì•¼í•¨.</span></span><br><span class="line">    httpLogger.log(&#123;</span><br><span class="line">      level: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">      message: message,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.appLogger = appLogger;</span><br><span class="line"><span class="built_in">exports</span>.httpLogStream = httpLogStream;</span><br></pre></td></tr></table></figure><h2 id="express-í…ŒìŠ¤íŠ¸"><a href="#express-í…ŒìŠ¤íŠ¸" class="headerlink" title="express í…ŒìŠ¤íŠ¸"></a>express í…ŒìŠ¤íŠ¸</h2><p>ì˜ˆì œ expressë¥¼ ë§Œë“ ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> morgan = <span class="built_in">require</span>(<span class="string">&quot;morgan&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">&#x27;./logger&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> morganFormat = process.env.NODE_ENV !== <span class="string">&quot;production&quot;</span> ? <span class="string">&quot;dev&quot;</span> : <span class="string">&quot;combined&quot;</span>; <span class="comment">// <span class="doctag">NOTE:</span> morgan ì¶œë ¥ í˜•íƒœ</span></span><br><span class="line"></span><br><span class="line">app.use(morgan(morganFormat, &#123; <span class="attr">stream</span>: logger.httpLogStream &#125;)); <span class="comment">// <span class="doctag">NOTE:</span> http request ë¡œê·¸ ë‚¨ê¸°ê¸°</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;hihi&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/set-item&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id, name, item_id &#125; = req.query;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> id === <span class="string">&#x27;undefined&#x27;</span> || <span class="keyword">typeof</span> name === <span class="string">&#x27;undefined&#x27;</span> || <span class="keyword">typeof</span> item_id === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    logger.appLogger(<span class="number">3</span>).log(&#123;</span><br><span class="line">      level: <span class="string">&#x27;warn&#x27;</span>,</span><br><span class="line">      message: <span class="string">&#x27;íŒŒë¼ë¯¸í„° ëˆ„ë½&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">200</span>).json(&#123; <span class="attr">statusCode</span>: <span class="number">403</span>, <span class="attr">message</span>: <span class="string">&#x27;íŒŒë¼ë¯¸í„° ëˆ„ë½&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> item_id !== <span class="string">&#x27;string&#x27;</span> || !item_id.includes(<span class="string">&#x27;item_&#x27;</span>)) &#123;</span><br><span class="line">    logger.appLogger(<span class="number">3</span>).log(&#123;</span><br><span class="line">      level: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">      message: <span class="string">&#x27;ì˜ëª»ëœ ì•„ì´í…œ íƒ€ì…&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">200</span>).json(&#123; <span class="attr">statusCode</span>: <span class="number">500</span>, <span class="attr">message</span>: <span class="string">&#x27;ì˜ëª»ëœ ì•„ì´í…œ íƒ€ì…&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  logger.appLogger(<span class="number">3</span>).log(&#123;</span><br><span class="line">    level: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">    message: <span class="string">`user_id: <span class="subst">$&#123;id&#125;</span>, name: <span class="subst">$&#123;name&#125;</span>, íšë“ ì•„ì´í…œ: <span class="subst">$&#123;item_id&#125;</span>`</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> res.status(<span class="number">200</span>).json(&#123; <span class="attr">statusCode</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">&#x27;ì²˜ë¦¬ ì„±ê³µ&#x27;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.use(<span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  logger.appLogger(<span class="number">4</span>).log(&#123;</span><br><span class="line">    level: <span class="string">&#x27;error&#x27;</span>,</span><br><span class="line">    message: err.stack,</span><br><span class="line">  &#125;);</span><br><span class="line">  res.status(<span class="number">500</span>).json(&#123; <span class="attr">statusCode</span>: <span class="number">500</span>, <span class="attr">message</span>: err.message &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">`app listening on port <span class="subst">$&#123;PORT&#125;</span>`</span>));</span><br></pre></td></tr></table></figure><p>http requestì˜ ìƒíƒœë¥¼ ì•Œê¸° ìœ„í•´ì„  <a href="https://www.npmjs.com/package/morgan">morgan</a> ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš© í•œë‹¤.</p><p>ì•±ì˜ ë¡œê·¸ëŠ” ê°„ë‹¨í•˜ë‹¤. ë¡œê¹… ë ˆë²¨ì„ ì ì–´ì£¼ê³  ì¶œë ¥í•  ë©”ì„¸ì§€ë¥¼ ì‘ì„±í•˜ë©´ ëœë‹¤.</p><p>ë¡œê¹…ì˜ ë ˆë²¨ì€ error, warn, info, debug, verbose, sillyê°€ ì‡ëŠ”ë° ìƒí™©ì— ë§ê²Œ ì“°ì.</p><h2 id="ê²°ê³¼"><a href="#ê²°ê³¼" class="headerlink" title="ê²°ê³¼"></a>ê²°ê³¼</h2><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1586684513/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-12_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_6.40.34_g1wwbm.png" alt="ìƒì„± í´ë” ë¦¬ìŠ¤íŠ¸"></p><p>ì‹¤í–‰ í›„ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³´ë©´ ìœ„ì™€ ê°™ì€ í´ë”ê°€ ìƒê¸´ë‹¤ ì•„ë˜ëŠ” íŒŒì¼ì˜ ë‚´ìš©.</p><p>app.log</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2020-04-12T17:47:41+09:00 [warn]: spend_item - íŒŒë¼ë¯¸í„° ëˆ„ë½</span><br><span class="line">2020-04-12T17:47:41+09:00 [error]: spend_item - ì˜ëª»ëœ ì•„ì´í…œ íƒ€ì…</span><br><span class="line">2020-04-12T17:47:41+09:00 [info]: spend_item - user_id: abc, name: 123, íšë“ ì•„ì´í…œ: item_123</span><br></pre></td></tr></table></figure><p>http.log</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">2020-04-12T17:47:41+09:00 [info]: http - [0mGET &#x2F;eqwe [33m404[0m 5.140 ms - 143[0m</span><br><span class="line"></span><br><span class="line">2020-04-12T17:47:41+09:00 [info]: http - [0mGET &#x2F;set-item?id&#x3D;abc&amp;name&#x3D;123 [32m200[0m 541.433 ms - 50[0m</span><br><span class="line"></span><br><span class="line">2020-04-12T17:47:41+09:00 [info]: http - [0mGET &#x2F;set-item?id&#x3D;abc&amp;name&#x3D;123&amp;item_id&#x3D;123 [32m200[0m 4.376 ms - 57[0m</span><br><span class="line"></span><br><span class="line">2020-04-12T17:47:41+09:00 [info]: http - [0mGET &#x2F;set-item?id&#x3D;abc&amp;name&#x3D;123&amp;item_id&#x3D;item_123 [36m304[0m 2.525 ms - -[0m</span><br></pre></td></tr></table></figure><p>app-error.log</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2020-04-12T17:47:41+09:00 [error]: spend_item - ì˜ëª»ëœ ì•„ì´í…œ íƒ€ì…</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Log </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS SQS ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2020/03/04/etc-aws-sqs/"/>
      <url>/2020/03/04/etc-aws-sqs/</url>
      
        <content type="html"><![CDATA[<h2 id="SQSë€"><a href="#SQSë€" class="headerlink" title="SQSë€?"></a>SQSë€?</h2><p>ì„œë²„ë“¤ë¼ë¦¬ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì™„ì „ê´€ë¦¬í˜• Message Queue ì„œë¹„ìŠ¤</p><h3 id="Message-Queueë€"><a href="#Message-Queueë€" class="headerlink" title="Message Queueë€?"></a>Message Queueë€?</h3><p>ë©”ì‹œì§€ë¥¼ ì´ìš©í•˜ì—¬ ì—¬ëŸ¬ ì„œë²„ë¥¼ ì—°ê²°í•´ì£¼ëŠ” ì—­í• ì´ë¼ ìƒê° í•œë‹¤.</p><p>ë°©ì‹ì€ senderê°€ ë°ì´í„°ë¥¼ Queueì— ì ì¬í–ˆë‹¤ê°€ receiverê°€ êº¼ë‚´ì„œ ì²˜ë¦¬ í•œë‹¤.</p><h3 id="ëª©ì "><a href="#ëª©ì " class="headerlink" title="ëª©ì "></a>ëª©ì </h3><p><a href="https://www.icelancer.com/2016/12/message-queue.html">Message QueueëŠ” ì™œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ê°€?</a></p><h2 id="ì‹¤ìŠµ"><a href="#ì‹¤ìŠµ" class="headerlink" title="ì‹¤ìŠµ"></a>ì‹¤ìŠµ</h2><p>SQSëŠ” í‘œì¤€, FIFO ë‘ ê°€ì§€ë¥¼ ì§€ì› í•œë‹¤.</p><h3 id="í‘œì¤€"><a href="#í‘œì¤€" class="headerlink" title="í‘œì¤€"></a>í‘œì¤€</h3><p>express(sender)ì—ì„œ SQS(Queue)ì— ë©”ì„¸ì§€ë¥¼ ì ì¬ í•˜ê³  Lambda(receiver)ì—ì„œ</p><p>êº¼ë‚¸ ë‹¤ìŒì— DynamoDBì— ì €ì¥ì„ ì‹¤ìŠµìœ¼ë¡œ í•´ë³´ê² ë‹¤.</p><h4 id="ìƒì„±"><a href="#ìƒì„±" class="headerlink" title="ìƒì„±"></a>ìƒì„±</h4><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564911596/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.03.26_eqtwnv.png" alt="ìƒì„±"></p><p>í‘œì¤€ìœ¼ë¡œ í•˜ë©´ ë©”ì„¸ì§€ê°€ ì¤‘ë³µìœ¼ë¡œ ì˜¬ ìˆ˜ ìˆë‹¤ëŠ”ê±´ë° ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì²˜ë¦¬ë¥¼ í•´ì•¼ í•  êº¼ ê°™ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564912059/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_6.43.43_y1gobg.png" alt="ìƒì„±ê²°ê³¼"></p><h4 id="sender"><a href="#sender" class="headerlink" title="sender"></a>sender</h4><p>API í˜¸ì¶œ ì‹œ SQSì— ë©”ì„¸ì§€ë¥¼ ì „ì†¡í•˜ê²Œë” í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">  extended: <span class="literal">true</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;&#x27;</span>, <span class="comment">// ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;&#x27;</span>, <span class="comment">// IAM</span></span><br><span class="line">  secretAccessKey: <span class="string">&#x27;&#x27;</span> <span class="comment">// IAM</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sqs = <span class="keyword">new</span> AWS.SQS(&#123; <span class="attr">apiVersion</span>: <span class="string">&#x27;2012-11-05&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;server is listening&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;hihi&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendMessage</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> params = &#123;</span><br><span class="line">    QueueUrl: <span class="string">&#x27;ìƒì„±í•œ SQS URL&#x27;</span>,</span><br><span class="line">    MessageBody: <span class="built_in">JSON</span>.stringify(message),</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    sqs.sendMessage(params).promise().then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      resolve();</span><br><span class="line">    &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      reject(e);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> id = req.body.id;</span><br><span class="line">  <span class="keyword">const</span> log = &#123; id, <span class="attr">dtm</span>: <span class="built_in">Date</span>.now(), <span class="attr">action</span>: <span class="string">&#x27;login&#x27;</span> &#125;;</span><br><span class="line">  sendMessage(log).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.json(&#123; <span class="attr">code</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">&#x27;success&#x27;</span> &#125;);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    res.json(&#123; <span class="attr">code</span>: <span class="number">500</span>, <span class="attr">message</span>: e &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/purchase&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id, item &#125; = req.body;</span><br><span class="line">  <span class="keyword">const</span> log = &#123; id, item, <span class="attr">dtm</span>: <span class="built_in">Date</span>.now(), <span class="attr">action</span>: <span class="string">&#x27;purchase&#x27;</span> &#125;;</span><br><span class="line">  sendMessage(log).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.json(&#123; <span class="attr">code</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">&#x27;success&#x27;</span> &#125;);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">500</span>, <span class="attr">message</span>: e &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/search&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id, word &#125; = req.body.id;</span><br><span class="line">  <span class="keyword">const</span> log = &#123; id, word, <span class="attr">dtm</span>: <span class="built_in">Date</span>.now(), <span class="attr">action</span>: <span class="string">&#x27;search&#x27;</span> &#125;;</span><br><span class="line">  sendMessage(log).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.json(&#123; <span class="attr">code</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">&#x27;success&#x27;</span> &#125;);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    res.json(&#123; <span class="attr">code</span>: <span class="number">500</span>, <span class="attr">message</span>: e &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="receiver"><a href="#receiver" class="headerlink" title="receiver"></a>receiver</h4><p>Lambdaë¥¼ receiverë¡œ ì“¸ ê»€ë° í•´ë‹¹ í•˜ëŠ” IAM ì—­í• ì„ ìƒì„±ì„ ë¯¸ë¦¬ í•´ì•¼ í•œë‹¤.</p><h5 id="ê¶Œí•œ-ìƒì„±"><a href="#ê¶Œí•œ-ìƒì„±" class="headerlink" title="ê¶Œí•œ ìƒì„±"></a>ê¶Œí•œ ìƒì„±</h5><ol><li>ì—­í•¢ ë§Œë“¤ê¸°ë¥¼ ëˆ„ë¥¸ë‹¤.</li><li>ì‚¬ìš© ì‚¬ë¡€ëŠ” lambdaë¡œ</li><li>SQS ê²€ìƒ‰í•´ì„œ ì¶”ê°€</li><li>ë¡œê·¸ë¥¼ ë³´ê¸° ìœ„í•´ CloudWatchë„ ì¶”ê°€</li><li>íƒœê·¸ëŠ” ëŒ€ì¶©..</li><li>ë§ˆì§€ë§‰ìœ¼ë¡œ í™•ì¸ í›„ ìƒì„±</li></ol><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564912498/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.38.44_lct92b.png" alt="ê¶Œí•œ - 1"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564912540/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.38.56_v6dtw7.png" alt="ê¶Œí•œ - 2"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564912589/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.39.09_v6vw41.png" alt="ê¶Œí•œ - 3"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564912658/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.39.29_y0lhjm.png" alt="ê¶Œí•œ - 4"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564912715/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.39.45_jtepdo.png" alt="ê¶Œí•œ - 5"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564912754/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.40.11_rdb3ou.png" alt="ê¶Œí•œ - 6"></p><h5 id="Lambda-ìƒì„±"><a href="#Lambda-ìƒì„±" class="headerlink" title="Lambda ìƒì„±"></a>Lambda ìƒì„±</h5><ol><li>ìœ„ì—ì„œ ë§Œë“  ê¶Œí•œì„ ì—°ê²°</li><li>ì½”ë“œë¥¼ ì‘ì„± í•´ì„œ Lambdaì— ì—…ë¡œë“œ</li></ol><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564912834/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.40.59_q8qvy2.png" alt="ê¶Œí•œì—°ê²°"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564912900/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.41.50_ichu61.png" alt="ê²°ê³¼"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564912947/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.42.06_spxuby.png" alt="íŠ¸ë¦¬ê±°ì¶”ê°€"></p><p>ì•„ë˜ì˜ ì½”ë“œëŠ” ëŒ€ê¸°ì—´ì´ ë§Œë“  ë©”ì„¸ì§€ IDë¥¼ ê¸°ë°˜ìœ¼ë¡œ dynamodbì—ì„œ ì²´í¬ë¥¼ í•œ ë‹¤ìŒì— ë„£ëŠ”ë‹¤.</p><p>ì‹¤ë¬´ì—ì„œ ì•ˆ ì¨ ë´¤ê¸°ì— AWS ì»¤ë®¤ë‹ˆí‹°ì— ì§ˆë¬¸í•œ ê²°ê³¼ ì´ëŸ° ì‹ìœ¼ë¡œ í•˜ëŠ” ê²Œ ë§ë‹¤ê³  í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;&#x27;</span>, <span class="comment">// ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;&#x27;</span>, <span class="comment">// IAM</span></span><br><span class="line">  secretAccessKey: <span class="string">&#x27;&#x27;</span> <span class="comment">// IAM</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sqs = <span class="keyword">new</span> AWS.SQS(&#123; <span class="attr">apiVersion</span>: <span class="string">&#x27;2012-11-05&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.handler = <span class="keyword">async</span> (event) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * body: ë‚´ê°€ ë³´ë‚¸ ë©”ì„¸ì§€</span></span><br><span class="line"><span class="comment">   * messageId: uniqueì¸ì§„ ëª¨ë¥´ê² ì§€ë§Œ ë©”ì„¸ì§€ ì•„ë””ê°€ ì¡´ì¬</span></span><br><span class="line"><span class="comment">   * receiptHandle: ë©”ì„¸ì§€ë¥¼ íì—ì„œ ì§€ìš°ê¸° ìœ„í•œ íŒŒë¼ë¯¸í„°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> &#123; body, messageId, receiptHandle &#125; = event.Records[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> message = <span class="built_in">JSON</span>.parse(body);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> haveData;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> params = &#123;</span><br><span class="line">      TableName: <span class="string">&#x27;í…Œì´ë¸”ëª…&#x27;</span>,</span><br><span class="line">      Key: &#123;</span><br><span class="line">        messageId: messageId,</span><br><span class="line">        dtm: <span class="built_in">Number</span>(message.dtm),</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    haveData = <span class="keyword">await</span> dynamo.get(params).promise();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;sqs worker err&#x27;</span>, e);</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">statusCode</span>: <span class="number">500</span>, <span class="attr">message</span>: <span class="string">&#x27;sqs worker err&#x27;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> haveData !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> putParams = &#123;</span><br><span class="line">        TableName: <span class="string">&#x27;í…Œì´ë¸”ëª…&#x27;</span>,</span><br><span class="line">        Item: &#123;</span><br><span class="line">          messageId: messageId,</span><br><span class="line">          dtm: <span class="built_in">Number</span>(message.dtm),</span><br><span class="line">          action: message.action</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">if</span> (message.action === <span class="string">&#x27;purchase&#x27;</span>) params.Item.item = message.item;</span><br><span class="line">      <span class="keyword">if</span> (message.action === <span class="string">&#x27;search&#x27;</span>) params.Item.search = message.word;</span><br><span class="line">      <span class="keyword">const</span> removeParams = &#123; <span class="attr">QueueUrl</span>: <span class="string">&#x27;SQS URL&#x27;</span>, ReceiptHandle &#125;;</span><br><span class="line">      <span class="keyword">await</span> <span class="built_in">Promise</span>.all([</span><br><span class="line">        dynamo.put(putParams).promise(),</span><br><span class="line">        sqs.deleteMessage(removeParams).promise(),</span><br><span class="line">      ]);</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">statusCode</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">&#x27;sqs worker success&#x27;</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;sqs worker err&#x27;</span>, e);</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">statusCode</span>: <span class="number">500</span>, <span class="attr">message</span>: <span class="string">&#x27;sqs worker err&#x27;</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="í…ŒìŠ¤íŠ¸"><a href="#í…ŒìŠ¤íŠ¸" class="headerlink" title="í…ŒìŠ¤íŠ¸"></a>í…ŒìŠ¤íŠ¸</h4><p>ì½”ë“œë¥¼ ì‹¤í–‰ í•˜ê¸° ì „ì— DynamoDBë¥¼ ìƒì„± í•œë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564913031/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.44.24_r35cg0.png" alt="dynamodb"></p><p>ìš”ì²­ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564913314/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.08.22_nhela2.png" alt="request"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1564913351/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-04_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_6.17.38_il4lgl.png" alt="response"></p><h3 id="FIFO"><a href="#FIFO" class="headerlink" title="FIFO"></a>FIFO</h3><h4 id="sqs-ìƒì„±"><a href="#sqs-ìƒì„±" class="headerlink" title="sqs ìƒì„±"></a>sqs ìƒì„±</h4><p>fifo ë°©ì‹ì€ ëŒ€ê¸°ì—´ ì´ë¦„ ë’¤ì— .fifoë¥¼ ë¶™ì—¬ì•¼ í•œë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1586187582/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-06_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_11.55.41_ymmkdq.png" alt="SQS ìƒì„±"></p><p>ì•„ë˜ì— ëŒ€ê¸°ì—´ ìƒì„± íŒŒë‘ ë²„íŠ¼ í´ë¦­</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1586188170/eqweqwe_ynydaf.png" alt="SQS ìƒì„± ì™„ë£Œ"></p><p>ìƒì„± ì™„ë£Œ ì‹œ ì•„ë˜ì˜ URLì€ ë‚˜ì¤‘ì— í•„ìš”.</p><h4 id="sender-1"><a href="#sender-1" class="headerlink" title="sender"></a>sender</h4><p>ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ ë³¸ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;&#x27;</span>, <span class="comment">// ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;&#x27;</span>, <span class="comment">// IAM</span></span><br><span class="line">  secretAccessKey: <span class="string">&#x27;&#x27;</span> <span class="comment">// IAM</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sqs = <span class="keyword">new</span> AWS.SQS(&#123; <span class="attr">apiVersion</span>: <span class="string">&#x27;2012-11-05&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> randomStr = <span class="function">(<span class="params">len</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> characters = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> charactersLength = characters.length;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">    result += characters.charAt(<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * charactersLength));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sendMessage = <span class="function">(<span class="params">type, id, body</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> params = &#123;</span><br><span class="line">    QueueUrl: <span class="string">&#x27;SQSì—ì„œ ë°œê¸‰í•œ URL&#x27;</span>,</span><br><span class="line">    MessageBody: <span class="built_in">JSON</span>.stringify(body), <span class="comment">// <span class="doctag">NOTE:</span> ë³´ë‚¼ ë©”ì„¸ì§€</span></span><br><span class="line">    MessageGroupId: type, <span class="comment">// <span class="doctag">NOTE:</span> ë©”ì‹œì§€ ê·¸ë£¹ ID íŠ¹ì • ë©”ì‹œì§€ ê·¸ë£¹ì— ì†í•œ ë©”ì‹œì§€ë¥¼ ì§€ì •í•˜ëŠ” íƒœê·¸. ë™ì¼í•œ ë©”ì‹œì§€ ê·¸ë£¹ì— ì†í•œ ë©”ì‹œì§€ëŠ” ë©”ì‹œì§€ ê·¸ë£¹ì— ë”°ë¼ ì—„ê²©í•œ ìˆœì„œë¡œ í•­ìƒ í•˜ë‚˜ì”© ì²˜ë¦¬ë©ë‹ˆë‹¤</span></span><br><span class="line">    MessageDeduplicationId: <span class="string">`<span class="subst">$&#123;id&#125;</span>:<span class="subst">$&#123;<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()&#125;</span>:<span class="subst">$&#123;randomStr(<span class="number">5</span>)&#125;</span>`</span>, <span class="comment">// <span class="doctag">NOTE:</span> ë©”ì‹œì§€ ì¤‘ë³µ ì œê±° ID ì „ì†¡ëœ ë©”ì‹œì§€ì˜ ì¤‘ë³µ ì œê±°ì— ì‚¬ìš©ë˜ëŠ” í† í°. íŠ¹ì • ë©”ì‹œì§€ ì¤‘ë³µ ì œê±° IDê°€ ìˆëŠ” ë©”ì‹œì§€ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡í•œ ê²½ìš°, ë©”ì‹œì§€ ì¤‘ë³µ ì œê±° IDê°€ ë™ì¼í•œ ëª¨ë“  ë©”ì‹œì§€ëŠ” ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì‹ ë˜ì§€ë§Œ ì¤‘ë³µ ì œê±° ê°„ê²©ì¸ 5ë¶„ ë™ì•ˆì€ ì „ë‹¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = sqs.sendMessage(params).promise();</span><br><span class="line">    result.then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;ì„±ê³µí•œ ë©”ì„¸ì§€&#x27;</span>, <span class="built_in">JSON</span>.stringify((data)));</span><br><span class="line">      resolve(data);</span><br><span class="line">    &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;ì‹¤íŒ¨í•œ ë©”ì„¸ì§€&#x27;</span>, <span class="built_in">JSON</span>.stringify(params));</span><br><span class="line">      reject(e);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">sendMessage(<span class="string">&#x27;join&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, &#123;<span class="attr">id</span>: <span class="string">&#x27;a&#x27;</span>, <span class="attr">ts</span>: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(), <span class="attr">message</span>: <span class="string">&#x27;hihi&#x27;</span>&#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;a - send success&#x27;</span>);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;e&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  sendMessage(<span class="string">&#x27;join&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, &#123;<span class="attr">id</span>: <span class="string">&#x27;b&#x27;</span>, <span class="attr">ts</span>: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(), <span class="attr">message</span>: <span class="string">&#x27;hello&#x27;</span>&#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;b - send success&#x27;</span>);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;e&#x27;</span>, e);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  sendMessage(<span class="string">&#x27;join&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, &#123;<span class="attr">id</span>: <span class="string">&#x27;c&#x27;</span>, <span class="attr">ts</span>: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(), <span class="attr">message</span>: <span class="string">&#x27;ë‚˜ë¹„ë³´ë²³ë”°ìš°&#x27;</span>&#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;c - send success&#x27;</span>);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;e&#x27;</span>, e);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="number">500</span>);</span><br></pre></td></tr></table></figure><p>ì „ì†¡ ìˆœì„œëŠ” a -&gt; c -&gt; bë‹¤.</p><h4 id="receiver-1"><a href="#receiver-1" class="headerlink" title="receiver"></a>receiver</h4><h5 id="ê¶Œí•œ-ìƒì„±-1"><a href="#ê¶Œí•œ-ìƒì„±-1" class="headerlink" title="ê¶Œí•œ ìƒì„±"></a>ê¶Œí•œ ìƒì„±</h5><p>ìœ„ì—ì„œ ë§Œë“  í‘œì¤€ SQS ì—­í• ê³¼ ê°™ë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1586188248/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-07_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_12.03.26_j5igud.png" alt="IAM ìƒì„±"></p><h5 id="Lambda-ìƒì„±-1"><a href="#Lambda-ìƒì„±-1" class="headerlink" title="Lambda ìƒì„±"></a>Lambda ìƒì„±</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;&#x27;</span>, <span class="comment">// ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;&#x27;</span>, <span class="comment">// IAM</span></span><br><span class="line">  secretAccessKey: <span class="string">&#x27;&#x27;</span> <span class="comment">// IAM</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ddb = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient(&#123; <span class="attr">apiVersion</span>: <span class="string">&#x27;2012-08-10&#x27;</span> &#125;);</span><br><span class="line"><span class="keyword">const</span> sqs = <span class="keyword">new</span> AWS.SQS(&#123; <span class="attr">apiVersion</span>: <span class="string">&#x27;2012-11-05&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.handler = <span class="keyword">async</span> (event) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> body = <span class="built_in">JSON</span>.parse(event.Records[<span class="number">0</span>].body);</span><br><span class="line">  <span class="keyword">const</span> receiptHandle = event.Records[<span class="number">0</span>].receiptHandle;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;body&#x27;</span>, body);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;receiptHandle&#x27;</span>, receiptHandle);</span><br><span class="line">  <span class="keyword">const</span> putParams = &#123;</span><br><span class="line">    TableName: <span class="string">&#x27;receive&#x27;</span>,</span><br><span class="line">    Item: &#123;</span><br><span class="line">      id: body.id,</span><br><span class="line">      timestamp: body.ts,</span><br><span class="line">      message: body.message,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> sqsParams = &#123;</span><br><span class="line">    QueueUrl: <span class="string">&#x27;SQSì—ì„œ ë°œê¸‰í•˜ëŠ” URL&#x27;</span>,</span><br><span class="line">    ReceiptHandle: receiptHandle, <span class="comment">// <span class="doctag">NOTE:</span> í•´ë‹¹ ë©”ì„¸ì§€ì˜ UUIDë¼ ìƒê°í•˜ë©´ ë ë“¯.</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">Promise</span>.all([</span><br><span class="line">      ddb.put(putParams).promise(), <span class="comment">// <span class="doctag">NOTE:</span> dynamodbì— ì €ì¥</span></span><br><span class="line">      sqs.deleteMessage(sqsParams).promise(), <span class="comment">// <span class="doctag">NOTE:</span> ìˆ˜ì‹ í•œ ë©”ì„¸ì§€ëŠ” ì‚­ì œ</span></span><br><span class="line">    ]);</span><br><span class="line">    <span class="keyword">const</span> response = &#123;</span><br><span class="line">      statusCode: <span class="number">200</span>,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(<span class="string">&#x27;receive success&#x27;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;e&#x27;</span>, e);</span><br><span class="line">    <span class="keyword">const</span> response = &#123;</span><br><span class="line">      statusCode: <span class="number">500</span>,</span><br><span class="line">      body: <span class="built_in">JSON</span>.stringify(<span class="string">&#x27;receive err&#x27;</span>),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="Lambda-íŠ¸ë¦¬ê±°-ì„¤ì •"><a href="#Lambda-íŠ¸ë¦¬ê±°-ì„¤ì •" class="headerlink" title="Lambda íŠ¸ë¦¬ê±° ì„¤ì •"></a>Lambda íŠ¸ë¦¬ê±° ì„¤ì •</h5><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1586188519/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-07_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_12.16.55_hvzumg.png" alt="lambda íŠ¸ë¦¬ê±° ì„¤ì •"></p><h5 id="í…ŒìŠ¤íŠ¸-1"><a href="#í…ŒìŠ¤íŠ¸-1" class="headerlink" title="í…ŒìŠ¤íŠ¸"></a>í…ŒìŠ¤íŠ¸</h5><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1586188696/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-07_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_12.56.55_ntkiob.png" alt="cloudwatch ê²°ê³¼"></p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1586188637/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-04-07_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_12.56.35_hamng2.png" alt="dynamodb ê²°ê³¼"></p><p>í—ˆìš©ë˜ëŠ” ë²”ìœ„ì˜ ë©”ì„¸ì§€ì˜ ìˆ˜ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë´ì•¼ ì •í™•í•˜ë‚˜ ìš°ì„ ì€ ì˜ë„í•œëŒ€ë¡œ í”„ë¡œì„¸ìŠ¤ëŠ” ì‘ë™ í–ˆë‹¤.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://sarc.io/index.php/miscellaneous/1615-message-queue-mq">Message Queue (MQ) ë€ ë¬´ì—‡ì¼ê¹Œ</a></li><li><a href="https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/sqs-examples-send-receive-messages.html">Amazon SQS Node.js ì˜ˆì œ</a></li><li><a href="https://docs.aws.amazon.com/ko_kr/AWSSimpleQueueService/latest/SQSDeveloperGuide/using-messagegroupid-property.html">Amazon SQS ë©”ì‹œì§€ ê·¸ë£¹ ID ì‚¬ìš©</a></li><li><a href="https://docs.aws.amazon.com/ko_kr/AWSSimpleQueueService/latest/SQSDeveloperGuide/using-messagededuplicationid-property.html">Amazon SQS ë©”ì‹œì§€ ì¤‘ë³µ ì œê±° ID ì‚¬ìš©</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Expressì—ì„œ Swaggerë¥¼ ì´ìš©í•œ API DOC ë§Œë“¤ê¸°</title>
      <link href="/2020/01/12/nodejs-express-swagger/"/>
      <url>/2020/01/12/nodejs-express-swagger/</url>
      
        <content type="html"><![CDATA[<p>íŒ€ì›ì— ì˜í•´ ì•Œê²Œ ëœ swagger! ê¶ê¸ˆí•´ì„œ í•œ ë²ˆ ë„ì „í•´ë´£ë‹¤.</p><h2 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add swagger-ui-express</span><br></pre></td></tr></table></figure><h2 id="swagger-document-ì‘ì„±"><a href="#swagger-document-ì‘ì„±" class="headerlink" title="swagger document ì‘ì„±"></a>swagger document ì‘ì„±</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  openapi: <span class="string">&#x27;3.0.1&#x27;</span>,</span><br><span class="line">  info: &#123;</span><br><span class="line">    version: <span class="string">&#x27;0.0.1&#x27;</span>,</span><br><span class="line">    title: <span class="string">&#x27;swagger ì ìš©í•´ë³´ê¸°.&#x27;</span>,</span><br><span class="line">    description: <span class="string">&#x27;example API&#x27;</span>,</span><br><span class="line">    termsOfService: <span class="string">&#x27;http://api_url/terms/&#x27;</span>,</span><br><span class="line">    contact: &#123;</span><br><span class="line">      name: <span class="string">&#x27;delryn&#x27;</span>,</span><br><span class="line">      email: <span class="string">&#x27;hidelryn@gmail.com&#x27;</span>,</span><br><span class="line">      url: <span class="string">&#x27;https://hidelryn@github.io&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    license: &#123;</span><br><span class="line">      name: <span class="string">&#x27;Apache 2.0&#x27;</span>,</span><br><span class="line">      url: <span class="string">&#x27;https://www.apache.org/licenses/LICENSE-2.0.html&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  servers: [</span><br><span class="line">    &#123;</span><br><span class="line">      url: <span class="string">&#x27;http://localhost:3000/&#x27;</span>,</span><br><span class="line">      description: <span class="string">&#x27;Local server&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      url: <span class="string">&#x27;https://api_url_testing&#x27;</span>,</span><br><span class="line">      description: <span class="string">&#x27;Testing server&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      url: <span class="string">&#x27;https://api_url_production&#x27;</span>,</span><br><span class="line">      description: <span class="string">&#x27;Production server&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  security: [</span><br><span class="line">    &#123;</span><br><span class="line">      ApiKeyAuth: []</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  tags: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">&#x27;test operations&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  paths: &#123;</span><br><span class="line">    <span class="string">&#x27;/getUser&#x27;</span>: &#123;</span><br><span class="line">      get: &#123;</span><br><span class="line">        tags: [<span class="string">&#x27;test operations&#x27;</span>],</span><br><span class="line">        description: <span class="string">&#x27;ìœ ì € ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°&#x27;</span>,</span><br><span class="line">        operationId: <span class="string">&#x27;getUser&#x27;</span>,</span><br><span class="line">        parameters: [</span><br><span class="line">          &#123;</span><br><span class="line">            name: <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">            <span class="keyword">in</span>: <span class="string">&#x27;query&#x27;</span>,</span><br><span class="line">            <span class="string">&quot;schema&quot;</span>: &#123;</span><br><span class="line">              <span class="string">&quot;$ref&quot;</span>: <span class="string">&quot;#/components/schemas/userid&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">        responses: &#123;</span><br><span class="line">          <span class="string">&#x27;200&#x27;</span>: &#123;</span><br><span class="line">            description: <span class="string">&#x27;ìœ ì € ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°&#x27;</span>,</span><br><span class="line">            content: &#123;</span><br><span class="line">              <span class="string">&#x27;application/json&#x27;</span>: &#123;</span><br><span class="line">                schema: &#123;</span><br><span class="line">                  $ref: <span class="string">&#x27;#/components/schemas/User&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&#x27;400&#x27;</span>: &#123;</span><br><span class="line">            description: <span class="string">&#x27;íŒŒë¼ë¯¸í„°ê°€ ìƒëµ ë ì—ˆìŒ&#x27;</span>,</span><br><span class="line">            content: &#123;</span><br><span class="line">              <span class="string">&#x27;application/json&#x27;</span>: &#123;</span><br><span class="line">                schema: &#123;</span><br><span class="line">                  $ref: <span class="string">&#x27;#/components/schemas/Error&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                example: &#123;</span><br><span class="line">                  message: <span class="string">&#x27;idê°€ ìƒëµ ë˜ì—ˆìŒ&#x27;</span>,</span><br><span class="line">                  internal_code: <span class="string">&#x27;missing_parameters&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;/createUser&quot;</span>: &#123;</span><br><span class="line">      post: &#123;</span><br><span class="line">        tags: [<span class="string">&#x27;test operations&#x27;</span>],</span><br><span class="line">        description: <span class="string">&#x27;ìœ ì € ë°ì´í„° ìƒì„±&#x27;</span>,</span><br><span class="line">        operationId: <span class="string">&#x27;createUser&#x27;</span>,</span><br><span class="line">        parameters: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">            <span class="string">&quot;in&quot;</span>: <span class="string">&quot;body&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;ìœ ì € ì´ë¦„&quot;</span>,</span><br><span class="line">            <span class="string">&quot;schema&quot;</span>: &#123;</span><br><span class="line">              <span class="string">&quot;$ref&quot;</span>: <span class="string">&quot;#/components/schemas/username&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;age&quot;</span>,</span><br><span class="line">            <span class="string">&quot;in&quot;</span>: <span class="string">&quot;body&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;ìœ ì € ë‚˜ì´&quot;</span>,</span><br><span class="line">            <span class="string">&quot;schema&quot;</span>: &#123;</span><br><span class="line">              <span class="string">&quot;$ref&quot;</span>: <span class="string">&quot;#/components/schemas/userage&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            required: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        requestBody: &#123;</span><br><span class="line">          content: &#123;</span><br><span class="line">            <span class="string">&#x27;application/json&#x27;</span>: &#123;</span><br><span class="line">              schema: &#123;</span><br><span class="line">                $ref: <span class="string">&#x27;#/components/schemas/reqUser&#x27;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              required: <span class="literal">true</span>,</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        responses: &#123;</span><br><span class="line">          <span class="string">&#x27;200&#x27;</span>: &#123;</span><br><span class="line">            description: <span class="string">&#x27;ìœ ì € ìƒì„± ì™„ë£Œ&#x27;</span>,</span><br><span class="line">            content: &#123;</span><br><span class="line">              <span class="string">&#x27;application/json&#x27;</span>: &#123;</span><br><span class="line">                schema: &#123;</span><br><span class="line">                  $ref: <span class="string">&#x27;#/components/schemas/User&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&#x27;400&#x27;</span>: &#123;</span><br><span class="line">            description: <span class="string">&#x27;íŒŒë¼ë¯¸í„°ê°€ ìƒëµ ë˜ì—ˆìŒ&#x27;</span>,</span><br><span class="line">            content: &#123;</span><br><span class="line">              <span class="string">&#x27;application/json&#x27;</span>: &#123;</span><br><span class="line">                schema: &#123;</span><br><span class="line">                  $ref: <span class="string">&#x27;#/components/schemas/Error&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                example: &#123;</span><br><span class="line">                  message: <span class="string">&#x27;ì´ë¦„ ë˜ëŠ” ë‚˜ì´ê°€ ìƒëµ ë˜ì—ˆë‹¤&#x27;</span>,</span><br><span class="line">                  internal_code: <span class="string">&#x27;invalid_parameters&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    schemas: &#123;</span><br><span class="line">      userid: &#123;</span><br><span class="line">        type: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">        description: <span class="string">&#x27;ìœ ì € ê³ ìœ  ì•„ì´ë””&#x27;</span>,</span><br><span class="line">        example: <span class="string">&#x27;qjrkqnek23nvie&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      username: &#123;</span><br><span class="line">        type: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">        description: <span class="string">&#x27;ìœ ì € ì´ë¦„&#x27;</span>,</span><br><span class="line">        example: <span class="string">&#x27;delryn&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      userage: &#123;</span><br><span class="line">        type: <span class="string">&#x27;integer&#x27;</span>,</span><br><span class="line">        description: <span class="string">&#x27;ìœ ì € ë‚˜ì´&#x27;</span>,</span><br><span class="line">        example: <span class="number">33</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      reqUser: &#123;</span><br><span class="line">        type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          name: &#123;</span><br><span class="line">            $ref: <span class="string">&#x27;#/components/schemas/username&#x27;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          age: &#123;</span><br><span class="line">            $ref: <span class="string">&#x27;#/components/schemas/userage&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      User: &#123;</span><br><span class="line">        type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          id: &#123;</span><br><span class="line">            $ref: <span class="string">&#x27;#/components/schemas/userid&#x27;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          name: &#123;</span><br><span class="line">            $ref: <span class="string">&#x27;#/components/schemas/username&#x27;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          age: &#123;</span><br><span class="line">            $ref: <span class="string">&#x27;#/components/schemas/userage&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// Users: &#123;</span></span><br><span class="line">      <span class="comment">//   type: &#x27;object&#x27;,</span></span><br><span class="line">      <span class="comment">//   properties: &#123;</span></span><br><span class="line">      <span class="comment">//     users: &#123;</span></span><br><span class="line">      <span class="comment">//       type: &#x27;array&#x27;,</span></span><br><span class="line">      <span class="comment">//       items: &#123;</span></span><br><span class="line">      <span class="comment">//         $ref: &#x27;#/components/schemas/User&#x27;</span></span><br><span class="line">      <span class="comment">//       &#125;</span></span><br><span class="line">      <span class="comment">//     &#125;</span></span><br><span class="line">      <span class="comment">//   &#125;</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">      <span class="built_in">Error</span>: &#123;</span><br><span class="line">        type: <span class="string">&#x27;object&#x27;</span>,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          message: &#123;</span><br><span class="line">            type: <span class="string">&#x27;string&#x27;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          internal_code: &#123;</span><br><span class="line">            type: <span class="string">&#x27;string&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ì½”ë“œë¡œ api ë¬¸ì„œë¥¼ ì •ì˜í•œë‹¤ê³  ìƒê°í•˜ë©´ ë¨.</p><h2 id="ì–´í”Œë¦¬ì¼€ì´ì…˜-ì ìš©"><a href="#ì–´í”Œë¦¬ì¼€ì´ì…˜-ì ìš©" class="headerlink" title="ì–´í”Œë¦¬ì¼€ì´ì…˜ ì ìš©"></a>ì–´í”Œë¦¬ì¼€ì´ì…˜ ì ìš©</h2><p>ê°„ë‹¨í•œ api ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‘ì„± í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> nanoid = <span class="built_in">require</span>(<span class="string">&#x27;nanoid&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> swaggerUi = <span class="built_in">require</span>(<span class="string">&#x27;swagger-ui-express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> swaggerDocument = <span class="built_in">require</span>(<span class="string">&#x27;./swagger.js&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"><span class="keyword">const</span> redisClient = redis.createClient();</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">  extended: <span class="literal">true</span></span><br><span class="line">&#125;));</span><br><span class="line">app.use(<span class="string">&#x27;/api-docs&#x27;</span>, swaggerUi.serve, swaggerUi.setup(swaggerDocument));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/getUser&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> userId = req.query.id;</span><br><span class="line">  <span class="keyword">if</span> (!userId) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">400</span>, <span class="attr">message</span>: <span class="string">&#x27;Missing parameters&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  redisClient.hget(<span class="string">&#x27;swaggerUser&#x27;</span>, userId, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">500</span>, <span class="attr">message</span>: <span class="string">&#x27;System error&#x27;</span> &#125;);</span><br><span class="line">    <span class="keyword">if</span> (!data) <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">403</span>, <span class="attr">message</span>: <span class="string">&#x27;None user&#x27;</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> parse = <span class="built_in">JSON</span>.parse(data);</span><br><span class="line">    <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">200</span>, <span class="attr">data</span>: parse &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/createUser&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; name, age &#125; = req.body;</span><br><span class="line">  <span class="keyword">if</span> (!age || !name) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">500</span>, <span class="attr">message</span>: <span class="string">&#x27;Missing parameters&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> id = nanoid();</span><br><span class="line">  <span class="keyword">const</span> data = &#123;id, name, age&#125;;</span><br><span class="line">  redisClient.hset(<span class="string">&#x27;swaggerUser&#x27;</span>, id, <span class="built_in">JSON</span>.stringify(data), <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">500</span>, <span class="attr">message</span>: <span class="string">&#x27;System error&#x27;</span> &#125;);</span><br><span class="line">    <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">200</span>, data &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;server is listening&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì‹¤ì œ swagger ì ìš©í•œ ì½”ë“œëŠ” ì´ëŸ¬í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> swaggerUi = <span class="built_in">require</span>(<span class="string">&#x27;swagger-ui-express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> swaggerDocument = <span class="built_in">require</span>(<span class="string">&#x27;./swagger.js&#x27;</span>);</span><br><span class="line">app.use(<span class="string">&#x27;/api-docs&#x27;</span>, swaggerUi.serve, swaggerUi.setup(swaggerDocument));</span><br></pre></td></tr></table></figure><p>ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ê¸°ë™ ì‹œ localhost:3000/api-docë¡œ ì ‘ì†ì„ í•˜ê²Œ ë˜ë©´ ì ìš©ëœ í™”ë©´ì´ ë‚˜ì˜´.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1578828733/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-01-12_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.31.50_fw12ci.png" alt="ê²°ê³¼"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
            <tag> Swagger </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springì—ì„œ json ë‹¤ë£¨ê¸°</title>
      <link href="/2020/01/05/etc-spring-jackson/"/>
      <url>/2020/01/05/etc-spring-jackson/</url>
      
        <content type="html"><![CDATA[<h2 id="ì˜ì¡´ì„±"><a href="#ì˜ì¡´ì„±" class="headerlink" title="ì˜ì¡´ì„±"></a>ì˜ì¡´ì„±</h2><p>pom.xml(maven)ì— jacksonì„ ì¶”ê°€ í•œë‹¤.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.fasterxml.jackson.core/jackson-databind --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;userId&quot;</span>: <span class="string">&quot;hidelryn&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;12345q&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;gameData&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;gameId&quot;</span>: <span class="string">&quot;a1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;sessionKey&quot;</span>: <span class="string">&quot;qrkqkej2l31qeqk&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;userLocale&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;locale&quot;</span>: <span class="string">&quot;ko_KR&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;createAt&quot;</span>: <span class="number">1578220139</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;delryn&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;scores&quot;</span>: [</span><br><span class="line">      <span class="number">100</span>,</span><br><span class="line">      <span class="number">30</span>,</span><br><span class="line">      <span class="number">60</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;item&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;itemId&quot;</span>: <span class="string">&quot;0_id&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;itemAmount&quot;</span>: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;itemId&quot;</span>: <span class="string">&quot;1_id&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;itemAmount&quot;</span>: <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;itemId&quot;</span>: <span class="string">&quot;2_id&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;itemAmount&quot;</span>: <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;itemId&quot;</span>: <span class="string">&quot;3_id&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;itemAmount&quot;</span>: <span class="number">3</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;itemId&quot;</span>: <span class="string">&quot;4_id&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;itemAmount&quot;</span>: <span class="number">4</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;itemId&quot;</span>: <span class="string">&quot;5_id&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;itemAmount&quot;</span>: <span class="number">5</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìœ„ì™€ ê°™ì€ jsonì„ ë‹¤ë£¨ê¸° ìœ„í•´ì„œ í˜•íƒœ?ì— ë§ëŠ” ë°ì´í„° í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•´ì¤˜ì•¼ í•œë‹¤.</p><p>getter/setterê°€ í•˜ë‚˜ ë¼ë„ ìƒëµ ì‹œ jackson ì˜¤ë¥˜ê°€ ë‚˜ë¯€ë¡œ ì²´í¬ë¥¼ ì˜ í•˜ì.</p><p>ì˜ˆì‹œë¡œ Userë¼ëŠ” í´ë˜ìŠ¤ë¥¼ ì‘ì„±í•´ë³¸ë‹¤. ì†”ì§íˆ ìë°”ìŠ¤í¬ë¦½íŠ¸ì— ë¹„í•´ ì¢€ ê·€ì°¬ë‹¤..</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.delryn.helloworld.model;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> String userId;</span><br><span class="line"><span class="keyword">private</span> String password;</span><br><span class="line"><span class="keyword">private</span> GameData gameData;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> userId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.userId = userId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.password = password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> GameData <span class="title">getGameData</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> gameData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGameData</span><span class="params">(GameData gameData)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.gameData = gameData;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>GameData í´ë˜ìŠ¤.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.delryn.helloworld.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GameData</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> List&lt;Item&gt; items;</span><br><span class="line"><span class="keyword">private</span> String gameId;</span><br><span class="line"><span class="keyword">private</span> String sessionKey;</span><br><span class="line"><span class="keyword">private</span> UserLocale userLocale;</span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="keyword">private</span> List&lt;Integer&gt; scores;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">getItem</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> items;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setItem</span><span class="params">(List&lt;Item&gt; item)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.items = item;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getGameId</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> gameId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGameId</span><span class="params">(String gameId)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.gameId = gameId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getSessionKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> sessionKey;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionKey</span><span class="params">(String sessionKey)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.sessionKey = sessionKey;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> UserLocale <span class="title">getUserLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> userLocale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserLocale</span><span class="params">(UserLocale userLocale)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.userLocale = userLocale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">getScores</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> scores;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setScores</span><span class="params">(List&lt;Integer&gt; scores)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.scores = scores;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>UserLocale í´ë˜ìŠ¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.delryn.helloworld.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserLocale</span> </span>&#123;</span><br><span class="line"><span class="keyword">private</span> Locale locale;</span><br><span class="line"><span class="keyword">private</span> Long createAt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Locale <span class="title">getLocale</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> locale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(Locale locale)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.locale = locale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Long <span class="title">getCreateAt</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> createAt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateAt</span><span class="params">(Long createAt)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.createAt = createAt;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë°ì´í„° ëª¨ë¸ í´ë˜ìŠ¤ê°€ ì™„ë£Œë˜ì—ˆìœ¼ë‹ˆ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì¨ë³´ì.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.delryn.helloworld.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Locale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.delryn.helloworld.model.GameData;</span><br><span class="line"><span class="keyword">import</span> com.delryn.helloworld.model.Item;</span><br><span class="line"><span class="keyword">import</span> com.delryn.helloworld.model.User;</span><br><span class="line"><span class="keyword">import</span> com.delryn.helloworld.model.UserLocale;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Handles requests for the application home page.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(HomeController.class);</span><br><span class="line"></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/resjson&quot;, method = RequestMethod.GET, produces = &quot;application/json&quot;)</span> <span class="comment">// produces = &quot;application/json&quot;ì„ í•´ì¤˜ì•¼ ì‘ë‹µ Content-typeì´ application/jsonì´ ë¨.</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">resJson</span><span class="params">(Locale locale)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> unixTime = System.currentTimeMillis() / <span class="number">1000L</span>;</span><br><span class="line"></span><br><span class="line">UserLocale userLocale = <span class="keyword">new</span> UserLocale();</span><br><span class="line">userLocale.setLocale(locale);</span><br><span class="line">userLocale.setCreateAt(unixTime);</span><br><span class="line"></span><br><span class="line">List&lt;Integer&gt; scores = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">scores.add(<span class="number">100</span>);</span><br><span class="line">scores.add(<span class="number">30</span>);</span><br><span class="line">scores.add(<span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">List&lt;Item&gt; items = <span class="keyword">new</span> ArrayList&lt;Item&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">Item item = <span class="keyword">new</span> Item();</span><br><span class="line">item.setItemId(i + <span class="string">&quot;_id&quot;</span>);</span><br><span class="line">item.setItemAmount(i);</span><br><span class="line">items.add(item);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GameData gameData = <span class="keyword">new</span> GameData();</span><br><span class="line">gameData.setGameId(<span class="string">&quot;a1&quot;</span>);</span><br><span class="line">gameData.setItem(items);</span><br><span class="line">gameData.setSessionKey(<span class="string">&quot;qrkqkej2l31qeqk&quot;</span>);</span><br><span class="line">gameData.setUserLocale(userLocale);</span><br><span class="line">gameData.setName(<span class="string">&quot;delryn&quot;</span>);</span><br><span class="line">gameData.setScores(scores);</span><br><span class="line"></span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setUserId(<span class="string">&quot;hidelryn&quot;</span>);</span><br><span class="line">user.setPassword(<span class="string">&quot;12345q&quot;</span>);</span><br><span class="line">user.setGameData(gameData);</span><br><span class="line"></span><br><span class="line">ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">String result = mapper.writeValueAsString(user);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1578220977/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-01-05_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.42.33_oukrmv.png" alt="ì‘ë‹µ"></p><p>ì˜ë„í•œ ëŒ€ë¡œ ë‚˜ì˜¨ë‹¤. ì´ì œ GET, POSTë¡œ ì˜¤ëŠ” ë°ì´í„°ë¥¼ ì²˜ë¦¬ í•´ë³´ì.</p><h2 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h2><p>getì¸ ê²½ìš° ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì˜ ë°ì´í„°ë¥¼ ë°›ì•„ì•¼ í•˜ëŠ”ë° ë‹¹ì—°íˆ ìŠ¤íŠ¸ë§ì´ë¯€ë¡œ json íŒŒì‹±ì„ í•´ì¤˜ì•¼ í•œë‹¤.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/reqjson&quot;, method = RequestMethod.GET)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">reqJson</span><span class="params">(<span class="meta">@RequestParam(value=&quot;data&quot;, required=false)</span> String data)</span> <span class="keyword">throws</span> IOException </span>&#123; <span class="comment">// @RequestParamì„ í†µí•´ íŒŒë¼ë¯¸í„°ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.</span></span><br><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">User user = objectMapper.readValue(data, User.class);</span><br><span class="line">logger.info(<span class="string">&quot;userId is &#123;&#125;.&quot;</span>, user.getUserId());</span><br><span class="line">logger.info(<span class="string">&quot;password is &#123;&#125;.&quot;</span>, user.getPassword());</span><br><span class="line">logger.info(<span class="string">&quot;gameData - sessionKey is &#123;&#125;.&quot;</span>, user.getGameData().getSessionKey());</span><br><span class="line"><span class="keyword">for</span> (Integer i : user.getGameData().getScores()) &#123;</span><br><span class="line">logger.info(<span class="string">&quot;score is &#123;&#125;.&quot;</span>, i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (Item item : user.getGameData().getItem()) &#123;</span><br><span class="line">logger.info(<span class="string">&quot;itemId is &#123;&#125;, &#123;&#125;. &quot;</span>, item.getItemId(), item.getItemAmount());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë°ì´í„° í´ë˜ìŠ¤ì— ë„£ì–´ì£¼ê¸°ë§Œ í•˜ë©´ ëœë‹¤.</p><h2 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h2><p>postëŠ” íŒŒë¼ë¯¸í„° ë°›ëŠ” ê³³ì— ë°ì´í„° í´ë˜ìŠ¤ë¥¼ ì ì–´ì£¼ë‹ˆ ì•Œì•„ì„œ ë“¤ì–´ì˜´.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/reqjson2&quot;, method = RequestMethod.POST)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">reqJson2</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> <span class="keyword">throws</span> IOException </span>&#123; <span class="comment">// @RequestBodyë¼ëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ì ì–´ì¤˜ì•¼ í•¨.</span></span><br><span class="line">logger.info(<span class="string">&quot;userId is &#123;&#125;.&quot;</span>, user.getUserId());</span><br><span class="line">logger.info(<span class="string">&quot;password is &#123;&#125;.&quot;</span>, user.getPassword());</span><br><span class="line">logger.info(<span class="string">&quot;gameData - sessionKey is &#123;&#125;.&quot;</span>, user.getGameData().getSessionKey());</span><br><span class="line"><span class="keyword">for</span> (Integer i : user.getGameData().getScores()) &#123;</span><br><span class="line">logger.info(<span class="string">&quot;score is &#123;&#125;.&quot;</span>, i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (Item item : user.getGameData().getItem()) &#123;</span><br><span class="line">logger.info(<span class="string">&quot;itemId is &#123;&#125;, &#123;&#125;. &quot;</span>, item.getItemId(), item.getItemAmount());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;ok&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2019/12/20/db-redis/"/>
      <url>/2019/12/20/db-redis/</url>
      
        <content type="html"><![CDATA[<h2 id="redisë€"><a href="#redisë€" class="headerlink" title="redisë€?"></a>redisë€?</h2><ul><li>key-value í˜•ì‹ì˜ NoSQL ë°ì´í„° ë² ì´ìŠ¤</li><li>ì¼ë°˜ì ì¸ DBëŠ” ë””ìŠ¤í¬ì— ì €ì¥ì„ í•˜ëŠ”ë° redisëŠ” ë©”ëª¨ë¦¬ì— ì €ì¥ì„ í•œë‹¤.</li></ul><h2 id="ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆì—ˆë˜-ì "><a href="#ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆì—ˆë˜-ì " class="headerlink" title="ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆì—ˆë˜ ì "></a>ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆì—ˆë˜ ì </h2><ul><li>ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë‹¤ì–‘í•˜ê²Œ ë‹¤ë¤„ë³´ì§„ ì•Šì•˜ì§€ë§Œ ë‚´ê°€ ë‹¤ë¤„ë³¸ ê±° ì¤‘ì—ëŠ” ì½ê³ /ì“°ê¸°ê°€ ì œì¼ ë¹¨ëìŒ</li><li>ë‹¤ì–‘í•œ ë°ì´í„° íƒ€ì…ì´ ì¡´ì¬ í•œë‹¤.</li></ul><h2 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h2><p>Macì˜ ê²½ìš° brewë¥¼ í†µí•´ ì„¤ì¹˜</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">brew install redis</span><br><span class="line">brew services start redis</span><br><span class="line">redis-server -v <span class="comment"># ë²„ì „ í™•ì¸</span></span><br></pre></td></tr></table></figure><p>ì‹¤í–‰í•  í´ë”ì—ì„œ í„°ë¯¸ë„ì„ ì—´ê³  ë‹¤ìŒì˜ ëª…ë ¹ì–´ë¥¼ ì…ë ¥ í•œë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm i redis -S <span class="comment"># node.js redis client</span></span><br></pre></td></tr></table></figure><h2 id="redis-ë°ì´í„°-íƒ€ì…"><a href="#redis-ë°ì´í„°-íƒ€ì…" class="headerlink" title="redis ë°ì´í„° íƒ€ì…"></a>redis ë°ì´í„° íƒ€ì…</h2><p>ë°ì´í„° íƒ€ì…ì˜ ëª…ë ¹ì–´ë“¤ì´ ì—„ì²­ ë§ê¸° ë•Œë¬¸ì— ì „ë¶€ ì“°ê¸°ëŠ” ë¶ˆê°€ëŠ¥ í•´ì„œ ìµœëŒ€í•œ ì¨ ë³¸ ìœ„ì£¼ë¡œ ì‘ì„±</p><h3 id="ê³µí†µ"><a href="#ê³µí†µ" class="headerlink" title="ê³µí†µ"></a>ê³µí†µ</h3><p>redisì— ì—°ê²°í•˜ê¸° ìœ„í•œ ì½”ë“œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> redisClient = redis.createClient(<span class="number">6379</span>, <span class="string">&#x27;localhost&#x27;</span>);</span><br></pre></td></tr></table></figure><h3 id="strings"><a href="#strings" class="headerlink" title="strings"></a>strings</h3><p>key - valueë¥¼ ì €ì¥í•  ìˆ˜ ìˆëŠ” ë°ì´í„° íƒ€ì…ì´ë‹¤.</p><p>ëª¨ë“  ë°ì´í„°(ìˆ«ì, ë¬¸ì, JSON, ê¸°íƒ€ ë“±ë“±)ë¥¼ ì“¸ ìˆ˜ ìˆìœ¼ë‚˜ ì½ì„ ë•ŒëŠ” ë°ì´í„° íƒ€ì…ì´</p><p>stringìœ¼ë¡œ ë˜ì–´ ìˆë‹¤ ê·¸ë˜ì„œ íƒ€ì… ì´ë¦„ì´ stringì¸ê°€..? í¬ê¸°ëŠ” 512MBê¹Œì§€ ê°€ëŠ¥</p><h4 id="set-mset"><a href="#set-mset" class="headerlink" title="set, mset"></a>set, mset</h4><ul><li>setì€ í•˜ë‚˜ì˜ keyì™€ valueë¥¼ ì €ì¥ì„ í•œë‹¤.</li><li>msetì€ ì—¬ëŸ¬ ê°œì˜ key, valueë¥¼ ì €ì¥í•  ë•Œ ì“´ë‹¤.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redisClient.set(<span class="string">&#x27;key&#x27;</span>, <span class="number">1</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// OK</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.mset([<span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>, <span class="number">2</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123; <span class="comment">// ì—´ ì•ˆì— [key, value ...]</span></span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// OK</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="get-mget"><a href="#get-mget" class="headerlink" title="get, mget"></a>get, mget</h4><ul><li>getì€ keyë¥¼ í†µí•´ valueë¥¼ ì½ëŠ”ë‹¤.</li><li>mgetì€ ì—¬ëŸ¬ ê°œì˜ keyë¡œ valueë¥¼ ì½ì„ ë•Œ ì‚¬ìš© í•œë‹¤.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redisClient.get(<span class="string">&#x27;key&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result, <span class="keyword">typeof</span> result); <span class="comment">// value, string</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.mget([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// [&#x27;1&#x27;, &#x27;2&#x27;]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="del"><a href="#del" class="headerlink" title="del"></a>del</h4><p>keyë¥¼ ì‚­ì œ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redisClient.del(<span class="string">&#x27;key&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 1</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="incrby"><a href="#incrby" class="headerlink" title="incrby"></a>incrby</h4><p>í•´ë‹¹ ìˆ«ì ë§Œí¼ ì¦,ê°ì†Œê°€ ì§„í–‰ ëœë‹¤ ì´ ë…€ì„ì€ ì›ìì„±ì„ ì§€ì› í•œë‹¤.</p><p>ì˜ˆë¡œ 0ì¸ ìƒíƒœì—ì„œ Aì—ì„œëŠ” ìˆ«ìë¥¼ 2ë¥¼ ì¦ê°€ ì‹œí‚¤ê³  Bì—ì„œëŠ” 4ë¥¼ ì¦ê°€ í•˜ë¼ëŠ” ê²Œ ë¹„ìŠ·í•œ ì‹œê¸°ì— </p><p>ì¼ì–´ë‚¬ì„ ë•Œ ë®ì–´ì“°ì§€ ì•Šê³  í•˜ë‚˜ í•˜ë‚˜ì”© ì²˜ë¦¬í•˜ì—¬ ì´ 6ì´ ëœë‹¤.</p><p>ê·¸ë¦¬ê³  ì´ëŸ° ì¦,ê°ì†ŒëŠ” ë¦¬í„´ íƒ€ì…ì€ ìˆ«ìë¡œ ë°›ëŠ”ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redisClient.incrby(<span class="string">&#x27;key&#x27;</span>, <span class="number">2</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result, <span class="keyword">typeof</span> result); <span class="comment">// 2, number</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="setex"><a href="#setex" class="headerlink" title="setex"></a>setex</h4><p>ì§€ì •í•œ ì‹œê°„ì´ ì§€ë‚˜ë©´ keyê°€ ì‚­ì œ ëœë‹¤ ë§Œë£Œê°€ í•„ìš”í•œ ìºì‹œë‚˜ ì„¸ì…˜ì— ì¢‹ì€ íƒ€ì…ì´ë‹¤.</p><p>ë‹¨ìœ„ëŠ” ì´ˆ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redisClient.setex(<span class="string">&#x27;Session:UserA&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;abc&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// OK</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="lists"><a href="#lists" class="headerlink" title="lists"></a>lists</h3><p>listëŠ” ìë£Œêµ¬ì¡°ì— ë‚˜ì˜¤ëŠ” ìŠ¤íƒ, íì™€ ê°™ë‹¤ê³  ìƒê° í•˜ë©´ ëœë‹¤.</p><p>ë¦¬ìŠ¤íŠ¸ì— ë°ì´í„°ê°€ í•˜ë‚˜ë„ ì—†ì„ ì‹œ ìë™ìœ¼ë¡œ ì‚­ì œê°€ ë˜ê³  ë¦¬ìŠ¤íŠ¸ê°€ ë³´ìœ í•  ìˆ˜ ìˆëŠ” ë°ì´í„°ì˜ ê°œìˆ˜ëŠ”</p><p>ìµœëŒ€ 2<sup>32</sup> - 1 ì´ë‹¤.</p><h4 id="lpush"><a href="#lpush" class="headerlink" title="lpush"></a>lpush</h4><p>ìŠ¤íƒ, í ì²˜ëŸ¼ ë§ˆì§€ë§‰ì— ì‚½ì… ë˜ê³  ëŒì•„ì˜¤ëŠ” ê²°ê³¼ ê°’ì€ í˜„ì¬ ë¦¬ìŠ¤íŠ¸ì— í¬í•¨ëœ ê°’ì˜ ê°œìˆ˜</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redisClient.lpush(<span class="string">&#x27;MyList&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 1</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.lpush(<span class="string">&#x27;MyList&#x27;</span>, [<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result);  <span class="comment">// 3</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="rpop"><a href="#rpop" class="headerlink" title="rpop"></a>rpop</h4><p>ë¨¼ì € ë“¤ì–´ì˜¨ ë°ì´í„°ë¥¼ êº¼ë‚´ê³  ì‚­ì œ, íë¥¼ ìƒê°í•˜ë©´ ë˜ê² ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redisClient.rpop(<span class="string">&#x27;MyList&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#x27;a&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="lpop"><a href="#lpop" class="headerlink" title="lpop"></a>lpop</h4><p>ë§ˆì§€ë§‰ì— ë“¤ì–´ì˜¨ ë°ì´í„°ë¥¼ êº¼ë‚´ê³  ì‚­ì œ, ìŠ¤íƒì„ ìƒê°í•˜ë©´ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redisClient.lpop(<span class="string">&#x27;MyList&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#x27;d&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="lrange"><a href="#lrange" class="headerlink" title="lrange"></a>lrange</h4><p>ì¸ë±ìŠ¤ë¡œ ë²”ìœ„ë¥¼ ì§€ì •í•´ì„œ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒ í•  ìˆ˜ ìˆë‹¤.</p><p>0, -1ë¡œ í•˜ë©´ ì „ì²´ ì¡°íšŒë¥¼ í•˜ê³  ì¸ë±ìŠ¤ëŠ” ì œì¼ ë§ˆì§€ë§‰ ë°ì´í„°ê°€ 0ë¶€í„° ì‹œì‘ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redisClient.lrange(<span class="string">&#x27;MyList&#x27;</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#x27;c&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="sets"><a href="#sets" class="headerlink" title="sets"></a>sets</h3><p>setsì€ ìˆœì„œê°€ ì—†ê³  ë˜‘ê°™ì€ ë°ì´í„°ê°€ ì—†ëŠ” êµ¬ì¡°ì´ë©° í•˜ë‚˜ì˜ setì´ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ë°ì´í„°ì˜</p><p>ìµœëŒ€ ê°œìˆ˜ëŠ” 2<sup>32</sup> - 1 ì´ë‹¤.</p><h4 id="sadd"><a href="#sadd" class="headerlink" title="sadd"></a>sadd</h4><p>í•˜ë‚˜ ë˜ëŠ” ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆê³  ì„±ê³µ ì‹œ ë¦¬í„´ì€ ì‚½ì…í•œ ê°œìˆ˜ë‹¤. </p><p>ì¤‘ë³µëœ ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°ì—ëŠ” 0ì„ ë°›ëŠ”ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">redisClient.sadd(<span class="string">&#x27;MySet&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 1</span></span><br><span class="line">  redisClient.sadd(<span class="string">&#x27;MySet&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="built_in">console</span>.log(result); <span class="comment">// 0</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.sadd(<span class="string">&#x27;MySet&#x27;</span>, [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 3</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="srem"><a href="#srem" class="headerlink" title="srem"></a>srem</h4><p>í•˜ë‚˜ ë˜ëŠ” ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•  ìˆ˜ ìˆê³  ì„±ê³µ ì‹œ ì‚­ì œëœ ê°œìˆ˜ë¥¼ ë¦¬í„´ ë°›ëŠ”ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redisClient.srem(<span class="string">&#x27;MySet&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 1</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.srem(<span class="string">&#x27;MySet&#x27;</span>, [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 2</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="smembers"><a href="#smembers" class="headerlink" title="smembers"></a>smembers</h4><p>setsì— ì†í•œ ë°ì´í„°ë“¤ì„ ëª¨ë‘ ë³¼ ìˆ˜ ìˆë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redisClient.smembers(<span class="string">&#x27;MySet&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// [&#x27;d&#x27;]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="sunion"><a href="#sunion" class="headerlink" title="sunion"></a>sunion</h4><p>í•©ì§‘í•© ì²˜ëŸ¼ ì—¬ëŸ¬ setsë“¤ì˜ ë°ì´í„°ë“¤ì„ í•©ì³ì„œ ë³¼ ìˆ˜ ìˆë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redisClient.sunion([<span class="string">&#x27;MySet&#x27;</span>, <span class="string">&#x27;MySet2&#x27;</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    [</span></span><br><span class="line"><span class="comment">      &#x27;1&#x27;, &#x27;b&#x27;, &#x27;2&#x27;,</span></span><br><span class="line"><span class="comment">      &#x27;c&#x27;, &#x27;d&#x27;, &#x27;4&#x27;,</span></span><br><span class="line"><span class="comment">      &#x27;3&#x27;</span></span><br><span class="line"><span class="comment">    ]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="srandmember"><a href="#srandmember" class="headerlink" title="srandmember"></a>srandmember</h4><p>setsì˜ ë°ì´í„°ë“¤ ì¤‘ ëœë¤ìœ¼ë¡œ í•˜ë‚˜ ê°€ì§€ê³  ì˜¨ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redisClient.srandmember(<span class="string">&#x27;MySet2&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 1, 2, 3, 4 ì¤‘ ì•„ë¬´ê±°ë‚˜ </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="sscan"><a href="#sscan" class="headerlink" title="sscan"></a>sscan</h4><p>ë°ì´í„°ê°€ ì—„ì²­ í° setsì—ì„œ smembersë¥¼ í˜¸ì¶œ í•˜ëŠ” ê²½ìš° ì²˜ë¦¬ í•˜ëŠ” ë™ì•ˆ ë‹¤ë¥¸ ìš”ì²­ì— ì‘ë‹µ í•˜ì§ˆ</p><p>ì•Šìœ¼ë¯€ë¡œ ê·¸ëŸ´ ê²½ìš° sscanì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤ê³  í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sscan = <span class="function">(<span class="params">cursor, arr, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  redisClient.sscan(<span class="string">&#x27;MySet3&#x27;</span>, cursor, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> nextCursor = <span class="built_in">Number</span>(data[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">const</span> result = arr.concat(data[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span> (nextCursor === <span class="number">0</span>) <span class="keyword">return</span> cb(<span class="literal">null</span>, result);</span><br><span class="line">    <span class="keyword">return</span> sscan(nextCursor, result);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>1000000ê±´ì´ ìˆëŠ” setsì— ì¬ê·€ë¡œ ì§œì„œ ëŒë ¤ë´¤ëŠ”ë° ê²ë‚˜ ëŠë¦¬ë„¤â€¦</p><h3 id="sorted-sets"><a href="#sorted-sets" class="headerlink" title="sorted sets"></a>sorted sets</h3><p>ì •ë ¬ëœ setsëŠ” ì ìˆ˜ë¡œ ì •ë ¬ëœ, ë˜‘ê°™ì€ ë°ì´í„°ê°€ ì—†ëŠ” êµ¬ì¡°ì´ë‹¤.</p><p>ì‰½ê²Œ ì´í•´ í•˜ìë©´ í•˜ë‚˜ì˜ í…Œì´ë¸”(=key)ì— key(=member), value(=score)ê°€ ì„¸íŠ¸ë¡œ </p><p>ì €ì¥ì´ ë˜ëŠ”ë° valueëŠ” ìˆ«ìë§Œ ë˜ê³  ì •ë ¬ì„ í•  ìˆ˜ ìˆë‹¤ëŠ” ì˜ë¯¸ í•œ ê°€ì§€ ìœ ì˜í•  ì ì€ ì •ë ¬ ì‹œ</p><p>ê°™ì€ scoreê°€ ìˆëŠ” ê²½ìš°ì—ëŠ” ì´ë¦„ìˆœìœ¼ë¡œ ì •ë ¬ ëœë‹¤.</p><h4 id="zadd"><a href="#zadd" class="headerlink" title="zadd"></a>zadd</h4><p>í•˜ë‚˜ì˜ member, scoreë¥¼ ì €ì¥ì„ í•˜ê³  ì„±ê³µ ì‹œ 1ì„ ë¦¬í„´ í•˜ê³  ì¤‘ë³µëœ ë°ì´í„°ëŠ” 0ì„ ë¦¬í„´ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redisClient.zadd(<span class="string">&#x27;MySt&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="zincrby"><a href="#zincrby" class="headerlink" title="zincrby"></a>zincrby</h4><p>í•˜ë‚˜ì˜ memberì˜ scoreë¥¼ ì›í•˜ëŠ” ê°’ë§Œí¼ ì¦,ê°ì†Œ í•  ìˆ˜ ìˆê³  ë¦¬í„´ì€ ì¦,ê°ì†Œëœ ê°’ì´ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redisClient.zincrby(<span class="string">&#x27;MySt&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 130</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="zrange-zrevrange"><a href="#zrange-zrevrange" class="headerlink" title="zrange, zrevrange"></a>zrange, zrevrange</h4><p>zrangeëŠ” ì§€ì •í•œ indexì˜ ë²”ìœ„ë§Œí¼ scoreê°€ ë‚®ì€ ìˆœìœ¼ë¡œ ì •ë ¬ëœ memberë“¤ì„ </p><p>ì¡°íšŒ í•  ìˆ˜ ìˆê³  0, -1ì€ ëª¨ë‘ ì¡°íšŒì´ë‹¤.</p><p>zrevrangeëŠ” zrangeì™€ ë°˜ëŒ€ë¡œ scoreê°€ ë†’ì€ ìˆœìœ¼ë¡œ ì •ë ¬ëœ memberë“¤ì„ ì¡°íšŒ í•  ìˆ˜ ìˆë‹¤.</p><p>withscoresë¥¼ ì¶”ê°€í•˜ë©´ scoreë„ ê²°ê³¼ì— ë‚˜ì˜¨ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redisClient.zrange(<span class="string">&#x27;MySt&#x27;</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// [a, b]</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.zrevrange(<span class="string">&#x27;MySt&#x27;</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="string">&#x27;withscores&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// [ &#x27;b&#x27;, &#x27;200&#x27;, &#x27;a&#x27;, &#x27;130&#x27; ]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="zrank-zrevrank"><a href="#zrank-zrevrank" class="headerlink" title="zrank, zrevrank"></a>zrank, zrevrank</h4><p>ë‘˜ ë‹¤ memberì˜ indexë¥¼ ë¦¬í„´ í•œë‹¤.</p><p>ì°¨ì´ì ì€ zrankëŠ” scoreê°€ ì‘ì€ ìˆœìœ¼ë¡œ 0, zrevrankëŠ” scoreê°€ í° ìˆœìœ¼ë¡œ 0</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redisClient.zrank(<span class="string">&#x27;MySt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 0</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.zrevrank(<span class="string">&#x27;MySt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 1</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="zscore"><a href="#zscore" class="headerlink" title="zscore"></a>zscore</h4><p>memberì˜ scoreë¥¼ ë¦¬í„´ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redisClient.zscore(<span class="string">&#x27;MySt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 130, íƒ€ì…ì€ ë¬¸ìí˜•ì´ë‹¤ ìˆ«ì ì•„ë‹˜..</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="zrem"><a href="#zrem" class="headerlink" title="zrem"></a>zrem</h4><p>ë°ì´í„°ë¥¼ ì‚­ì œ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redisClient.zrem(<span class="string">&#x27;MySt&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 1</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="zscan"><a href="#zscan" class="headerlink" title="zscan"></a>zscan</h4><p>zscanë„ sscanê³¼ ë¹„ìŠ·í•œ ìš©ë„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redisClient.zscan(<span class="string">&#x27;MySt&#x27;</span>, <span class="number">0</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="hashes"><a href="#hashes" class="headerlink" title="hashes"></a>hashes</h3><p>hashesëŠ” í•˜ë‚˜ì˜ keyì— ì—¬ëŸ¬ê°œ field, valueë¥¼ ì €ì¥ í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°</p><h4 id="hset-hmset"><a href="#hset-hmset" class="headerlink" title="hset, hmset"></a>hset, hmset</h4><ul><li>hsetì€ í•˜ë‚˜ì˜ field, valueë¥¼ ì‚½ì…</li><li>hmsetì€ ì—¬ëŸ¬ê°œì˜ field, valueë¥¼ ì‚½ì…</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redisClient.hset(<span class="string">&#x27;MyHash&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">1</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 1</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.hmset(<span class="string">&#x27;MyHash&#x27;</span>, [<span class="string">&#x27;b&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;c&#x27;</span>, <span class="number">2</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// OK</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="hget-hmget"><a href="#hget-hmget" class="headerlink" title="hget, hmget"></a>hget, hmget</h4><ul><li>hgetì€ í•˜ë‚˜ì˜ fieldë¡œ ì¡°íšŒ í•´ì„œ valueë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤.</li><li>hmgetì€ ì—¬ëŸ¬ ê°œì˜ fieldë¡œ ì¡°íšŒë¥¼ í•´ì„œ ì—¬ëŸ¬ valueë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤.</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redisClient.hget(<span class="string">&#x27;MyHash&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 1</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.hmget(<span class="string">&#x27;MyHash&#x27;</span>, [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// [&#x27;1&#x27;, &#x27;2&#x27;]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="hdel"><a href="#hdel" class="headerlink" title="hdel"></a>hdel</h4><p>í•„ë“œë¥¼ ì‚­ì œ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redisClient.hdel(<span class="string">&#x27;MyHash&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 1</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="hgetall"><a href="#hgetall" class="headerlink" title="hgetall"></a>hgetall</h4><p>í•´ë‹¹ keyì˜ ëª¨ë“  field, valueë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redisClient.hgetall(<span class="string">&#x27;MyHash&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#123; a: &#x27;1&#x27;, b: &#x27;1&#x27; &#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="hscan"><a href="#hscan" class="headerlink" title="hscan"></a>hscan</h4><p>scan ì‹œë¦¬ì¦ˆë“¤ì€ ëª¨ë‘ ë™ì¼</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redisClient.hscan(<span class="string">&#x27;MyHash&#x27;</span>, <span class="number">0</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// [ &#x27;0&#x27;, [ &#x27;a&#x27;, &#x27;1&#x27;, &#x27;b&#x27;, &#x27;1&#x27; ] ]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="hyperloglog"><a href="#hyperloglog" class="headerlink" title="hyperloglog"></a>hyperloglog</h3><p>hyperloglogëŠ” í•´ë‹¹ keyì˜ ë°ì´í„° ê°œìˆ˜ë¥¼ êµ¬í•˜ê¸° ìœ„í•œ ì²˜ìŒ ë³´ëŠ” êµ¬ì¡°ë‹¤.</p><p>ì¥ì ì€ í•˜ë‚˜ì˜ keyë‹¹ ì•„ì£¼ ì‘ì€ ë©”ëª¨ë¦¬(ìµœëŒ€12KB)ë¥¼ ì‚¬ìš©í•˜ê³  ë‹¨ì ì€ ì´ê²Œ 100% ì •í™•ë„ë¥¼</p><p>ë³´ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•œë‹¤ í‘œì¤€ì˜¤ì°¨ëŠ” 0.81%ì¸ë°(ê·¸ëŸ¼ 99%ëŠ” ë§ëŠ”ë‹¤ëŠ” ì†Œë¦¬ë„¤..) ì‚¬ìš© ì˜ˆëŠ”</p><p>í•´ë‹¹ ì‚¬ì´íŠ¸ë‚˜ ê²Œì„ì— ê³ ìœ  ë°©ë¬¸ì ìˆ˜ ê°™ì€ ì¼€ì´ìŠ¤</p><h4 id="pfadd"><a href="#pfadd" class="headerlink" title="pfadd"></a>pfadd</h4><p>í‚¤ì— í•˜ë‚˜ì˜ ë°ì´í„° ë˜ëŠ” ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ì‚½ì…í•  ìˆ˜ ìˆë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redisClient.pfadd(<span class="string">&#x27;visit:2020-01-01&#x27;</span>, [<span class="string">&#x27;user1&#x27;</span>, <span class="string">&#x27;user2&#x27;</span>, <span class="string">&#x27;user3&#x27;</span>, <span class="string">&#x27;user4&#x27;</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.pfadd(<span class="string">&#x27;visit:2020-01-02&#x27;</span>, <span class="string">&#x27;user4&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="pfcount"><a href="#pfcount" class="headerlink" title="pfcount"></a>pfcount</h4><p>í•˜ë‚˜ì˜ í‚¤ ë˜ëŠ” ì—¬ëŸ¬ í‚¤ì˜ ê°œìˆ˜ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">redisClient.pfcount(<span class="string">&#x27;visit:2020-01-02&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// 4</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">redisClient.pfcount([<span class="string">&#x27;visit:2020-01-02&#x27;</span>, <span class="string">&#x27;visit:2020-01-01&#x27;</span>], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// user4ê°€ ê³µí†µìœ¼ë¡œ ë“¤ì–´ê°€ìˆê¸° ë•Œë¬¸ì— 4</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ê·¸-ì™¸-ì»¤ë§¨ë“œ"><a href="#ê·¸-ì™¸-ì»¤ë§¨ë“œ" class="headerlink" title="ê·¸ ì™¸ ì»¤ë§¨ë“œ"></a>ê·¸ ì™¸ ì»¤ë§¨ë“œ</h2><h3 id="pub-sub"><a href="#pub-sub" class="headerlink" title="pub/sub"></a>pub/sub</h3><p>publish(ë°œì†¡) / subscribe(êµ¬ë…)ì˜ ì•½ì</p><p>ë©”ì„¸ì§€ë¥¼ ì£¼ê³  ë°›ëŠ” ê¸°ëŠ¥, ì£¼ì˜í•´ì•¼ í•  ì ì€ êµ¬ë…ì¤‘ì¸ ê²½ìš° ë‹¤ë¥¸ redisì˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš© ë¶ˆê°€</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// publish.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> redisClient = redis.createClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> channel = <span class="string">&#x27;MyChannel&#x27;</span>;</span><br><span class="line"></span><br><span class="line">redisClient.publish(channel, <span class="string">&#x27;Hi!&#x27;</span>, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// subscribe.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> redisClient = redis.createClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> channel = <span class="string">&#x27;MyChannel&#x27;</span>;</span><br><span class="line"></span><br><span class="line">redisClient.subscribe(channel);</span><br><span class="line"></span><br><span class="line">redisClient.on(<span class="string">&#x27;message&#x27;</span>, <span class="function">(<span class="params">channel, message</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;channel&#x27;</span>, channel, <span class="string">&#x27;message&#x27;</span>, message);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// redisClient.get(&#x27;qewqw&#x27;, (e, d) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(e); // êµ¬ë…ì¤‘ì´ë¯€ë¡œ ì—ëŸ¬ê°€ ëœ¬ë‹¤.</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br></pre></td></tr></table></figure><p>subscribe.jsë¥¼ ì‹¤í–‰ì„ í•˜ë©´ ì±„ë„(MyChannel)ì„ êµ¬ë… ì¤‘ì´ê³   </p><p>publish.jsë¥¼ ì‹¤í–‰ì„ í•˜ê²Œ ë˜ë©´ ë‚´ê°€ ì‘ì„±í•œ ë©”ì„¸ì§€ê°€ ì±„ë„(MyChannel)ì— ë³´ë‚´ê²Œ ë˜ê³ </p><p>subscribe.jsëŠ” êµ¬ë…ì¤‘ì´ë¯€ë¡œ publish.jsì—ì„œ ë³´ë‚¸ ë©”ì„¸ì§€ë¥¼ ê³„ì† ì¶œë ¥ì„ í•œë‹¤.</p><h3 id="íŠ¸ëœì­ì…˜"><a href="#íŠ¸ëœì­ì…˜" class="headerlink" title="íŠ¸ëœì­ì…˜"></a>íŠ¸ëœì­ì…˜</h3><p>redisì—ì„œ ìˆœì°¨ì  ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì»¤ë§¨ë“œë¥¼ ì§€ì›ì„ í•œë‹¤.</p><p>ê·¸ëŸ¬ë‚˜ ì¤‘ê°„ì— ì—ëŸ¬ê°€ ë‚˜ë„ ë¡¤ë°±ì´ ì•ˆ ë˜ê³  ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°â€¦</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multi = redisClient.multi();</span><br><span class="line"></span><br><span class="line">multi.set(<span class="string">&#x27;tr&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">multi.setbit(<span class="string">&#x27;bbb&#x27;</span>, <span class="string">&#x27;bb&#x27;</span>, <span class="number">2</span>); <span class="comment">// ì—ëŸ¬ ë‚˜ëŠ” ë¶€ë¶„</span></span><br><span class="line">multi.incrby(<span class="string">&#x27;tr&#x27;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">multi.exec(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) <span class="built_in">console</span>.log(err); <span class="comment">// ì—ëŸ¬ê°€ ì°í˜</span></span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ê·¸ëŸ¬ë‚˜ ì‹¤ì œë¡œ ë“¤ì–´ ê°€ì„œ ë³´ë©´ trì´ 3ì´ ë˜ì–´ ìˆìŒ</p><h4 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h4><p>watchë¥¼ ì„ ì–¸í•œ keyë¥¼ íŠ¸ëœì­ì…˜ì„ ì“¸ë ¤ê³  í–ˆì„ ë•Œ ì™¸ë¶€ì—ì„œ ê°’ì„ ë³€ê²½í•˜ê²Œ ë˜ëŠ” ê²½ìš°</p><p>íŠ¸ëœì­ì…˜ì„ ì‹¤í–‰í•˜ì§€ ì•ŠëŠ”ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">redisClient.watch(<span class="string">&#x27;tt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multi = redisClient.multi();</span><br><span class="line"></span><br><span class="line">multi.incrby(<span class="string">&#x27;tt&#x27;</span>, <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">redisClient.incrby(<span class="string">&#x27;tt&#x27;</span>, <span class="number">10</span>); <span class="comment">// multië¥¼ ì‹¤í–‰ í•˜ê¸° ì „ì— 10ì„ ì˜¬ë¦¼</span></span><br><span class="line"></span><br><span class="line">multi.exec(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì‹¤ì œ ttì˜ valueë¥¼ ë³´ë©´ 10ìœ¼ë¡œ ë˜ì–´ ìˆë‹¤.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="http://www.acornpub.co.kr/book/redis-essentials">Redis í•µì‹¬ ì •ë¦¬</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> NoSQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS DynamoDB ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2019/12/17/db-aws-dynamodb/"/>
      <url>/2019/12/17/db-aws-dynamodb/</url>
      
        <content type="html"><![CDATA[<h2 id="DynamoDBë€"><a href="#DynamoDBë€" class="headerlink" title="DynamoDBë€?"></a>DynamoDBë€?</h2><p>AWSì—ì„œ ê°œë°œí•œ key-valueí˜• NoSQL ë°ì´í„°ë² ì´ìŠ¤</p><h2 id="ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆì—ˆë˜-ì¥ì "><a href="#ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆì—ˆë˜-ì¥ì " class="headerlink" title="ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆì—ˆë˜ ì¥ì "></a>ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆì—ˆë˜ ì¥ì </h2><ul><li>ë³„ë„ë¡œ ì„¤ì¹˜ë‚˜ ë²„ì „ ê´€ë¦¬ ë“±ì„ í•  ì¼ì´ ì—†ì–´ì„œ í¸ë¦¬ í–ˆì—ˆë‹¤.</li><li>ì €ì¥ ê³µê°„ ìš©ëŸ‰ì´ ì œí•œì´ ì—†ê¸° ë•Œë¬¸ì— ì‹ ê²½ ì•ˆ ì¼ì—ˆë‹¤.</li><li>ì‚¬ìš©ëŸ‰ ë§Œí¼ ìš”ê¸ˆì´ ë¶€ê³¼ ëœë‹¤.</li></ul><h2 id="ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆì—ˆë˜-ë‹¨ì "><a href="#ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆì—ˆë˜-ë‹¨ì " class="headerlink" title="ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆì—ˆë˜ ë‹¨ì "></a>ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆì—ˆë˜ ë‹¨ì </h2><ul><li>ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ì‚½ì…í•  ë•Œ (bulk insert) ê°œìˆ˜ ì œí•œì´ ìˆì–´ì„œ ì¡°ê¸ˆ ë¶ˆí¸ í–ˆì—ˆë‹¤.</li><li>ë³´ì¡° ì¸ë±ìŠ¤ ìƒì„± ì‹œ ë°ì´í„° ìˆ˜ê°€ ë§ì§€ ì•Šì€ë° ê½¤ ëŠë¦° í¸ì´ë‹¤.</li></ul><h2 id="í…Œì´ë¸”"><a href="#í…Œì´ë¸”" class="headerlink" title="í…Œì´ë¸”"></a>í…Œì´ë¸”</h2><p>DynamoDBë¥¼ ì‚¬ìš© í•˜ê¸°ì „ì— í…Œì´ë¸”ì´ ì¡´ì¬ í•˜ê¸° ë•Œë¬¸ì— ìƒì„±ì„ í•´ ì¤˜ì•¼ í•œë‹¤.</p><p>ì›¹ ì½˜ì†” ê¸°ì¤€ í…Œì´ë¸” ì‘ì„± ì‹œ ë‚˜ì˜¤ëŠ” í•­ëª©ì„ ì•„ëŠ” ëŒ€ë¡œ ì •ë¦¬ë¥¼ í•´ ë³¸ë‹¤.</p><p>í…Œì´ë¸”ì€ í•œ ë²ˆ ë§Œë“¤ë©´ ìˆ˜ì •ì´ ì•ˆ ë˜ë¯€ë¡œ ì–´ë–¤ ë°ì´í„°ë¥¼ ë‹¤ë£°ì§€ì— ë”°ë¼ êµ¬ì„±ì´ ë‹¤ë¥´ê¸° ë•Œë¬¸ì—</p><p>ì‹ ì¤‘íˆ ìƒê°ì„ í•œ ë‹¤ìŒ ë§Œë“¤ì–´ì•¼ í•œë‹¤.</p><h3 id="í…Œì´ë¸”-ì´ë¦„"><a href="#í…Œì´ë¸”-ì´ë¦„" class="headerlink" title="í…Œì´ë¸” ì´ë¦„"></a>í…Œì´ë¸” ì´ë¦„</h3><p>ë§ ê·¸ëŒ€ë¡œ í•´ë‹¹ í…Œì´ë¸”ì˜ ì´ë¦„ì„ ì‘ì„± í•´ì•¼ í•œë‹¤.</p><p>í…Œì´ë¸”ëª…ì€ í•´ë‹¹ ë¦¬ì „ì—ì„œëŠ” ì¤‘ë³µëœ ì´ë¦„ìœ¼ë¡œëŠ” ë§Œë“¤ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ê³ ìœ í•´ì•¼ í•œë‹¤.</p><p>ì˜ˆë£Œ ì„œìš¸ ë¦¬ì „ì—ì„œ usersë€ í…Œì´ë¸”ì„ ìƒì„± ì‹œ ì„œìš¸ì—ì„œëŠ” userë€ í…Œì´ë¸”ì„ ìƒˆë¡œ ëª» ë§Œë“ ë‹¤.</p><p>ì„œìš¸ ë¦¬ì „ì—ì„œ usersê°€ ìˆì§€ë§Œ ë‹¤ë¥¸ ë¦¬ì „(ë„ì¿„)ê°™ì€ ê²½ìš°ì—ëŠ” users í…Œì´ë¸” ìƒì„± ê°€ëŠ¥</p><h3 id="ê¸°ë³¸-í‚¤-íŒŒí‹°ì…˜-í‚¤"><a href="#ê¸°ë³¸-í‚¤-íŒŒí‹°ì…˜-í‚¤" class="headerlink" title="ê¸°ë³¸ í‚¤ (íŒŒí‹°ì…˜ í‚¤)"></a>ê¸°ë³¸ í‚¤ (íŒŒí‹°ì…˜ í‚¤)</h3><p>DynamoDBëŠ” key-valueì˜ êµ¬ì¡°ë‹¤.</p><p>ê¸°ë³¸ í‚¤ëŠ” keyì— í•´ë‹¹ í•˜ê¸° ë•Œë¬¸ì— ê³ ìœ í•œ ë°ì´í„°ê°€ ë“¤ì–´ì˜¬ í•­ëª©ìœ¼ë¡œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.</p><p>ë°ì´í„°ë¥¼ ì‚½ì… í•  ë•Œ í•„ìˆ˜ì ìœ¼ë¡œ ë“¤ì–´ ê°€ì•¼ í•œë‹¤.</p><p>ì˜ˆë¡œ ì´ì „ì— ì“°ë˜ ì„œë¹„ìŠ¤ì—ì„œëŠ” ìœ ì € í…Œì´ë¸”ì„ ìƒì„± ì‹œ ê¸°ë³¸ í‚¤ëŠ” user_idë¡œ ë§Œë“¤ì—ˆì—ˆë‹¤.</p><h3 id="ì •ë ¬-í‚¤"><a href="#ì •ë ¬-í‚¤" class="headerlink" title="ì •ë ¬ í‚¤"></a>ì •ë ¬ í‚¤</h3><p>ì •ë ¬ í‚¤ëŠ” ì–´ë– í•œ ë°ì´í„°ë¥¼ ë‹¤ë£° ì§€ì— ë”°ë¼ ì„ íƒ / ë¯¸ì„ íƒì„ í•˜ë©´ ëœë‹¤.</p><p>ë‚´ê°€ ëŠë¼ê¸°ì—” second key ê°™ì€ ëŠë‚Œì¸ë° ì˜ˆë¡œ ìœ ì €ì˜ í–‰ë™ì„ ëª¨ë‘ ê¸°ë¡í•˜ëŠ” í…Œì´ë¸”ì„ ìƒì„± ì‹œ</p><p>ê¸°ë³¸ í‚¤ë§Œ ìƒì„±í•œ ê²½ìš°ì—ëŠ” user_idê°€ aì˜ í–‰ë™ì€ 1íšŒë§Œ ì‚½ì…ì„ í•  ìˆ˜ ìˆë‹¤.</p><p>ì™œëƒë©´ ë‹¤ìŒ ë²ˆ ì‚½ì… ì‹œ user_idì— aê°€ ë“±ë¡ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë‹¤.</p><p>ì´ëŸ¬í•œ ê²½ìš°ì— ì •ë ¬ í‚¤ë¥¼ ì¶”ê°€í•˜ì—¬ ì‚¬ìš©í•˜ë©´ ê°€ëŠ¥ í•œë° ì˜ˆë¡œ ì •ë ¬ í‚¤ë¥¼ timestampë¡œ ë§Œë“¤ì–´ì„œ</p><p>ì‚½ì…ì„ í•˜ë©´ ì•„ë˜ì˜ í…Œì´ë¸”ì²˜ëŸ¼ ì‚¬ìš©ì„ í•  ìˆ˜ ìˆê²Œ ëœë‹¤.</p><table><thead><tr><th>user_id(ê¸°ë³¸ í‚¤)</th><th>timestamp(ì •ë ¬ í‚¤)</th><th>action</th></tr></thead><tbody><tr><td>a</td><td>1</td><td>â€˜loginâ€™</td></tr><tr><td>a</td><td>2</td><td>â€˜logoutâ€™</td></tr></tbody></table><p>ëŒ€ì‹  ì •ë ¬ í‚¤ë¥¼ ì¶”ê°€ í•˜ê²Œ ë˜ë©´ ì´í›„ ì‚½ì…, ì¡°íšŒ, ì‚­ì œ ìš”ì²­ ì‹œ ì •ë ¬ í‚¤ì˜ ë°ì´í„°ë¥¼ í•„ìˆ˜ì ìœ¼ë¡œ</p><p>ë„£ì–´ì•¼ í•œë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ê¼­ í•„ìš”í•œ ê²½ìš°ì—ë§Œ êµ¬ì„±ì— í¬í•¨ í•˜ì.</p><h3 id="ë³´ì¡°-ì¸ë±ìŠ¤"><a href="#ë³´ì¡°-ì¸ë±ìŠ¤" class="headerlink" title="ë³´ì¡° ì¸ë±ìŠ¤"></a>ë³´ì¡° ì¸ë±ìŠ¤</h3><p>key-value êµ¬ì¡°ì´ê¸° ë•Œë¬¸ì— ê¸°ë³¸ì ìœ¼ë¡œ ì¡°íšŒ ì‹œ ê¸°ë³¸ í‚¤ ë˜ëŠ” ê¸°ë³¸ + ì •ë ¬ í‚¤ë¡œë§Œ ê²€ìƒ‰ì´</p><p>ê°€ëŠ¥í•œë° ì˜ˆë¡œ ì•„ë˜ì˜ í…Œì´ë¸”ì—ì„œ ìœ ì €ì˜ loginí•œ ì•¡ì…˜ë§Œ ì¡°íšŒë¥¼ í•˜ê³  ì‹¶ì„ ë•Œ </p><p>ë³´ì¡° ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í•´ì„œ ì´ìš©ì„ í•˜ë©´ ëœë‹¤.</p><table><thead><tr><th>user_id(ê¸°ë³¸ í‚¤)</th><th>timestamp(ì •ë ¬ í‚¤)</th><th>action</th></tr></thead><tbody><tr><td>a</td><td>1</td><td>â€˜loginâ€™</td></tr><tr><td>a</td><td>2</td><td>â€˜logoutâ€™</td></tr><tr><td>b</td><td>3</td><td>â€˜loginâ€™</td></tr></tbody></table><p>ë³´ì¡° ì¸ë±ìŠ¤ë„ ë§ˆì°¬ê°€ì§€ë¡œ ê¸°ë³¸ í‚¤ ê·¸ë¦¬ê³  ì„ íƒ ì‚¬í•­ìœ¼ë¡œ ì •ë ¬ í‚¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.</p><h3 id="ì½ê¸°-ì“°ê¸°-ìš©ëŸ‰-ëª¨ë“œ"><a href="#ì½ê¸°-ì“°ê¸°-ìš©ëŸ‰-ëª¨ë“œ" class="headerlink" title="ì½ê¸°/ì“°ê¸° ìš©ëŸ‰ ëª¨ë“œ"></a>ì½ê¸°/ì“°ê¸° ìš©ëŸ‰ ëª¨ë“œ</h3><p>ì½ê¸° ìš©ëŸ‰ / ì“°ê¸° ìš©ëŸ‰ ì„¤ì •ì— ë”°ë¼ ì‚¬ìš© ê°€ê²©ì˜ êµ¬ì„±ì´ ì •í•´ ì§„ë‹¤.</p><p>ì´ ìš©ëŸ‰ì€ ì‚¬ìš© íšŒìˆ˜ë¼ ìƒê°ì„ í•˜ê³  ì„¤ì •ì„ í–ˆì—ˆë‹¤. ìœ ì €ê°€ ë§ì•„ì ¸ì„œ ì‚¬ìš©ìê°€ ë§ì•„ ì§€ë©´</p><p>í›… ì˜¬ë¼ê°€ê³ , ì‚¬ìš©ìê°€ ë–¨ì–´ ì§€ë©´ ìì—°ìŠ¤ë ˆ ë‚´ë ¤ê°€ê³ â€¦</p><p>ì½ê¸° ìš©ëŸ‰ì€ ì˜¬ë ¤ë„ ê°€ê²©ì´ ë§ì´ ë³€í™”ê°€ ì—†ëŠ”ë° ì“°ê¸° ìš©ëŸ‰ì€ ì¢€ ë§Œ ì˜¬ë ¤ë„ ê°€ê²©ì´ ë»¥íŠ€ê¸° ëœë‹¤.</p><p>ì²˜ìŒ DynamoDB ì‚¬ìš©í•  ë• ì˜¨ë””ë©˜ë“œ ëª¨ë“œê°€ ì—†ì–´ì„œ ìš©ëŸ‰ í¬ê¸°ì— ì¢€ ë¶ˆì•ˆ í–ˆì—ˆëŠ”ë°</p><p>ì¶”ê°€ê°€ ë˜ì–´ì„œ ì„œë¹„ìŠ¤ ë•Œ ë³€ê²½ì„ í–ˆì—ˆë‹¤. ì˜¨ë””ë©˜ë“œ ìµœê³ !</p><h3 id="ì˜¤í† ìŠ¤ì¼€ì¼ë§"><a href="#ì˜¤í† ìŠ¤ì¼€ì¼ë§" class="headerlink" title="ì˜¤í† ìŠ¤ì¼€ì¼ë§"></a>ì˜¤í† ìŠ¤ì¼€ì¼ë§</h3><p>ì‚¬ìš© ìˆ˜ê°€ ë§ì•„ì§€ë©´ ì„¤ì •ì— ë”°ë¼ ì•Œì•„ì„œ ëŠ˜ì–´ë‚˜ê³  í•˜ëŠ”ë° ì´ ë¶€ë¶„ì€ í¬ê²Œ ì‹ ê²½ì„ ì•ˆ ì¨ë´¤ë‹¤.</p><p>ì˜¨ë””ë©˜ë“œë¼ë©´ ê±´ë“œë¦´ ì¼ë„ ì—†ìœ¼ë‹ˆ íŒ¨ìŠ¤</p><h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2><p>Node.jsë¡œ ì§„í–‰í•´ë³´ê² ë‹¤.</p><p>í•´ë‹¹ í”„ë¡œì íŠ¸ í´ë”ì—ì„œ npmì„ í†µí•´ aws-sdkë¥¼ ë‹¤ìš´ ë°›ëŠ”ë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i aws-sdk -S</span><br></pre></td></tr></table></figure><h3 id="Create"><a href="#Create" class="headerlink" title="Create"></a>Create</h3><h4 id="Put"><a href="#Put" class="headerlink" title="Put"></a>Put</h4><p>í•˜ë‚˜ì˜ rowë¥¼ ì‚½ì… í•  ìˆ˜ ìˆë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  TableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// í…Œì´ë¸”ëª…</span></span><br><span class="line">  Item: &#123;</span><br><span class="line">    user_id: <span class="string">&#x27;a&#x27;</span>, <span class="comment">// ê¸°ë³¸ í‚¤</span></span><br><span class="line">    ts: <span class="built_in">Date</span>.now(), <span class="comment">// ì •ë ¬ í‚¤, ì¡´ì¬ í•˜ì§€ ì•Šìœ¼ë©´ ìƒëµ ê°€ëŠ¥</span></span><br><span class="line">    action: <span class="string">&#x27;login&#x27;</span>, <span class="comment">// ì´í›„ë¡œëŠ” ì¶”ê°€í•˜ê³  ì‹¶ì€ ë°ì´í„°ë“¤</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.put(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#123;&#125; ì‚½ì… ì„±ê³µ ì‹œ ë„˜ì–´ì˜¤ëŠ” ë°ì´í„° X</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="BatchWrite"><a href="#BatchWrite" class="headerlink" title="BatchWrite"></a>BatchWrite</h4><p>í•œ ë²ˆì— rowë¥¼ ì—¬ëŸ¬ ê°œ ë„£ì„ ìˆ˜ ìˆëŠ” ë°©ë²•, ê·¸ëŸ¬ë‚˜ 25ê°œ ì´í•˜ë§Œ ê°€ëŠ¥ í•˜ë‹¤..</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  RequestItems: &#123;</span><br><span class="line">    users: [ <span class="comment">// ë°°ì—´ì˜ ì´ë¦„ì€ í…Œì´ë¸”ëª…ì´ë‹¤.</span></span><br><span class="line">      &#123;</span><br><span class="line">        PutRequest: &#123;</span><br><span class="line">          Item: &#123; <span class="comment">// putê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ê¸°ë³¸ í‚¤, ì •ë ¬ í‚¤, ì´í•˜ ì¶”ê°€í•˜ê³  ì‹¶ì€ í•­ëª©</span></span><br><span class="line">            user_id: <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">            ts: <span class="built_in">Date</span>.now(),</span><br><span class="line">            action: <span class="string">&#x27;logout&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        PutRequest: &#123;</span><br><span class="line">          Item: &#123;</span><br><span class="line">            user_id: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">            ts: <span class="built_in">Date</span>.now(),</span><br><span class="line">            action: <span class="string">&#x27;charge&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        PutRequest: &#123;</span><br><span class="line">          Item: &#123;</span><br><span class="line">            user_id: <span class="string">&#x27;d&#x27;</span>,</span><br><span class="line">            ts: <span class="built_in">Date</span>.now(),</span><br><span class="line">            action: <span class="string">&#x27;login&#x27;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.batchWrite(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#123; UnprocessedItems: &#123;&#125; &#125;</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Read"><a href="#Read" class="headerlink" title="Read"></a>Read</h3><h4 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h4><p>í•˜ë‚˜ì˜ rowë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  TableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// í…Œì´ë¸”ëª…</span></span><br><span class="line">  Key: &#123;</span><br><span class="line">    user_id: <span class="string">&#x27;a&#x27;</span>, <span class="comment">// ê¸°ë³¸ í‚¤</span></span><br><span class="line">    ts: <span class="number">1597722895588</span>, <span class="comment">// ì •ë ¬ í‚¤, ì¡´ì¬ í•˜ì§€ ì•Šìœ¼ë©´ ìƒëµ ê°€ëŠ¥</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.get(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    &#123; Item: &#123; ts: 1597722895588, user_id: &#x27;a&#x27;, action: &#x27;login&#x27; &#125; &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ë°ì´í„°ê°€ ì¡´ì¬ í•˜ì§€ ì•Šì„ ì‹œì—ëŠ” &#123;&#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="BatchGet"><a href="#BatchGet" class="headerlink" title="BatchGet"></a>BatchGet</h4><p>í•œ ë²ˆì— ì—¬ëŸ¬ rowë¥¼ ê°€ì§€ê³  ì˜¬ ìˆ˜ ìˆëŠ” ë°©ë²•, ì´ ì—­ì‹œ ê°œìˆ˜ ì œí•œ 100ê°œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  RequestItems: &#123;</span><br><span class="line">    users: &#123; <span class="comment">// í…Œì´ë¸”ëª…</span></span><br><span class="line">      Keys: [</span><br><span class="line">        &#123;</span><br><span class="line">          user_id: <span class="string">&#x27;a&#x27;</span>, <span class="comment">// ê¸°ë³¸ í‚¤</span></span><br><span class="line">          ts: <span class="number">1597722895588</span>, <span class="comment">// ì •ë ¬ í‚¤, ì—†ìœ¼ë©´ ìƒëµ ê°€ëŠ¥</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          user_id: <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">          ts: <span class="number">1597723408876</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.batchGet(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    í•˜ë‚˜ ë¼ë„ ë°ì´í„°ê°€ ì¡´ì¬ ì‹œ</span></span><br><span class="line"><span class="comment">    &#123; Responses: &#123; users: [ [Object], [Object] ] &#125;, UnprocessedKeys: &#123;&#125; &#125;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    ëª¨ë‘ ì—†ì„ ì‹œ</span></span><br><span class="line"><span class="comment">    &#123; Responses: &#123; users: [] &#125;, UnprocessedKeys: &#123;&#125; &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="Query"><a href="#Query" class="headerlink" title="Query"></a>Query</h4><p>ì¡°ê±´ì„ ë„£ì–´ì„œ ê²€ìƒ‰ì„ í•  ìˆ˜ ìˆë‹¤.</p><p>ê¸°ë³¸ í‚¤ì˜ ê²½ìš°ì—ëŠ” equal(=)ë§Œ ë˜ê³  ì •ë ¬ í‚¤ê°€ ìˆëŠ” ê²½ìš° ë¶€ë“±í˜¸(&gt;, &gt;= ë“±ë“±)ê°€ ê°€ëŠ¥ í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  TableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// í…Œì´ë¸”ëª…</span></span><br><span class="line">  KeyConditionExpression: <span class="string">&#x27;#x = :x and #y &gt; :y&#x27;</span>, <span class="comment">// ì¡°ê±´ë¬¸</span></span><br><span class="line">  ExpressionAttributeNames: &#123; <span class="comment">// #ì€ í‚¤ì˜ aliasë¼ ìƒê°í•˜ë©´ ë¨.</span></span><br><span class="line">    <span class="string">&#x27;#x&#x27;</span>: <span class="string">&#x27;user_id&#x27;</span>, <span class="comment">// xëŠ” user_id</span></span><br><span class="line">    <span class="string">&#x27;#y&#x27;</span>: <span class="string">&#x27;ts&#x27;</span>, <span class="comment">// yëŠ” íƒ€ì„ìŠ¤íƒ¬í”„</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ExpressionAttributeValues: &#123; <span class="comment">// :ì€ ê°’ì˜ alias</span></span><br><span class="line">    <span class="string">&#x27;:x&#x27;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="comment">// ê²€ìƒ‰í•  user_id</span></span><br><span class="line">    <span class="string">&#x27;:y&#x27;</span>: <span class="number">10000</span>, <span class="comment">// ê²€ìƒ‰í•  ts</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.query(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    ë°ì´í„°ê°€ 1ê°œë¼ë„ ìˆì„ ì‹œì—ëŠ”</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      Items: [</span></span><br><span class="line"><span class="comment">        &#123; ts: 1597722895588, user_id: &#x27;a&#x27;, action: &#x27;login&#x27; &#125;,</span></span><br><span class="line"><span class="comment">        &#123; ts: 1597723408876, user_id: &#x27;a&#x27;, action: &#x27;charge&#x27; &#125;</span></span><br><span class="line"><span class="comment">      ],</span></span><br><span class="line"><span class="comment">      Count: 2,</span></span><br><span class="line"><span class="comment">      ScannedCount: 2</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    ì¡´ì¬ í•˜ì§€ ì•Šì„ ì‹œì—ëŠ”</span></span><br><span class="line"><span class="comment">    &#123; Items: [], Count: 0, ScannedCount: 0 &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="ë³´ì¡°ì¸ë±ìŠ¤ë¥¼-ì´ìš©í•œ-ì¿¼ë¦¬"><a href="#ë³´ì¡°ì¸ë±ìŠ¤ë¥¼-ì´ìš©í•œ-ì¿¼ë¦¬" class="headerlink" title="ë³´ì¡°ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•œ ì¿¼ë¦¬"></a>ë³´ì¡°ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•œ ì¿¼ë¦¬</h4><p>ìœ„ì— ì ì€ ê±° ì²˜ëŸ¼ actionì„ ë³´ì¡° ì¸ë±ìŠ¤ë¡œ ë§Œë“¤ì–´ì„œ ê²€ìƒ‰ì„ í•´ ë³¸ë‹¤.</p><p>ê¸°ë³¸ í‚¤ëŠ” action ì •ë ¬ í‚¤ëŠ” ìƒëµ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  TableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// í…Œì´ë¸”ëª…</span></span><br><span class="line">  IndexName: <span class="string">&#x27;action-index&#x27;</span>, <span class="comment">// ë³´ì¡° ì¸ë±ìŠ¤ëª…</span></span><br><span class="line">  KeyConditionExpression: <span class="string">&#x27;#x = :x&#x27;</span>, <span class="comment">// ì¡°ê±´ë¬¸</span></span><br><span class="line">  ExpressionAttributeNames: &#123; <span class="comment">// #ì€ í‚¤ì˜ aliasë¼ ìƒê°í•˜ë©´ ë¨.</span></span><br><span class="line">    <span class="string">&#x27;#x&#x27;</span>: <span class="string">&#x27;action&#x27;</span>, <span class="comment">// xëŠ” action</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ExpressionAttributeValues: &#123; <span class="comment">// :ì€ ê°’ì˜ alias</span></span><br><span class="line">    <span class="string">&#x27;:x&#x27;</span>: <span class="string">&#x27;login&#x27;</span>, <span class="comment">// ê²€ìƒ‰í•  action</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.query(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      Items: [</span></span><br><span class="line"><span class="comment">        &#123; ts: 1597723408876, action: &#x27;login&#x27;, user_id: &#x27;d&#x27; &#125;,</span></span><br><span class="line"><span class="comment">        &#123; ts: 1597727204965, action: &#x27;login&#x27;, user_id: &#x27;z&#x27; &#125;</span></span><br><span class="line"><span class="comment">      ],</span></span><br><span class="line"><span class="comment">      Count: 2,</span></span><br><span class="line"><span class="comment">      ScannedCount: 2</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="Scan"><a href="#Scan" class="headerlink" title="Scan"></a>Scan</h4><p>ë°ì´í„°ë¥¼ ëª¨ë‘ ê²€ìƒ‰ í•  ìˆ˜ ìˆëŠ” ë°©ë²• í˜¹ì—¬ë‚˜ í•´ì„œ FilterëŠ” ê²€ìƒ‰í•˜ê¸° ìœ„í•œ ì¡°ê±´ì´ ì•„ë‹Œ</p><p>ëª¨ë“  ë°ì´í„°ë¥¼ ì½ì€ í›„ì— ì¡°ê±´ëŒ€ë¡œ ê±¸ëŸ¬ì§€ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ê²€ìƒ‰ ì†ë„ì™€ëŠ” ì „í˜€ ìƒê´€ì´ ì—†ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  TableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// í…Œì´ë¸”ëª…, ì´í•˜ ëª¨ë“  í”„ë¡œí¼í‹°ëŠ” ìƒëµ ê°€ëŠ¥</span></span><br><span class="line">  <span class="comment">// Limit: 100, // ê°œìˆ˜ ì œí•œ</span></span><br><span class="line">  <span class="comment">// FilterExpression: &#x27;#action = :action&#x27;, // í•„í„°ë§</span></span><br><span class="line">  <span class="comment">// ExpressionAttributeNames: &#123;</span></span><br><span class="line">  <span class="comment">//   &#x27;#action&#x27;: &#x27;action&#x27;</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">  <span class="comment">// ExpressionAttributeValues: &#123;</span></span><br><span class="line">  <span class="comment">//   &#x27;:action&#x27;: &#x27;login&#x27;</span></span><br><span class="line">  <span class="comment">// &#125;,</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.scan(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      Items: [</span></span><br><span class="line"><span class="comment">        &#123; ts: 1597723408876, user_id: &#x27;b&#x27;, action: &#x27;logout&#x27; &#125;,</span></span><br><span class="line"><span class="comment">        &#123; ts: 1597723408876, user_id: &#x27;d&#x27;, action: &#x27;login&#x27; &#125;,</span></span><br><span class="line"><span class="comment">        &#123; ts: 1597722895588, user_id: &#x27;a&#x27;, action: &#x27;login&#x27; &#125;,</span></span><br><span class="line"><span class="comment">        &#123; ts: 1597723408876, user_id: &#x27;a&#x27;, action: &#x27;charge&#x27; &#125;</span></span><br><span class="line"><span class="comment">      ],</span></span><br><span class="line"><span class="comment">      Count: 4,</span></span><br><span class="line"><span class="comment">      ScannedCount: 4</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h3><p>ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ëŠ” ë°©ë²•, ê¸°ë³¸ í‚¤ì™€ ì •ë ¬ í‚¤ë¥¼ ì œì™¸í•œ í•­ëª©ë§Œ ìˆ˜ì •ì´ ê°€ëŠ¥ í•˜ë‹¤.</p><p>UpdateExpression ì„¤ì •ì— ë”°ë¼ ì¡°ê¸ˆ ë‹¤ë¥´ë‹¤.</p><h5 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h5><p>í”íˆ ì“°ëŠ” ê¸°ì¡´ì˜ X ê°’ì„ Y ê°’ìœ¼ë¡œ ë³€ê²½í•  ë•Œ ì“´ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  TableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// í…Œì´ë¸”ëª…</span></span><br><span class="line">  Key: &#123; <span class="comment">// ê¸°ë³¸ í‚¤, ì •ë ¬ í‚¤(ë¯¸ì„ íƒ ì‹œ ìƒëµ ê°€ëŠ¥)</span></span><br><span class="line">    user_id: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">    ts: <span class="number">1597723408876</span></span><br><span class="line">  &#125;,</span><br><span class="line">  UpdateExpression: <span class="string">&#x27;set #x = :x&#x27;</span>, <span class="comment">// ìˆ˜ì •í•  í•­ëª© alias</span></span><br><span class="line">  ExpressionAttributeNames: &#123;</span><br><span class="line">    <span class="string">&#x27;#x&#x27;</span>: <span class="string">&#x27;action&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ExpressionAttributeValues: &#123;</span><br><span class="line">    <span class="string">&#x27;:x&#x27;</span>: <span class="number">10</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ReturnValues: <span class="string">&#x27;ALL_NEW&#x27;</span>, <span class="comment">// ìˆ˜ì •í•œ ë°ì´í„° ë°›ì•„ì˜¤ê¸°, ìƒëµ ê°€ëŠ¥</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.update(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#123; Attributes: &#123; ts: 1597723408876, action: 10, user_id: &#x27;a&#x27; &#125; &#125;</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h5><p>ìˆ˜ì •í•  í•­ëª©ì´ ìˆ«ì ê°’ì´ê³  Në§Œí¼ ì¦ê°€ì‹œí‚¬ í•„ìš”ê°€ ìˆì„ ë•Œ ì‚¬ìš© í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  TableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// í…Œì´ë¸”ëª…</span></span><br><span class="line">  Key: &#123; <span class="comment">// ê¸°ë³¸ í‚¤, ì •ë ¬ í‚¤(ë¯¸ì„ íƒ ì‹œ ìƒëµ ê°€ëŠ¥)</span></span><br><span class="line">    user_id: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">    ts: <span class="number">1597723408876</span></span><br><span class="line">  &#125;,</span><br><span class="line">  UpdateExpression: <span class="string">&#x27;add #x :x&#x27;</span>, <span class="comment">// ìˆ˜ì •í•  í•­ëª© alias</span></span><br><span class="line">  ExpressionAttributeNames: &#123;</span><br><span class="line">    <span class="string">&#x27;#x&#x27;</span>: <span class="string">&#x27;action&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ExpressionAttributeValues: &#123;</span><br><span class="line">    <span class="string">&#x27;:x&#x27;</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ReturnValues: <span class="string">&#x27;ALL_NEW&#x27;</span>, <span class="comment">// ì—…ë°ì´íŠ¸í•œ ë°ì´í„° ë°›ì•„ì˜¤ê¸°, ìƒëµ ê°€ëŠ¥</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.update(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#123; Attributes: &#123; ts: 1597723408876, action: 11, user_id: &#x27;a&#x27; &#125; &#125;</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="Remove"><a href="#Remove" class="headerlink" title="Remove"></a>Remove</h5><p>íŠ¹ì • í•­ëª©ì„ ì‚­ì œí•  ë•Œ ì‚¬ìš©í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  TableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// í…Œì´ë¸”ëª…</span></span><br><span class="line">  Key: &#123; <span class="comment">// ê¸°ë³¸ í‚¤, ì •ë ¬ í‚¤(ë¯¸ì„ íƒ ì‹œ ìƒëµ ê°€ëŠ¥)</span></span><br><span class="line">    user_id: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">    ts: <span class="number">1597723408876</span></span><br><span class="line">  &#125;,</span><br><span class="line">  UpdateExpression: <span class="string">&#x27;remove #x&#x27;</span>, <span class="comment">// ìˆ˜ì •í•  í•­ëª© alias</span></span><br><span class="line">  ExpressionAttributeNames: &#123;</span><br><span class="line">    <span class="string">&#x27;#x&#x27;</span>: <span class="string">&#x27;action&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  ReturnValues: <span class="string">&#x27;ALL_NEW&#x27;</span>, <span class="comment">// ì—…ë°ì´íŠ¸í•œ ë°ì´í„° ë°›ì•„ì˜¤ê¸°, ìƒëµ ê°€ëŠ¥</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.update(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#123; Attributes: &#123; ts: 1597723408876, user_id: &#x27;a&#x27; &#125; &#125;</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h3><h4 id="Delete-1"><a href="#Delete-1" class="headerlink" title="Delete"></a>Delete</h4><p>í•˜ë‚˜ì˜ rowë¥¼ ì‚­ì œí•  ë•Œ ì“´ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  TableName: <span class="string">&#x27;users&#x27;</span>, <span class="comment">// í…Œì´ë¸”ëª…</span></span><br><span class="line">  Key: &#123; <span class="comment">// ê¸°ë³¸ í‚¤, ì •ë ¬ í‚¤(ë¯¸ì„ íƒ ì‹œ ìƒëµ ê°€ëŠ¥)</span></span><br><span class="line">    user_id: <span class="string">&#x27;a&#x27;</span>,</span><br><span class="line">    ts: <span class="number">1597723408876</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.delete(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#123;&#125;</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="BatchWrite-1"><a href="#BatchWrite-1" class="headerlink" title="BatchWrite"></a>BatchWrite</h4><p>í•œ ë²ˆì— ì—¬ëŸ¬ rowë¥¼ ì‚­ì œí•˜ëŠ” ë°©ë²•, ë§ˆì°¬ê°€ì§€ë¡œ ê°œìˆ˜ ì œí•œ 25ê°œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  RequestItems: &#123;</span><br><span class="line">    users: [ <span class="comment">// í…Œì´ë¸”ëª…</span></span><br><span class="line">      &#123;</span><br><span class="line">        DeleteRequest: &#123; <span class="comment">// ì´ ë¶€ë¶„ì´ ì—¬ëŸ¬ ê°œ ì‚½ì…í•  ë•Œì™€ ë‹¤ë¥´ë‹¤</span></span><br><span class="line">          Key: &#123;</span><br><span class="line">            user_id: <span class="string">&#x27;a&#x27;</span>, <span class="comment">// ê¸°ë³¸ í‚¤</span></span><br><span class="line">            ts: <span class="number">1597722895588</span>, <span class="comment">// ì •ë ¬ í‚¤, ì—†ìœ¼ë©´ ìƒëµ ê°€ëŠ¥</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        DeleteRequest: &#123;</span><br><span class="line">          Key: &#123;</span><br><span class="line">            user_id: <span class="string">&#x27;b&#x27;</span>,</span><br><span class="line">            ts: <span class="number">1597723408876</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">dynamo.batchWrite(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="íŠ¸ëœì­ì…˜"><a href="#íŠ¸ëœì­ì…˜" class="headerlink" title="íŠ¸ëœì­ì…˜"></a>íŠ¸ëœì­ì…˜</h2><p>DynamoDBë¥¼ ì²˜ìŒ ì‚¬ìš© í–ˆì„ ë•ŒëŠ” ëª» ë´¤ì—ˆëŠ”ë° ì–¼ë§ˆ ì•ˆ ë˜ì–´ì„œ ì¶”ê°€ê°€ ë˜ì—ˆë‹¤.</p><p>ì‹¤ë¬´ì—ì„œëŠ” ì¨ ë³´ì§„ ì•ŠìŒâ€¦ğŸ˜…</p><p>TransactGetItems, TransactWriteItems 2 ê°€ì§€ê°€ ì¡´ì¬ í•˜ëŠ”ë°</p><p>ì „ìëŠ” ì½ê¸° ê´€ë ¨ íŠ¸ëœì­ì…˜, í›„ìëŠ” ì“°ê¸°, ìˆ˜ì •, ì‚­ì œì™€ ê´€ë ¨ëœ íŠ¸ëœì­ì…˜ì„ ê±¸ ìˆ˜ ìˆë‹¤.</p><h3 id="TransactGetItems"><a href="#TransactGetItems" class="headerlink" title="TransactGetItems"></a>TransactGetItems</h3><p>ìœ ì € í…Œì´ë¸”ì—ì„œ ìœ ì € ì •ë³´ë¥¼ ì½ì–´ ì˜¨ í›„ ìœ ì €ê°€ ë³´ìœ í•œ ì•„ì´í…œ í…Œì´ë¸”ì„ ì½ì–´ë³´ë ¤ í•œë‹¤.</p><p>ìœ ì € í…Œì´ë¸”ì—ì„œëŠ” user_idê°€ ë¬¸ìì—´ì¸ë° í˜„ì¬ ë°ì´í„° íƒ€ì…ì´ ìˆ«ìë¼ì„œ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— </p><p>2ë²ˆì§¸ëŠ” ì‹¤í–‰ì´ ë˜ì§ˆ ì•Šê³  íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ë¼ëŠ” ì—ëŸ¬ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getParams = &#123;</span><br><span class="line">  TransactItems: [</span><br><span class="line">    &#123;</span><br><span class="line">      Get: &#123;</span><br><span class="line">        TableName: <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">        Key: &#123;</span><br><span class="line">          user_id: <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      Get: &#123;</span><br><span class="line">        TableName: <span class="string">&#x27;items&#x27;</span>,</span><br><span class="line">        Key: &#123;</span><br><span class="line">          user_id: <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dynamo.transactGet(getParams).promise().then(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(r, <span class="literal">null</span>, <span class="number">2</span>));</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    TransactionCanceledException: Transaction cancelled, please refer cancellation reasons for specific reasons [None, ValidationError]</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="TransactWriteItems"><a href="#TransactWriteItems" class="headerlink" title="TransactWriteItems"></a>TransactWriteItems</h3><p>ê°€ì… ì‹œ ìœ ì € ì •ë³´ë¥¼ ê¸°ë¡ í•˜ê³  ì•„ì´í…œ í…Œì´ë¸”ì— ì´ˆê¸° ê°’ìœ¼ë¡œ í¬ì…˜ì„ ì§€ê¸‰í•˜ë ¤ í•œë‹¤.</p><p>ìœ„ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ìœ ì € í…Œì´ë¸”ì—ì„œëŠ” user_idê°€ ë¬¸ìì—´ì¸ë° í˜„ì¬ ë°ì´í„° íƒ€ì…ì´ ìˆ«ìë¼ì„œ </p><p>ë‹¤ë¥´ê¸° ë•Œë¬¸ì— 2ë²ˆì§¸ëŠ” ì‹¤í–‰ì´ ë˜ì§ˆ ì•Šê³  íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ë¼ëŠ” ì—ëŸ¬ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  TransactItems: [</span><br><span class="line">    &#123;</span><br><span class="line">      Put: &#123;</span><br><span class="line">        TableName: <span class="string">&#x27;users&#x27;</span>,</span><br><span class="line">        Item: &#123;</span><br><span class="line">          user_id: <span class="number">1</span>,</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      Put: &#123;</span><br><span class="line">        TableName: <span class="string">&#x27;items&#x27;</span>,</span><br><span class="line">        Item: &#123;</span><br><span class="line">          user_id: <span class="number">1</span>,</span><br><span class="line">          potion: <span class="number">10</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dynamo.transactWrite(params).promise().then(<span class="function">(<span class="params">r</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(r);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html">DynamoDB doc</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> NoSQL </tag>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ë§¥ ìˆ¨ê¹€ í´ë” ë³´ëŠ” ë‹¨ì¶•í‚¤</title>
      <link href="/2019/12/08/etc-mac-hidden/"/>
      <url>/2019/12/08/etc-mac-hidden/</url>
      
        <content type="html"><![CDATA[<p>Command + Shift + .(ì [dot])</p>]]></content>
      
      
      
        <tags>
            
            <tag> ETC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Artilleryë¥¼ ì´ìš©í•œ ë¶€í•˜ í…ŒìŠ¤íŠ¸</title>
      <link href="/2019/10/27/etc-loadtest-artillery/"/>
      <url>/2019/10/27/etc-loadtest-artillery/</url>
      
        <content type="html"><![CDATA[<h2 id="ë¶€í•˜-í…ŒìŠ¤íŠ¸"><a href="#ë¶€í•˜-í…ŒìŠ¤íŠ¸" class="headerlink" title="ë¶€í•˜ í…ŒìŠ¤íŠ¸"></a>ë¶€í•˜ í…ŒìŠ¤íŠ¸</h2><p>ì˜ˆë¡œ ë‚´ê°€ ì–´ë–¤ ê²Œì„ ì„œë²„ë¥¼ ë§Œë“¤ì—ˆëŠ”ë° ì•„ë§ˆë„ ìœ ì €ê°€ ìµœëŒ€ ì–¼ë§ˆ ì •ë„ ì ‘ì† í•´ì„œ APIë¥¼</p><p>í˜¸ì¶œ í•˜ì§€ ì•Šì„ê¹Œ? ì˜ˆìƒí•´ì„œ ê°€ìƒì˜ ìœ ì €ë¥¼ ìƒì„±í•˜ì—¬ APIë¥¼ ê³„ì† í˜¸ì¶œí•´ì„œ ì„œë²„ê°€ ì–´ë–¤ ìƒíƒœê°€ </p><p>ë˜ëŠ”ì§€ í™•ì¸ì„ í•˜ëŠ” ê²ƒì„ ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¼ ì´í•´ í–ˆë‹¤.</p><p>ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ í˜„ì¬ ì´ ì„œë¹„ìŠ¤ì˜ ì„œë²„ ì‚¬ì–‘ì´ ê´œì°®ì€ì§€, ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ì ì  ëŠë ¤ì§„ë‹¤ëŠ”ì§€</p><p>ë“±ë“± ì´ëŸ¬í•œ ë¶€ë¶„ì„ ì²´í¬ í•˜ì—¬ ìˆ˜ì • ë° ê°œì„ ì„ í•œë‹¤.</p><p>ì‹¤ì œë¡œ ì˜¨ë¼ì¸ ê²Œì„ë“±ì„ ë³´ë©´ ì¢…ì¢… ì˜¤í”ˆ ì‹œ ì„œë²„ê°€ í„°ì§€ëŠ”ë° ì–¼ë§ˆë‚˜ ëª°ë¦°ê±´ì§€.. ë¬´ì„­ë‹¤</p><h2 id="Artillery"><a href="#Artillery" class="headerlink" title="Artillery"></a>Artillery</h2><p>ArtilleryëŠ” Node.jsì—ì„œ ì“¸ ìˆ˜ ìˆëŠ” ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬ ì¸ë° ì•„ë˜ì™€ ê°™ì€ ë°©ë²•ì„ ì§€ì› í•œë‹¤.</p><ul><li>HTTP</li><li>Socket.io</li><li>WebSocket</li></ul><p>ë‹¤ë¥¸ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë„êµ¬ë¥¼ ì•„ì§ ì•ˆ ì¨ë´ì„œ ì¥ì ì´ë‚˜ ë‹¨ì ì€ ì˜ ëª¨ë¥´ê² ë‹¤..</p><h2 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h2><p>node.jsê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">npm i artillery -g <span class="comment"># npm</span></span><br><span class="line">artillery -V <span class="comment"># ë²„ì „ í™•ì¸</span></span><br><span class="line"><span class="comment">#         ___         __  _ ____                  _</span></span><br><span class="line"><span class="comment">#   _____/   |  _____/ /_(_) / /__  _______  __  (_)___  _____</span></span><br><span class="line"><span class="comment">#  /____/ /| | / ___/ __/ / / / _ \/ ___/ / / / / / __ \/____/</span></span><br><span class="line"><span class="comment"># /____/ ___ |/ /  / /_/ / / /  __/ /  / /_/ / / / /_/ /____/</span></span><br><span class="line"><span class="comment">#     /_/  |_/_/   \__/_/_/_/\___/_/   \__, (_)_/\____/</span></span><br><span class="line"><span class="comment">#                                     /____/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ------------ Version Info ------------</span></span><br><span class="line"><span class="comment"># Artillery: 1.6.0-29</span></span><br><span class="line"><span class="comment"># Artillery Pro: not installed (https://artillery.io/pro)</span></span><br><span class="line"><span class="comment"># Node.js: v10.16.1</span></span><br><span class="line"><span class="comment"># OS: darwin/x64</span></span><br><span class="line"><span class="comment"># --------------------------------------</span></span><br></pre></td></tr></table></figure><h2 id="ì—°ìŠµí• -ì–´í”Œë¦¬ì¼€ì´ì…˜"><a href="#ì—°ìŠµí• -ì–´í”Œë¦¬ì¼€ì´ì…˜" class="headerlink" title="ì—°ìŠµí•  ì–´í”Œë¦¬ì¼€ì´ì…˜"></a>ì—°ìŠµí•  ì–´í”Œë¦¬ì¼€ì´ì…˜</h2><p>ì•„ì£¼ ê°„ë‹¨í•œ APIë¥¼ Expressë¡œ ì‘ì„±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> uuid = <span class="built_in">require</span>(<span class="string">&#x27;nanoid&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">  extended: <span class="literal">true</span>,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/join&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">200</span>, <span class="attr">id</span>: uuid.nanoid(), <span class="attr">create_at</span>: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/data&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.query;</span><br><span class="line">  <span class="keyword">if</span> (!id) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">500</span>, <span class="attr">message</span>: <span class="string">&#x27;something wrong&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res.json(&#123; <span class="attr">code</span>: <span class="number">200</span>, id &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`running on port <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ì‹œë‚˜ë¦¬ì˜¤"><a href="#ì‹œë‚˜ë¦¬ì˜¤" class="headerlink" title="ì‹œë‚˜ë¦¬ì˜¤"></a>ì‹œë‚˜ë¦¬ì˜¤</h2><p>ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‘ì„±í•œëŒ€ë¡œ APIë¥¼ ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œì„ í•˜ì—¬ ë¶€í•˜ë¥¼ ì¤„ ìˆ˜ê°€ ìˆë‹¤.</p><p>ì§€ê¸ˆì€ ì—°ìŠµìœ¼ë¡œ HTTP í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‘ì„± í•œë‹¤.</p><ol><li>/joinì„ í†µí•´ IDë¥¼ ì‘ë‹µ ë°›ëŠ”ë‹¤.</li><li>/dataì— IDë¥¼ ë³´ë‚¸ë‹¤.</li></ol><p>artilleryëŠ” json ë˜ëŠ” yamlì„ ì§€ì›í•˜ëŠ”ë° yamlì´ ë‚˜ì€ ë“¯(ì£¼ì„ì„ ì“¸ ìˆ˜ ìˆì–´ì„œ!)</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">config:</span></span><br><span class="line">  <span class="attr">target:</span> <span class="string">&quot;http://localhost:3000&quot;</span> <span class="comment"># host</span></span><br><span class="line">  <span class="attr">phases:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">duration:</span> <span class="number">30</span> <span class="comment"># í•´ë‹¹ ì´ˆë§Œí¼ ì‹¤í–‰</span></span><br><span class="line">      <span class="attr">arrivalRate:</span> <span class="number">300</span> <span class="comment"># ê°€ìƒ ì‚¬ìš©ì ìˆ˜</span></span><br><span class="line">  <span class="attr">processor:</span> <span class="string">&quot;./util.js&quot;</span> <span class="comment"># ì°¸ì¡°í•  js</span></span><br><span class="line">  <span class="attr">defaults:</span></span><br><span class="line">    <span class="attr">headers:</span> <span class="comment"># header ì„¸íŒ…</span></span><br><span class="line">      <span class="attr">Content-Type:</span> <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line"><span class="attr">scenarios:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">flow:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">post:</span> <span class="comment"># method ì„¤ì •</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">&quot;/join&quot;</span> <span class="comment"># api url</span></span><br><span class="line">        <span class="attr">body:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="attr">afterResponse:</span> <span class="string">&quot;responseData&quot;</span> <span class="comment"># api ì‘ë‹µë°›ì€ í›„ì˜ ì‹¤í–‰í•  í•¨ìˆ˜</span></span><br><span class="line">        <span class="attr">match:</span> <span class="comment"># í•´ë‹¹ ê°’ì´ ë§ëŠ”ì§€ ì²´í¬</span></span><br><span class="line">          <span class="attr">json:</span> <span class="string">&quot;$.code&quot;</span> <span class="comment"># json ë°ì´í„° ì¤‘ì— codeë¥¼ ì„ íƒ</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">200</span> <span class="comment"># 200ì´ë©´ success ì•„ë‹ˆë©´ fail</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">function:</span> <span class="string">&quot;setParam&quot;</span> <span class="comment"># get ì‹¤í–‰í•˜ê¸°ì „ì— ì°¸ì¡°í•  í•¨ìˆ˜</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">get:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">&quot;/data?id=<span class="template-variable">&#123;&#123; id &#125;&#125;</span>&quot;</span> <span class="comment"># setParamì—ì„œ ë„£ì€ ID</span></span><br><span class="line">        <span class="attr">match:</span></span><br><span class="line">          <span class="attr">json:</span> <span class="string">&quot;$.code&quot;</span></span><br><span class="line">          <span class="attr">value:</span> <span class="number">200</span></span><br></pre></td></tr></table></figure><p>ì´ì „ì—” ëª°ëëŠ”ë° í•¨ìˆ˜ë¥¼ ì‹œë‚˜ë¦¬ì˜¤ ë¡œì§ì— ì¶”ê°€í•  ìˆ˜ê°€ ìˆì—ˆë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> responseData = <span class="function">(<span class="params">requestParams, response, context, ee, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> json = <span class="built_in">JSON</span>.parse(response.body);</span><br><span class="line">  <span class="keyword">if</span> (json.code === <span class="number">200</span>) &#123;</span><br><span class="line">    data.push(json.id);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> next(); <span class="comment">// nextë¥¼ ë¦¬í„´í•´ì¤˜ì•¼ ë‹¤ì‹œ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> setParam = <span class="function">(<span class="params">context, events, done</span>) =&gt;</span> &#123;</span><br><span class="line">   context.vars[<span class="string">&#x27;id&#x27;</span>] = data[i]; <span class="comment">// idë¼ëŠ” ê°’ì— íŒŒë¼ë¯¸í„° ì„¤ì •</span></span><br><span class="line">   i++;</span><br><span class="line">   <span class="keyword">return</span> done(); <span class="comment">// ì½œë°±</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.responseData = responseData;</span><br><span class="line"><span class="built_in">exports</span>.setParam = setParam;</span><br></pre></td></tr></table></figure><h2 id="ì‹¤í–‰-ë°-ê²°ê³¼"><a href="#ì‹¤í–‰-ë°-ê²°ê³¼" class="headerlink" title="ì‹¤í–‰ ë° ê²°ê³¼"></a>ì‹¤í–‰ ë° ê²°ê³¼</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">artillery run -o ê²°ê³¼.json ì‹¤í–‰í•  íŒŒì¼ëª….yaml</span><br><span class="line">artillery report ê²°ê³¼.json</span><br></pre></td></tr></table></figure><ol><li>ì‘ì„±í•œ yamlíŒŒì¼ì˜ ì‹¤í–‰ ê²°ê³¼ë¥¼ jsonìœ¼ë¡œ ì €ì¥ì„ í•œë‹¤.</li><li>report ëª…ë ¹ì–´ë¡œ ì‹¤í–‰ì„ í•˜ë©´ htmlë¡œ ì°¨íŠ¸ ë“± ê²°ê³¼ í™”ë©´ì„ ë³´ì—¬ ì¤€ë‹¤.</li></ol><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://artillery.io/docs/">artillery doc</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> LoadTest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js Sequelize ì‚¬ìš©í•´ë³´ê¸° - 2</title>
      <link href="/2019/09/25/nodejs-use-sequelize-2/"/>
      <url>/2019/09/25/nodejs-use-sequelize-2/</url>
      
        <content type="html"><![CDATA[<p>Expressì—ì„œ Sequelize ORM ì‚¬ìš©í•˜ì—¬ MySQL Join, Transaction ì‚¬ìš©í•´ë³´ê¸°</p><h2 id="ìŠ¤í‚¤ë§ˆ-ìƒì„±"><a href="#ìŠ¤í‚¤ë§ˆ-ìƒì„±" class="headerlink" title="ìŠ¤í‚¤ë§ˆ ìƒì„±"></a>ìŠ¤í‚¤ë§ˆ ìƒì„±</h2><p>ê´€ê³„ë¥¼ ë§ºê¸° ìœ„í•´ í”Œë ˆì´ì–´, íŒ€ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆë¥¼ ìƒì„± í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">sequelize, DataTypes</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> players = sequelize.define(<span class="string">&#x27;players&#x27;</span>, &#123;</span><br><span class="line">    id: &#123; <span class="attr">type</span>: DataTypes.INTEGER, <span class="attr">primaryKey</span>: <span class="literal">true</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    name: &#123;</span><br><span class="line">      type: DataTypes.STRING,</span><br><span class="line">      allowNull: <span class="literal">false</span>,</span><br><span class="line">      validate: &#123;</span><br><span class="line">        notNull(val) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!val) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;ì„ ìˆ˜ ì´ë¦„ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    position: DataTypes.STRING,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    timestamps: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  players.associate = <span class="function">(<span class="params">models</span>) =&gt;</span> &#123; <span class="comment">// <span class="doctag">NOTE:</span> N : 1</span></span><br><span class="line">    players.belongsTo(models.teams);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> players;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">sequelize, DataTypes</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> teams = sequelize.define(<span class="string">&#x27;teams&#x27;</span>, &#123;</span><br><span class="line">    id: &#123; <span class="attr">type</span>: DataTypes.INTEGER, <span class="attr">primaryKey</span>: <span class="literal">true</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    title: &#123;</span><br><span class="line">      type: DataTypes.STRING,</span><br><span class="line">      allowNull: <span class="literal">false</span>,</span><br><span class="line">      validate: &#123;</span><br><span class="line">        notNull(val) &#123;</span><br><span class="line">          <span class="keyword">if</span> (!val) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;íŒ€ ì´ë¦„ì´ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    place: DataTypes.STRING,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    timestamps: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  teams.associate = <span class="function">(<span class="params">models</span>) =&gt;</span> &#123; <span class="comment">// <span class="doctag">NOTE:</span> 1 : N</span></span><br><span class="line">    teams.hasMany(models.players);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> teams;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="ì¡°ì¸"><a href="#ì¡°ì¸" class="headerlink" title="ì¡°ì¸"></a>ì¡°ì¸</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> join í”Œë ˆì´ì–´(N) : íŒ€(1)</span></span><br><span class="line">router.get(<span class="string">&#x27;/join1&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  db.players.findAll(&#123;</span><br><span class="line">    include: &#123; <span class="attr">model</span>: db.teams &#125;,</span><br><span class="line">  &#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!result.length) <span class="keyword">return</span> res.json(&#123; <span class="attr">message</span>: <span class="string">&#x27;NOT FOUND&#x27;</span> &#125;);</span><br><span class="line">    <span class="keyword">return</span> res.json(result);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> res.json(e));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> join íŒ€(1): í”Œë ˆì´ì–´ (N)</span></span><br><span class="line">router.get(<span class="string">&#x27;/join2&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  db.teams.findAll(&#123;</span><br><span class="line">    include: &#123; <span class="attr">model</span>: db.players &#125;,</span><br><span class="line">  &#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!result.length) <span class="keyword">return</span> res.json(&#123; <span class="attr">message</span>: <span class="string">&#x27;NOT FOUND&#x27;</span> &#125;);</span><br><span class="line">    <span class="keyword">return</span> res.json(result);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> res.json(e));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1569750654/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-09-29_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_6.35.58_jdydkd.png" alt="join-1"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1569750679/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-09-29_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_6.35.49_qqjugx.png" alt="join-2"></p><h2 id="íŠ¸ëœì­ì…˜"><a href="#íŠ¸ëœì­ì…˜" class="headerlink" title="íŠ¸ëœì­ì…˜"></a>íŠ¸ëœì­ì…˜</h2><p>ì„ ìˆ˜ë¥¼ ë“±ë¡ì„ í•˜ëŠ”ë° í•´ë‹¹ íŒ€ì´ ì¡´ì¬í•˜ë©´ ì»¤ë°‹, ì—…ìœ¼ë©´ ë¡¤ë°± í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> íŠ¸ëœì­ì…˜</span></span><br><span class="line">router.post(<span class="string">&#x27;/transaction&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; name, position, teamId &#125; = req.body;</span><br><span class="line">  db.sequelize.transaction().then(<span class="keyword">async</span> (t) =&gt; &#123; <span class="comment">// <span class="doctag">NOTE:</span> íŠ¸ëœì­ì…˜ ì‹œì‘</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> player = <span class="keyword">await</span> db.players.create(&#123; <span class="comment">// <span class="doctag">NOTE:</span> ì„ ìˆ˜ ë“±ë¡</span></span><br><span class="line">        name,</span><br><span class="line">        position,</span><br><span class="line">        teamId,</span><br><span class="line">      &#125;, &#123; <span class="attr">transaction</span>: t &#125;);</span><br><span class="line">      <span class="keyword">await</span> db.teams.findOne(&#123; <span class="comment">// <span class="doctag">NOTE:</span> í•´ë‹¹ íŒ€ì´ ì‡ëŠ”ì§€ ì²´í¬</span></span><br><span class="line">        where: &#123;</span><br><span class="line">          id: player.teamId,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;, &#123; <span class="attr">transaction</span>: t &#125;); <span class="comment">// <span class="doctag">NOTE:</span> íŠ¸ëœì­ì…˜</span></span><br><span class="line">      t.commit(); <span class="comment">// <span class="doctag">NOTE:</span> íŒ€ì´ ì‡ìœ¼ë¨¼ commit (=ì €ì¥)</span></span><br><span class="line">      <span class="keyword">return</span> res.json(&#123; <span class="attr">message</span>: <span class="string">&#x27;create success&#x27;</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      t.rollback(); <span class="comment">// <span class="doctag">NOTE:</span> ì—ëŸ¬ (ì—…ëŠ” íŒ€)ì¸ ê²½ìš° ë¡¤ë°± (ì €ì¥ ì·¨ì†Œ)</span></span><br><span class="line">      <span class="keyword">return</span> res.json(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> res.json(e));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1569750780/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-09-29_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_6.38.40_jnocf1.png" alt="ì‹¤í–‰ ê²°ê³¼"></p><h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><p>ì§ì ‘ ì¿¼ë¦¬ ì‹¤í–‰ë„ ê°€ëŠ¥ í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> sql ì¿¼ë¦¬</span></span><br><span class="line">router.get(<span class="string">&#x27;/query&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  db.sequelize.query(<span class="string">&#x27;select * from players&#x27;</span>).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(result); <span class="comment">// <span class="doctag">NOTE:</span> ë˜‘ê°™ì€ ê²°ê³¼ê°€ 2ê°œ ë‚˜ì˜¤ë¯€ë¡œ [0]ìœ¼ë¡œ ì²˜ë¦¬.</span></span><br><span class="line">    <span class="keyword">return</span> res.json(result[<span class="number">0</span>]);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> res.json(e));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
            <tag> ORM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js Sequelize ì‚¬ìš©í•´ë³´ê¸° - 1</title>
      <link href="/2019/09/24/nodejs-use-sequelize-1/"/>
      <url>/2019/09/24/nodejs-use-sequelize-1/</url>
      
        <content type="html"><![CDATA[<p>Expressì—ì„œ Sequelize ORM ì‚¬ìš©í•˜ì—¬ MySQL CRUD í•´ë³´ê¸°</p><p>ì‘ì„± ë‹¹ì‹œ sequelize ë²„ì „ì€ 5.19.1</p><h2 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add sequelize, mysql2</span><br></pre></td></tr></table></figure><p>sequelizeëŠ” ë‹¤ë¥¸ rdbë„ ì§€ì›ì„ í•œë‹¤. mysql2 ëŒ€ì‹  ë‹¤ë¥¸ rdb ëª¨ë“ˆ ì„¤ì¹˜ ê°€ëŠ¥ í•˜ë‹¤.</p><h2 id="ì„¤ì •"><a href="#ì„¤ì •" class="headerlink" title="ì„¤ì •"></a>ì„¤ì •</h2><h3 id="init"><a href="#init" class="headerlink" title="init"></a>init</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> sequelize init</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> db = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;mysql://root@localhost/test&#x27;</span>); <span class="comment">// <span class="doctag">NOTE:</span> mysql connect url</span></span><br><span class="line"></span><br><span class="line">fs.readdirSync(__dirname).filter(<span class="function">(<span class="params">file</span>) =&gt;</span> (file.indexOf(<span class="string">&#x27;.&#x27;</span>) !== <span class="number">0</span>) &amp;&amp; (file !== <span class="string">&#x27;index.js&#x27;</span>)).forEach(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> model = sequelize.import(path.join(__dirname, file));</span><br><span class="line">  db[model.name] = model;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(db).forEach(<span class="function">(<span class="params">modelName</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">&#x27;associate&#x27;</span> <span class="keyword">in</span> db[modelName]) &#123;</span><br><span class="line">    db[modelName].associate(db);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">db.sequelize = sequelize;</span><br><span class="line">db.Sequelize = Sequelize;</span><br><span class="line">db.Op = Sequelize.Op; <span class="comment">// <span class="doctag">NOTE:</span> v5ë¶€í„´ ì´ê±¸ í•´ì¤˜ì•¼ ì¡°ê±´ì ˆ equalê°™ì€ê±° ì“¸ìˆ˜ ì‡ìŒ.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = db;</span><br></pre></td></tr></table></figure><p>sequelizeë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì´ë‹ˆì…œë¼ì´ì¦ˆë¼ê³  ì•Œì•„ë‘ë©´ ëœë‹¤.</p><h3 id="í…Œì´ë¸”-ìŠ¤í‚¤ë§ˆ-ë§Œë“¤ê¸°"><a href="#í…Œì´ë¸”-ìŠ¤í‚¤ë§ˆ-ë§Œë“¤ê¸°" class="headerlink" title="í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë§Œë“¤ê¸°"></a>í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë§Œë“¤ê¸°</h3><p>í…Œì´ë¸” ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•´ì•¼ ì‚¬ìš©í•  ìˆ˜ ì‡ìŒ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">sequelize, DataTypes</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> animes = sequelize.define(<span class="string">&#x27;animes&#x27;</span>, &#123; <span class="comment">// <span class="doctag">NOTE:</span> &#x27;animes&#x27;ëŠ” í…Œì´ë¸”ëª…</span></span><br><span class="line">    id: &#123; <span class="attr">type</span>: DataTypes.INTEGER, <span class="attr">primaryKey</span>: <span class="literal">true</span>, <span class="attr">autoIncrement</span>: <span class="literal">true</span> &#125;, <span class="comment">// <span class="doctag">NOTE:</span> primary key</span></span><br><span class="line">    title: DataTypes.STRING,</span><br><span class="line">    quarter: DataTypes.STRING,</span><br><span class="line">    createAt: &#123;</span><br><span class="line">      type: DataTypes.DATE,</span><br><span class="line">      defaultValue: DataTypes.NOW,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    timestamps: <span class="literal">false</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> animes;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ìì£¼ ì“°ëŠ” ë°ì´í„° íƒ€ì…ë§Œ ì ì–´ë‘ì.</p><ul><li>DataTypes.INTEGER = ì •ìˆ˜í˜• int</li><li>DataTypes.STRING = ë¬¸ìí˜• varchar(255)</li><li>DataTypes.TEXT = ë¬¸ìí˜• TEXT</li><li>DataTypes.DATE = ë‚ ì§œ DATETIME</li><li>DataTypes.BOOLEAN = tinyint 1/0</li></ul><h3 id="ì—°ê²°"><a href="#ì—°ê²°" class="headerlink" title="ì—°ê²°"></a>ì—°ê²°</h3><p>ì•± ì‹¤í–‰ ì‹œ dbì— ì—°ê²°í•˜ê³  ìŠ¤í‚¤ë§ˆì— ì •ì˜ëœ í…Œì´ë¸”ì´ ì—…ìœ¼ë©´ ìƒì„±ì„ í•œë‹¤.</p><p>ì•„ ìŠ¤í‚¤ë§ˆë¥¼ ë³€ê²½í•œë‹¤ê³  ì´ë¯¸ ìƒì„±ëœ í…Œì´ë¸”ì´ ë³€ê²½ë˜ì§„ ì•ŠëŠ”ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.sequelize</span><br><span class="line">  .sync()</span><br><span class="line">  .then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;DB ì—°ê²° ì„±ê³µ&#x27;</span>);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(e);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><h2 id="crud"><a href="#crud" class="headerlink" title="crud"></a>crud</h2><p>routerì— paramterê°€ ì˜¤ëŠ” ê°’ìœ¼ë¡œ crudë¥¼ í•´ë³¸ë‹¤.</p><h3 id="create"><a href="#create" class="headerlink" title="create"></a>create</h3><p>1 rowë¥¼ ìƒì„±</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> create</span></span><br><span class="line">router.post(<span class="string">&#x27;/create&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; title, quarter &#125; = req.body;</span><br><span class="line">  db.animes.create(&#123;</span><br><span class="line">    title,</span><br><span class="line">    quarter,</span><br><span class="line">  &#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> res.json(result)).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> res.json(e));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1569746033/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-09-29_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.33.37_ot4ry9.png" alt="ì‹¤í–‰ ê²°ê³¼"></p><h3 id="ì—¬ëŸ¬-ê°œ-create"><a href="#ì—¬ëŸ¬-ê°œ-create" class="headerlink" title="ì—¬ëŸ¬ ê°œ create"></a>ì—¬ëŸ¬ ê°œ create</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> multiple create</span></span><br><span class="line">router.post(<span class="string">&#x27;/multiple-create&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = req.body; <span class="comment">// <span class="doctag">NOTE:</span> Array Object [&#123;&#125;, &#123;&#125; ... ]</span></span><br><span class="line">  db.animes.bulkCreate(data).then(<span class="function">(<span class="params">result</span>) =&gt;</span> res.json(result)).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> res.json(e));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1569746119/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-09-29_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.34.57_mh04pr.png" alt="ì‹¤í–‰ ê²°ê³¼"></p><h3 id="read"><a href="#read" class="headerlink" title="read"></a>read</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">router.post(<span class="string">&#x27;/select&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.body;</span><br><span class="line">  db.animes.findAll(&#123;</span><br><span class="line">    where: &#123;</span><br><span class="line">      id,</span><br><span class="line">      <span class="comment">// id: &#123; // <span class="doctag">NOTE:</span> &gt;, = ê°™ì€ ì¡°ê±´ì‹ì„ ì“°ëŠ” ë°©ë²•.</span></span><br><span class="line">      <span class="comment">//   [db.Op.gt]: id,</span></span><br><span class="line">      <span class="comment">// &#125;,</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// limit: 1, // <span class="doctag">NOTE:</span> ê°œìˆ˜ ì œí•œ</span></span><br><span class="line">    <span class="comment">// attributes: [&#x27;title&#x27;], // <span class="doctag">NOTE:</span> íŠ¹ì • ì»¬ëŸ¼ë§Œ ì½ì„ ë•Œ</span></span><br><span class="line">    <span class="comment">// order: [&#x27;id&#x27;, &#x27;desc&#x27;], // <span class="doctag">NOTE:</span> ì •ë ¬</span></span><br><span class="line">  &#125;).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123; <span class="comment">// <span class="doctag">NOTE:</span> ê²°ê³¼ëŠ” []ì—</span></span><br><span class="line">    <span class="keyword">if</span> (!result.length) <span class="keyword">return</span> res.json(&#123; <span class="attr">message</span>: <span class="string">&#x27;NOT FOUND&#x27;</span> &#125;);</span><br><span class="line">    <span class="keyword">return</span> res.json(result);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> res.json(e));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1569746257/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-09-29_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.37.25_z9kmf3.png" alt="ì‹¤í–‰ ê²°ê³¼"></p><h4 id="ì¡°ê±´ì ˆ-ì •ë¦¬"><a href="#ì¡°ê±´ì ˆ-ì •ë¦¬" class="headerlink" title="ì¡°ê±´ì ˆ ì •ë¦¬"></a>ì¡°ê±´ì ˆ ì •ë¦¬</h4><ul><li>gt: &gt;</li><li>eq: ==</li><li>gte: &gt;=</li><li>in: Array ì•ˆì— í¬í•¨</li><li>lt: &lt;</li><li>lte: &lt;=</li><li>ne: !=</li><li>nin: Array ì•ˆì— í¬í•¨í•˜ì§€ ì•Šì€</li></ul><h3 id="update"><a href="#update" class="headerlink" title="update"></a>update</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> update</span></span><br><span class="line">router.post(<span class="string">&#x27;/update&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id, title &#125; = req.body;</span><br><span class="line">  db.animes.update(</span><br><span class="line">    &#123;</span><br><span class="line">      title,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      where: &#123;</span><br><span class="line">        id,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  ).then(<span class="function">() =&gt;</span> res.json(&#123; <span class="attr">message</span>: <span class="string">&#x27;update success&#x27;</span> &#125;)).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> res.json(e));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì—…ë°ì´íŠ¸ ëœ ë‚´ìš©ì„ ì½œë°± ë°›ì§„ ì•ŠëŠ”ë‹¤.</p><h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> delete</span></span><br><span class="line">router.post(<span class="string">&#x27;/delete&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.body;</span><br><span class="line">  db.animes.destroy(&#123;</span><br><span class="line">    where: &#123;</span><br><span class="line">      id,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;).then(<span class="function">() =&gt;</span> res.json(&#123; <span class="attr">message</span>: <span class="string">&#x27;delete success&#x27;</span> &#125;)).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> res.json(e));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì—…ë°ì´íŠ¸ì™€ ë§ˆì°¬ê°€ì§€ë¡œ ë³„ë„ë¡œ ì½œë°± ë°›ëŠ”ê²Œ ì—…ë‹¤.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
            <tag> ORM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS Lambda ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2019/08/19/etc-aws-lambda-apigateway/"/>
      <url>/2019/08/19/etc-aws-lambda-apigateway/</url>
      
        <content type="html"><![CDATA[<h2 id="Lambdaë€"><a href="#Lambdaë€" class="headerlink" title="Lambdaë€?"></a>Lambdaë€?</h2><p>ì„œë²„ë¦¬ìŠ¤, ì´ë²¤íŠ¸ ì²˜ë¦¬ ë°©ì‹ì˜ ì»´í“¨íŒ… ì„œë¹„ìŠ¤</p><blockquote><p>ì„œë²„ë¦¬ìŠ¤(serverless)ë€ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œìê°€ ì„œë²„ë¥¼ í”„ë¡œë¹„ì €ë‹í•˜ê±°ë‚˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í™•ì¥ì„ ê´€ë¦¬í•  í•„ìš”ê°€ ì—†ëŠ” í´ë¼ìš°ë“œ ì»´í“¨íŒ… ëª¨ë¸</p></blockquote><p>ì´ë²¤íŠ¸ ì²˜ë¦¬ ë°©ì‹ì€ ë‚´ê°€ í•´ë³¸ ê±´ ì•„ë˜ì™€ ê°™ë‹¤.</p><ul><li>ì§ì ‘ Lambdaë¥¼ ë™ê¸°/ë¹„ë™ê¸°ì‹ìœ¼ë¡œ í˜¸ì¶œ</li><li>CloudWatch Eventë¥¼ í†µí•œ í˜¸ì¶œ</li><li>API GateWayë¥¼ ì—°ë™í•˜ì—¬ í˜¸ì¶œ</li></ul><h3 id="ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆë˜-ì¥ì "><a href="#ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆë˜-ì¥ì " class="headerlink" title="ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆë˜ ì¥ì "></a>ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆë˜ ì¥ì </h3><ul><li>ì‚¬ìš©ìê°€ ë³„ë„ë¡œ êµ¬ì¶•í•˜ê±°ë‚˜ ê´€ë¦¬í•  í•„ìš”ê°€ ì—†ë‹¤.</li><li>ë‹¤ì–‘í•œ ì–¸ì–´ ì§€ì› (Node.js, Golang, Python, Java ë“±ë“±ë“±)</li></ul><h3 id="ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆë˜-ë‹¨ì "><a href="#ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆë˜-ë‹¨ì " class="headerlink" title="ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆë˜ ë‹¨ì "></a>ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆë˜ ë‹¨ì </h3><ul><li>lambdaì˜ cold start ì •ë„?</li><li>CloudWatchë¡œ ë¡œê·¸ë¥¼ ë³¼ ë•Œ ë³´ê¸°ê°€ ì¢€ ì–´ë ¤ì› ì—ˆë‹¤</li></ul><blockquote><p>cold startë€ ìµœê·¼ì— í˜¸ì¶œë˜ì§€ ì•Šì€ Lambda í•¨ìˆ˜ê°€ ì‹¤í–‰ë˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì¶”ê°€ ì§€ì—° ì‹œê°„</p></blockquote><h3 id="Lambda-í•¨ìˆ˜-ìƒì„±"><a href="#Lambda-í•¨ìˆ˜-ìƒì„±" class="headerlink" title="Lambda í•¨ìˆ˜ ìƒì„±"></a>Lambda í•¨ìˆ˜ ìƒì„±</h3><p>ë©”ë‰´ì— ê°€ì„œ ìƒì„±ì„ í•œë‹¤.</p><p>ë­”ê°€ ë‹¤ë¥¸ ê±°ì™€ ì‚¬ìš©í• ë ¤ë©´ ì—­í• ì„ ìˆ˜ì •ì„ í•´ì•¼ í• í…ë° í˜„ì¬ëŠ” ì•„ë‹ˆë¯€ë¡œ íŒ¨ìŠ¤</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1597837406/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-08-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.33.58_qgqnep.png" alt="ëŒë‹¤ í•¨ìˆ˜ ìƒì„±"></p><p>ì§§ì€ ì‹œê°„ ë‚´ ìƒì„±ì´ ë˜ê³  ì•„ë˜ì™€ ê°™ì€ í™”ë©´ìœ¼ë¡œ ì´ë™ì„ í•  ê²ƒì´ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1597839698/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-08-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_9.21.15_f1rw7m.png" alt="ê²°ê³¼ í™”ë©´"></p><p>ê°„ë‹¨í•œ ì½”ë“œëŠ” í™”ë©´ì˜ ì—ë””í„°ì—ì„œ ì²˜ë¦¬ë„ ê°€ëŠ¥ í•˜ê³  ì™¸ë¶€ ëª¨ë“ˆì´ í•„ìš”í•œ ì½”ë“œëŠ”</p><p>ì½”ë“œë¥¼ ì‘ì„±í•œ íŒŒì¼ê³¼ node_modulesë¥¼ ì••ì¶•í•˜ì—¬ ì—…ë¡œë“œí•˜ë©´ ëœë‹¤.</p><p>í™”ë©´ì„ ë°‘ìœ¼ë¡œ ë‚´ë¦¬ë©´ Lambda ë‚´ì—ì„œ ì“¸ ìˆ˜ ìˆëŠ” í™˜ê²½ ë³€ìˆ˜ë¥¼ ì§€ì • í•  ìˆ˜ ìˆê³ </p><p>ê¸°ë³¸ ì„¤ì •ì—ì„œ ëŸ°íƒ€ì„ê³¼ ë©”ëª¨ë¦¬, ì œí•œ ì‹œê°„(timeout) ë“±ì„ ì„¤ì • í•  ìˆ˜ ìˆëŠ”ë° ë©”ëª¨ë¦¬ë‚˜</p><p>ì œí•œ ì‹œê°„ì€ ì½”ë“œì˜ ìƒíƒœì— ë”°ë¼ ë‹¬ë¼ì§€ë¯€ë¡œ ë­ë¼ ì ì„ ìˆ˜ê°€ ì—†ë‹¤.</p><p>VPCëŠ” ElasticCache ì‚¬ìš©í•  ë•Œ ì„¤ì •ì„ í•´ ë´¤ê¸´ í–ˆëŠ”ë°.. í˜„ì¬ í¬ìŠ¤íŠ¸ì—ì„  ì œì™¸í•˜ê³ </p><p>ê·¸ ì™¸ ë‚˜ë¨¸ì§€ëŠ” ì„¤ì •ì„ í•´ ë³¸ì ì´ ì—†ì–´ì„œ ì¼ë‹¨ íŒ¨ìŠ¤ í•˜ê² ë‹¤.</p><h3 id="ì´ë²¤íŠ¸-í˜¸ì¶œ"><a href="#ì´ë²¤íŠ¸-í˜¸ì¶œ" class="headerlink" title="ì´ë²¤íŠ¸ í˜¸ì¶œ"></a>ì´ë²¤íŠ¸ í˜¸ì¶œ</h3><p>ê¸°ì¡´ lambdaì˜ ì½”ë“œë¥¼ ì‚´ì§ ë°”ê¾¼ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.handler = <span class="keyword">async</span> (event) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> name = event.name || <span class="string">&#x27;world&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> response = &#123;</span><br><span class="line">        statusCode: <span class="number">200</span>,</span><br><span class="line">        body: <span class="string">`Hello! <span class="subst">$&#123;name&#125;</span>`</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;response&#x27;</span>, response)</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="ì§ì ‘-í˜¸ì¶œ"><a href="#ì§ì ‘-í˜¸ì¶œ" class="headerlink" title="ì§ì ‘ í˜¸ì¶œ"></a>ì§ì ‘ í˜¸ì¶œ</h4><p>aws-sdkë¥¼ ì´ìš©í•˜ì—¬ ë¡œì»¬ì—ì„œë‚˜ ë‹¤ë¥¸ í™˜ê²½ì—ì„œ ì‚¬ìš©ì´ ê°€ëŠ¥ í•˜ë‹¤.</p><h5 id="ë™ê¸°ì‹-í˜¸ì¶œ"><a href="#ë™ê¸°ì‹-í˜¸ì¶œ" class="headerlink" title="ë™ê¸°ì‹ í˜¸ì¶œ"></a>ë™ê¸°ì‹ í˜¸ì¶œ</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> lambda = <span class="keyword">new</span> AWS.Lambda();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  FunctionName: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">  InvocationType: <span class="string">&#x27;RequestResponse&#x27;</span>, <span class="comment">// <span class="doctag">NOTE:</span> í•´ë‹¹ ë¶€ë¶„ì€ ì£¼ì„í•´ë„ ëœë‹¤ lambdaì˜ default type</span></span><br><span class="line">  Payload: <span class="built_in">JSON</span>.stringify(&#123; <span class="attr">name</span>: <span class="string">&#x27;delryn&#x27;</span> &#125;),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">lambda.invoke(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      StatusCode: 200,</span></span><br><span class="line"><span class="comment">      ExecutedVersion: &#x27;$LATEST&#x27;,</span></span><br><span class="line"><span class="comment">      Payload: &#x27;&#123;&quot;statusCode&quot;:200,&quot;body&quot;:&quot;Hello! delryn&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h5 id="ë¹„ë™ê¸°ì‹-í˜¸ì¶œ"><a href="#ë¹„ë™ê¸°ì‹-í˜¸ì¶œ" class="headerlink" title="ë¹„ë™ê¸°ì‹ í˜¸ì¶œ"></a>ë¹„ë™ê¸°ì‹ í˜¸ì¶œ</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">  region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">  accessKeyId: <span class="string">&#x27;IAM ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">  secretAccessKey: <span class="string">&#x27;IAM ì‹œí¬ë¦¿ ì—‘ì„¸ìŠ¤ í‚¤&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> lambda = <span class="keyword">new</span> AWS.Lambda();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">  FunctionName: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">  InvocationType: <span class="string">&#x27;Event&#x27;</span>,</span><br><span class="line">  Payload: <span class="built_in">JSON</span>.stringify(&#123; <span class="attr">name</span>: <span class="string">&#x27;lunacy&#x27;</span> &#125;),</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">lambda.invoke(params).promise().then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// &#123; StatusCode: 202, Payload: &#x27;&#x27; &#125;</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì‹¤ì œ í˜¸ì¶œ ë˜ì—ˆëŠ”ì§€ CloudWatch Logë¥¼ ë³´ë©´ ì•Œ ìˆ˜ê°€ ìˆë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1597842973/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-08-19_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_10.15.43_dczmlh.png" alt="cloudwatch"></p><h3 id="CloudWatch-Eventë¥¼-í†µí•œ-í˜¸ì¶œ"><a href="#CloudWatch-Eventë¥¼-í†µí•œ-í˜¸ì¶œ" class="headerlink" title="CloudWatch Eventë¥¼ í†µí•œ í˜¸ì¶œ"></a>CloudWatch Eventë¥¼ í†µí•œ í˜¸ì¶œ</h3><p>í™”ë©´ì—ì„œ íŠ¸ë¦¬ê±°ë¥¼ ëˆ„ë¥´ê³  EventBridge(CloudWatch Events)ë¥¼ ì„ íƒ í•œë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1597895265/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-08-20_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.47.27_wsb3rz.png" alt="cron"></p><p>cron ì‘ì—…ì„ ê±°ëŠ”ê±°ë¼ ìƒê° í•˜ë©´ ëœë‹¤ Lambdaì˜ ì‹œê°„ëŒ€ëŠ” UTC 0 ì´ë¯€ë¡œ </p><p>ì˜ ê³ ë ¤í•´ì•¼ í•˜ê³  í‘œí˜„ì‹ ì‘ì„±ë²•ì€ ì•„ë˜ ì°¸ê³  ë¬¸ì„œë¥¼ ë³´ë©´ ì„¤ëª…ì´ ì˜ ë‚˜ì™€ ìˆë‹¤.</p><p>CloudWatch ê°€ì„œ ë³´ë©´ 1ë¶„ ë§ˆë‹¤ ì‹¤í–‰ í•˜ëŠ” ê±¸ í™•ì¸ ê°€ëŠ¥</p><h2 id="API-GateWayë€"><a href="#API-GateWayë€" class="headerlink" title="API GateWayë€?"></a>API GateWayë€?</h2><p>ê°œë°œìê°€ APIë¥¼ ì‰½ê²Œ ìƒì„±, ìœ ì§€ ê´€ë¦¬ í•˜ëŠ” ì™„ì „ê´€ë¦¬í˜• ì„œë¹„ìŠ¤</p><p>ê°œì¸ì ìœ¼ë¡œ ì¨ ë´¤ì„ ë•ŒëŠ” routerë¥¼ ì„¤ì •í•˜ëŠ” ëŠë‚Œì´ì˜€ë‹¤.</p><h3 id="ìƒì„±"><a href="#ìƒì„±" class="headerlink" title="ìƒì„±"></a>ìƒì„±</h3><p>í™”ë©´ì´ ë­”ê°€ ì¢€ ë°”ë€Œì—ˆë‹¤. WebSocketì€ ë‹¤ë¥¸ í¬ìŠ¤íŠ¸ì—ì„œ ë‹¤ë£¨ì—ˆìœ¼ë‹ˆ ì§€ê¸ˆì€ Lambda í•¨ìˆ˜ë¥¼ </p><p>í˜¸ì¶œ í•´ë³´ê¸° ìœ„í•œ HTTP APIë¡œ ë§Œë“¤ì–´ ë³¸ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1597896931/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-08-20_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.14.17_vysq89.png" alt="ìƒì„± - 1"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1597896955/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-08-20_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.14.40_desklm.png" alt="ìƒì„± - 2"></p><h3 id="ê²½ë¡œ-ì„¤ì •"><a href="#ê²½ë¡œ-ì„¤ì •" class="headerlink" title="ê²½ë¡œ ì„¤ì •"></a>ê²½ë¡œ ì„¤ì •</h3><p>ê°œë°œ ë©”ë‰´ì—ì„œ ê²½ë¡œë¥¼ ì„ íƒí•˜ê³  createë¥¼ ëˆŒëŸ¬ ì¤€ ë‹¤ìŒ ìƒí™©ì— ë§ëŠ” ë©”ì„œë“œë¥¼ ì„ íƒ í•œë‹¤.</p><p>ì§€ê¸ˆì€ í…ŒìŠ¤íŠ¸ë¡œ Any(POST or GET)ìœ¼ë¡œ ë§Œë“¤ì–´ ë³¸ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1597897221/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-08-20_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.20.03_ll8xka.png" alt="Any"></p><p>í†µí•© ì—°ê²°ì„ ëˆ„ë¥´ë©´ í™”ë©´ì´ ë°”ë€ŒëŠ”ë° í†µí•© ìƒì„± ë° ì—°ê²°ì„ ëˆŒëŸ¬ ì¤€ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1597897439/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-08-20_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.23.27_tnauuq.png" alt="í†µí•© ì—°ê²°"></p><p>ê¸°ì¡´ì— ì“°ë˜ Lambda í•¨ìˆ˜ë¥¼ ì—°ê²°í•˜ë©´ ë, íŒŒë¼ë¯¸í„°ë¥¼ ì˜ ë°›ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì½”ë“œë¥¼ ìˆ˜ì •</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.handler = <span class="keyword">async</span> (event) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> param;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> event.queryStringParameters !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        param = <span class="string">&#x27;GET&#x27;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> event.body !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        param = <span class="string">&#x27;POST&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> response = &#123;</span><br><span class="line">        statusCode: <span class="number">200</span>,</span><br><span class="line">        body: <span class="string">`Hello! <span class="subst">$&#123;param&#125;</span>`</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;response&#x27;</span>, response)</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="í˜¸ì¶œ"><a href="#í˜¸ì¶œ" class="headerlink" title="í˜¸ì¶œ"></a>í˜¸ì¶œ</h3><p>í˜¸ì¶œí•  URLì€ ë©”ë‰´ì—ì„œ API:ì´ë¦„ (VPC ë§í¬ ë°‘)ì„ ëˆ„ë¥´ë©´ ë‚˜ì˜¨ë‹¤.</p><p>HTTP Clientë¥¼ ì´ìš©í•´ í™•ì¸ì„ í•´ ë³¸ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1597898614/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-08-20_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.43.04_xox40w.png" alt="GET"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1597898614/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-08-20_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_1.42.45_ndlmmj.png" alt="POST"></p><p>ì‹¤ì œ ë°ì´í„°ë¥¼ ë°›ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì²˜ëŸ¼ ì ‘ê·¼ í•˜ë©´ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">event.queryStringParameters.param <span class="comment">// GET</span></span><br><span class="line">event.body.param <span class="comment">// POST</span></span><br></pre></td></tr></table></figure><p>ê·¸ ì™¸ì—ë„ event ë‚´ì— í—¤ë”ì— ëŒ€í•œ ì •ë³´ë„ í¬í•¨ í•˜ê³  ìˆìœ¼ë¯€ë¡œ í•„ìš”í•  ë•Œ í™•ì¸</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://www.redhat.com/ko/topics/cloud-native-apps/what-is-serverless">ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜</a></li><li><a href="https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/tutorial-scheduled-events-schedule-expressions.html">rate ë˜ëŠ” cronì„ ì‚¬ìš©í•œ ì˜ˆì•½ í‘œí˜„ì‹</a></li><li><a href="https://docs.aws.amazon.com/ko_kr/AmazonCloudWatch/latest/events/ScheduledEvents.html">ê·œì¹™ì— ëŒ€í•œ ì˜ˆì•½ í‘œí˜„ì‹</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>yarn or npmì—ì„œ í¼ë¯¸ì…˜ ì—ëŸ¬ í•´ê²°ë²•</title>
      <link href="/2019/08/17/etc-npm-yarn-permission-err/"/>
      <url>/2019/08/17/etc-npm-yarn-permission-err/</url>
      
        <content type="html"><![CDATA[<p>ê¸°ì–µì´ ì•ˆ ë‚˜ëŠ”ë° yarnìœ¼ë¡œ ì„¤ì¹˜ë¥¼ í• ë¼ í•˜ë©´ ì•„ë˜ ê°™ì´ ê³„ì† ë–³ìŒ.</p><p>/usr/local/lib/node_modules</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EACCES: permission denied</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>ì²˜ìŒì—” ë§¤ ë²ˆ sudo ë¶™ì—¬ ê°€ì§€ê³  í–‡ëŠ”ë° ì–´ì´êµ¬ ì´ê±° ë„ˆë¬´ ê·€ì°¬ê³  ì§œì¦ ë‚¨.</p><p>ì—­ì‹œ ìŠ¤íƒì˜¤ë²„í”Œë¡œìš°ì— ê²€ìƒ‰ í•˜ë‹ˆ ë‚˜ ê°™ì€ ì‚¬ëŒì´ ìˆì—ˆë‹¤</p><h2 id="ëª…ë ¹ì–´"><a href="#ëª…ë ¹ì–´" class="headerlink" title="ëª…ë ¹ì–´"></a>ëª…ë ¹ì–´</h2><ul><li><p>yarnì˜ ê²½ìš°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R <span class="variable">$USER</span>:<span class="variable">$GROUP</span> ~/.npm</span><br><span class="line">sudo chown -R <span class="variable">$USER</span>:<span class="variable">$GROUP</span> ~/.config</span><br></pre></td></tr></table></figure></li><li><p>npmì˜ ê²½ìš°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R $(whoami) /usr/<span class="built_in">local</span>/lib/node_modules</span><br></pre></td></tr></table></figure></li></ul><p>ê·¸ëƒ¥ ê·¸ëŒ€ë¡œ ì¹˜ë©´ ë‹¤ìŒ ë¶€í„° í¼ë¯¸ì…˜ ì—ëŸ¬ ì•ˆ ëœ¬ë‹¤.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://stackoverflow.com/questions/49529696/yarn-error-eaccess-permission-denied-scandir-home-ubuntu-config-yarn-link">stackoverflow - yarn error â€œEACCESS: permission denied, scandir â€˜/home/ubuntu/.config/yarn/linkâ€™â€</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ETC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lambda + Websocket + Dynamodbë¥¼ ì´ìš©í•œ ê°„ë‹¨ ì±„íŒ… ì‹¤ìŠµ</title>
      <link href="/2019/07/29/etc-aws-apigateway-websocket/"/>
      <url>/2019/07/29/etc-aws-apigateway-websocket/</url>
      
        <content type="html"><![CDATA[<h2 id="IAM-ì—­í• -ë§Œë“¤ê¸°"><a href="#IAM-ì—­í• -ë§Œë“¤ê¸°" class="headerlink" title="IAM ì—­í•  ë§Œë“¤ê¸°"></a>IAM ì—­í•  ë§Œë“¤ê¸°</h2><p>ì•„ë˜ì™€ ê°™ì€ ê¶Œí•œì„ ì¶”ê°€í•˜ì—¬ ìƒì„±ì„ í•œë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1583644259/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-03-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.10.33_ydjudf.png" alt="auth"></p><h2 id="Dynamodb-ìƒì„±"><a href="#Dynamodb-ìƒì„±" class="headerlink" title="Dynamodb ìƒì„±"></a>Dynamodb ìƒì„±</h2><ul><li>í…Œì´ë¸” ì´ë¦„ì€ my_chat</li><li>ê¸°ë³¸ íŒŒí‹°ì…˜ í‚¤ëŠ” connection_id (ë¬¸ìì—´)</li><li>ê¸€ë¡œë²Œ ì¸ë±ìŠ¤ í‚¤ëŠ” user_id-index</li></ul><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1583644587/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-03-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.15.51_q7uaax.png" alt="dynamodb-info"></p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1583644615/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-03-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.16.05_mf6bhp.png" alt="gsi"></p><h2 id="lambda-í•¨ìˆ˜-ìƒì„±"><a href="#lambda-í•¨ìˆ˜-ìƒì„±" class="headerlink" title="lambda í•¨ìˆ˜ ìƒì„±"></a>lambda í•¨ìˆ˜ ìƒì„±</h2><p>lambdaëŠ” ìœ„ì˜ ë§Œë“  IAM roleë¡œ ìƒì„±ì„ í•œë‹¤.</p><h3 id="ì—°ê²°-í•¨ìˆ˜"><a href="#ì—°ê²°-í•¨ìˆ˜" class="headerlink" title="ì—°ê²° í•¨ìˆ˜"></a>ì—°ê²° í•¨ìˆ˜</h3><p>ì—°ê²°ëœ ìœ ì € ì•„ì´ë””(í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì „ì†¡), ì»¤ë„¥ì…˜ ì•„ì´ë””(api gatewayìª½ì—ì„œ ìì²´ ë°œê¸‰)ë¥¼ </p><p>dynamodbì— ì €ì¥ì„ í•´ì„œ ê´€ë¦¬ë¥¼ í•˜ê²Œë” í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ddb = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient(&#123; <span class="attr">region</span>: <span class="string">&#x27;ap-northeast-2&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TABLE_NAME = <span class="string">&#x27;my_chat&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ì»¤ë„¥ì…˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>Dynamodbì— í•´ë‹¹ ìœ ì € ID, ì»¤ë„¥ì…˜ ID ë‹´ì•„ë‘”ë‹¤.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">exports</span>.handler = <span class="keyword">async</span> (event) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> connectionId = event.requestContext.connectionId;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> event.queryStringParameters === <span class="string">&#x27;undefined&#x27;</span> || <span class="keyword">typeof</span> event.queryStringParameters.user_id === <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;ì—°ê²° ì‹¤íŒ¨&#x27;</span>, <span class="string">&#x27;ìœ ì € ì•„ì´ë””ê°€ ì—†ìŒ&#x27;</span>);</span><br><span class="line">    result.statusCode = <span class="number">500</span>;</span><br><span class="line">    result.body = <span class="string">`ì—°ê²° ì‹¤íŒ¨: <span class="subst">$&#123;connectionId&#125;</span>`</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> userId = event.queryStringParameters.user_id;</span><br><span class="line">  <span class="keyword">const</span> checkParams = &#123;</span><br><span class="line">    TableName: TABLE_NAME,</span><br><span class="line">    IndexName: <span class="string">&#x27;user_id-index&#x27;</span>,</span><br><span class="line">    KeyConditionExpression: <span class="string">&#x27;#user_id = :user_id&#x27;</span>,</span><br><span class="line">    ExpressionAttributeNames: &#123;</span><br><span class="line">      <span class="string">&#x27;#user_id&#x27;</span>: <span class="string">&#x27;user_id&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    ExpressionAttributeValues: &#123;</span><br><span class="line">      <span class="string">&#x27;:user_id&#x27;</span>: userId,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> putParams = &#123;</span><br><span class="line">    TableName: TABLE_NAME,</span><br><span class="line">    Item: &#123;</span><br><span class="line">      connection_id: connectionId,</span><br><span class="line">      user_id: userId,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> duplicateCheck = <span class="keyword">await</span> ddb.query(checkParams).promise();</span><br><span class="line">    <span class="keyword">if</span> (duplicateCheck.Items.length &gt; <span class="number">0</span>) &#123; <span class="comment">// <span class="doctag">NOTE:</span> ë§Œì•½ì— ì¤‘ë³µëœ ìœ ì €ê°€ ì ‘ì†ì´ ë˜ëŠ” ê²½ìš°..?</span></span><br><span class="line">      <span class="keyword">const</span> del = [];</span><br><span class="line">      duplicateCheck.Items.forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> delParams = &#123;</span><br><span class="line">          TableName: TABLE_NAME,</span><br><span class="line">          Key: &#123;</span><br><span class="line">            connection_id: key.connection_id,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        del.push(ddb.delete(delParams).promise());</span><br><span class="line">        <span class="built_in">Promise</span>.all(del);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> ddb.put(putParams).promise();</span><br><span class="line">    result.statusCode = <span class="number">200</span>;</span><br><span class="line">    result.body = <span class="string">`ì—°ê²° ì„±ê³µ: <span class="subst">$&#123;connectionId&#125;</span>`</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;ì—°ê²° ì™„ë£Œ&#x27;</span>, <span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    result.statusCode = <span class="number">500</span>;</span><br><span class="line">    result.body = <span class="string">`ì—°ê²° ì‹¤íŒ¨: <span class="subst">$&#123;connectionId&#125;</span>`</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;ì—°ê²° ì‹¤íŒ¨&#x27;</span>, <span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, <span class="built_in">JSON</span>.stringify(e));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ì—°ê²°-í•´ì œ-í•¨ìˆ˜"><a href="#ì—°ê²°-í•´ì œ-í•¨ìˆ˜" class="headerlink" title="ì—°ê²° í•´ì œ í•¨ìˆ˜"></a>ì—°ê²° í•´ì œ í•¨ìˆ˜</h3><p>í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì—°ê²°ì„ í•´ì œ ì‹œ ìë™ í˜¸ì¶œ ë˜ì–´ dynamodbì—ì„œ ì‚­ì œë¥¼ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ddb = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient(&#123;<span class="attr">region</span>: <span class="string">&#x27;ap-northeast-2&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ì—°ê²° í•´ì œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>dynamodbì—ì„œ ì‚­ì œí•¨.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">exports</span>.handler = <span class="keyword">async</span> event =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> connectionId = event.requestContext.connectionId;</span><br><span class="line">  <span class="keyword">const</span> params = &#123;</span><br><span class="line">    TableName: <span class="string">&#x27;my_chat&#x27;</span>,</span><br><span class="line">    Key: &#123;</span><br><span class="line">      connection_id: connectionId,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> ddb.delete(params).promise();</span><br><span class="line">    result.statusCode = <span class="number">200</span>;</span><br><span class="line">    result.body = <span class="string">`ì—°ê²° í•´ì œ: <span class="subst">$&#123;connectionId&#125;</span>`</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;ì—°ê²° í•´ì œ&#x27;</span>, <span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    result.statusCode = <span class="number">500</span>;</span><br><span class="line">    result.body = <span class="string">`í•´ì œ ì‹¤íŒ¨: <span class="subst">$&#123;connectionId&#125;</span>`</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;í•´ì œ ì‹¤íŒ¨&#x27;</span>, <span class="built_in">JSON</span>.stringify(result));</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, <span class="built_in">JSON</span>.stringify(e));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="ë©”ì„¸ì§€-ì „ì†¡"><a href="#ë©”ì„¸ì§€-ì „ì†¡" class="headerlink" title="ë©”ì„¸ì§€ ì „ì†¡"></a>ë©”ì„¸ì§€ ì „ì†¡</h3><p>í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë©”ì„¸ì§€ë¥¼ ì „ì†¡ ì‹œ dynamodbì— ë‹´ì•„ë‘” ì—°ê²°ëœ ëª¨ë“  ìœ ì €ì—ê²Œ ì¼ê´„ ì „ì†¡ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ddb = <span class="keyword">new</span> AWS.DynamoDB.DocumentClient(&#123; <span class="attr">region</span>: <span class="string">&#x27;ap-northeast-2&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> TABLE_NAME = <span class="string">&#x27;my_chat&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ë©”ì„¸ì§€ ì „ì†¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">exports</span>.handler = <span class="keyword">async</span> event =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> result = &#123;&#125;;</span><br><span class="line">  <span class="keyword">let</span> connectionData;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    connectionData = <span class="keyword">await</span> ddb.scan(&#123; <span class="attr">TableName</span>: TABLE_NAME &#125;).promise(); <span class="comment">// <span class="doctag">NOTE:</span> ëª¨ë“  ì»¤ë„¥ì…˜ IDë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤.</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    result.statusCode = <span class="number">500</span>;</span><br><span class="line">    result.body = <span class="string">&#x27;ì—°ê²°ëœ ì•„ì´ë””ë¥¼ ê°€ì§€ê³  ì˜¬ ìˆ˜ê°€ ì—†ë‹¤&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> apigwManagementApi = <span class="keyword">new</span> AWS.ApiGatewayManagementApi(&#123;</span><br><span class="line">    apiVersion: <span class="string">&#x27;2018-11-29&#x27;</span>,</span><br><span class="line">    endpoint: event.requestContext.domainName + <span class="string">&#x27;/&#x27;</span> + event.requestContext.stage,</span><br><span class="line">    region: <span class="string">&#x27;ap-northeast-2&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> message = <span class="built_in">JSON</span>.parse(event.body).message;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> postCalls = connectionData.Items.map(<span class="keyword">async</span> (&#123; connection_id, user_id &#125;) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> post = &#123;</span><br><span class="line">        connection_id,</span><br><span class="line">        user_id,</span><br><span class="line">        message,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;post&#x27;</span>, <span class="built_in">JSON</span>.stringify(post));</span><br><span class="line">      <span class="keyword">await</span> apigwManagementApi.postToConnection(&#123; <span class="attr">ConnectionId</span>: connection_id, <span class="attr">Data</span>: <span class="built_in">JSON</span>.stringify(post) &#125;).promise(); <span class="comment">// <span class="doctag">NOTE:</span> ë©”ì„¸ì§€ ì „ì†¡</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="keyword">if</span> (e.statusCode === <span class="number">410</span>) &#123; <span class="comment">// <span class="doctag">NOTE:</span> ì—°ê²° ëŠê¸´ ì»¤ë„¥ì…˜ IDëŠ” ì‚­ì œ</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`deleting <span class="subst">$&#123;user_id&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">await</span> ddb.delete(&#123; <span class="attr">TableName</span>: TABLE_NAME, <span class="attr">Key</span>: &#123; connection_id &#125; &#125;).promise();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;e&#x27;</span>, e.stack);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="built_in">Promise</span>.all(postCalls);</span><br><span class="line">    result.statusCode = <span class="number">200</span>;</span><br><span class="line">    result.body = <span class="string">&#x27;ë©”ì„¸ì§€ ì „ì†¡ ì„±ê³µ&#x27;</span>;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    result.statusCode = <span class="number">500</span>;</span><br><span class="line">    result.body = <span class="string">&#x27;ë©”ì„¸ì§€ ì „ì†¡ ì‹¤íŒ¨&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="API-GATEWAY"><a href="#API-GATEWAY" class="headerlink" title="API GATEWAY"></a>API GATEWAY</h2><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1583645464/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-03-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.30.29_d4cc4t.png" alt="gateway"></p><p>ê²½ë¡œ í‘œí˜„ì‹ì€ ì‰½ê²Œ ìƒê°í•˜ë©´ ì›¹ì†Œì¼“ì˜ ì ‘ê·¼í•  url ì´ë¼ê³  ìƒê°í•˜ë©´ ë ë“¯. <a href="https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/apigateway-websocket-api-selection-expressions.html">ë§í¬</a> ì°¸ê³ .</p><h3 id="connect"><a href="#connect" class="headerlink" title="connect"></a>connect</h3><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1583645607/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-03-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.32.53_ypezj1.png" alt="ì—°ê²°"></p><h3 id="disconnect"><a href="#disconnect" class="headerlink" title="disconnect"></a>disconnect</h3><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1583645629/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-03-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.33.06_iy9vwv.png" alt="ì—°ê²°í•´ì œ"></p><h3 id="message"><a href="#message" class="headerlink" title="message"></a>message</h3><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1583645645/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-03-08_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.33.14_prdz6o.png" alt="message"></p><h2 id="ë°°í¬"><a href="#ë°°í¬" class="headerlink" title="ë°°í¬"></a>ë°°í¬</h2><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1561985875/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-01_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_9.47.23_rp5uh3.png" alt="ë°°í¬"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1561985909/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-01_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_9.47.35_tlxaut.png" alt="ë°°í¬-2"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1561985926/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-01_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_9.53.35_drtebl.png" alt="ë°°í¬-3"></p><h2 id="í´ë¼ì´ì–¸íŠ¸-í…ŒìŠ¤íŠ¸"><a href="#í´ë¼ì´ì–¸íŠ¸-í…ŒìŠ¤íŠ¸" class="headerlink" title="í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸"></a>í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>WebSocket test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> wSocket;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            wSocket = <span class="keyword">new</span> WebSocket(<span class="string">&quot;wss://evfxor8p6a.execute-api.ap-northeast-2.amazonaws.com/dev&quot;</span>);</span></span><br><span class="line"><span class="javascript">            wSocket.onopen = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123; onOpen(e) &#125;;</span></span><br><span class="line"><span class="javascript">            wSocket.onclose = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123; onClose(e) &#125;;</span></span><br><span class="line"><span class="javascript">            wSocket.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123; onMessage(e) &#125;;</span></span><br><span class="line"><span class="javascript">            wSocket.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123; onError(e) &#125;;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">onOpen</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;WebSocket opened!&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&#x27;connect: &#x27;</span>, e);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#btn_open&quot;</span>).attr(<span class="string">&quot;disabled&quot;</span>, <span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#btn_close&quot;</span>).removeAttr(<span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#btn_send&quot;</span>).removeAttr(<span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#message&quot;</span>).removeAttr(<span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">onClose</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;WebSocket closed!&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#btn_open&quot;</span>).removeAttr(<span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#btn_close&quot;</span>).attr(<span class="string">&quot;disabled&quot;</span>, <span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#btn_send&quot;</span>).attr(<span class="string">&quot;disabled&quot;</span>, <span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#message&quot;</span>).attr(<span class="string">&quot;disabled&quot;</span>, <span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">onMessage</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">&quot;ë©”ì‹œì§€ ìˆ˜ì‹  : &quot;</span> + e.data);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">onError</span>(<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            alert(<span class="string">&quot;ì˜¤ë¥˜ë°œìƒ : &quot;</span> + e.data);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">doOpen</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line">            init();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">doClose</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line">            wSocket.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">doSend</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> ms = &#123; <span class="string">&quot;action&quot;</span>: <span class="string">&quot;message&quot;</span>, <span class="string">&quot;message&quot;</span>: $(<span class="string">&#x27;#message&#x27;</span>).val() &#125;;</span></span><br><span class="line">            </span><br><span class="line"><span class="javascript">            ms = <span class="built_in">JSON</span>.stringify(ms);</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="keyword">typeof</span> ms);</span></span><br><span class="line">            wSocket.send(ms);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#btn_open&quot;</span>).removeAttr(<span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#btn_close&quot;</span>).attr(<span class="string">&quot;disabled&quot;</span>, <span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#btn_send&quot;</span>).attr(<span class="string">&quot;disabled&quot;</span>, <span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#message&quot;</span>).attr(<span class="string">&quot;disabled&quot;</span>, <span class="string">&quot;disabled&quot;</span>);</span></span><br><span class="line">            init();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;doOpen();&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Open&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn_open&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;doClose();&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Close&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn_close&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;message&quot;</span>&gt;</span>Message: <span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Message&quot;</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;doSend();&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Send&quot;</span> <span class="attr">id</span>=<span class="string">&quot;btn_send&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ms = &#123; <span class="string">&quot;action&quot;</span>: <span class="string">&quot;message&quot;</span>, <span class="string">&quot;message&quot;</span>: $(<span class="string">&#x27;#message&#x27;</span>).val() &#125;;</span><br></pre></td></tr></table></figure><p>í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ë‚¼ ë•Œ actionì´ api ê²Œì´íŠ¸ì›¨ì´ì—ì„œ ì •í•œ ê²½ë¡œì´ê³  </p><p>messageëŠ” ë³´ë‚¼ íŒŒë¼ë¯¸í„°.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1561987448/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-01_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_10.19.50_ct90nj.png" alt="ì‹¤í–‰ê²°ê³¼"></p><blockquote><p>ì°¸ê³ </p></blockquote><p><a href="https://github.com/aws-samples/simple-websockets-chat-app">aws-samples/simple-websockets-chat-app</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js Cluster ëª¨ë“œ ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2019/07/13/nodejs-use-cluster/"/>
      <url>/2019/07/13/nodejs-use-cluster/</url>
      
        <content type="html"><![CDATA[<p>Node.jsëŠ” ê¸°ë³¸ì ìœ¼ë¡œ CPUë¥¼ 1ê°œë§Œ ì“°ê¸° ë•Œë¬¸ì— ë©€í‹° ì½”ì–´ ì´ìƒì¸ PCì—ì„  </p><p>í´ëŸ¬ìŠ¤í„° ëª¨ë“œë¡œ ì•±ì„ ëŒë ¤ì•¼ ëª¨ë“  CPUë¥¼ ì‚¬ìš©ì„ í•œë‹¤ê³  í•œë‹¤.</p><h2 id="PM2"><a href="#PM2" class="headerlink" title="PM2"></a>PM2</h2><p>ë¡œì»¬ ë˜ëŠ” AWS EC2ì—ì„œ appì„ ëŒë¦´ ë•Œ ì£¼ë¡œ <a href="https://www.npmjs.com/package/pm2">PM2</a>ë¡œ ì•±ì„ êµ¬ë™ í•˜ëŠ”ë° ëª¨ë“ˆì—ì„œ í´ëŸ¬ìŠ¤í„° ëª¨ë“œë¥¼ í¸ë¦¬í•˜ê²Œ ì§€ì›ì„ í•œë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start index.js -i max <span class="comment"># cpu core ìˆ˜ ë§Œí¼ í”„ë¡œì„¸ìŠ¤ ìƒì„±í•˜ê³  ì‹¤í–‰.</span></span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1562861140/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-12_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_12.27.00_zww2l3.png" alt="ê²°ê³¼"></p><h2 id="ì½”ë“œ"><a href="#ì½”ë“œ" class="headerlink" title="ì½”ë“œ"></a>ì½”ë“œ</h2><p>ì˜ˆë¡œ AWS ElasticBeanstalk ê°™ì€ ê²½ìš° PM2ë¡œ êµ¬ë™ì„ í•˜ëŠ”ê²Œ ì•„ë‹ˆê¸° ë•Œë¬¸ì— </p><p>ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ëŒë ¤ì•¼ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> cluster = <span class="built_in">require</span>(<span class="string">&#x27;cluster&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> numCPUs = <span class="built_in">require</span>(<span class="string">&#x27;os&#x27;</span>).cpus().length;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!process.env.PORT) &#123;</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;process.env.PORT not set&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CLUSTER_ENV_VARS = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (cluster.isMaster) &#123; <span class="comment">// ë§ˆìŠ¤í„° í”„ë¡œì„¸ìŠ¤ì¸ ê²½ìš°.</span></span><br><span class="line">   fork();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">   <span class="built_in">require</span>(<span class="string">&#x27;./index.js&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fork</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; numCPUs; i++) &#123;</span><br><span class="line">       <span class="keyword">const</span> envClone = <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringfy(process.env)) <span class="comment">// í™˜ê²½ ì¹´í”¼ í•´ì„œ ëª¨ë“  í”„ë¡œì„¸ìŠ¤ í†µì¼.</span></span><br><span class="line">       envClone.PORT = <span class="built_in">parseInt</span>(process.env.PORT) + i; <span class="comment">// í¬íŠ¸ë„ ë‚˜ëˆ„ì</span></span><br><span class="line"></span><br><span class="line">       <span class="keyword">const</span> worker = cluster.fork(envClone);</span><br><span class="line">       CLUSTER_ENV_VARS[worker.id] = envClone;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   cluster.on(<span class="string">&#x27;exit&#x27;</span>, <span class="function">(<span class="params">worker, code, signal</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">&#x27;worker %s died, forking again&#x27;</span>, worker.process.pid);</span><br><span class="line">       <span class="keyword">const</span> new_worker = cluster.fork(CLUSTER_ENV_VARS[worker.id]);</span><br><span class="line">       CLUSTER_ENV_VARS[new_worker.id] = CLUSTER_ENV_VARS[worker.id];</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1562861923/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-12_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_12.07.10_srslma.png" alt="ë¹ˆìŠ¤í†¡"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Expressì—ì„œ node-cache ëª¨ë“ˆ ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2019/07/12/nodejs-express-cache/"/>
      <url>/2019/07/12/nodejs-express-cache/</url>
      
        <content type="html"><![CDATA[<p>DBì˜ ë°ì´í„° ì¤‘ ì½ê¸°ë¡œ ìì£¼ ì‚¬ìš©í•˜ì§€ë§Œ ë³€ê²½ì€ ìì£¼ ì¼ì–´ë‚˜ì§€ ì•Šê³  ì“°ê¸°ëŠ” ì ì€ ë°ì´í„°ëŠ”</p><p>ë©”ëª¨ë¦¬ì— ìºì‹œë¡œ ë‚¨ê²¨ì„œ ì‚¬ìš©í•˜ë©´ ì†ë„ ë©´ì—ì„œ ì¢‹ì•„ì§„ë‹¤.</p><p>ë‹¤ë§Œ ë©”ëª¨ë¦¬ ì„±ëŠ¥ì— ë§ê²Œ ì–‘ì„ ì¡°ì ˆí•´ì•¼ í•  ê²ƒì´ë‹¤.</p><p>í…ŒìŠ¤íŠ¸ëŠ” AWS ë‚´ì˜ elasticbeanstalk, dynamodbë¡œ ì§„í–‰.</p><p>express ìì²´ì— ê¸°ëŠ¥ì´ ì—…ê¸° ë•Œë¬¸ì— <a href="https://www.npmjs.com/package/node-cache">node-cache</a> ë¼ëŠ” ëª¨ë“ˆì„ ì‚¬ìš© í–‡ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> doc = <span class="built_in">require</span>(<span class="string">&#x27;dynamodb-doc&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">    region: <span class="string">&#x27;ap-northeast-2&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">    accessKeyId: process.env.AWS_ACCESS_KEY_ID, <span class="comment">// IAM</span></span><br><span class="line">    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY <span class="comment">// IAM</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> awsClient = <span class="keyword">new</span> AWS.DynamoDB();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dynamo = <span class="keyword">new</span> doc.DynamoDB(awsClient);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> nodeCache = <span class="built_in">require</span>(<span class="string">&#x27;node-cache&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> myCache = <span class="keyword">new</span> nodeCache( &#123; <span class="attr">stdTTL</span>: <span class="number">0</span>, <span class="attr">checkperiod</span>: <span class="number">600</span> &#125; ); <span class="comment">// init</span></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;d=(Â´â–½ï½€)=b&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/data&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    myCache.get(<span class="string">&#x27;character&#x27;</span>, <span class="function">(<span class="params">err, value</span>) =&gt;</span> &#123; <span class="comment">// ë©”ëª¨ë¦¬ ìºì‹œì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°.</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">throw</span> err;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (value) &#123; <span class="comment">// ì•„ì§ ìºì‹œì— ë‚¨ì•„ ìˆìœ¼ë©´ ìºì‹œ ë°ì´í„° ì „ì†¡.</span></span><br><span class="line">                res.json(<span class="built_in">JSON</span>.parse(value));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// ìºì‹œì— ì—…ìœ¼ë©´ DBì—ì„œ ë¶ˆëŸ¬ì„œ ìºì‹œì— ë‚¨ê¸°ê³  ì „ì†¡.</span></span><br><span class="line">                <span class="keyword">const</span> params = &#123;</span><br><span class="line">                    TableName: <span class="string">&#x27;character_list&#x27;</span></span><br><span class="line">                &#125;;</span><br><span class="line">                dynamo.scan(params, <span class="function">(<span class="params">err, datas</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> err;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        myCache.set(<span class="string">&#x27;character&#x27;</span>, <span class="built_in">JSON</span>.stringify(datas.Items), <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="comment">// ìºì‹œ ë“±ë¡.</span></span><br><span class="line">                            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                                <span class="keyword">throw</span> err;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                res.json(datas.Items); <span class="comment">// ì „ì†¡</span></span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/clear&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; <span class="comment">// ìºì‹œ í´ë¦¬ì–´.</span></span><br><span class="line">    myCache.keys(<span class="function">(<span class="params">err, mykeys</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">throw</span> err;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (mykeys.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                myCache.del(mykeys, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> err;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        res.send(<span class="string">&#x27;success&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.send(<span class="string">&#x27;no cache&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`server listening on port <span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>stdTTLëŠ” ìºì‹œ ì ìš© ì‹œê°„, ì´ˆ ë‹¨ìœ„ë¡œ ë˜ì–´ì‡ê³  0ì„ ë„£ìœ¼ë©´ ë¬´ì œí•œ</li><li>checkperiodëŠ” ì´ˆ ë‹¨ìœ„ê³  í•´ë‹¹ ì´ˆ ë§ˆë‹¤ ì²´í¬í•˜ì—¬ ìºì‹œë¥¼ ì‚­ì œí•œë‹¤ëŠ” ì˜ë¯¸. ê¸°ë³¸ê°’ì€ 600</li></ul><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563076831/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-14_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.29.46_igx2wo.png" alt="ì²« í˜¸ì¶œ"></p><p>ìµœì´ˆ í˜¸ì¶œ ì‹œì—ëŠ” ìºì‹œì— ì•ˆ ë‚¨ì•„ìˆê¸° ë–„ë¬¸ì— dynamodbì—ì„œ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ì˜¨ë‹¤.</p><p>ëŒ€ì¶© 2ìë¦¬ ms ë‹¨ìœ„ë¡œ ê°€ì§€ê³  ì˜¨ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563076932/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-14_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.30.07_vsuifq.png" alt="ë‹¤ìŒ í˜¸ì¶œ"></p><p>ì´ì œ ë‹¤ìŒ í˜¸ì¶œ ì‹œì—ëŠ” ìºì‹œì—ì„œ ë¶ˆëŸ¬ì˜¤ë¯€ë¡œ í•œ ìë¦¬ëŒ€ msë¡œ ì¤„ì–´ë“œëŠ” ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ì¸ìŠ¤íƒ€ê·¸ë¨ ë¡œê·¸ì¸ API ì—°ë™ í•´ë³´ê¸°</title>
      <link href="/2019/06/02/nodejs-instagram-signup/"/>
      <url>/2019/06/02/nodejs-instagram-signup/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.instagram.com/developer/">ì¸ìŠ¤íƒ€ê·¸ë¨ ë””ë²¨ë¡œí¼</a>ì— ì ‘ì†í•´ì„œ ì¸ìŠ¤íƒ€ê·¸ë¨ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ í•œë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1559463877/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.08.22_nseaw1.png" alt="dashboard"></p><p>ì¸ìŠ¤íƒ€ê·¸ë¨ë„ ë‹¤ë¥¸ ì†Œì…œì²˜ëŸ¼ ì•±ì„ í•˜ë‚˜ ìƒì„± í•´ì•¼ í•œë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1559464190/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.34.21_z6a5by.png" alt="create app"></p><p>Policy urlí•˜ê³  contract email ë¹¼ê³¤ ëª¨ë‘ í•„ìˆ˜ í•­ëª©ì´ë‹¤. ëŒ€ì¶© ì“°ì.</p><p>ì¤‘ìš”í•œ í•­ëª©ì€ Valid redirect URLS ì¸ë° ì´ê²Œ ì¸ìŠ¤íƒ€ê·¸ë¨ ì„œë²„ì—ì„œ ìœ ì € ì •ë³´ë¥¼ ë³´ë‚´ì£¼ëŠ”</p><p>ì½œë°± urlë‹¤. url ì…ë ¥í•  ë•Œ í˜ë¶ì²˜ëŸ¼ httpë¡œëŠ” ì•ˆ í•´ì¤€ë‹¤ ã…œã…œ <a href="https://www.npmjs.com/package/ngrok">ngrok</a>ìœ¼ë¡œ ë‚´ ë¡œì»¬ì— https urlì„ ë°›ì.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1559464042/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-06-02_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.12.51_ls7hhl.png" alt="ngrok"></p><p>ì´ì œ ë‚´ìš©ì„ ë‹¤ ì ì–´ì„œ ì™„ë£Œë¥¼ í•˜ê²Œ ë˜ë©´ ì•„ë˜ì™€ ê°™ì´ í•„ìš”í•œ ì •ë³´ë“¤ì„ ë³¼ ìˆ˜ ì‡ê²Œ ëœë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565879475/%E3%85%8B%E3%85%8B%E3%85%8B%E3%85%8B_rxyjub.png" alt="app detail"></p><p>ê·€ì°®ì€ ì„¤ì •ì€ ë‹¤ ëë‚«ë‹¤. ì´ì œ ì½”ë“œë¡œ êµ¬í˜„ì„ í•´ë³´ì.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  clientId: process.env.INSTAGRAM_CLIENT_ID,</span><br><span class="line">  secret: process.env.INSTAGRAM_CLIENT_SECRET,</span><br><span class="line">  url: process.env.INSTAGRAM_CALLBACK_URL,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> INSTAGRAM_AUTH_URL = <span class="string">`https://api.instagram.com/oauth/authorize/?client_id=<span class="subst">$&#123;config.clientId&#125;</span>&amp;redirect_uri=<span class="subst">$&#123;config.url&#125;</span>&amp;response_type=code`</span>;</span><br><span class="line">  res.redirect(INSTAGRAM_AUTH_URL);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>config ì•ˆì— ì‡ëŠ” ê°’ë“¤ì€ ì¸ìŠ¤íƒ€ê·¸ë¨ ë””ë²¨ë¡œí¼ì—ì„œ ë³´ê³  í™˜ê²½ë³€ìˆ˜ë¡œ ë“±ë¡ì„ í•´ë‘ë©´ ëœë‹¤.</p><p>ì„œë²„ì˜ /ë¡œ ì ‘ì†í•˜ê²Œ ë˜ë©´ ì¸ìŠ¤íƒ€ê·¸ë¨ì˜ ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•˜ê²Œ ë” í•´ë†§ë‹¤.</p><p>ì´ì œ ì¸ìŠ¤íƒ€ê·¸ë¨ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ì„ í•˜ë©´ ì‘ì„±í•œ ì½œë°± URLë¡œ ë°ì´í„°ê°€ ë„˜ì–´ì˜¤ê²Œ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/instagram/callback&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.query.error) &#123;</span><br><span class="line">    <span class="comment">// eslint-disable-next-line no-console</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;error: &#x27;</span>, req.query.error, <span class="string">&#x27;error_reason&#x27;</span>, req.query.error_reason);</span><br><span class="line">    <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/fail&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    url: <span class="string">&#x27;https://api.instagram.com/oauth/access_token&#x27;</span>,</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    form: &#123;</span><br><span class="line">      client_id: config.clientId, <span class="comment">// ì¸ìŠ¤íƒ€ì—ì„œ ë°›ì€ í´ë¼ì´ì–¸íŠ¸ ì•„ì´ë””</span></span><br><span class="line">      client_secret: config.secret, <span class="comment">// ì¸ìŠ¤íƒ€ì—ì„œ ë°›ì€ ì‹œí¬ë¦¿, ë…¸ì¶œë˜ë©´ ì•ˆë˜ëŠ” ê°’ì„</span></span><br><span class="line">      grant_type: <span class="string">&#x27;authorization_code&#x27;</span>, <span class="comment">// ì´ê±´ ê³ ì • ê°’</span></span><br><span class="line">      redirect_uri: config.url,</span><br><span class="line">      code: req.query.code,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> request(options, <span class="function">(<span class="params">error, response, body</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!error &amp;&amp; response.statusCode === <span class="number">200</span>) &#123;</span><br><span class="line">      <span class="comment">// eslint-disable-next-line no-console</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;body&#x27;</span>, <span class="built_in">JSON</span>.parse(body)); <span class="comment">// access_tokení•˜ê³  ìœ ì € í”„ë¡œí•„ì´ ë„˜ì–´ì˜´.</span></span><br><span class="line">      <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/success&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/fail&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/fail&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> res.send(<span class="string">&#x27;fail&#x27;</span>));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/success&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> res.send(<span class="string">&#x27;success&#x27;</span>));</span><br></pre></td></tr></table></figure><p>ì‚¬ìš©ìê°€ ì·¨ì†Œí•˜ê±°ë‚˜ ê¸°íƒ€ ì—ëŸ¬ê°€ ë‚˜ê²Œ ë˜ë©´ errorë€ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë„˜ì–´ì˜¤ê²Œ ëœë‹¤ê³  í•œë‹¤.</p><p>ì •ìƒì ì´ë©´ ì´ì œ ê·¸ ì•„ë˜ì²˜ëŸ¼ ì¸ìŠ¤íƒ€ê·¸ë¨ APIë¡œ í•„ìš”í•œ ê°’ë“¤ì„ ë„£ì–´ì„œ ë³´ë‚´ë©´ ìš”ì²­í•œ ìœ ì €ì˜ </p><p>í”„ë¡œí•„ì„ ë°›ì•„ ë³¼ìˆ˜ ì‡ê²Œ ëœë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565880032/%E3%85%8E%E3%84%B8_skmsqn.png" alt="ê²°ê³¼"></p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ëŠ” ì§¤</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565881824/ezgif.com-video-to-gif_cvh7qa.gif" alt="signup"></p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://www.instagram.com/developer/authentication/">instagram doc</a></li><li><a href="https://github.com/hidelryn/instagram-auth-api-example">ì†ŒìŠ¤ ì½”ë“œ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
            <tag> Auth </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS Athena ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2019/05/22/etc-aws-athena/"/>
      <url>/2019/05/22/etc-aws-athena/</url>
      
        <content type="html"><![CDATA[<h2 id="Athenaë€"><a href="#Athenaë€" class="headerlink" title="Athenaë€?"></a>Athenaë€?</h2><p>AWS S3ì— ë³´ê´€ëœ ë°ì´í„°ë¥¼ SQLì„ ì‚¬ìš©í•˜ì—¬ ë¶„ì„í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤</p><h2 id="ì‚¬ìš©í•˜ê²Œ-ëœ-ê³„ê¸°"><a href="#ì‚¬ìš©í•˜ê²Œ-ëœ-ê³„ê¸°" class="headerlink" title="ì‚¬ìš©í•˜ê²Œ ëœ ê³„ê¸°"></a>ì‚¬ìš©í•˜ê²Œ ëœ ê³„ê¸°</h2><p>ì²˜ìŒ í”„ë¡œì íŠ¸ì—ì„œ ë¶„ì„í•  ë°ì´í„°ë¥¼ DynamoDBì— ë³´ê´€ì„ í•˜ëŠ”ë° ì§‘ê³„ë¥¼ í•˜ê¸°ê°€ ë„ˆë¬´ ë¶ˆí¸í•´ì„œ</p><p>ìš°ìš¸í•˜ë˜ ì¤‘ì— AWS í˜ë¶ ê·¸ë£¹ì—ì„œ Vingleì´ë¼ëŠ” íšŒì‚¬ì—ì„œ ë‹¹ì‹œ ì„¸ì…˜ ì œëª©ì€ ì˜ ê¸°ì–µ ì•ˆ ë‚˜ëŠ”ë°</p><p>ë¡œê·¸ ì˜€ë‚˜.. ì‚¬ìš©ì íŒ¨í„´ì´ì˜€ë‚˜.. ì•„ë¬´íŠ¼ ë‚˜ì—ê²Œ í•„ìš”í•œ ì •ë³´ë¥¼ ë°°ìš¸ ìˆ˜ ìˆì„ ê±° ê°™ì•„ì„œ í‡´ê·¼í•˜ê³ </p><p>ì°¸ê°€ í–ˆì—ˆë‹¤ ì„¤ëª…ì„ ë“£ê³  ë‹¤ìŒ í”„ë¡œì íŠ¸ì—ëŠ” ê¼­ ì¨ë³´ê¸°ë¡œ ë§ˆìŒì„ ë¨¹ì—ˆì—ˆë‹¤ â˜ºï¸</p><h2 id="ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆë˜-ì¥ì "><a href="#ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆë˜-ì¥ì " class="headerlink" title="ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆë˜ ì¥ì "></a>ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆë˜ ì¥ì </h2><ul><li>ë³„ë„ë¡œ ì„¤ì¹˜ë‚˜ ë²„ì „ ê´€ë¦¬ ë“±ì„ í•  ì¼ì´ ì—†ì–´ì„œ í¸ë¦¬ í–ˆì—ˆë‹¤.</li><li>ì¿¼ë¦¬ ì‚¬ìš© íšŒìˆ˜ëŸ‰ì— ë”°ë¥¸ ìš”ê¸ˆ ë¶€ê³¼</li></ul><h2 id="ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆë˜-ë‹¨ì "><a href="#ì‚¬ìš©í•˜ë©´ì„œ-ëŠê¼ˆë˜-ë‹¨ì " class="headerlink" title="ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆë˜ ë‹¨ì "></a>ì‚¬ìš©í•˜ë©´ì„œ ëŠê¼ˆë˜ ë‹¨ì </h2><ul><li>ì•„ë˜ì— ê¸°ìˆ í•˜ê² ì§€ë§Œ íŒŒí‹°ì…˜ì„ ë¶ˆëŸ¬ì™€ì•¼ í•˜ëŠ”ë° ì¼ì¼ ê¸°ì¤€ìœ¼ë¡œ íŒŒí‹°ì…”ë‹ì„ í•˜ë©´ í•˜ë£¨ì— í•œë²ˆì”© ë¡œë“œë¥¼ í•´ì¤˜ì•¼ í•œë‹¤. ìë™ ì§€ì›ì´ ì•„ë‹ˆì˜€ìŒ (í˜¹ì‹œ ìë™ ì§€ì› í•˜ëŠ” ë°©ë²•ì„ ë‚´ê°€ ëª°ëì„ì§€ë„ ëª¨ë¥¸ë‹¤)</li><li>ë°ì´í„°ë¥¼ ë¶„ì„í•˜ëŠ” ì‚¬ëŒì´ SQLì„ ëª¨ë¥´ë©´ ìŒ..</li></ul><h2 id="Athena-ì‹¤ìŠµ-í•´ë³´ê¸°"><a href="#Athena-ì‹¤ìŠµ-í•´ë³´ê¸°" class="headerlink" title="Athena ì‹¤ìŠµ í•´ë³´ê¸°"></a>Athena ì‹¤ìŠµ í•´ë³´ê¸°</h2><h3 id="ì„ì‹œ-ë°ì´í„°"><a href="#ì„ì‹œ-ë°ì´í„°" class="headerlink" title="ì„ì‹œ ë°ì´í„°"></a>ì„ì‹œ ë°ì´í„°</h3><p>Athenaì˜ ë¹„ìš©ì„ ì ˆê°í•˜ê¸° ìœ„í•´ì„œëŠ” gzip ì••ì¶• í•˜ëŠ” ê²Œ ì¢‹ë‹¤ê³  í•œë‹¤.</p><p>ë°ì´í„°ê°€ ì ì€ jsonì€ ìƒê´€ì—†ì§€ë§Œ jsonì´ ê·œëª¨ê°€ í° ê²½ìš°ì—ëŠ” ê³ ë ¤í•´ì•¼ í•œë‹¤.</p><p>ì§€ê¸ˆì€ json ë°ì´í„°ë¥¼ ì••ì¶•í•´ì„œ S3ì— ì—…ë¡œë“œ í•´ ë³¸ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  userId: <span class="string">&quot;hidelryn&quot;</span>,</span><br><span class="line">  password: <span class="string">&quot;12345q&quot;</span>,</span><br><span class="line">  gameData: &#123;</span><br><span class="line">    gameId: <span class="string">&quot;a1&quot;</span>,</span><br><span class="line">    sessionKey: <span class="string">&quot;qrkqkej2l31qeqk&quot;</span>,</span><br><span class="line">    userLocale: &#123;</span><br><span class="line">      locale: <span class="string">&quot;ko_KR&quot;</span>,</span><br><span class="line">      createAt: <span class="string">&quot;2020-05-21 11:15:58&quot;</span>,</span><br><span class="line">      unix: <span class="number">1590027358</span></span><br><span class="line">    &#125;,</span><br><span class="line">    name: <span class="string">&quot;delryn&quot;</span>,</span><br><span class="line">    scores: [</span><br><span class="line">      <span class="number">100</span>,</span><br><span class="line">      <span class="number">30</span>,</span><br><span class="line">      <span class="number">60</span></span><br><span class="line">    ],</span><br><span class="line">    item: [</span><br><span class="line">      &#123;</span><br><span class="line">        itemId: <span class="string">&quot;0_id&quot;</span>,</span><br><span class="line">        itemAmount: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        itemId: <span class="string">&quot;1_id&quot;</span>,</span><br><span class="line">        itemAmount: <span class="number">1</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        itemId: <span class="string">&quot;2_id&quot;</span>,</span><br><span class="line">        itemAmount: <span class="number">2</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        itemId: <span class="string">&quot;3_id&quot;</span>,</span><br><span class="line">        itemAmount: <span class="number">3</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        itemId: <span class="string">&quot;4_id&quot;</span>,</span><br><span class="line">        itemAmount: <span class="number">4</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        itemId: <span class="string">&quot;5_id&quot;</span>,</span><br><span class="line">        itemAmount: <span class="number">5</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = obj;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">&#x27;zlib&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> json = <span class="built_in">require</span>(<span class="string">&#x27;./sample&#x27;</span>); <span class="comment">// ìœ„ì— ì‘ì„±í•œ Object</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> output = fs.createWriteStream(<span class="string">&#x27;log_1.json.gz&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> compress = zlib.createGzip();</span><br><span class="line">compress.pipe(output);</span><br><span class="line">compress.write(<span class="built_in">JSON</span>.stringify(json));</span><br><span class="line">compress.end();</span><br></pre></td></tr></table></figure><p><strong>NOTE</strong></p><ul><li>s3ì— json pretty íŒŒì¼ì„ ì—…ë¡œë“œë¥¼ í•˜ê²Œ ë˜ëŠ” ê²½ìš° ë‚˜ì¤‘ì— ì¿¼ë¦¬í•  ë•Œ json íŒŒì‹± ìª½ ì˜¤ë¥˜ê°€ ë‚œë‹¤.</li><li>s3 prefixë¥¼ í™•ì¸í•´ ë‘˜ ê²ƒ. (ì´í›„ íŒŒí‹°ì…”ë‹ ë•Œë¬¸ì—)</li></ul><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1590140610/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-22_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_6.43.18_oljukh.png" alt="s3"></p><h3 id="Workgroup-ìƒì„±"><a href="#Workgroup-ìƒì„±" class="headerlink" title="Workgroup ìƒì„±"></a>Workgroup ìƒì„±</h3><p>ì´ì œ athena ë©”ë‰´ë¡œ ê°€ì„œ Workgroupì„ ìƒì„± í•˜ê³  ë‚´ìš©ì€ ìƒí™©ì— ë§ê²Œ ì ì–´ì£¼ì.</p><p>Workgroupì„ ë§Œë“œëŠ” ì´ìœ ëŠ” ë¶„ë¥˜ë³„ë¡œ ì¿¼ë¦¬ì˜ ê²°ê³¼ë¥¼ ì €ì¥í•  s3ë¥¼ ì§€ì • í•´ì£¼ëŠ” ê²ƒ</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1590140287/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-22_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_6.37.41_pk5mjq.png" alt="athena-1"></p><p>ìƒì„± í•˜ë©´ defaultë¡œ primaryê°€ ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì´ë²ˆì— ìƒì„±í•œ ê±¸ë¡œ ë°”ê¿” ì¤€ë‹¤.</p><h3 id="ë°ì´í„°ë² ì´ìŠ¤-ìƒì„±"><a href="#ë°ì´í„°ë² ì´ìŠ¤-ìƒì„±" class="headerlink" title="ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±"></a>ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> log_db</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1590048696/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.11.13_c9r2n6.png" alt="athena-3"></p><h3 id="í…Œì´ë¸”-ìƒì„±"><a href="#í…Œì´ë¸”-ìƒì„±" class="headerlink" title="í…Œì´ë¸” ìƒì„±"></a>í…Œì´ë¸” ìƒì„±</h3><p>ë‚´ê°€ ë§Œë“  ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì„ íƒ í•˜ê³  í…Œì´ë¸”ì„ ìƒì„± í•œë‹¤.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> user_log (</span><br><span class="line">  userId <span class="keyword">string</span>,</span><br><span class="line">  <span class="keyword">password</span> <span class="keyword">string</span>,</span><br><span class="line">  gameData <span class="keyword">struct</span>&lt;</span><br><span class="line">    gameId:<span class="keyword">string</span>,</span><br><span class="line">    sessionKey:<span class="keyword">string</span>,</span><br><span class="line">    userLocale:<span class="keyword">struct</span>&lt;</span><br><span class="line">      locale:<span class="keyword">string</span>,</span><br><span class="line">      createAt:<span class="built_in">timestamp</span>,</span><br><span class="line">      unix:<span class="built_in">bigint</span></span><br><span class="line">    &gt;,</span><br><span class="line">    <span class="keyword">name</span>:<span class="keyword">string</span>,</span><br><span class="line">    scores:<span class="built_in">array</span>&lt;<span class="built_in">int</span>&gt;,</span><br><span class="line">    item:<span class="built_in">array</span>&lt;<span class="keyword">struct</span>&lt;</span><br><span class="line">      itemId:<span class="keyword">string</span>,</span><br><span class="line">      itemAmount:<span class="built_in">int</span></span><br><span class="line">    &gt;&gt;</span><br><span class="line">  &gt;</span><br><span class="line">) PARTITIONED <span class="keyword">BY</span> (<span class="keyword">year</span> <span class="built_in">int</span>, <span class="keyword">month</span> <span class="built_in">int</span>, <span class="keyword">day</span> <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE <span class="string">&#x27;org.apache.hive.hcatalog.data.JsonSerDe&#x27;</span></span><br><span class="line">LOCATION <span class="string">&#x27;s3://athena-delryn-test/logs/users/&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>í…Œì´ë¸”ì˜ í•„ë“œëŠ” jsonì˜ í‚¤, ë°ì´í„° íƒ€ì…ì€ <a href="https://docs.aws.amazon.com/ko_kr/athena/latest/ug/data-types.html">ë§í¬</a>ì—ì„œ í™•ì¸</li><li>PARTITIONEDì„ ê±°ëŠ” ì´ìœ ëŠ” s3ì—ì„œ ì¿¼ë¦¬ ì‹œ ëª¨ë“  íŒŒì¼ì„ ìŠ¤ìº” í•˜ê¸° ë–„ë¬¸ì— ë¹„ìš©ì´ ë§ì´ ë“¤ê³  ì¿¼ë¦¬ ì‘ë‹µ ì§€ì—° ì‹œê°„ì´ ëŠ˜ì–´ë‚˜ê¸° ë•Œë¬¸ì— ì§€ì •ì„ í•´ì¤˜ì•¼ ë¹„ìš©, ì„±ëŠ¥ ìƒìœ¼ë¡œ ëª¨ë‘ ì¢‹ë‹¤.</li><li>ROW FORMAT SERDEì€ ê·¸ëƒ¥ json ë°ì´í„°ë‹ˆ json ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€</li><li>LOCATIONì€ ë¶„ì„í•  ë°ì´í„°ê°€ ë³´ê´€ë˜ì–´ ìˆëŠ” s3 ê²½ë¡œ</li></ul><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1590141952/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-22_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.05.37_b6ukic.png" alt="athena-4"></p><h3 id="íŒŒí‹°ì…˜-ë¡œë“œ"><a href="#íŒŒí‹°ì…˜-ë¡œë“œ" class="headerlink" title="íŒŒí‹°ì…˜ ë¡œë“œ"></a>íŒŒí‹°ì…˜ ë¡œë“œ</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MSCK <span class="keyword">REPAIR</span> <span class="keyword">TABLE</span> user_log;</span><br></pre></td></tr></table></figure><p>ìœ„ì—ì„œ ì ì€ ë‹¨ì ì´ ì´ ë¶€ë¶„ì¸ë° ì¢€ ë” ìì„¸í•˜ê²Œ ì˜ˆë¡œ ë“¤ìë©´</p><p>í˜„ì¬ ì¼ì¼ë³„ë¡œ íŒŒí‹°ì…˜ì„ ê±¸ì–´ë†¨ê¸° ë•Œë¬¸ì— ì˜¤ëŠ˜(5ì›” 22ì¼) íŒŒí‹°ì…˜ ë¡œë“œ ì‹œ s3ì— 22ì¼ì— ì—…ë¡œë“œëœ </p><p>ë°ì´í„°ë“¤(ë¡œë“œ ì´í›„ì—ë„ ì—…ë¡œë“œ ë˜ëŠ” ë°ì´í„°ê¹Œì§€) ì¿¼ë¦¬ê°€ ê°€ëŠ¥ í•˜ë‹¤.</p><p>ê·¸ëŸ¬ë‚˜ ë‹¤ìŒ ë‚ (23ì¼)ì— s3ì— ë°ì´í„°ê°€ ì—…ë¡œë“œ ë˜ê³  íŒŒí‹°ì…˜ ë¡œë“œë¥¼ ì•ˆí•œ ìƒíƒœì—ì„œëŠ” </p><p>22ì¼ì ë°ì´í„°ë¡œë§Œ ì¿¼ë¦¬ê°€ ê°€ëŠ¥ í•´ì„œ íŒŒí‹°ì…˜ ë¡œë“œë¥¼ ë‹¹ì¼ ë‹¤ì‹œ í•´ì¤˜ì•¼ 23ì¼ì ë°ì´í„°ë„ ì¿¼ë¦¬ë¡œ </p><p>ì½ì„ ìˆ˜ ìˆë‹¤ ê·¸ëŸ¬ë¯€ë¡œ ì¼ì¼ë³„ë¡œ í•˜ë£¨ì— í•œë²ˆ íŒŒí‹°ì…˜ ë¡œë“œë¥¼ í•´ì¤˜ì•¼ í•œë‹¤.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> user_log <span class="keyword">ADD</span> <span class="keyword">PARTITION</span> (<span class="keyword">year</span> = ë…„, <span class="keyword">month</span> = ì›”, <span class="keyword">day</span> = ì¼) LOCATION <span class="string">&#x27;s3://athena-delryn-test/logs/users/&#x27;</span></span><br></pre></td></tr></table></figure><p>ë‚˜ëŠ” ì¼ì¼ 00ì‹œ ì§€ë‚˜ê°€ê³  ë‚˜ì„œ Lambda CloudWatchEventë¡œ cronì„ ëŒë ¸ì—ˆë‹¤.</p><h3 id="ì¿¼ë¦¬-ì‹¤í–‰"><a href="#ì¿¼ë¦¬-ì‹¤í–‰" class="headerlink" title="ì¿¼ë¦¬ ì‹¤í–‰"></a>ì¿¼ë¦¬ ì‹¤í–‰</h3><p>ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆê²Œ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰ í•´ ë³¸ë‹¤.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="string">&quot;log_db&quot;</span>.<span class="string">&quot;user_log&quot;</span> <span class="keyword">where</span> gamedata.userlocale.locale = <span class="string">&#x27;ko_KR&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1590142863/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-22_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.20.18_dherd6.png" alt="ì¿¼ë¦¬ ê²°ê³¼"></p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://bunjang.github.io/back-end/2019/03/11/bunjang-athena.html">ë²ˆê°œì¥í„° ê¸°ìˆ  ë¸”ë¡œê·¸</a></li><li><a href="https://blog.skeddly.com/2016/12/using-compressed-json-data-with-amazon-athena.html">Using Compressed JSON Data With Amazon Athena</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Amazon Linux2ì—ì„œ timezone ë³€ê²½ í•´ë³´ê¸°</title>
      <link href="/2019/05/12/etc-aws-ec2-timezone/"/>
      <url>/2019/05/12/etc-aws-ec2-timezone/</url>
      
        <content type="html"><![CDATA[<h2 id="ë¦¬ëˆ…ìŠ¤ì˜-default-timezone"><a href="#ë¦¬ëˆ…ìŠ¤ì˜-default-timezone" class="headerlink" title="ë¦¬ëˆ…ìŠ¤ì˜ default timezone"></a>ë¦¬ëˆ…ìŠ¤ì˜ default timezone</h2><p>ê¸°ë³¸ì ìœ¼ë¡œ utc 0ìœ¼ë¡œ ì„¤ì • ë˜ì–´ ìˆë‹¤.</p><p>ì•„ë˜ëŠ” ec2ì—ì„œ dateë¥¼ ì°ì„ ë–„ì™€ moment-timezoneë¥¼ ì´ìš©í•´ì„œ í•œêµ­ ì‹œê°„(utc +9)ìœ¼ë¡œ ì°ì€ ì°¨ì´</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1589277249/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-12_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_6.53.13_tfzqne.png" alt="date"></p><h2 id="ë³€ê²½-ë°©ë²•-ì‹¤ìŠµ"><a href="#ë³€ê²½-ë°©ë²•-ì‹¤ìŠµ" class="headerlink" title="ë³€ê²½ ë°©ë²• ì‹¤ìŠµ"></a>ë³€ê²½ ë°©ë²• ì‹¤ìŠµ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;sysconfig&#x2F;clock # íŒŒì¼ì„ ì—° í›„</span><br><span class="line">ZONE&#x3D;&quot;Asia&#x2F;Seoul&quot; # ì²˜ìŒì—ëŠ” ZONE&#x3D;&quot;UTC&quot;ë¡œ ë˜ì–´ ìˆëŠ”ë° ì´ ë¶€ë¶„ì„ ë³€ê²½ í•´ì¤€ë‹¤.</span><br></pre></td></tr></table></figure><p>ê·¸ë¦¬ê³  vimì—ì„œ ë‚˜ì˜¨ í›„ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì³ ì¤€ë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -sf /usr/share/zoneinfo/Asia/Seoul /etc/localtime <span class="comment"># ì¸ìŠ¤í„´ìŠ¤ê°€ í˜„ì§€ ì‹œê°„ ì •ë³´ë¥¼ ì°¸ì¡°í•  ë•Œ í‘œì¤€ ì‹œê°„ëŒ€ íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡ /etc/localtimeê³¼ í‘œì¤€ ì‹œê°„ëŒ€ íŒŒì¼ ì‚¬ì´ì— ì‹¬ë³¼ ë§í¬ë¥¼ ìƒì„±</span></span><br><span class="line">sudo reboot <span class="comment"># ì‹œìŠ¤í…œ ì¬ë¶€íŒ… sshì—ì„œ íŒ…ê²¨ì ¸ ë‚˜ì˜¨ë‹¤.</span></span><br></pre></td></tr></table></figure><p>ë‹¤ì‹œ ì•±ì—ì„œ í™•ì¸í•˜ëŠ” ê²½ìš° ì œëŒ€ë¡œ í•œêµ­ ì‹œê°„ìœ¼ë¡œ ì¶œë ¥ ëœë‹¤. </p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1589277838/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2020-05-12_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.03.43_lw5vlf.png" alt="date"></p><h2 id="ElasticBeanstalk"><a href="#ElasticBeanstalk" class="headerlink" title="ElasticBeanstalk"></a>ElasticBeanstalk</h2><p>í”„ë¡œì íŠ¸ ì ˆëŒ€ ê²½ë¡œì— .ebextensions í´ë”ë¥¼ ìƒì„±ì„ í•œë‹¤.</p><p>ê·¸ ì•ˆì— 00-set-timezone.config íŒŒì¼ ìƒì„±</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">commands:</span><br><span class="line">  set_time_zone:</span><br><span class="line">    command: ln -f -s &#x2F;usr&#x2F;share&#x2F;zoneinfo&#x2F;Asia&#x2F;Seoul &#x2F;etc&#x2F;localtime</span><br></pre></td></tr></table></figure><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/set-time.html#change_time_zone">Linux ì¸ìŠ¤í„´ìŠ¤ì˜ ì‹œê°„ ì„¤ì •</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> AWS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gin ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2019/03/01/go-study-gin/"/>
      <url>/2019/03/01/go-study-gin/</url>
      
        <content type="html"><![CDATA[<h2 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com/gin-gonic/gin</span><br></pre></td></tr></table></figure><h2 id="ì˜ˆì œ"><a href="#ì˜ˆì œ" class="headerlink" title="ì˜ˆì œ"></a>ì˜ˆì œ</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/gin-gonic/gin&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// router := gin.Default() // defaultë¡œ í•´ë„ ê¸°ë³¸ì ì¸ê±´ ë‹¤ ëœë‹¤</span></span><br><span class="line"></span><br><span class="line">router := gin.New() <span class="comment">// ì»¤ìŠ¤í…€ì„ í•˜ê³  ì‹¶ìœ¼ë©´ ì´ê±¸ë¡œ.</span></span><br><span class="line"></span><br><span class="line">router.Use(gin.LoggerWithFormatter(<span class="function"><span class="keyword">func</span><span class="params">(param gin.LogFormatterParams)</span> <span class="title">string</span></span> &#123; <span class="comment">// ì»¤ìŠ¤í…€ ë¡œê·¸ (ì•„íŒŒì¹˜ì—ì„œ ì¶œë ¥í•˜ëŠ” í˜•ì‹)</span></span><br><span class="line"><span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%s - [%s] \&quot;%s %s %s %d %s \&quot;%s\&quot; %s\&quot;\n&quot;</span>,</span><br><span class="line">param.ClientIP,</span><br><span class="line">param.TimeStamp.Format(time.RFC1123),</span><br><span class="line">param.Method,</span><br><span class="line">param.Path,</span><br><span class="line">param.Request.Proto,</span><br><span class="line">param.StatusCode,</span><br><span class="line">param.Latency,</span><br><span class="line">param.Request.UserAgent(),</span><br><span class="line">param.ErrorMessage,</span><br><span class="line">)</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">router.Use(gin.Recovery()) <span class="comment">// go panic -&gt; recover í•˜ëŠ” ë¯¸ë“¤ì›¨ì–´.</span></span><br><span class="line"></span><br><span class="line">router.LoadHTMLGlob(<span class="string">&quot;view/*&quot;</span>) <span class="comment">// view í´ë” ì„¤ì •</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// METHOD GET</span></span><br><span class="line">router.GET(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.HTML(http.StatusOK, <span class="string">&quot;index.html&quot;</span>, gin.H&#123; <span class="comment">// Goë¡œ HTMl ìì£¼ ë¿Œë¦¬ì§„ ì•Šê²Ÿì§€ë§Œ ì“°ë ¤ë©´ ì´ë ‡ê²Œ.. viewì—ì„œ ì½ì„ ë• html ì°¸ê³ , í…œí”Œë¦¿ ì—”ì§„ì€ í•¸ë“¤ë°”ë‘ ë¹„ìŠ· (.ë¹¼ê³ )</span></span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;Golang&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">http íŒ¨í‚¤ì§€ì— ìƒíƒœë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë³€ìˆ˜ ëª¨ìŒ ëª‡ê°€ì§€ë§Œ.</span></span><br><span class="line"><span class="comment">http.StatusOK = 200</span></span><br><span class="line"><span class="comment">http.StatusBadRequest = 400</span></span><br><span class="line"><span class="comment">http.StatusForbidden = 403</span></span><br><span class="line"><span class="comment">http.StatusNotFound = 404</span></span><br><span class="line"><span class="comment">http.StatusInternalServerError = 500</span></span><br><span class="line"><span class="comment">http.StatusBadGateway = 502</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ë¦¬ë””ë ‰ì…˜.</span></span><br><span class="line">router.GET(<span class="string">&quot;/re&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">c.Redirect(http.StatusMovedPermanently, <span class="string">&quot;http://localhost:3000/&quot;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ë¼ìš°íŒ…ì„ ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì„ ìˆ˜ ìˆë‹¤. ë²„ì „ë³„ API ë§Œë“¤ ë•Œ ì¢‹ì€ë“¯.</span></span><br><span class="line">v1 := router.Group(<span class="string">&quot;/v1&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">v1.GET(<span class="string">&quot;/path/:param&quot;</span>, readPathParam)</span><br><span class="line">v1.GET(<span class="string">&quot;/query&quot;</span>, getQueryString)</span><br><span class="line">v1.POST(<span class="string">&quot;/login&quot;</span>, loginV1)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// version v2</span></span><br><span class="line">v2 := router.Group(<span class="string">&quot;/v2&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">v2.POST(<span class="string">&quot;/login&quot;</span>, loginV2)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// router.Run(&quot;:3000&quot;) // ê¸°ë³¸ ì‹¤í–‰? ì•ˆì˜ ì¸ìëŠ” í¬íŠ¸ë²ˆí˜¸.</span></span><br><span class="line"></span><br><span class="line">server := &amp;http.Server&#123; <span class="comment">// http ì„¤ì •ì„ ì»¤ìŠ¤í…€í•˜ê³  ì‹¶ìœ¼ë©´ ìš”ë ‡ê²Œ.</span></span><br><span class="line">Addr:           <span class="string">&quot;:3000&quot;</span>, <span class="comment">// port</span></span><br><span class="line">Handler:        router,</span><br><span class="line">ReadTimeout:    <span class="number">10</span> * time.Second,</span><br><span class="line">WriteTimeout:   <span class="number">10</span> * time.Second,</span><br><span class="line">MaxHeaderBytes: <span class="number">1</span> &lt;&lt; <span class="number">20</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server.ListenAndServe() <span class="comment">// http config ì„¤ì • í›„ ê¸°ë™.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">METHOD GET, URL pathë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì“°ëŠ” ê²½ìš°.</span></span><br><span class="line"><span class="comment">íŠ¹ì´í•˜ê²Œ path paramì´ ë¹„ì–´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ 403ìœ¼ë¡œ ì‘ë‹µí•œë‹¤. ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ì•ˆí•´ë„ ë¨.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readPathParam</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">param := c.Param(<span class="string">&quot;param&quot;</span>)</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line"><span class="string">&quot;code&quot;</span>:    <span class="number">200</span>,</span><br><span class="line"><span class="string">&quot;message&quot;</span>: param,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ì¿¼ë¦¬ìŠ¤íŠ¸ë§</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getQueryString</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">id := c.Query(<span class="string">&quot;id&quot;</span>)                           <span class="comment">// ì›í•˜ëŠ” ì¿¼ë¦¬ìŠ¤íŠ¸ë§ ê°’ ì½ê¸°</span></span><br><span class="line">isGuest := c.DefaultQuery(<span class="string">&quot;isGuest&quot;</span>, <span class="string">&quot;false&quot;</span>) <span class="comment">// ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì´ ë¹„ì—‡ì„ ì‹œ ê¸°ë³¸ ê°’ ëŒ€ì²´í•˜ëŠ” ë²• ë”°ë¡œ ì¡°ê±´ì²˜ë¦¬ ì•ˆí•´ë„ ë˜ëŠ”êµ°..</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(id) == <span class="number">0</span> &#123; <span class="comment">// ë¬¸ìì—´ë¡œ ë“¤ì–´ì˜¤ê¸° ë•œì— nilê³¼ ë¹„êµê°€ ì•ˆëœë‹¤.. ê¸¸ì´ë¡œ ë¹„êµí•´ì•¼ í•¨..</span></span><br><span class="line">c.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class="line"><span class="string">&quot;code&quot;</span>:    <span class="number">403</span>,</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;parameter check&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> <span class="comment">// returnì„ ëª…ì‹œí•œ ì´ìœ ëŠ” ì—¬ê¸°ì„œ ë©ˆì¶”ê¸° ìœ„í•´.. ì•ˆ ê·¸ëŸ¬ë©´ ì•„ë˜ ì‘ë‹µì„ ì´ì–´ì„œ ë³´ë‚´ë²„ë¦°ë‹¤.. ë‚˜ë¨¸ì§€ returnë„ ë§ˆì°¬ê°€ì§€.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"><span class="string">&quot;id&quot;</span>:      id,</span><br><span class="line"><span class="string">&quot;isGuest&quot;</span>: isGuest,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line"><span class="string">&quot;code&quot;</span>:    <span class="number">200</span>,</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line"><span class="string">&quot;data&quot;</span>:    data,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// User - êµ¬ì¡°ì²´</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">ID    <span class="keyword">string</span> <span class="string">`json:&quot;id&quot; binding:&quot;required&quot;`</span></span><br><span class="line">Name  <span class="keyword">string</span> <span class="string">`json:&quot;name&quot; binding:&quot;required&quot;`</span></span><br><span class="line">Phone <span class="keyword">string</span> <span class="string">`json:&quot;phone&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// User2 - êµ¬ì¡°ì²´</span></span><br><span class="line"><span class="keyword">type</span> User2 <span class="keyword">struct</span> &#123;</span><br><span class="line">ID    <span class="keyword">string</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">Name  <span class="keyword">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">Phone <span class="keyword">string</span> <span class="string">`json:&quot;phone&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// METHOD POST ì¸ ê²½ìš°.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loginV1</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> params User <span class="comment">// ìœ„ì— ì„ ì–¸í•œ Test êµ¬ì¡°ì²´ì„.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err := c.ShouldBindJSON(&amp;params); err != <span class="literal">nil</span> &#123; <span class="comment">// ë°”ì¸ë”©í•  ë–„ requiredì— ë¹ˆ ê°’ì´ ë“œëŸ¬ì˜¨ ê²½ìš°.</span></span><br><span class="line">c.JSON(http.StatusBadRequest, gin.H&#123;</span><br><span class="line"><span class="string">&quot;code&quot;</span>:    <span class="number">403</span>,</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;parameter check&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">log.Print(err.Error())</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;params&quot;</span>, params)</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line"><span class="string">&quot;code&quot;</span>:    <span class="number">200</span>,</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line"><span class="string">&quot;version&quot;</span>: <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loginV2</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> params User2 <span class="comment">// ìœ„ì— ì„ ì–¸í•œ Test êµ¬ì¡°ì²´ì„.</span></span><br><span class="line"></span><br><span class="line">c.BindJSON(&amp;params) <span class="comment">// ë°”ì¸ë”©ì„ ì•ˆí•  ì‹œ body json ë°›ëŠ” ë²•.</span></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;params&quot;</span>, params)</span><br><span class="line"></span><br><span class="line">c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line"><span class="string">&quot;code&quot;</span>:    <span class="number">200</span>,</span><br><span class="line"><span class="string">&quot;message&quot;</span>: <span class="string">&quot;success&quot;</span>,</span><br><span class="line"><span class="string">&quot;version&quot;</span>: <span class="string">&quot;v2&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
            <tag> Gin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Axiosì—ì„œ Bigintê°€ í¬í•¨ëœ JSON íŒŒì‹±í•˜ê¸°</title>
      <link href="/2019/02/24/nodejs-parse-bigint-json/"/>
      <url>/2019/02/24/nodejs-parse-bigint-json/</url>
      
        <content type="html"><![CDATA[<p>ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ìˆ«ìí˜•ì˜ ë²”ìœ„ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;ìµœì†Œë²”ìœ„&#x27;</span>, <span class="built_in">Math</span>.pow(<span class="number">-2</span>, <span class="number">53</span>) - <span class="number">1</span>); <span class="comment">// -9007199254740992</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;ìµœëŒ€ë²”ìœ„&#x27;</span>, <span class="built_in">Math</span>.pow(<span class="number">2</span>, <span class="number">53</span>) - <span class="number">1</span>); <span class="comment">// 9007199254740991</span></span><br></pre></td></tr></table></figure><p>íƒ€ì‚¬ APIë¥¼ ì‚¬ìš©í•˜ë˜ ì¤‘ UUIDê°€ ìë£Œí˜•ì˜ ë²”ìœ„ë¥¼ ë„˜ê¸°ëŠ” ìˆ«ìê°€ ë“¤ì–´ì˜¨ ì ì´ ì‡ì—‡ë‹¤.</p><p>ê²€ìƒ‰ì„ í•´ë³´ë‹ˆ <a href="https://www.npmjs.com/package/json-bigint">json-bigint</a>ë¼ëŠ” ëª¨ë“ˆì„ í†µí•´ í•´ê²°ì„ í•˜ì˜€ë‹¤.</p><p>ì¬í˜„ì„ í•´ë³´ê¸° ìœ„í•´ íŒŒì´ì¬ì˜ í”Œë¼ìŠ¤í¬ë¡œ ê°€ë³ê²Œ í° ìˆ«ìë¥¼ ì‘ë‹µí•´ì£¼ëŠ” ì„œë²„ë¥¼ ë„ì›Œë³´ì.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&quot;code&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;SUCEESS&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="number">328381293434898918</span></span><br><span class="line">    &#125;</span><br><span class="line">    jsonString = json.dumps(data)</span><br><span class="line">    <span class="keyword">return</span> jsonString</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">3000</span>)</span><br></pre></td></tr></table></figure><p>í†µìƒì ìœ¼ë¡œ ë³´ë‚¼ ê²½ìš°ì—ëŠ” ì•„ë˜ì™€ ê°™ì´ ê²°ê³¼ë¥¼ ë°›ì„ ê²ƒì´ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>);</span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">    method: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;http://localhost:3000&#x27;</span></span><br><span class="line">&#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = response.data;</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">      &quot;code&quot;: 200,</span></span><br><span class="line"><span class="comment">      &quot;message&quot;: &quot;SUCEESS&quot;,</span></span><br><span class="line"><span class="comment">      &quot;value&quot;: 328381293434898940</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>json-bigintë¥¼ ì‚¬ìš©í•´ì„œ ë°›ì•„ë³´ì.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> JSONbig = <span class="built_in">require</span>(<span class="string">&#x27;json-bigint&#x27;</span>);</span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">    method: <span class="string">&#x27;get&#x27;</span>,</span><br><span class="line">    url: <span class="string">&#x27;http://localhost:3000&#x27;</span>,</span><br><span class="line">    transformResponse: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JSONbig.parse(data);</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> data = response.data;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;jp2&#x27;</span>, data.value.toString()); <span class="comment">// jp2 328381293434898918</span></span><br><span class="line">    </span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://stackoverflow.com/questions/18755125/node-js-is-there-any-proper-way-to-parse-json-with-large-numbers-long-bigint">node.js is there any proper way to parse JSON with large numbers? (long, bigint, int64)</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goì—ì„œ JSON, HTTP client ì‚¬ìš©ë²• ì •ë¦¬</title>
      <link href="/2019/02/21/go-use-json-http/"/>
      <url>/2019/02/21/go-use-json-http/</url>
      
        <content type="html"><![CDATA[<p>Goì—ì„œ JSONì„ ì‚¬ìš©í•˜ë ¤ë©´ ë¨¼ì € í‘œì¤€ íŒ¨í‚¤ì§€ì¸ ncoding/json íŒ¨í‚¤ì§€ë¥¼ import í•´ì•¼ í•œë‹¤.</p><h2 id="JSON"><a href="#JSON" class="headerlink" title="JSON"></a>JSON</h2><h3 id="êµ¬ì¡°ì²´-gt-JSON"><a href="#êµ¬ì¡°ì²´-gt-JSON" class="headerlink" title="êµ¬ì¡°ì²´ -&gt; JSON"></a>êµ¬ì¡°ì²´ -&gt; JSON</h3><p>Goì—ì„œ êµ¬ì¡°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜í•˜ëŠ” ë²•ë¶€í„° ì ëŠ”ë‹¤.</p><p>ì¢€ ë‹¹í™©ìŠ¤ëŸ¬ì›Ÿë˜ ê±´ êµ¬ì¡°ì²´ì˜ ë³€ìˆ˜ê°€ ì²« ê¸€ìê°€ ëŒ€ë¬¸ìì—¬ì•¼ ëœë‹¤.</p><p>ê·¸ë¦¬ê³  JSON ë¬¸ìì—´ ë§Œë“¤ ë•Œ ë¦¬í„´ ê°’ì´ 2ê°œë‹¤</p><p>ì²« ë²ˆì§¸ ë¦¬í„´ì€ JSON ë¬¸ìì—´ ë°ì´í„°, 2ë²ˆì¨° ë¦¬í„´ì€ ë¬¸ìì—´ ë§Œë“œëŠ”ê²Œ ì‹¤íŒ¨ í–ˆì„ ê²½ìš°ì˜ ì—ëŸ¬</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// User - ìœ ì € êµ¬ì¡°ì²´</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID   <span class="keyword">string</span></span><br><span class="line">    Name <span class="keyword">string</span></span><br><span class="line">    Age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">u := User&#123;&#125;</span><br><span class="line"></span><br><span class="line">u.ID = <span class="string">&quot;onepiece&quot;</span></span><br><span class="line">u.Name = <span class="string">&quot;luffy&quot;</span></span><br><span class="line">u.Age = <span class="number">18</span></span><br><span class="line"></span><br><span class="line">uToJSON, err := json.Marshal(u)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="built_in">panic</span>(err)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;uToJSON:&quot;</span>, <span class="keyword">string</span>(uToJSON)) <span class="comment">// uToJSON &#123;&quot;ID&quot;:&quot;onepiece&quot;,&quot;Name&quot;:&quot;luffy&quot;,&quot;Age&quot;:18&#125;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìœ„ì—ì„œ ì–¸ê¸‰í•œë“¯ì´ ëŒ€ë¬¸ìë¥¼ ì¨ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë‚´ JSON ë¬¸ìì—´ë„ ëŒ€ë¬¸ìë¡œ ë“¤ì–´ê°„ë‹¤</p><p>ì†Œë¬¸ìë¡œ í•˜ê¸° ìœ„í•´ì„  ë‹¤ìŒê³¼ ê°™ì´ í•´ì•¼ í•¨.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// User2 - ìœ ì €2 êµ¬ì¡°ì²´</span></span><br><span class="line"><span class="keyword">type</span> User2 <span class="keyword">struct</span> &#123;</span><br><span class="line">ID   <span class="keyword">string</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">Name <span class="keyword">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">Age  <span class="keyword">int</span>    <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">u2 := <span class="built_in">new</span>(User2)</span><br><span class="line"></span><br><span class="line">u2.ID = <span class="string">&quot;neverland&quot;</span></span><br><span class="line">u2.Name = <span class="string">&quot;emma&quot;</span></span><br><span class="line">u2.Age = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">u2ToJSON, _ := json.Marshal(u2)</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;u2ToJSON:&quot;</span>, <span class="keyword">string</span>(u2ToJSON)) <span class="comment">// u2ToJSON &#123;&quot;id&quot;:&quot;neverland&quot;,&quot;name&quot;:&quot;emma&quot;,&quot;age&quot;:10&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì €ëŸ°ì‹ìœ¼ë¡œ ì •ì˜ë¥¼ í•´ì¤˜ì•¼ í•¨. ì¢€ ê·€ì°®ê²Œ ë˜ì–´ ì‡ë‹¤;;</p><p>ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ì— string()ìœ¼ë¡œ ê°ì‹¸ì¤˜ì•¼ ë¬¸ìì—´ë¡œ ëœë‹¤. ì•ˆ ê·¸ëŸ¬ë©´ ë°”ì´ë„ˆë¦¬ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ë˜ì–´ ìˆìŒ.</p><p>ì•„ë˜ì²˜ëŸ¼ keyì•ˆì— ë˜ ë‹¤ë¥¸ key/valueê°€ ì‡ëŠ” JSON ê°™ì€ ê²½ìš°ì—ëŠ” êµ¬ì¡°ì²´ ì•ˆì˜ êµ¬ì¡°ì²´ë¡œ.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;aa&quot;</span>: <span class="string">&quot;xx&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;bb&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;z&quot;</span>: <span class="string">&quot;z&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Anime - ì• ë‹ˆë§¤ êµ¬ì¡°ì²´</span></span><br><span class="line"><span class="keyword">type</span> Anime <span class="keyword">struct</span> &#123;</span><br><span class="line">    Title   <span class="keyword">string</span> <span class="string">`json:&quot;title&quot;`</span></span><br><span class="line">    Year    <span class="keyword">int</span>    <span class="string">`json:&quot;year&quot;`</span></span><br><span class="line">    Heroine Heroine <span class="comment">// ìš”ëŸ°ì‹ìœ¼ë¡œ ë°‘ì˜ êµ¬ì¡°ì²´ë¥¼ ì¶”ê°€</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Heroine - ì—¬íˆë¡œì¸ *-_-* êµ¬ì¡°ì²´</span></span><br><span class="line"><span class="keyword">type</span> Heroine <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">    Age  <span class="keyword">int</span>    <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    ani := <span class="built_in">new</span>(Anime)</span><br><span class="line"></span><br><span class="line">    ani.Title = <span class="string">&quot;ë°©íŒ¨ìš©ì‚¬ ì„±ê³µë‹´&quot;</span></span><br><span class="line">    ani.Year = <span class="number">2019</span></span><br><span class="line">    ani.Heroine.Name = <span class="string">&quot;í•„ë¡œ&quot;</span></span><br><span class="line">    ani.Heroine.Age = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    aniToJSON, _ := json.Marshal(ani)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;aniToJSON:&quot;</span>, <span class="keyword">string</span>(aniToJSON)) <span class="comment">// aniToJSON &#123;&quot;title&quot;:&quot;ë°©íŒ¨ìš©ì‚¬ ì„±ê³µë‹´&quot;,&quot;year&quot;:2019,&quot;Heroine&quot;:&#123;&quot;name&quot;:&quot;í•„ë¡œ&quot;,&quot;age&quot;:1&#125;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ë§µ-gt-JSON"><a href="#ë§µ-gt-JSON" class="headerlink" title="ë§µ -&gt; JSON"></a>ë§µ -&gt; JSON</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> myMap <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    myMap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">    myMap[<span class="string">&quot;a&quot;</span>] = <span class="string">&quot;apple&quot;</span></span><br><span class="line">    myMap[<span class="string">&quot;b&quot;</span>] = <span class="string">&quot;banana&quot;</span></span><br><span class="line"></span><br><span class="line">    myMapToJSON, _ := json.Marshal(myMap)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;myMapToJSON:&quot;</span>, <span class="keyword">string</span>(myMapToJSON)) <span class="comment">// myMapToJSON: &#123;&quot;a&quot;:&quot;apple&quot;,&quot;b&quot;:&quot;banana&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ì¸í„°í˜ì´ìŠ¤-gt-JSON"><a href="#ì¸í„°í˜ì´ìŠ¤-gt-JSON" class="headerlink" title="ì¸í„°í˜ì´ìŠ¤ -&gt; JSON"></a>ì¸í„°í˜ì´ìŠ¤ -&gt; JSON</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">        <span class="string">&quot;a&quot;</span>: <span class="string">&quot;hi&quot;</span>,</span><br><span class="line">        <span class="string">&quot;b&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">&quot;c&quot;</span>: <span class="number">33</span>,</span><br><span class="line">        <span class="string">&quot;d&quot;</span>: []<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">            <span class="string">&quot;array1&quot;</span>,</span><br><span class="line">            <span class="string">&quot;array2&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;e&quot;</span>: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">            <span class="string">&quot;x&quot;</span>: <span class="string">&quot;x&quot;</span>,</span><br><span class="line">            <span class="string">&quot;y&quot;</span>: <span class="string">&quot;y&quot;</span>,</span><br><span class="line">            <span class="string">&quot;z&quot;</span>: <span class="string">&quot;z&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mToJSON, _ := json.Marshal(m)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;mToJSON:&quot;</span>, <span class="keyword">string</span>(mToJSON)) <span class="comment">// mToJSON &#123;&quot;a&quot;:&quot;hi&quot;,&quot;b&quot;:true,&quot;c&quot;:33,&quot;d&quot;:[&quot;array1&quot;,&quot;array2&quot;],&quot;e&quot;:&#123;&quot;x&quot;:&quot;x&quot;,&quot;y&quot;:&quot;y&quot;,&quot;z&quot;:&quot;z&quot;&#125;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JSON-íŒŒì‹±"><a href="#JSON-íŒŒì‹±" class="headerlink" title="JSON íŒŒì‹±"></a>JSON íŒŒì‹±</h3><p>ì½ì„ ìƒ˜í”Œ ë°ì´í„°</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;int&quot;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">&quot;str&quot;</span>: <span class="string">&quot;aaa&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;bool&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;arr&quot;</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">    <span class="attr">&quot;obj&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;x&quot;</span>: <span class="string">&quot;x&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;y&quot;</span>: <span class="string">&quot;y&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;all&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;obj2&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;obj3&quot;</span>: &#123;</span><br><span class="line">                <span class="attr">&quot;a&quot;</span>: <span class="string">&quot;a&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;b&quot;</span>: <span class="string">&quot;b&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;bool&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;arr2&quot;</span>: [<span class="string">&quot;q&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="string">&quot;e&quot;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>io/ioutilë¼ëŠ” í‘œì¤€ íŒ¨í‚¤ì§€ë¥¼ í†µí•´ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì‡ìŒ.</p><h3 id="JSON-gt-ì¸í„°í˜ì´ìŠ¤"><a href="#JSON-gt-ì¸í„°í˜ì´ìŠ¤" class="headerlink" title="JSON -&gt; ì¸í„°í˜ì´ìŠ¤"></a>JSON -&gt; ì¸í„°í˜ì´ìŠ¤</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    myJSON, err := ioutil.ReadFile(<span class="string">&quot;./sample.json&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;myJSON:&quot;</span>, <span class="keyword">string</span>(myJSON)) <span class="comment">// ìœ„ì˜ ìƒ˜í”Œ json ë¬¸ìì—´ì¸ ìƒíƒœ.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ë¨¼ì € ë‹´ì„ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“œëŸ¬ì¤€ë‹¤.</span></span><br><span class="line">    <span class="keyword">var</span> myJSONparse <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// ì—ëŸ¬ ë‹´ì„ ë³€ìˆ˜(JSON parse ì‹¤íŒ¨ ì‹œ ë¦¬í„´.) := json.Unmarshal(JSON ë¬¸ìì—´, ë‹´ì„ ì¸í„°í˜ì´ìŠ¤ë‚˜ êµ¬ì¡°ì²´ì˜ í¬ì¸í„°)</span></span><br><span class="line">    e := json.Unmarshal(myJSON, &amp;myJSONparse) <span class="comment">// ì´ê²Œ íŒŒì‹±í•˜ëŠ” êµ¬ë¬¸. </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> e != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(e)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(myJSONparse) <span class="comment">// map[int:3 str:aaa bool:true arr:[1 2 3] obj:map[x:x y:y] all:map[obj2:map[obj3:map[a:a b:b] bool:false arr2:[q w e]]]]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    myInt := myJSONparse[<span class="string">&quot;int&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;myInt:&quot;</span>, myInt) <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    myStr := myJSONparse[<span class="string">&quot;str&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;myStr:&quot;</span>, myStr) <span class="comment">// aaa</span></span><br><span class="line"></span><br><span class="line">    myBool := myJSONparse[<span class="string">&quot;bool&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;myBool:&quot;</span>, myBool) <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">    all := myJSONparse[<span class="string">&quot;all&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">`myJSONparse[&quot;all&quot;]:`</span>, all) <span class="comment">// myJSONparse[&quot;all&quot;] map[obj2:map[obj3:map[a:a b:b] bool:false arr2:[q w e]]]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ì¸í„°í˜ì´ìŠ¤ ì•ˆì˜ ë§µë“¤ì€ ì•ì— map ì¸í„°í˜ì´ìŠ¤ë¥¼ ë¶™ì—¬ì¤˜ì•¼ ëœë‹¤, ì•ˆ í•˜ë©´ ì—ëŸ¬ê°€ ë‚œë‹¤..</span></span><br><span class="line">    obj2 := all.(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)[<span class="string">&quot;obj2&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;obj2&quot;</span>, obj2) <span class="comment">// map[obj3:map[a:a b:b] bool:false arr2:[q w e]]</span></span><br><span class="line"></span><br><span class="line">    obj3 := obj2.(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)[<span class="string">&quot;obj3&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;obj3:&quot;</span>, obj3) <span class="comment">// obj3: map[a:a b:b]</span></span><br><span class="line"></span><br><span class="line">    obj3A := obj3.(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)[<span class="string">&quot;a&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;obj3.a:&quot;</span>, obj3A) <span class="comment">// obj3.a: a</span></span><br><span class="line"></span><br><span class="line">    obj3B := obj3.(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)[<span class="string">&quot;b&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;obj3.b:&quot;</span>, obj3B) <span class="comment">// obj3.b: b</span></span><br><span class="line"></span><br><span class="line">    obj3C := obj3.(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)[<span class="string">&quot;c&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;obj3.c:&quot;</span>, obj3C) <span class="comment">// obj3.c: &lt;nil&gt; ì—…ëŠ” ê°’ì´ë‹ˆê¹</span></span><br><span class="line"></span><br><span class="line">    obj2Bool := obj2.(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)[<span class="string">&quot;bool&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;obj2.bool:&quot;</span>, obj2Bool) <span class="comment">// obj2.bool: false</span></span><br><span class="line"></span><br><span class="line">    obj2Arr2 := obj2.(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)[<span class="string">&quot;arr2&quot;</span>]</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;obj2.arr:&quot;</span>, obj2Arr2) <span class="comment">// obj2.arr: [q w e]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JSON-gt-êµ¬ì¡°ì²´"><a href="#JSON-gt-êµ¬ì¡°ì²´" class="headerlink" title="JSON -&gt; êµ¬ì¡°ì²´"></a>JSON -&gt; êµ¬ì¡°ì²´</h3><p>êµ¬ì¡°ì²´ë¥¼ ì¡°ë‚¸ ì •ì˜í•´ì„œ ë°›ì•„ì•¼ í•¨.. -_-</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// parseJSON - JSON 1depth</span></span><br><span class="line"><span class="keyword">type</span> parseJSON <span class="keyword">struct</span> &#123;</span><br><span class="line">    Int  <span class="keyword">int</span>      <span class="string">`json:&quot;int&quot;`</span></span><br><span class="line">    Str  <span class="keyword">string</span>   <span class="string">`json:&quot;str&quot;`</span></span><br><span class="line">    Bool <span class="keyword">bool</span>     <span class="string">`json:&quot;bool&quot;`</span></span><br><span class="line">    Arr  []<span class="keyword">int</span>    <span class="string">`json:&quot;arr&quot;`</span></span><br><span class="line">    Obj  FirstObj <span class="string">`json:&quot;obj&quot;`</span></span><br><span class="line">    All  FirstAll <span class="string">`json:&quot;all&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FirstObj - JSON 1depth obj</span></span><br><span class="line"><span class="keyword">type</span> FirstObj <span class="keyword">struct</span> &#123;</span><br><span class="line">    X <span class="keyword">string</span> <span class="string">`json:&quot;x&quot;`</span></span><br><span class="line">    Y <span class="keyword">string</span> <span class="string">`json:&quot;y&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FirstAll - JSON 1depth all</span></span><br><span class="line"><span class="keyword">type</span> FirstAll <span class="keyword">struct</span> &#123;</span><br><span class="line">    All SecondObj2 <span class="string">`json:&quot;obj2&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SecondObj2 - JSON 2depth obj2</span></span><br><span class="line"><span class="keyword">type</span> SecondObj2 <span class="keyword">struct</span> &#123;</span><br><span class="line">    Obj3 thirdObj3 <span class="string">`json:&quot;obj3&quot;`</span></span><br><span class="line">    Bool <span class="keyword">bool</span>      <span class="string">`json:&quot;bool&quot;`</span></span><br><span class="line">    Arr2 []<span class="keyword">string</span>  <span class="string">`json:&quot;arr2&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// thirdObj3 - JSON 3depth obj3</span></span><br><span class="line"><span class="keyword">type</span> thirdObj3 <span class="keyword">struct</span> &#123;</span><br><span class="line">    A <span class="keyword">string</span> <span class="string">`json:&quot;a&quot;`</span></span><br><span class="line">    B <span class="keyword">string</span> <span class="string">`json:&quot;b&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    myJSON, err := ioutil.ReadFile(<span class="string">&quot;./sample.json&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;myJSON:&quot;</span>, <span class="keyword">string</span>(myJSON))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    res := parseJSON&#123;&#125;</span><br><span class="line"></span><br><span class="line">    parseErr := json.Unmarshal(myJSON, &amp;res)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> parseErr != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(parseErr)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(res) <span class="comment">// &#123;3 aaa true [1 2 3] &#123;x y&#125; &#123;&#123;&#123;a b&#125; false [q w e]&#125;&#125;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>í™•ì¸ìš©ìœ¼ë¡œ Expressë¡œ í•˜ë‚˜ ë„ì›€</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">  extended: <span class="literal">true</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;listen&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/q&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.status(<span class="number">200</span>).send(&#123;<span class="attr">code</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">&quot;hi&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/q2&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.status(<span class="number">403</span>).send(&#123;<span class="attr">code</span>: <span class="number">403</span>, <span class="attr">message</span>: <span class="string">&quot;403&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/q3&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.status(<span class="number">500</span>).send(&#123;<span class="attr">code</span>: <span class="number">500</span>, <span class="attr">message</span>: <span class="string">&quot;wrong&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/q4&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.query);</span><br><span class="line">    res.status(<span class="number">200</span>).send(&#123;<span class="attr">code</span>: <span class="number">200</span>, <span class="attr">message</span>: req.query.id&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/q5&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;req header: &#x27;</span>, req.headers);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;content-type: &#x27;</span>, req.headers[<span class="string">&#x27;content-type&#x27;</span>]);</span><br><span class="line">    res.status(<span class="number">200</span>).send(&#123;<span class="attr">code</span>: <span class="number">200</span>, <span class="attr">message</span>: <span class="string">&quot;hi&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/w&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;body: &#x27;</span>, req.body);</span><br><span class="line">    res.status(<span class="number">200</span>).send(&#123;<span class="attr">code</span>: <span class="number">200</span>, <span class="attr">id</span>: req.body.id, <span class="attr">name</span>: req.body.name&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/w2&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;req header: &#x27;</span>, req.headers);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;content-type: &#x27;</span>, req.headers[<span class="string">&#x27;content-type&#x27;</span>]);</span><br><span class="line">    res.status(<span class="number">200</span>).send(&#123;<span class="attr">code</span>: <span class="number">200</span>, <span class="attr">title</span>: req.body.title&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ë‚´ì¥ íŒ¨í‚¤ì§€ net/httpë¥¼ í†µí•´ ê°€ëŠ¥í•¨.</p><h3 id="Get"><a href="#Get" class="headerlink" title="Get"></a>Get</h3><h4 id="ì¿¼ë¦¬ìŠ¤íŠ¸ë§"><a href="#ì¿¼ë¦¬ìŠ¤íŠ¸ë§" class="headerlink" title="ì¿¼ë¦¬ìŠ¤íŠ¸ë§"></a>ì¿¼ë¦¬ìŠ¤íŠ¸ë§</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;net/url&quot;</span></span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    req2, err := http.NewRequest(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://localhost:3000/q4&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    q := url.Values&#123;&#125;</span><br><span class="line">q.Add(<span class="string">&quot;userId&quot;</span>, <span class="string">&quot;eqweqw12312&quot;</span>)</span><br><span class="line">q.Add(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;í™ê¸¸ë™&quot;</span>)</span><br><span class="line">q.Add(<span class="string">&quot;api_key&quot;</span>, <span class="string">&quot;zfxgrwwewrere&quot;</span>)</span><br><span class="line"></span><br><span class="line">    req2.URL.RawQuery = q.Encode() <span class="comment">// ì¿¼ë¦¬ìŠ¤íŠ¸ë§ ì´ìŠ¤ì¼€ì´í”„</span></span><br><span class="line"></span><br><span class="line">    client2 := &amp;http.Client&#123;&#125;</span><br><span class="line"></span><br><span class="line">    res2, err := client2.Do(req2) <span class="comment">// ì—¬ê¸°ê°€ ì‹¤ì œ ì‹¤í–‰í•˜ëŠ” ë¶€ë¶„.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> res2.Body.Close()</span><br><span class="line"></span><br><span class="line">    thisBody2, err := ioutil.ReadAll(res2.Body)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;thisBody2&quot;</span>, <span class="keyword">string</span>(thisBody2)) <span class="comment">// thisBody2 &#123;&quot;code&quot;:200&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ë³¸ë¬¸-ë°›ê¸°"><a href="#ë³¸ë¬¸-ë°›ê¸°" class="headerlink" title="ë³¸ë¬¸ ë°›ê¸°"></a>ë³¸ë¬¸ ë°›ê¸°</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> parseJSON <span class="keyword">struct</span> &#123;</span><br><span class="line">Code    <span class="keyword">int</span>    <span class="string">`json:&quot;code&quot;`</span></span><br><span class="line">Message <span class="keyword">string</span> <span class="string">`json:&quot;message&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    resp, err := http.Get(<span class="string">&quot;http://localhost:3000/q&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> resp.Body.Close() <span class="comment">// client exit</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;resp&quot;</span>, resp) <span class="comment">// resp &amp;&#123;200 OK 200 HTTP/1.1 1 1 map[Connection:[keep-alive] X-Powered-By:[Express] Content-Type:[application/json; charset=utf-8] Content-Length:[27] Etag:[W/&quot;1b-yJ5LQLosEB2UsjA+s0n8DgGAfvY&quot;] Date:[Sun, 24 Feb 2019 14:42:31 GMT]] 0xc42013c400 27 [] false false map[] 0xc42010a100 &lt;nil&gt;&#125;</span></span><br><span class="line"></span><br><span class="line">    body, err := ioutil.ReadAll(resp.Body) <span class="comment">// bodyë¥¼ ì½ìœ¼ë©´ ì´ë ‡ê²Œ í•´ì•¼ ëœë‹¤.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;body&quot;</span>, <span class="keyword">string</span>(body)) <span class="comment">// body &#123;&quot;code&quot;:200,&quot;message&quot;:&quot;hi&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">    thisRes := parseJSON&#123;&#125;</span><br><span class="line"></span><br><span class="line">    parseErr := json.Unmarshal(body, &amp;thisRes) <span class="comment">// json parse</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> parseErr != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(parseErr)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(thisRes.Code) <span class="comment">// 200</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;bytes&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// myParam - JSON íŒŒë¼ë¯¸í„°</span></span><br><span class="line"><span class="keyword">type</span> myParam <span class="keyword">struct</span> &#123;</span><br><span class="line">ID   <span class="keyword">string</span> <span class="string">`json:&quot;id&quot;`</span></span><br><span class="line">Name <span class="keyword">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    thisParam := myParam&#123;&#125; <span class="comment">// êµ¬ì¡°ì²´.</span></span><br><span class="line"></span><br><span class="line">    thisParam.ID = <span class="string">&quot;SAO&quot;</span></span><br><span class="line">    thisParam.Name = <span class="string">&quot;kirito&quot;</span></span><br><span class="line"></span><br><span class="line">    reqParams, _ := json.Marshal(thisParam) <span class="comment">// json stringfy()</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// json ë¬¸ìì—´ë¡œ ë³€ê²½ì„ í•œ í›„ byteë¡œ ë³€ê²½ì„ í•´ì¤˜ì•¼ í•œë‹¤. íŒŒë¼ë¯¸í„°ì— stringì´ ë“¤ì–´ê°ˆìˆ˜ê°€ ì—…ìŒ..</span></span><br><span class="line"></span><br><span class="line">    buff := bytes.NewBuffer(reqParams)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;buff&quot;</span>, buff) <span class="comment">// buff &#123;&quot;id&quot;:&quot;SAO&quot;,&quot;name&quot;:&quot;kirito&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">    postRes2, err := http.Post(<span class="string">&quot;http://localhost:3000/w&quot;</span>, <span class="string">&quot;application/json&quot;</span>, buff)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> postRes2.Body.Close()</span><br><span class="line"></span><br><span class="line">    postResBody2, err := ioutil.ReadAll(postRes2.Body)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;postResBody2&quot;</span>, <span class="keyword">string</span>(postResBody2)) <span class="comment">// postResBody2 &#123;&quot;code&quot;:200,&quot;id&quot;:&quot;SAO&quot;,&quot;name&quot;:&quot;kirito&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ê³µí†µ"><a href="#ê³µí†µ" class="headerlink" title="ê³µí†µ"></a>ê³µí†µ</h3><h4 id="í—¤ë”-ì¶”ê°€"><a href="#í—¤ë”-ì¶”ê°€" class="headerlink" title="í—¤ë” ì¶”ê°€"></a>í—¤ë” ì¶”ê°€</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">    <span class="string">&quot;bytes&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> jsonStr = []<span class="keyword">byte</span>(<span class="string">`&#123;&quot;title&quot;:&quot;ì „ìƒí–ˆë”ë‹ˆ ìŠ¬ë¼ì„ì´ì—ˆë˜ ê±´ì— ëŒ€í•˜ì—¬&quot;&#125;`</span>)</span><br><span class="line"></span><br><span class="line">    req, err := http.NewRequest(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;http://localhost:3000/w2&quot;</span>, bytes.NewBuffer(jsonStr))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    req.Header.Add(<span class="string">&quot;content-type&quot;</span>, <span class="string">&quot;application/json&quot;</span>) <span class="comment">// ì´ëŸ° ì‹ìœ¼ë¡œ í—¤ë”ì— ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.</span></span><br><span class="line">    req.Header.Add(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line"></span><br><span class="line">    client := &amp;http.Client&#123;&#125;</span><br><span class="line"></span><br><span class="line">    res, err := client.Do(req)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> res.Body.Close()</span><br><span class="line"></span><br><span class="line">    thisBody, err := ioutil.ReadAll(res.Body)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;thisBody&quot;</span>, <span class="keyword">string</span>(thisBody)) <span class="comment">// thisBody &#123;&quot;code&quot;:200,&quot;title&quot;:&quot;ì „ìƒí–ˆë”ë‹ˆ ìŠ¬ë¼ì„ì´ì—ˆë˜ ê±´ì— ëŒ€í•˜ì—¬&quot;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ìƒíƒœ-í™•ì¸"><a href="#ìƒíƒœ-í™•ì¸" class="headerlink" title="ìƒíƒœ í™•ì¸"></a>ìƒíƒœ í™•ì¸</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;) <span class="comment">// ìƒíƒœë¥¼ ë°›ê¸° ìœ„í•œ ì±„ë„.</span></span><br><span class="line"></span><br><span class="line">    ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    ch3 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        resp, err := http.Get(<span class="string">&quot;http://localhost:3000/q&quot;</span>) <span class="comment">// http ë©”ì†Œë“œ GET</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="built_in">panic</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">defer</span> resp.Body.Close() <span class="comment">// http í´ë¼ì´ì–¸íŠ¸ ì¢…ë£Œ.</span></span><br><span class="line"></span><br><span class="line">        r := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">        r[<span class="string">&quot;statusCode&quot;</span>] = resp.StatusCode <span class="comment">// ìƒíƒœì½”ë“œ.</span></span><br><span class="line">        r[<span class="string">&quot;status&quot;</span>] = resp.Status <span class="comment">// ìƒíƒœ ë©”ì„¸ì§€.</span></span><br><span class="line"></span><br><span class="line">        ch1 &lt;- r</span><br><span class="line"></span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        resp, err := http.Get(<span class="string">&quot;http://localhost:3000/q2&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="built_in">panic</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">defer</span> resp.Body.Close() <span class="comment">// client exit</span></span><br><span class="line"></span><br><span class="line">        r := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">        r[<span class="string">&quot;statusCode&quot;</span>] = resp.StatusCode</span><br><span class="line">        r[<span class="string">&quot;status&quot;</span>] = resp.Status</span><br><span class="line"></span><br><span class="line">        ch2 &lt;- r</span><br><span class="line"></span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        resp, err := http.Get(<span class="string">&quot;http://localhost:3000/q3&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="built_in">panic</span>(err)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">defer</span> resp.Body.Close() <span class="comment">// client exit</span></span><br><span class="line"></span><br><span class="line">        r := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">        r[<span class="string">&quot;statusCode&quot;</span>] = resp.StatusCode</span><br><span class="line">        r[<span class="string">&quot;status&quot;</span>] = resp.Status</span><br><span class="line"></span><br><span class="line">        ch3 &lt;- r</span><br><span class="line"></span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> index := <span class="number">0</span>; index &lt; <span class="number">3</span>; index++ &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> msg1 := &lt;-ch1:</span><br><span class="line">            fmt.Println(<span class="string">&quot;ì²« ë²ˆì¨° ë¦¬í€˜ìŠ¤íŠ¸ http status&quot;</span>, msg1) <span class="comment">// ì²« ë²ˆì¨° ë¦¬í€˜ìŠ¤íŠ¸ http status map[statusCode:200 status:200 OK]</span></span><br><span class="line">        <span class="keyword">case</span> msg2 := &lt;-ch2:</span><br><span class="line">            fmt.Println(<span class="string">&quot;ë‘ ë²ˆì¨° ë¦¬í€˜ìŠ¤íŠ¸ http status&quot;</span>, msg2) <span class="comment">// ë‘ ë²ˆì¨° ë¦¬í€˜ìŠ¤íŠ¸ http status map[statusCode:403 status:403 Forbidden]</span></span><br><span class="line">        <span class="keyword">case</span> msg3 := &lt;-ch3:</span><br><span class="line">            fmt.Println(<span class="string">&quot;ì„¸ ë²ˆì¨° ë¦¬í€˜ìŠ¤íŠ¸ http status&quot;</span>, msg3) <span class="comment">// ì„¸ ë²ˆì¨° ë¦¬í€˜ìŠ¤íŠ¸ http status map[statusCode:500 status:500 Internal Server Error]</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go êµ¬ì¡°ì²´, ì¸í„°í˜ì´ìŠ¤ ì •ë¦¬</title>
      <link href="/2019/02/17/go-study-4/"/>
      <url>/2019/02/17/go-study-4/</url>
      
        <content type="html"><![CDATA[<h2 id="êµ¬ì¡°ì²´"><a href="#êµ¬ì¡°ì²´" class="headerlink" title="êµ¬ì¡°ì²´"></a>êµ¬ì¡°ì²´</h2><p>ë³€ìˆ˜ë“¤ì˜ ì§‘í•©, JSì—ëŠ” ì—…ì§€ë§Œ ì†”ë¦¬ë””í‹°ì—ì„œ ì¢€ ì¨ë´£ë‹¤.</p><p>GoëŠ” í´ë˜ìŠ¤ê°€ ì—…ê¸° ë•Œë¬¸ì— êµ¬ì¡°ì²´ë¥¼ í´ë˜ìŠ¤ì²˜ëŸ¼ ì“°ë¯€ë¡œ ì˜ ê¸°ì–µí•´ë‘ì.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Go êµ¬ì¡°ì²´ ì„ ì–¸ ë°©ë²•.</span></span><br><span class="line"><span class="keyword">type</span> user <span class="keyword">struct</span> &#123;</span><br><span class="line">id       <span class="keyword">string</span></span><br><span class="line">name     <span class="keyword">string</span></span><br><span class="line">password <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">êµ¬ì¡°ì²´ í˜¸ì¶œ ë°©ë²•</span></span><br><span class="line"><span class="comment">ì“°ê³  ë³´ë‹ˆ ë­”ê°€ ìë°”ìŠ¤í¬ë¦½íŠ¸ Object ìŠ¤ëŸ½ë‹¤.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">a := user&#123;&#125;</span><br><span class="line">a.id = <span class="string">&quot;emma&quot;</span></span><br><span class="line">a.name = <span class="string">&quot;ì— ë§ˆ&quot;</span></span><br><span class="line">a.password = <span class="string">&quot;neverland&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(a) <span class="comment">// &#123;emma ì— ë§ˆ neverland&#125;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(a.id) <span class="comment">// emma</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// êµ¬ì¡°ì²´ í˜¸ì¶œ ë°©ë²• new ì—°ì‚°ìë¥¼ ë¶™ì—¬ì„œ ì“¸ìˆ˜ ìˆë‹¤.</span></span><br><span class="line">b := <span class="built_in">new</span>(user)</span><br><span class="line"></span><br><span class="line">b.id = <span class="string">&quot;luffy&quot;</span></span><br><span class="line">b.name = <span class="string">&quot;ë£¨í”¼&quot;</span></span><br><span class="line">b.password = <span class="string">&quot;onepiece&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(b) <span class="comment">// &amp;&#123;luffy ë£¨í”¼ onepiece&#125; í¬ì¸í„°ë¥¼ ë¦¬í„´ í•œë‹¤.</span></span><br><span class="line"></span><br><span class="line">fmt.Println(b.id) <span class="comment">// luffy</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ìƒì„±ì"><a href="#ìƒì„±ì" class="headerlink" title="ìƒì„±ì"></a>ìƒì„±ì</h3><p>êµ¬ì¡°ì²´ë¥¼ ì‚¬ìš©ì „ì— ì´ˆê¸°í™” í•  í•„ìš”ê°€ ìˆì„ ì‹œ ìƒì„±ì í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©ì„ í•  ìˆ˜ ìˆë‹¤ê³  í•œë‹¤.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// mapì´ ìˆëŠ” êµ¬ì¡°ì²´</span></span><br><span class="line"><span class="keyword">type</span> con <span class="keyword">struct</span> &#123;</span><br><span class="line">data <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ìƒì„±ì í•¨ìˆ˜ ìƒì„±</span></span><br><span class="line"><span class="comment">í¬ì¸í„°ë¡œ í•´ì•¼ ëœë‹¤.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newCon</span><span class="params">()</span> *<span class="title">con</span></span> &#123;</span><br><span class="line">c := con&#123;&#125;</span><br><span class="line">c.data = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">return</span> &amp;c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c := newCon() <span class="comment">// ìƒì„±ì í˜¸ì¶œ</span></span><br><span class="line">c.data[<span class="string">&quot;a&quot;</span>] = <span class="string">&quot;A&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(c) <span class="comment">// &amp;&#123;map[a:A]&#125;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(*c) <span class="comment">// &#123;map[a:A]&#125;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(c.data[<span class="string">&quot;a&quot;</span>]) <span class="comment">// A</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fmt.Println(*c.data[&quot;a&quot;]) // err</span></span><br><span class="line"></span><br><span class="line">d := newCon()</span><br><span class="line"></span><br><span class="line">d.data[<span class="string">&quot;b&quot;</span>] = <span class="string">&quot;B&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(d.data) <span class="comment">// map[b:B]</span></span><br><span class="line"></span><br><span class="line">fmt.Println(d.data[<span class="string">&quot;b&quot;</span>]) <span class="comment">// B</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ë©”ì†Œë“œ"><a href="#ë©”ì†Œë“œ" class="headerlink" title="ë©”ì†Œë“œ"></a>ë©”ì†Œë“œ</h3><p>ìœ„ì—ì„œë„ ì»ì§€ë§Œ GoëŠ” í´ë˜ìŠ¤ê°€ ì—…ê¸° ë•Œë¬¸ì— êµ¬ì¡°ì²´, ë©”ì†Œë“œë¡œ OOP ã„±ã„±</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ìœ ì € êµ¬ì¡°ì²´ ì •ì˜</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">id   <span class="keyword">string</span></span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">age  <span class="keyword">uint8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ë©”ì†Œë“œ ì •ì˜</span></span><br><span class="line"><span class="comment">    ì¼ë°˜ í•¨ìˆ˜ë‘ ê°™ìŒ íŒŒë¼ë¯¸í„°ë§Œ êµ¬ì¡°ì²´ì¼ë¿..</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u User)</span> <span class="title">getId</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> u.id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u User)</span> <span class="title">getName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> u.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u User)</span> <span class="title">getAge</span><span class="params">()</span> <span class="title">uint8</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> u.age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">user := User&#123;<span class="string">&quot;oneforall&quot;</span>, <span class="string">&quot;allforone&quot;</span>, <span class="number">99</span>&#125;</span><br><span class="line"></span><br><span class="line">id := user.getId() <span class="comment">// ë©”ì†Œë“œ í˜¸ì¶œ</span></span><br><span class="line"></span><br><span class="line">name := user.getName()</span><br><span class="line"></span><br><span class="line">age := user.getAge()</span><br><span class="line"></span><br><span class="line">fmt.Println(id, name, age) <span class="comment">// oneforall allforone 99</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="í¬ì¸í„°"><a href="#í¬ì¸í„°" class="headerlink" title="í¬ì¸í„°"></a>í¬ì¸í„°</h3><p>ë©”ì†Œë“œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ ë•Œ êµ¬ì¡°ì²´ë¥¼ í¬ì¸í„°ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.</p><p>í¬ì¸í„°ë‹ˆê¹.. êµ¬ì¡°ì²´ì˜ ì›ë³¸ì´ ë‹¹ì—°íˆ ë‹¬ë¼ì§„ë‹¤.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Cal <span class="keyword">struct</span> &#123;</span><br><span class="line">first  <span class="keyword">int</span></span><br><span class="line">second <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// êµ¬ì¡°ì²´ì˜ ë°ì´í„°ë¥¼ copy</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cal)</span> <span class="title">plus</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c.first = c.first + c.second</span><br><span class="line"><span class="keyword">return</span> c.first + c.second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c Cal)</span> <span class="title">multiply</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> c.first * c.second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// í¬ì¸í„°ë¡œ ì“¸ ê²½ìš°.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cal)</span> <span class="title">plus2</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">c.first = c.first + c.second</span><br><span class="line"><span class="keyword">return</span> c.first + c.second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Cal)</span> <span class="title">multiply2</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> c.first * c.second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">cal := Cal&#123;<span class="number">1</span>, <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">plus := cal.plus()</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;plus&quot;</span>, plus) <span class="comment">// plus 11</span></span><br><span class="line"></span><br><span class="line">multi := cal.multiply()</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;multi_1&quot;</span>, multi) <span class="comment">// multi_1 5</span></span><br><span class="line"></span><br><span class="line">cal2 := Cal&#123;<span class="number">1</span>, <span class="number">5</span>&#125;</span><br><span class="line"></span><br><span class="line">plus2 := cal2.plus2()</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;plus2&quot;</span>, plus2) <span class="comment">// plus2 11</span></span><br><span class="line"></span><br><span class="line">multi2 := cal2.multiply2()</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;multi2&quot;</span>, multi2) <span class="comment">// multi2 30 &#123;êµ¬ì¡°ì²´ ì›ë³¸ firstê°€ ë°”ë€Œì—‡ê¸° ë•Œë¬¸.&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ì¸í„°í˜ì´ìŠ¤"><a href="#ì¸í„°í˜ì´ìŠ¤" class="headerlink" title="ì¸í„°í˜ì´ìŠ¤"></a>ì¸í„°í˜ì´ìŠ¤</h2><p>êµ¬ì¡°ì²´ê°€ ë³€ìˆ˜ë“¤ì˜ ì§‘í•©ì´ë¼ë©´ ì¸í„°í˜ì´ìŠ¤ëŠ” ë©”ì†Œë“œë“¤ì˜ ì§‘í•©ì´ë‹¤.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ì¸í„°í˜ì´ìŠ¤</span></span><br><span class="line"><span class="comment">ë©”ì„œë“œì˜ ì§‘í•©.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">type</span> cal <span class="keyword">interface</span> &#123;</span><br><span class="line">plus() <span class="keyword">int</span></span><br><span class="line">multiply() <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> one <span class="keyword">struct</span> &#123;</span><br><span class="line">first  <span class="keyword">int</span></span><br><span class="line">second <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> two <span class="keyword">struct</span> &#123;</span><br><span class="line">first  <span class="keyword">int</span></span><br><span class="line">second <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a one)</span> <span class="title">plus</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> a.first + a.second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a one)</span> <span class="title">multiply</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> a.first * a.second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b two)</span> <span class="title">plus</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> b.first + b.second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b two)</span> <span class="title">multiply</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> b.first * b.second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">êµ¬ì¡°ì²´ì˜ ë©”ì†Œë“œë¥¼ ë‹¤ ì •ì˜í•˜ë©´</span></span><br><span class="line"><span class="comment">ì´ëŸ° ì‹ìœ¼ë¡œ ë©”ì†Œë“œë¥¼ í˜¸ì¶œì„ í•  ìˆ˜ ìˆë‹¤.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">showArea</span><span class="params">(cal ...cal)</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, s := <span class="keyword">range</span> cal &#123;</span><br><span class="line">a := s.plus()  <span class="comment">//ì¸í„°í˜ì´ìŠ¤ ë©”ì„œë“œ í˜¸ì¶œ</span></span><br><span class="line">fmt.Println(a) <span class="comment">// 6 \n 60</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := one&#123;<span class="number">1</span>, <span class="number">5</span>&#125;</span><br><span class="line">b := two&#123;<span class="number">10</span>, <span class="number">50</span>&#125;</span><br><span class="line"></span><br><span class="line">showArea(a, b)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ë°ì´í„°-íƒ€ì…"><a href="#ë°ì´í„°-íƒ€ì…" class="headerlink" title="ë°ì´í„° íƒ€ì…"></a>ë°ì´í„° íƒ€ì…</h3><p>ì¸í„°í˜ì´ìŠ¤ë¥¼ ë‹¤ì´ë‚˜ë¯¹ íƒ€ì…ì´ë¼ í•´ì„œ ë°ì´í„° íƒ€ì…ìœ¼ë¡œ ì“¸ ìˆ˜ ì‡ë‹¤.</p><p>JS Objectë‘ ë¹„ìŠ·í•´ë³´ì„, ìœ„ë³´ë‹¨ ì´ ìª½ìœ¼ë¡œ ë§ˆë‹ˆ ì“¸ ê±° ê°™ì€ ëŠë‚Œ ì•„ë‹Œ ëŠë‚Œ..?</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ìœ¼ë¡œ í•˜ë©´ Dynamic Type</span></span><br><span class="line"><span class="comment">ì„ ì–¸ ë°©ë²•ì€ ë°ì´í„° íƒ€ì…interface&#123;&#125; &#123;&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">v := []<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"><span class="number">1</span>,</span><br><span class="line"><span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;hi&quot;</span>,</span><br><span class="line"><span class="string">&quot;golang&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> v &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;val:&quot;</span>, item) <span class="comment">// 1, true, hi, golang</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">m := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"><span class="string">&quot;a&quot;</span>: <span class="string">&quot;hi&quot;</span>,</span><br><span class="line"><span class="string">&quot;b&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="string">&quot;c&quot;</span>: <span class="number">33</span>,</span><br><span class="line"><span class="string">&quot;d&quot;</span>: []<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"><span class="string">&quot;array1&quot;</span>,</span><br><span class="line"><span class="string">&quot;array2&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">&quot;e&quot;</span>: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line"><span class="string">&quot;x&quot;</span>: <span class="string">&quot;x&quot;</span>,</span><br><span class="line"><span class="string">&quot;y&quot;</span>: <span class="string">&quot;y&quot;</span>,</span><br><span class="line"><span class="string">&quot;z&quot;</span>: <span class="string">&quot;z&quot;</span>,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(m) <span class="comment">// map[c:33 d:[array1 array2] e:map[x:x y:y z:z] a:hi b:true]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë‹¤ìŒì— ì´ì–´ì„œ ã„±</p>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go ì—ëŸ¬, ì˜ˆì™¸ ì²˜ë¦¬, ê³ ë£¨í‹´, ì±„ë„, CPU í™œìš© ì •ë¦¬</title>
      <link href="/2019/02/17/go-study-5/"/>
      <url>/2019/02/17/go-study-5/</url>
      
        <content type="html"><![CDATA[<h2 id="ì—ëŸ¬"><a href="#ì—ëŸ¬" class="headerlink" title="ì—ëŸ¬"></a>ì—ëŸ¬</h2><p>JSì™€ ë‹¤ë¥´ê²Œ ì—ëŸ¬ ì¸ìëŠ” ë§ˆì§€ë§‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> thisStr = <span class="string">&quot;qq&quot;</span></span><br><span class="line"></span><br><span class="line">strToInt, err := strconv.Atoi(thisStr) <span class="comment">// string -&gt; int ì´ í•¨ìˆ˜ëŠ” 2ê°€ì§€ë¥¼ ë¦¬í„´í•¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(strToInt)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// log.Fatal(err.Error()) // ë©”ì„¸ì§€ ì¶œë ¥í•˜ê³  í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ.</span></span><br><span class="line">log.Print(err.Error()) <span class="comment">// ë©”ì„¸ì§€ë§Œ ì¶œë ¥.</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì—ëŸ¬ë¥¼ ì˜ë„ì ìœ¼ë¡œ ë§Œë“¤ ê²½ìš°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;errors&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">minusSample2, err := sample1(<span class="number">1</span>, <span class="number">5</span>) <span class="comment">// err test</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(minusSample2)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">log.Print(err.Error()) <span class="comment">// 2019/02/16 15:19:51 first is small then second</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sample1</span><span class="params">(first <span class="keyword">int</span>, second <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> first &gt;= second &#123;</span><br><span class="line"><span class="keyword">return</span> first - second, <span class="literal">nil</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">&quot;first is small then second&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ì˜ˆì™¸-ì²˜ë¦¬"><a href="#ì˜ˆì™¸-ì²˜ë¦¬" class="headerlink" title="ì˜ˆì™¸ ì²˜ë¦¬"></a>ì˜ˆì™¸ ì²˜ë¦¬</h2><p>goì—ëŠ” try/catchê°€ ì—…ë‹¤.</p><p>goì—ì„œëŠ” ì—ëŸ¬ê°€ ë‚˜ë©´ ë‚´ì¥ë˜ì‡ëŠ” panic() í•¨ìˆ˜ê°€ í˜¸ì¶œì´ ëœë‹¤. ê·¸ëŸ¬ë©´ ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜ì—ì„œ ë©ˆì¶”ê³ </p><p>ì¢…ë£Œëœë‹¤. recover()ë¼ëŠ” ë‚´ì¥ í•¨ìˆ˜ë¥¼ í˜¸ì¶œ í•˜ë©´ panic ìƒíƒœë¥¼ ë‹¤ì‹œ ì •ìƒìœ¼ë¡œ ë¡¤ë°± í•¨.</p><p>deferëŠ” try/catch/finally ì—ì„œ ë§ˆì§€ë§‰ finallyì™€ ê°™ìŒ.</p><p>ì•„ì§ì€ ë­”ê°€ ì–´ìƒ‰í•œ ëŠë‚Œì´ë‹¤ -_-</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ex(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;division 1&quot;</span>, sample2(<span class="number">2</span>, <span class="number">0</span>)) <span class="comment">// 2019/02/17 17:29:54 runtime error: integer divide by zero</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">ex(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;division 2&quot;</span>, sample2(<span class="number">3</span>, <span class="number">1</span>))</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sample2</span><span class="params">(first <span class="keyword">int</span>, second <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> first / second</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ex</span><span class="params">(f <span class="keyword">func</span>()</span>)</span> &#123; <span class="comment">// ì‹¤í–‰í•  í•¨ìˆ˜ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ”ê²ƒ.</span></span><br><span class="line">startTime := time.Now() <span class="comment">// ì‹œì‘ ì‹œê°„</span></span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">elapsedTime := time.Since(startTime)</span><br><span class="line">fmt.Println(<span class="string">&quot;ê²½ê³¼ì‹œê°„&quot;</span>, elapsedTime)</span><br><span class="line"><span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">log.Print(err)</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">f()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ê³ ë£¨í‹´"><a href="#ê³ ë£¨í‹´" class="headerlink" title="ê³ ë£¨í‹´"></a>ê³ ë£¨í‹´</h2><p>Go ëŸ°íƒ€ì„ì—ì„œ ê´€ë¦¬í•˜ëŠ” ì“°ë ˆë“œì´ë‹¤</p><p>OS ì“°ë ˆë“œë³´ë‹¤ ê°€ë³ê²Œ ë¹„ë™ê¸° ë™ì‹œì„± ì²˜ë¦¬ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ ë§Œë“  ê²ƒ</p><p>ì¼ë°˜ í•¨ìˆ˜ ì•ì— í‚¤ì›Œë“œë¡œ go ë¶™ì´ë©´ ë.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">test(<span class="string">&quot;sync&quot;</span>) <span class="comment">// í•¨ìˆ˜ë¥¼ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> test(<span class="string">&quot;async&quot;</span>) <span class="comment">// ê³ ë£¨í‹´ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(param <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(param)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ê·¼ë° ì‹¤í–‰í•˜ë©´ ê³ ë£¨í‹´ í•¨ìˆ˜ëŠ” ì¶œë ¥ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤. ì´ìœ ëŠ” ê³ ë£¨í‹´ì€ ë¹„ë™ê¸°ì´ê¸° ë•Œë¬¸ì—</p><p>ë©”ì¸ í•¨ìˆ˜ê°€ ë¨¼ì € ì‹¤í–‰í•œ ë’¤ ì¢…ë£Œë˜ê¸° ë•Œë¬¸ì— ê³ ë£¨í‹´ í•¨ìˆ˜ëŠ” ì”¹íŒë‹¤.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">test(<span class="string">&quot;sync-2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> test(<span class="string">&quot;async-2&quot;</span>)</span><br><span class="line"></span><br><span class="line">time.Sleep(time.Second * <span class="number">1</span>) <span class="comment">// 1ì´ˆ ëŒ€ê¸°.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">test</span><span class="params">(param <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(param)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ëŸ°ì‹ìœ¼ë¡œ í•˜ë©´ ë©”ì¸ì´ ì‹¤í–‰í•˜ê³  ì¢…ë£Œí•˜ê¸°ê¹Œì§€ 1ì´ˆë¥¼ ê¸°ë‹¤ë¦¬ê¸° ë•Œë¬¸ì— ê³ ë£¨í‹´ì´ ì‹¤í–‰ì´ ëœë‹¤.</p><h3 id="ìµëª…í•¨ìˆ˜"><a href="#ìµëª…í•¨ìˆ˜" class="headerlink" title="ìµëª…í•¨ìˆ˜"></a>ìµëª…í•¨ìˆ˜</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wait sync.WaitGroup <span class="comment">// ëª¨ë“  ê³ ë£¨í‹´ì´ ì¢…ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°í•´ì•¼ í•  ë•Œ ì‚¬ìš©</span></span><br><span class="line">wait.Add(<span class="number">3</span>)             <span class="comment">// 3ê°œì˜ ê³ ë£¨í‹´ ëŒ€ê¸°.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wait.Done() <span class="comment">// í˜„ì¬ ê³ ë£¨í‹´ì´ ì¢…ë£Œë˜ë©´ í˜¸ì¶œ</span></span><br><span class="line">fmt.Println(<span class="string">&quot;golang&quot;</span>)</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wait.Done()</span><br><span class="line">fmt.Println(<span class="string">&quot;Javascript&quot;</span>)</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> wait.Done()</span><br><span class="line">fmt.Println(<span class="string">&quot;Python&quot;</span>)</span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">wait.Wait() <span class="comment">// ìœ„ì˜ ìµëª…í•¨ìˆ˜ ê³ ë£¨í‹´ë“¤ì´ ëë‚  ë•Œê¹Œì§€ ëŒ€ê¸°.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ì±„ë„"><a href="#ì±„ë„" class="headerlink" title="ì±„ë„"></a>ì±„ë„</h2><p>ì±„ë„ì„ í†µí•´ ê³ ë£¨í‹´ í•¨ìˆ˜ë¼ë¦¬ ë˜ëŠ” ë©”ì¸ í•¨ìˆ˜ì™€ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ì„ ìˆ˜ ì‡ë‹¤.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">ch &lt;- <span class="number">123456</span> <span class="comment">// ì±„ë„ì— ê°’ ë³´ë‚´ê¸°.</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line">i := &lt;-ch <span class="comment">// ì±„ë„ë¡œë¶€í„° ê°’ ë°›ìŒ.</span></span><br><span class="line"></span><br><span class="line">fmt.Println(i) <span class="comment">// 123456</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì±„ë„ì„ ì“°ê²Œ ë˜ë©´ ê³ ë£¨í‹´ í•¨ìˆ˜ê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ê±°ë‚˜ ê·¸ëŸ´ í•„ìš”ê°€ ì—…ë‹¤.</p><p>ì±„ë„ì„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ì†¡ì‹ ì, ìˆ˜ì‹ ìê°€ ê¸°ë‹¤ë¦¬ëŠ” ì†ì„±ì´ ìˆì–´ì„œ ë°ì´í„° ìˆ˜ì‹ ì´ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ê¸° ë•Œë¬¸ì´ë‹¤.</p><p>ì•„ ê·¸ë¦¬ê³  ì±„ë„ì„ íŒŒë¼ë¯¸í„°ë¡œ ì¨ì„œ í•¨ìˆ˜ê°€ í•´ë‹¹ ì±„ë„ì„ ì†¡ì‹ í•  ê²ƒì¸ì§€, ìˆ˜ì‹ í•  ê²ƒì¸ì§€ ì§€ì •í•  ìˆ˜ ìˆë‹¤.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">1</span>) <span class="comment">// ë’¤ì— ìˆ«ìë§Œí¼ (ë²„í¼) ì±„ë„ì„ ìƒì„±í•œë‹¤ëŠ” ëœ».</span></span><br><span class="line"></span><br><span class="line">send(ch2)</span><br><span class="line"></span><br><span class="line">response(ch2) <span class="comment">// send data</span></span><br><span class="line"></span><br><span class="line">ch3 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2</span>) <span class="comment">// 2ê°œì˜ ë²„í¼ë¥¼ ê°€ì§„ ì±„ë„ì„ í• ë‹¹.</span></span><br><span class="line"></span><br><span class="line">ch3 &lt;- <span class="number">10</span></span><br><span class="line"></span><br><span class="line">ch3 &lt;- <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">close</span>(ch3) <span class="comment">// ì±„ë„ ë‹«ê¸° ë”ì´ìƒ ì†¡ì‹ ì€ ì•ˆë˜ì§€ë§Œ ìˆ˜ì‹ ì€ ê°€ëŠ¥í•˜ë‹¤.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fmt.Println(&lt;-ch3)</span></span><br><span class="line"><span class="comment">// fmt.Println(&lt;-ch3)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> ch3 &#123; <span class="comment">// ì±„ë„ì€ ë°˜ë³µë¬¸ìœ¼ë¡œë„ ëŒë¦´ìˆ˜ ìˆêµ°..</span></span><br><span class="line">fmt.Println(i) <span class="comment">// 10 -&gt; ë‹¤ìŒì€ 20 ì¶œë ¥.</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(ch <span class="keyword">chan</span>&lt;- <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">ch &lt;- <span class="string">&quot;send data&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">response</span><span class="params">(ch &lt;-<span class="keyword">chan</span> <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">data := &lt;-ch</span><br><span class="line">fmt.Println(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p>selectë¥¼ í†µí•´ ì—¬ëŸ¬ ê°œì˜ ì±„ë„ë¡œë¶€í„° ë©”ì„¸ì§€ë¥¼ ê¸°ë‹¤ë¦´ìˆ˜ ìˆë‹¤.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">c1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line">c2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line">c3 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// time.Sleep(time.Second * 1)</span></span><br><span class="line">c1 &lt;- <span class="string">&quot;1ë²ˆ ë§&quot;</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">time.Sleep(time.Second * <span class="number">3</span>)</span><br><span class="line">c2 &lt;- <span class="string">&quot;2ë²ˆ ë§&quot;</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">time.Sleep(time.Second * <span class="number">5</span>)</span><br><span class="line">c3 &lt;- <span class="string">&quot;3ë²ˆ ë§&quot;</span></span><br><span class="line">&#125;()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index := <span class="number">0</span>; index &lt; <span class="number">3</span>; index++ &#123;</span><br><span class="line"><span class="keyword">select</span> &#123;</span><br><span class="line"><span class="keyword">case</span> msg1 := &lt;-c1:</span><br><span class="line">fmt.Println(<span class="string">&quot;1ë²ˆ ë§ ë„ì°©&quot;</span>, msg1)</span><br><span class="line"><span class="keyword">case</span> msg2 := &lt;-c2:</span><br><span class="line">fmt.Println(<span class="string">&quot;2ë²ˆ ë§ ë„ì°©&quot;</span>, msg2)</span><br><span class="line"><span class="keyword">case</span> msg3 := &lt;-c3:</span><br><span class="line">fmt.Println(<span class="string">&quot;3ë²ˆ ë§ ë„ì°©&quot;</span>, msg3)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ê°ê° ì±„ë„ì„ ìƒì„±í•˜ê³  ê°ê°ì˜ ê³ ë£¨í‹´ì—ì„œ ì“°ì¸ë‹¤ê³  ê°€ì •í•˜ì. (ìœ„ì˜ ì²˜ëŸ¼)</p><p>ì´ì œ ë°˜ë³µë¬¸ì—ì„œ selectë¥¼ í†µí•´ ê°ê°ì˜ ê³ ë£¨í‹´ì—ì„œ í• ë‹¹í•œ ì±„ë„ì„ ëª¨ë‘ ì½ê²Œ ëœë‹¤.</p><p>ìœ„ì˜ ê²½ìš°ì— ì¼ì • ë”œë ˆì´ë¥¼ ì£¼ì—ˆì§€ë§Œ ìƒëµí•˜ê±°ë‚˜ ì¤‘ê°„ì— ì¢…ë£Œë˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ê¸°í–ˆë‹¤ê°€ ìˆ˜ì‹ í•œë‹¤.</p><h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><p>Goë„ ê¸°ë³¸ì ìœ¼ë¡œ cpuë¥¼ 1ê°œë§Œ ì“´ë‹¤. ëª¨ë“  cpuë¥¼ í™œìš©í•˜ë ¤ë©´ ì•„ë˜ì™€ ê°™ì´ í•´ì•¼ í•¨.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;runtime&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">thisComputerCPU := runtime.NumCPU() <span class="comment">// í˜„ì¬ ì»´ì˜ ì‹œí”¼ìœ  ê°œìˆ˜ë¥¼ êµ¬í•˜ëŠ” ë‚´ì¥ í•¨ìˆ˜.</span></span><br><span class="line">fmt.Println(<span class="string">&quot;CPU ê°œìˆ˜:&quot;</span>, thisComputerCPU) <span class="comment">// ë¡œì»¬ì€ ì¸í…” i5ì¸ë° 4ê°œ ë‚˜ì˜¨ë‹¤ ë‚˜ì¤‘ì— AWSì—ì„œ í…ŒìŠ¤íŠ¸í•´ë³´ì.</span></span><br><span class="line"></span><br><span class="line">runtime.GOMAXPROCS(thisComputerCPU) <span class="comment">// í˜„ì¬ ì»´ì˜ ì‹œí”¼ìœ ë¥¼ ë‹¤ ì“°ê²Ÿë‹¤ëŠ” ê±°.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go í•¨ìˆ˜ ë° íŒ¨í‚¤ì§€ ì •ë¦¬</title>
      <link href="/2019/02/09/go-study-3/"/>
      <url>/2019/02/09/go-study-3/</url>
      
        <content type="html"><![CDATA[<h2 id="í•¨ìˆ˜"><a href="#í•¨ìˆ˜" class="headerlink" title="í•¨ìˆ˜"></a>í•¨ìˆ˜</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">first := <span class="string">&quot;hello world!&quot;</span></span><br><span class="line">message(first)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">message</span><span class="params">(msg <span class="keyword">string</span>)</span></span> &#123; <span class="comment">// ë§¤ê°œë³€ìˆ˜ì—ëŠ” ìë£Œí˜•ì„ ë¶™ì—¬ì•¼ í•¨.</span></span><br><span class="line">fmt.Println(msg) <span class="comment">// hello world!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ê°€ë³€ì¸ìë„ ì§€ì›, ìŠ¬ë¼ì´ìŠ¤ë¡œ ë„˜ì–´ ì˜¨ë‹¤.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">manyParamter(<span class="string">&quot;go&quot;</span>, <span class="string">&quot;C++&quot;</span>, <span class="string">&quot;javascript&quot;</span>, <span class="string">&quot;python&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">manyParamter</span><span class="params">(_param ...<span class="keyword">string</span>)</span></span> &#123; <span class="comment">// ... ë¶™ì¸ë‹¤.</span></span><br><span class="line"><span class="keyword">for</span> _, item := <span class="keyword">range</span> _param &#123;</span><br><span class="line">fmt.Println(item)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë¦¬í„´ ì‹œì—ë„ ìë£Œí˜•ì„ ëª…ì‹œí•´ì•¼ í•¨.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(returnMessage(<span class="string">&quot;hi golang?&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnMessage</span><span class="params">(msg <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123; <span class="comment">// ì´ëŸ°ì‹ìœ¼ë¡œ ì¸ì ) ë‹«ê³  ì¶”ê°€.</span></span><br><span class="line"><span class="keyword">return</span> msg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ë‹¤ì¤‘ ë¦¬í„´ë„ ì§€ì›í•¨.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(returnMessages(<span class="string">&quot;golang&quot;</span>, <span class="string">&quot;node.js&quot;</span>, <span class="string">&quot;JAVA&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">returnMessages</span><span class="params">(msg ...<span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, <span class="keyword">string</span>, <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> msg[<span class="number">0</span>], msg[<span class="number">1</span>], <span class="number">20190209</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>goëŠ” í¬ì¸í„°ê°€ ì‡ìœ¼ë‹ˆ íŒŒë¼ë¯¸í„°ì— ì£¼ì†Œê°’ì„ ë„£ì„ ìˆ˜ ì‡ìŒ.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := <span class="string">&quot;ì™¼ì†ì€ ê±°ë“¤ë¿..&quot;</span></span><br><span class="line">pointerMessage(&amp;a)</span><br><span class="line">fmt.Println(a) <span class="comment">// ì˜¤ë¥¸ì†ì€ ?ì´ ì¶œë ¥ëœë‹¤. ë³€ìˆ˜ ê°’ì´ ë°”ë€Œì—‡ìœ¼ë‹ˆê¹.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pointerMessage</span><span class="params">(msg *<span class="keyword">string</span>)</span></span> &#123; <span class="comment">// í¬ì¸í„°ì¼ ê²½ìš°ì—ëŠ” * ë¶™ì—¬ì¤˜ì•¼ í•¨.</span></span><br><span class="line">fmt.Println(*msg) <span class="comment">// ì£¼ì†Œì— í• ë‹¹ëœ ê°’ì„ ì¶œë ¥.</span></span><br><span class="line">*msg = <span class="string">&quot;ì˜¤ë¥¸ì†ì€ ?&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ìµëª…í•¨ìˆ˜ ì‘ì„±ë²•</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ìë°”ìŠ¤í¬ë¦½íŠ¸ì¸ ê²½ìš°.</span></span><br><span class="line"><span class="comment">const af = (_param) -&gt; &#123;</span></span><br><span class="line"><span class="comment">return _param</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">af := <span class="function"><span class="keyword">func</span><span class="params">(param <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123; </span><br><span class="line"><span class="keyword">return</span> param</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(af(<span class="string">&quot;hello world&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="íŒ¨í‚¤ì§€"><a href="#íŒ¨í‚¤ì§€" class="headerlink" title="íŒ¨í‚¤ì§€"></a>íŒ¨í‚¤ì§€</h2><p>goì—ì„  ëª¨ë“ˆì„ íŒ¨í‚¤ì§€ë¼ ë¶€ë¥´ëŠ” ê±° ê°™ìŒ.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> timepackage <span class="comment">// ì´ íŒŒì¼ì´ í¬í•¨ëœ í´ë”ëª…ìœ¼ë¡œ ì§€ì–´ì¤˜ì•¼í•œë‹¤.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ì‚¬ìš©ì ì •ì˜ íŒ¨í‚¤ì§€.</span></span><br><span class="line"><span class="comment">init í•¨ìˆ˜ë¶€í„° ë§Œë“œëŸ¬ì•¼ í•œë‹¤.</span></span><br><span class="line"><span class="comment">init í•¨ìˆ˜ëŠ” íŒ¨í‚¤ì§€ê°€ ë¡œë“œ ë˜ë©´ì„œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜ë¡œ ë³„ë„ì˜ í˜¸ì¶œ ì—…ì´ ìë™ìœ¼ë¡œ í˜¸ì¶œ.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myTime <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">myTime = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>) <span class="comment">// ì´ˆê¸°í™”.</span></span><br><span class="line">thisTime := time.Now() <span class="comment">// JSì—ì„œ ì“°ëŠ” Date.now() ê°™ë‹¤ê³  ìƒê°í•˜ë©´ ë¨.</span></span><br><span class="line">myTime[<span class="string">&quot;now&quot;</span>] = thisTime.String() <span class="comment">// time.nowë§Œ (íƒ€ì„ ê°ì²´) .String()ìœ¼ë¡œ ë¬¸ìì—´ë¡œ ë³€í™˜ê°€ëŠ¥í•˜ë‹¤.</span></span><br><span class="line">myTime[<span class="string">&quot;yyyy-mm-dd&quot;</span>] = thisTime.Format(<span class="string">&quot;2006-01-02&quot;</span>) <span class="comment">// ì›í•˜ëŠ” í¬ë§·ì˜ ë‚ ì§œëŠ” ì„ì˜ê°€ ì•„ë‹ˆê³  ì € ë‚ ì§œë¡œ -_-</span></span><br><span class="line">myTime[<span class="string">&quot;yyyy-mm-dd HH:MM:SS&quot;</span>] = thisTime.Format(<span class="string">&quot;2006-01-02 15:04:05&quot;</span>) <span class="comment">// ì‹œê°„ ë¶„ë„ ë§ˆì°¬ê°€ì§€ë‹¤.</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">int64ëŠ” stringìœ¼ë¡œ ë³€í™˜í•  ë•Œ FormatIntë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤</span></span><br><span class="line"><span class="comment">Itoaë¡œëŠ” ì•ˆë¨.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">FormatInt(ìˆ«ì, ì§„ìˆ˜) 10ì€ 10ì§„ìˆ˜ë¡œ 16ì€ 16ì§„ìˆ˜ë¡œ.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">myTime[<span class="string">&quot;unixTimeStamp&quot;</span>] = strconv.FormatInt(thisTime.Unix(), <span class="number">10</span>)</span><br><span class="line">myTime[<span class="string">&quot;unixTimeStampNS&quot;</span>] = strconv.FormatInt(thisTime.UnixNano(), <span class="number">10</span>) <span class="comment">// MSê°€ ì•„ë‹Œ ë‚˜ë…¸</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">í¼ë¸”ë¦­ì´ë©´ í•¨ìˆ˜ì‹œì‘ì„ ëŒ€ë¬¸ìë¡œ</span></span><br><span class="line"><span class="comment">í”„ë¼ì´ë¹—ì´ë©´ ì†Œë¬¸ì (ì™¸ë¶€ì—ì„œ ëª» ë¶€ë¦„)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetMyTime</span><span class="params">()</span> <span class="title">map</span>[<span class="title">string</span>]<span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> myTime</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>íŒ¨í‚¤ì§€ì—ì„œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ ë•Œ ëŒ€ë¬¸ìë¡œ ì‹œì‘í•˜ë©´ í¼ë¸”ë¦­, ì†Œë¬¸ìë©´ í”„ë¼ì´ë¹—</p><p>ì‘ì„±í•œ íŒ¨í‚¤ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ë‹¤ìŒì²˜ëŸ¼</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;mypackage/timepackage&quot;</span> <span class="comment">// importí•  ë• í´ë” ê²½ë¡œë§Œ ì ì–´ì£¼ë©´ ëœë‹¤.</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">res := timepackage.GetMyTime() <span class="comment">// ì´ëŸ°ì‹ìœ¼ë¡œ.. ì•Œì•„ì„œ ë§¤í•‘ì´ ë˜ë‚˜ë³´ì˜¤.</span></span><br><span class="line"></span><br><span class="line">fmt.Println(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ê²°ê³¼</span></span><br><span class="line"><span class="comment">map[yyyy-mm-dd HH:MM:SS:2019-02-09 23:50:47 </span></span><br><span class="line"><span class="comment">unixTimeStamp:1549723847 </span></span><br><span class="line"><span class="comment">unixTimeStampNS:1549723847110405686 </span></span><br><span class="line"><span class="comment">now:2019-02-09 23:50:47.110405686 +0900 KST m=+0.000601933 </span></span><br><span class="line"><span class="comment">yyyy-mm-dd:2019-02-09]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì˜¤ëŠ˜ì€ ìš”ê¹Œì§€.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go ì¡°ê±´ë¬¸, ë°˜ë³µë¬¸, ì½œë ‰ì…˜ ì •ë¦¬</title>
      <link href="/2019/02/03/go-study-2/"/>
      <url>/2019/02/03/go-study-2/</url>
      
        <content type="html"><![CDATA[<h2 id="ì¡°ê±´ë¬¸"><a href="#ì¡°ê±´ë¬¸" class="headerlink" title="ì¡°ê±´ë¬¸"></a>ì¡°ê±´ë¬¸</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">a := <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> a == <span class="number">10</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;a is 10&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b := <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> b &gt;= <span class="number">5</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;aëŠ” 5ë³´ë‹¤ í¬ë‹¤&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> b &gt;= <span class="number">25</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;aëŠ” 25ë³´ë‹¤ í¬ë‹¤&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;???&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> name <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">c := <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> c &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">name = <span class="string">&quot;none1&quot;</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">name = <span class="string">&quot;none2&quot;</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">name = <span class="string">&quot;none3&quot;</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>, <span class="number">5</span>:</span><br><span class="line">name = <span class="string">&quot;none4,5&quot;</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">20</span>:</span><br><span class="line">name = <span class="string">&quot;true&quot;</span></span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">name = <span class="string">&quot;false&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;name&quot;</span>, name) <span class="comment">// name, true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>breakê°€ ì—…ìŒ.</p><h2 id="ë°˜ë³µë¬¸"><a href="#ë°˜ë³µë¬¸" class="headerlink" title="ë°˜ë³µë¬¸"></a>ë°˜ë³µë¬¸</h2><p>ì‹¬í”Œí•˜ê²Œ forë¬¸ í•˜ë‚˜</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++ &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;i:&quot;</span>, i)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>break, continueë„ ì‡ìŒ.</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">sum := <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index := <span class="number">0</span>; index &lt; <span class="number">10</span>; index++ &#123;</span><br><span class="line"><span class="keyword">if</span> index%<span class="number">2</span> != <span class="number">0</span> &#123;</span><br><span class="line">sum = sum + index</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> index == <span class="number">10</span> &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;sum&quot;</span>, sum) <span class="comment">// 25</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ì½œë ‰ì…˜"><a href="#ì½œë ‰ì…˜" class="headerlink" title="ì½œë ‰ì…˜"></a>ì½œë ‰ì…˜</h2><h3 id="array"><a href="#array" class="headerlink" title="array"></a>array</h3><p>ê³ ì • ë°°ì—´</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a [<span class="number">3</span>]<span class="keyword">int</span> <span class="comment">// ë°°ì—´ ì„ ì–¸ ë°©ë²•. ì´ˆê¸°ê°’ì´ ì—…ëŠ” ë°°ì—´ì˜ í¬ê¸°ë¥¼ ì •í•´ì¤˜ì•¼ í•œë‹¤. ê·¸ë¦¬ê³  ìë£Œí˜•ì„ ë¶™ì—¬ì¤€ë‹¤.</span></span><br><span class="line"></span><br><span class="line">fmt.Println(a) <span class="comment">// íƒ€ì…ì— ë”°ë¼ ì´ˆê¸° ê°’ì€ [0 0 0]</span></span><br><span class="line"></span><br><span class="line">a[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">a[<span class="number">1</span>] = <span class="number">2</span></span><br><span class="line">a[<span class="number">2</span>] = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">fmt.Println(a) <span class="comment">// [1 2 3]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s [<span class="number">2</span>]<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">fmt.Println(s) <span class="comment">// ë¹„ì–´ ìˆëŠ” ë°°ì—´ ê°™ì§€ë§Œ ì•„ë‹˜  [ ]</span></span><br><span class="line"></span><br><span class="line">s[<span class="number">0</span>] = <span class="string">&quot;aa&quot;</span></span><br><span class="line">s[<span class="number">1</span>] = <span class="string">&quot;bb&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(s) <span class="comment">// [aa bb]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> s2 = [...]<span class="keyword">string</span>&#123;<span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;z&quot;</span>&#125; <span class="comment">// ì´ˆê¸° ê°’ì„ ì¤¬ì„ ì‹œì— [...] í•˜ë©´ ì´ˆê¸° ê°’ì˜ í¬ê¸° ë§Œí¼ ë°°ì—´ í¬ê¸° ìƒì„±.</span></span><br><span class="line"></span><br><span class="line">fmt.Println(s2) <span class="comment">// [x y z]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// s2[3] = &quot;xy&quot; ë‹¹ì—°íˆ í¬ê¸°ë¥¼ ë„˜ì–´ì„œ ì¶”ê°€í•  ìˆ˜ê°€ ì—…ë‹¤.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">...ìœ¼ë¡œ í¬ê¸° ìë™ìœ¼ë¡œ ì¡ì•„ì¤„ ì‹œ ì´ˆê¸° ê°’ ì—…ìœ¼ë©´ ì—ëŸ¬ì„</span></span><br><span class="line"><span class="comment">var c = [...]int</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">c[0] = 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">fmt.Println(c)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h3><p>ë™ì  ë°°ì—´</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> sl []<span class="keyword">int</span> <span class="comment">// ìŠ¬ë¼ì´ìŠ¤ ì„ ì–¸ ë°©ë²• ë°°ì—´ê³¼ ê°™ì§€ë§Œ í¬ê¸°ë§Œ ë¹„ì–´ë‘ë©´ ëœë‹¤.</span></span><br><span class="line"></span><br><span class="line">fmt.Println(sl) <span class="comment">// []</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sl == <span class="literal">nil</span> &#123; <span class="comment">// ë¹„ì–´ ìˆëŠ” ìŠ¬ë¼ì´ìŠ¤ëŠ” ==  nil</span></span><br><span class="line">fmt.Println(<span class="string">&quot;ë¹„ì–´ ìˆëŠ” ìŠ¬ë¼ì´ìŠ¤&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sl) == <span class="number">0</span> &#123; <span class="comment">// ìŠ¬ë¼ì´ìŠ¤ë‚˜ ë°°ì—´ì˜ ê¸¸ì´ëŠ” len()í•¨ìˆ˜ë¡œ ì•Œ ìˆ˜ ìˆë‹¤.</span></span><br><span class="line">fmt.Println(<span class="string">&quot;ê¸¸ì´ê°€ 0ì¸ ë¹„ì–´ ìˆëŠ” ìŠ¬ë¼ì´ìŠ¤&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sl = <span class="built_in">append</span>(sl, <span class="number">7</span>) <span class="comment">// ìŠ¬ë¼ì´ìŠ¤ì˜ ìš”ì†Œ ì¶”ê°€ JSì—ì„œ .push()ë‘ ê°™ì€ ê¸°ëŠ¥ì´ë‹¤.</span></span><br><span class="line"></span><br><span class="line">fmt.Println(sl) <span class="comment">// [7]</span></span><br><span class="line"></span><br><span class="line">sl = <span class="built_in">append</span>(sl, <span class="number">1</span>, <span class="number">3</span>) <span class="comment">// pushì™€ ë§ˆì°¬ê°€ì§€ë¡œ ì—¬ëŸ¬ ê°œë¥¼ ê°™ì´ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.</span></span><br><span class="line"></span><br><span class="line">fmt.Println(sl) <span class="comment">// [7 1 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Go ì—ì„œ ë¶€ë¶„ ìŠ¬ë¼ì´ìŠ¤ í•˜ëŠ” ë²•.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">JS ex</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">let sli2 = [0,1,2,3]</span></span><br><span class="line"><span class="comment">sli2 = sli2.slice(0, 2)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">sli2 := []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">sli2 = sli2[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">fmt.Println(sli2) <span class="comment">// [0 1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ìŠ¬ë¼ì´ìŠ¤ ë³µì‚¬ c++ì—ì„œ memcopyì˜€ë‚˜ ê·¸ëŸ°ê²Œ ìˆì—ˆë˜ ê°™ë‹¤.</span></span><br><span class="line"><span class="comment">ê·¼ë° ì•„ë˜ì²˜ëŸ¼ ê·¸ëƒ¥ ì§ì ‘ ë„£ì–´ë„ ë³„ ì°¨ì´ëŠ” ì—…ëŠ”ë°.. ë­”ê°€ ë‹¤ë¥¸ê±¸ê¹Œ?</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">sli3 := []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">sli4 := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="built_in">len</span>(sli3), <span class="built_in">cap</span>(sli3))</span><br><span class="line"><span class="built_in">copy</span>(sli4, sli3)</span><br><span class="line">fmt.Println(sli3, sli4)</span><br><span class="line">sli4 = sli3[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">fmt.Println(sli4, sli3)</span><br><span class="line"></span><br><span class="line">sli5 := []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">sli6 := sli5</span><br><span class="line">sli5 = <span class="built_in">append</span>(sli5, <span class="number">7</span>)</span><br><span class="line">fmt.Println(sli5, sli6)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">JS forEach ê°™ì€ ê±° ì‚¬ìš©.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index, elem := <span class="keyword">range</span> sli5 &#123;</span><br><span class="line">fmt.Println(index, elem) <span class="comment">// 0 0 -&gt; 1 1 -&gt; 2 2 ... 5 7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// index ì—…ì´ ë°ì´í„°ë§Œ.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _, elem := <span class="keyword">range</span> sli5 &#123;</span><br><span class="line">fmt.Println(elem) <span class="comment">// 0 -&gt; 1 -&gt; 2 .. 7</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> aMap <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span> <span class="comment">// vqr ë³€ìˆ˜ëª… map[key type]value type</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> aMap == <span class="literal">nil</span> &#123; <span class="comment">// ì²˜ìŒ ë§µì„ ìƒì„±í•˜ë©´ nil ìƒíƒœ. ì´ ë§µì—ëŠ” ì•„ë¬´ ë°ì´í„°ë¥¼ ì“¸ ìˆ˜ ì—…ë‹¤.</span></span><br><span class="line">fmt.Println(<span class="string">&quot;nil map&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">aMap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>) <span class="comment">// makeë¡œ ì´ˆê¸°í™”ë¥¼ í•´ì¤˜ì•¼ ë°ì´í„°ë¥¼ ì“¸ ìˆ˜ ìˆë‹¤. ì•ˆ ê·¸ëŸ¬ë©´ ì˜¤ë¥˜ ë‚¨.</span></span><br><span class="line"></span><br><span class="line">aMap[<span class="number">0</span>] = <span class="string">&quot;Go&quot;</span> <span class="comment">// ì¶”ê°€ë‚˜ ê°±ì‹ .</span></span><br><span class="line">aMap[<span class="number">1</span>] = <span class="string">&quot;Node.js&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(aMap) <span class="comment">// map[0:Go 1:Node.js]</span></span><br><span class="line"></span><br><span class="line">fmt.Println(aMap[<span class="number">0</span>]) <span class="comment">// Go (í‚¤ ê°’ ì½ê¸°)</span></span><br><span class="line"></span><br><span class="line">bMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">bMap[<span class="string">&quot;a&quot;</span>] = <span class="string">&quot;PHP&quot;</span></span><br><span class="line">bMap[<span class="string">&quot;b&quot;</span>] = <span class="string">&quot;JAVA&quot;</span></span><br><span class="line">bMap[<span class="string">&quot;c&quot;</span>] = <span class="string">&quot;null&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">delete</span>(bMap, <span class="string">&quot;c&quot;</span>) <span class="comment">// í‚¤ ì‚­ì œ.</span></span><br><span class="line"></span><br><span class="line">fmt.Println(bMap) <span class="comment">// map[a:PHP b:JAVA]</span></span><br><span class="line"></span><br><span class="line">val, key := bMap[<span class="string">&quot;c&quot;</span>] <span class="comment">// valì—ëŠ” í‚¤ì— ëŒ€í•œ value, keyëŠ” ìˆìœ¼ë©´ true, ì—…ìœ¼ë©´ false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> !key &#123; <span class="comment">// í‚¤ê°€ ì¡´ì¬í•˜ëŠ” ì§€ ì²´í¬í•˜ëŠ” ë°©ë²•.</span></span><br><span class="line">fmt.Println(<span class="string">&quot;c is no exist&quot;</span>)</span><br><span class="line">fmt.Println(val) <span class="comment">// &quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">forë¬¸ì„ ì´ìš©í•œ map ì¶œë ¥.</span></span><br><span class="line"><span class="comment">ë‹¹ì—°íˆ ìˆœì„œëŠ” ë³´ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">JS</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">for (var [key, value] of myMap) &#123;</span></span><br><span class="line"><span class="comment">console.log(key + &quot; = &quot; + value);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">cMap := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">string</span>&#123;</span><br><span class="line"><span class="number">0</span>: <span class="string">&quot;Express&quot;</span>,</span><br><span class="line"><span class="number">1</span>: <span class="string">&quot;Flask&quot;</span>,</span><br><span class="line"><span class="number">2</span>: <span class="string">&quot;Jin&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> key, val := <span class="keyword">range</span> cMap &#123;</span><br><span class="line">fmt.Println(key, val)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go ì„¤ì¹˜ ë° ì„¤ì •, ì£¼ì„, ì¶œë ¥, ë³€ìˆ˜ ì •ë¦¬</title>
      <link href="/2019/01/27/go-study-1/"/>
      <url>/2019/01/27/go-study-1/</url>
      
        <content type="html"><![CDATA[<h2 id="ì„¤ì •"><a href="#ì„¤ì •" class="headerlink" title="ì„¤ì •"></a>ì„¤ì •</h2><h3 id="ì„¤ì¹˜"><a href="#ì„¤ì¹˜" class="headerlink" title="ì„¤ì¹˜"></a>ì„¤ì¹˜</h3><p><a href="https://golang.org/">ê³µì‹ ì‚¬ì´íŠ¸</a>ì—ì„œ .dmg ë°›ì•„ì„œ ì„¤ì¹˜í•˜ë©´ ë.</p><p>GCCê°€ í•„ìš”í•˜ë‹¤ëŠ”ë° MAC ê¸°ì¤€ Xcodeë•œì— ê·¸ëŸ°ì§€ ë”°ë¡œ ë­ ì„¤ì¹˜í•  í•„ìš˜ ì—…ì—‡ìŒ.</p><h3 id="workspace-ì„¤ì •"><a href="#workspace-ì„¤ì •" class="headerlink" title="workspace ì„¤ì •"></a>workspace ì„¤ì •</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">go-workspace</span><br><span class="line">â””â”€â”€â”€bin</span><br><span class="line">â””â”€â”€â”€pkg</span><br><span class="line">â””â”€â”€â”€src</span><br><span class="line">â”‚   â”‚â”€â”€â”€ ...</span><br></pre></td></tr></table></figure><p>ì›í•˜ëŠ” ê²½ë¡œì— workspace í´ë”ë¥¼ ë§Œë“¤ê³  ìœ„ì™€ ê°™ì€ êµ¬ì¡°ë¡œ í´ë” ìƒì„±ì„ í•œë‹¤</p><p>ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©í•  í´ë”ëŠ” srcì´ë‹¤.</p><h3 id="í™˜ê²½ë³€ìˆ˜"><a href="#í™˜ê²½ë³€ìˆ˜" class="headerlink" title="í™˜ê²½ë³€ìˆ˜"></a>í™˜ê²½ë³€ìˆ˜</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go env</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1548578451/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-01-27_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.37.59_gq4nkl.png" alt="env"></p><ul><li>GOROOT = Goê°€ ì„¤ì¹˜ëœ ë””ë ‰í† ë¦¬ + /pkgë¡œ (Go ì„¤ì¹˜ ì‹œ ìë™) ì—¬ê¸°ì— í‘œì¤€ íŒ¨í‚¤ì§€ê°€ ìˆë‹¤.</li><li>GOPATH = 3rd partyë‚˜ ì‚¬ìš©ì ì •ì˜ íŒ¨í‚¤ì§€ëŠ” ì—¬ê¸°ì—ì„œ ì°¾ëŠ”ë‹¤.</li></ul><p>ë‚´ê°€ í•´ì•¼í•  ê±´ GOPATHë¼ëŠ” ë¶€ë¶„ì„ ì‚¬ìš©í•  workspaceë¡œ ë°”ê¿”ì¤˜ì•¼ í•¨.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.bash_profile</span><br><span class="line"><span class="built_in">export</span> GOPATH=/Volumes/Seagate\ Slim\ Drive/project/golang <span class="comment"># ë³¸ì¸ì´ ì •í•œ workspace</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$GOPATH</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br><span class="line">go env</span><br></pre></td></tr></table></figure><p>ê·¸ëŸ¼ GOPATHê°€ ë³¸ì¸ì˜ workspaceë¡œ ë°”ë€Œì—‡ì„ ê²ƒ.</p><h2 id="main-í•¨ìˆ˜-ì‘ì„±"><a href="#main-í•¨ìˆ˜-ì‘ì„±" class="headerlink" title="main í•¨ìˆ˜ ì‘ì„±"></a>main í•¨ìˆ˜ ì‘ì„±</h2><p>í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ì—” ë©”ì¸ íŒ¨í‚¤ì§€ì™€ ë©”ì¸ í•¨ìˆ˜ê°€ íŒ”ìˆ˜ë‹¤. main.go</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ì£¼ì„"><a href="#ì£¼ì„" class="headerlink" title="ì£¼ì„"></a>ì£¼ì„</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// í•œì¤„ ì£¼ì„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">111111</span></span><br><span class="line"><span class="comment">222222</span></span><br><span class="line"><span class="comment">333333</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ì¶œë ¥ë¬¸"><a href="#ì¶œë ¥ë¬¸" class="headerlink" title="ì¶œë ¥ë¬¸"></a>ì¶œë ¥ë¬¸</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span> <span class="comment">// fmtë¼ëŠ” í‘œì¤€ íŒ¨í‚¤ì§€ import</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;hi! golang :)&quot;</span>)        <span class="comment">// JS: console.log(&quot;hi! golang :)&quot;);</span></span><br><span class="line">fmt.Println(<span class="string">&quot;hi!&quot;</span>, <span class="string">&quot;golang&quot;</span>, <span class="string">&quot;:)&quot;</span>)  <span class="comment">// JS: console.log(&quot;hi&quot;, &quot;golang :)&quot;)</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;hi! %s\n&quot;</span>, <span class="string">&quot;golang :)&quot;</span>) <span class="comment">// JS: console.log(&quot;hi&quot;, &quot;golang :)&quot;)</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ë³€ìˆ˜"><a href="#ë³€ìˆ˜" class="headerlink" title="ë³€ìˆ˜"></a>ë³€ìˆ˜</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;reflect&quot;</span></span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ë³€ìˆ˜ ì„ ì–¸</span></span><br><span class="line"><span class="comment">ê¸°ë³¸ìœ¼ë¡œ ë³€ìˆ˜ë§Œ ì„ ì–¸í•˜ë©´ ìë£Œí˜•ì— ë”°ë¼ default ê°’ ìƒê¹€ ìˆ«ìí˜•ì€ 0, ë¬¸ìí˜•ì€ &quot;&quot; boolì€ false</span></span><br><span class="line"><span class="comment">ìë£Œí˜• ë¶™ì´ëŠ”ê±´ í•„ìˆ˜ ì•„ë‹˜.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ê¸°ë³¸ ì•Œì•„ë‘¬ì•¼ í•  ìë£Œí˜•ë§Œ ì ì–´ë‘”ë‹¤.</span></span><br><span class="line"><span class="comment">int: 32bit ì‹œìŠ¤í…œì—ì„  int32, 64bit ì‹œìŠ¤í…œì—ì„  int64ë¡œ ìë™ ì„¤ì •</span></span><br><span class="line"><span class="comment">int32: ~2,147,483,648 ~ 2,147,483,647,</span></span><br><span class="line"><span class="comment">int64: ~9,233,372,036,854,775,808 ~ 9,223,372,036,854,775,807</span></span><br><span class="line"><span class="comment">float32: 32bit</span></span><br><span class="line"><span class="comment">float64: 64bit</span></span><br><span class="line"><span class="comment">bool: ì°¸, ê±°ì§“</span></span><br><span class="line"><span class="comment">string: ë¬¸ìì—´</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> f <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tf <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">&quot;foo&quot;</span> <span class="comment">// JS: var str = &#x27;foo&#x27;</span></span><br><span class="line"></span><br><span class="line">str2 := <span class="string">&quot;bar&quot;</span> <span class="comment">// í•¨ìˆ˜ ë‚´ì—ì„œë§Œ ì¶•ì•½ ê°€ëŠ¥.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bigInt <span class="keyword">int64</span> = <span class="number">923372036854775899</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cs = <span class="string">&quot;ìƒìˆ˜&quot;</span> <span class="comment">// JS: const cs = &quot;ìƒìˆ˜&quot;</span></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;i:&quot;</span>, i, <span class="string">&quot;f:&quot;</span>, f, <span class="string">&quot;tf:&quot;</span>, tf, <span class="string">&quot;str:&quot;</span>, str, <span class="string">&quot;str2:&quot;</span>, str2, <span class="string">&quot;cs:&quot;</span>, cs, <span class="string">&quot;bigInt:&quot;</span>, bigInt)</span><br><span class="line"></span><br><span class="line"><span class="comment">// i: 0 f: 0 tf: false str: foo str2: bar cs: ìƒìˆ˜ bigInt: 923372036854775899</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">JSì—ì„œ ``ë¡œ ì¶œë ¥í•˜ëŠ” ê±° GOì—ì„œ í•˜ëŠ” ë²•.</span></span><br><span class="line"><span class="comment">const name = &quot;delryn&quot;;</span></span><br><span class="line"><span class="comment">const age = 32;</span></span><br><span class="line"><span class="comment">const message `$&#123;name&#125; is $&#123;age&#125; years old`;</span></span><br><span class="line"><span class="comment">console.log(message);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">í¬ë©§ ì„œì‹ì </span></span><br><span class="line"><span class="comment">%s: ë¬¸ìì—´</span></span><br><span class="line"><span class="comment">%d: ì •ìˆ˜</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">name := <span class="string">&quot;delryn&quot;</span></span><br><span class="line">age := <span class="number">32</span></span><br><span class="line">message := fmt.Sprintf(<span class="string">&quot;%s is %d years old&quot;</span>, name, age)</span><br><span class="line"></span><br><span class="line">fmt.Println(message) <span class="comment">// delryn is 32 years old</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Go íƒ€ì… ì²´í¬í•˜ëŠ” ë²• reflect packageë¥¼ importë¥¼ í•´ì•¼ ë¨.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;i:&quot;</span>, reflect.TypeOf(i), <span class="string">&quot;f:&quot;</span>, reflect.TypeOf(f), <span class="string">&quot;tf:&quot;</span>, reflect.TypeOf(tf),</span><br><span class="line"><span class="string">&quot;str:&quot;</span>, reflect.TypeOf(str), <span class="string">&quot;str2:&quot;</span>, reflect.TypeOf(str2), <span class="string">&quot;cs:&quot;</span>, reflect.TypeOf(cs), <span class="string">&quot;bigInt:&quot;</span>, reflect.TypeOf(bigInt))</span><br><span class="line"></span><br><span class="line"><span class="comment">// i: int f: float64 tf: bool str: string str2: string cs: string bigInt: int64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">go í˜•ë³€í™˜</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> thisInt = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> intToStr <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">intToStr = strconv.Itoa(thisInt) <span class="comment">// int -&gt; string</span></span><br><span class="line"></span><br><span class="line">fmt.Println(<span class="string">&quot;int to str&quot;</span>, intToStr, reflect.TypeOf(intToStr)) <span class="comment">// int to str 3 string</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> thisStr = <span class="string">&quot;33&quot;</span></span><br><span class="line"></span><br><span class="line">strToInt, err := strconv.Atoi(thisStr) <span class="comment">// string -&gt; int ì´ê±°ëŠ” 2ê°€ì§€ ë¦¬í„´ì„ ë°›ë”ë¼. ë¬¸ë²•ì„ ë‚´ê°€ ì¶”ê°€í•œê²Œ ì•„ë‹ˆê³ .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Println(err)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;str to int&quot;</span>, strToInt, reflect.TypeOf(strToInt)) <span class="comment">// str to int 33 int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisë¥¼ MessageQueue ì„œë²„ë¡œ ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2018/12/23/nodejs-redis-queue/"/>
      <url>/2018/12/23/nodejs-redis-queue/</url>
      
        <content type="html"><![CDATA[<p>í…ŒìŠ¤íŠ¸ë¡œ ì„œë¹„ìŠ¤ì˜ apiê°€ ì˜¤ë©´ redisì— í ë©”ì„¸ì§€ë¥¼ ë“±ë¡í•´ë‘ê³  job ìœ¼ë¡œ</p><p>ë¶„ë§ˆë‹¤ redisì— ì ì¬ëœ í ë©”ì„¸ì§€ë“¤ì„ ì½ì–´ì„œ mysqlì— ì €ì¥ í•œ ë‹¤ìŒì— redisì—ì„œ ì‚­ì œ.</p><h2 id="ë¡œì§"><a href="#ë¡œì§" class="headerlink" title="ë¡œì§"></a>ë¡œì§</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> RedisSMQ = <span class="built_in">require</span>(<span class="string">&#x27;rsmq&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rsmq = <span class="keyword">new</span> RedisSMQ(&#123; <span class="attr">host</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>, <span class="attr">port</span>: <span class="number">6379</span>, <span class="attr">ns</span>: <span class="string">&#x27;rsmq&#x27;</span> &#125;); <span class="comment">// <span class="doctag">NOTE:</span> nsëŠ” ì €ì¥í•  íì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> í ìƒì„±</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>ì¤‘ë³µëœ í ì´ë¦„ì€ ìƒì„± ë¶ˆê°€</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>qname í ì´ë¦„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> createQueue = <span class="function">(<span class="params">qname</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    rsmq.createQueue(&#123; qname &#125;, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">      <span class="keyword">if</span> (!err &amp;&amp; <span class="built_in">Number</span>(result) === <span class="number">1</span>) <span class="keyword">return</span> resolve();</span><br><span class="line">      <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;í ìƒì„± ì‹¤íŒ¨&#x27;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ë©”ì„¸ì§€ ì „ì†¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>qname í ì´ë¦„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>message ë³´ë‚¼ ë©”ì„¸ì§€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> sendMessage = <span class="function">(<span class="params">qname, message</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    rsmq.sendMessage(&#123; qname, message &#125;, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">      <span class="keyword">if</span> (!err &amp;&amp; <span class="built_in">Number</span>(result) === <span class="number">1</span>) <span class="keyword">return</span> resolve();</span><br><span class="line">      <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;ë©”ì„¸ì§€ ì „ì†¡ ì‹¤íŒ¨&#x27;</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ë©”ì„¸ì§€ í ë³´ë‚´ëŠ” í”„ë¡œì„¸ìŠ¤.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>qname í ì´ë¦„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>message ë³´ë‚¼ ë©”ì„¸ì§€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> sendProcess = <span class="function">(<span class="params">qname, message</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    sendMessage(qname, message).then(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">return</span> resolve();</span><br><span class="line">    &#125;).catch(<span class="keyword">async</span> (e) =&gt; &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.name === <span class="string">&#x27;queueNotFound&#x27;</span>) &#123; <span class="comment">// <span class="doctag">NOTE:</span> queueë¥¼ ìƒì„± ì•ˆí•´ì„œ ë‚˜ëŠ” ì˜¤ë¥˜.</span></span><br><span class="line">          <span class="keyword">await</span> createQueue(qname);</span><br><span class="line">          <span class="keyword">await</span> sendMessage(qname, message);</span><br><span class="line">          <span class="keyword">return</span> resolve();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> reject(e);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> reject(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ë©”ì„¸ì§€ ìˆ˜ì‹ í•˜ê¸°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>qname í ì´ë¦„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> receiveMessage = <span class="function">(<span class="params">qname</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    rsmq.receiveMessage(&#123; qname &#125;, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err &amp;&amp; err.name === <span class="string">&#x27;queueNotFound&#x27;</span>) <span class="keyword">return</span> resolve(); <span class="comment">// <span class="doctag">NOTE:</span> ì•„ì§ ë“±ë¡ë˜ì§€ ì•Šì€ íë¥¼ ì½ì„ ì‹œ ì˜ˆì™¸ ì²˜ë¦¬</span></span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">      <span class="keyword">if</span> (!err &amp;&amp; result.id) <span class="keyword">return</span> resolve(result);</span><br><span class="line">      <span class="keyword">return</span> resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> sqlì— ë©”ì„¸ì§€ í ë‚´ìš© ì €ì¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>data ë©”ì„¸ì§€ ë‚´ìš©</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> saveLog = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> connection = mysql.createConnection(&#123;</span><br><span class="line">      host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">      user: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">      database: <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">      waitForConnections: <span class="literal">true</span>,</span><br><span class="line">      connectionLimit: <span class="number">20</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> sql = <span class="string">&#x27;INSERT INTO `my_log` (`user_id`, `event`, `create_at`) VALUES (?, ?, ?);&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> values = <span class="built_in">JSON</span>.parse(data.message);</span><br><span class="line">    connection.execute(sql, [values.user_id, values.event, values.create_at], <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      connection.end();</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">      <span class="keyword">return</span> resolve(data.id);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> queue ì‚­ì œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>qname í ì´ë¦„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>id í ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> deleteMessage = <span class="function">(<span class="params">qname, id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    rsmq.deleteMessage(&#123; qname, id &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">      <span class="keyword">return</span> resolve();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ë©”ì„¸ì§€ ì½ì€ í›„ mysqlì— ì €ì¥, ì½ì€ ë©”ì„¸ì§€ ì‚­ì œ.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>qname í ì´ë¦„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> receiveProcess = <span class="function">(<span class="params">qname</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    receiveMessage(qname).then(<span class="keyword">async</span> (data) =&gt; &#123; <span class="comment">// <span class="doctag">NOTE:</span> queueë¥¼ êº¼ë‚´ì„œ ì½ìŒ.</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> id = <span class="keyword">await</span> saveLog(data);</span><br><span class="line">          <span class="keyword">await</span> deleteMessage(qname, id);</span><br><span class="line">          <span class="keyword">return</span> resolve(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> resolve(<span class="literal">false</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">return</span> reject(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> reject(e);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.sendProcess = sendProcess;</span><br><span class="line"><span class="built_in">exports</span>.receiveProcess = receiveProcess;</span><br></pre></td></tr></table></figure><h2 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a>Producer</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> mt = <span class="built_in">require</span>(<span class="string">&#x27;moment-timezone&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> queue = <span class="built_in">require</span>(<span class="string">&#x27;./queue&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123;</span><br><span class="line">  extended: <span class="literal">true</span>,</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;hi&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/send&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> d = mt.tz(<span class="string">&#x27;Asia/Seoul&#x27;</span>); <span class="comment">// ì„œë²„ ì‹œê°„ì€ ì„œìš¸ë¡œ ë§ì¶”ê¸°.</span></span><br><span class="line">  <span class="keyword">let</span> hour = d.hour(); <span class="comment">// 0 ~ 23ì‹œ</span></span><br><span class="line">  <span class="keyword">let</span> min = d.minute() + <span class="number">1</span>; <span class="comment">// 0 ~ 59ë¶„ íëŠ” 1ë¶„ë’¤ì— êº¼ë‚¼êº¼ë¼ ë”í•´ì¤€ë‹¤</span></span><br><span class="line">  <span class="keyword">if</span> (min &gt; <span class="number">59</span>) &#123; <span class="comment">// ì‹œê°„ ì˜ˆì™¸ ì²˜ë¦¬ìš©</span></span><br><span class="line">    min = min === <span class="number">60</span> ? <span class="number">0</span> : min - <span class="number">59</span>;</span><br><span class="line">    hour = hour === <span class="number">23</span> ? <span class="number">0</span> : hour + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> qname = <span class="string">`<span class="subst">$&#123;hour&#125;</span>_<span class="subst">$&#123;min&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">const</span> data = &#123;</span><br><span class="line">    user_id: req.body.user_id,</span><br><span class="line">    event: req.body.event,</span><br><span class="line">    create_at: d.format(<span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>),</span><br><span class="line">  &#125;;</span><br><span class="line">  queue.sendProcess(qname, <span class="built_in">JSON</span>.stringify(data)).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.json(&#123; <span class="attr">result</span>: <span class="string">&#x27;success&#x27;</span> &#125;);</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.json(e);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;server listen&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; CronJob &#125; = <span class="built_in">require</span>(<span class="string">&#x27;cron&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> mt = <span class="built_in">require</span>(<span class="string">&#x27;moment-timezone&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> queue = <span class="built_in">require</span>(<span class="string">&#x27;./queue&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> job = <span class="keyword">new</span> CronJob(<span class="string">&#x27;* * * * *&#x27;</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// <span class="doctag">NOTE:</span> 1ë¶„ë§ˆë‹¤ í™•ì¸.</span></span><br><span class="line">  <span class="keyword">const</span> d = mt.tz(<span class="string">&#x27;Asia/Seoul&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> hour = d.hour();</span><br><span class="line">  <span class="keyword">const</span> min = d.minute();</span><br><span class="line">  <span class="keyword">const</span> qname = <span class="string">`<span class="subst">$&#123;hour&#125;</span>_<span class="subst">$&#123;min&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">const</span> loop = <span class="keyword">async</span> () =&gt; &#123; <span class="comment">// <span class="doctag">NOTE:</span> íì— ë“±ë¡ëœ ë©”ì„¸ì§€ë“¤ì„ ì „ë¶€ ë‹¤ ì½ê¸° ìœ„í•´ ì¬ê·€ë¡œ ì²˜ë¦¬ë¥¼ í•œë‹¤.</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> result = <span class="keyword">await</span> queue.receiveProcess(qname);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;qname&#x27;</span>, qname, <span class="string">&#x27;result&#x27;</span>, result);</span><br><span class="line">      <span class="keyword">if</span> (result) <span class="keyword">return</span> loop();</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  loop();</span><br><span class="line">&#125;, <span class="literal">null</span>, <span class="literal">true</span>, <span class="string">&#x27;Asia/Seoul&#x27;</span>);</span><br><span class="line">job.start();</span><br></pre></td></tr></table></figure><h2 id="í…ŒìŠ¤íŠ¸"><a href="#í…ŒìŠ¤íŠ¸" class="headerlink" title="í…ŒìŠ¤íŠ¸"></a>í…ŒìŠ¤íŠ¸</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> event = [<span class="string">&#x27;join&#x27;</span>, <span class="string">&#x27;login&#x27;</span>, <span class="string">&#x27;purcharse&#x27;</span>, <span class="string">&#x27;logout&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> test = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    request(&#123;</span><br><span class="line">      method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">      uri: <span class="string">&#x27;http://localhost:3000/send&#x27;</span>,</span><br><span class="line">      json: &#123;</span><br><span class="line">        user_id: <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">10000</span>) + <span class="number">1</span>,</span><br><span class="line">        event: event[<span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">3</span>)],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;, <span class="function">(<span class="params">err, res, body</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">      <span class="keyword">return</span> resolve(body);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">400</span>; i += <span class="number">1</span>) &#123;</span><br><span class="line">  params.push(test());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all(params).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;end&#x27;</span>);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://www.npmjs.com/package/rsmq">rsmq</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> MessageQueue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js JSONWEBTOKEN ì‚¬ìš©ë²• ì •ë¦¬</title>
      <link href="/2018/12/04/nodejs-use-jwt/"/>
      <url>/2018/12/04/nodejs-use-jwt/</url>
      
        <content type="html"><![CDATA[<p>ì„¸ì…˜ ë°ì´í„°ë¥¼ tokenìœ¼ë¡œ ë°œê¸‰í•˜ëŠ” í˜•íƒœ.</p><p>ì¥ì ì€ ì„œë²„ê°€ ë¶€ë‹´ì„ ì•ˆ ë°›ëŠ”ë‹¤. ê·¸ëŸ¬ë‚˜ ì—­ì‹œ ë‹¨ì ì€ ì„œë²„ì—ì„œ ì œì–´ê°€ ì•ˆë¨</p><p>í˜ì´ìŠ¤ë¶ì´ë‚˜ ê¸°íƒ€ SNSì˜ access_tokenì´ ì´ëŸ° í˜•íƒœ.</p><p>í…ŒìŠ¤íŠ¸ëŠ” ì‹¬í”Œí•˜ê²Œ í•´ë³¸ë‹¤.</p><ol><li>í´ë¼ì´ì–¸íŠ¸ì—ì„œ sdkë¡œ í˜ì´ìŠ¤ë¶ ì—‘ì„¸ìŠ¤ í† í°, ìœ ì € IDë¥¼ ë°›ì•„ì„œ ì„œë²„ì— ë³´ë‚¸ë‹¤.</li><li>ì„œë²„ì—ì„œëŠ” ë°›ì€ í† í°, IDë¥¼ ê²€ì¦ì„ í•œë‹¤.</li><li>ë ˆë””ìŠ¤ì— ìˆìœ¼ë©´ jwt í† í° + í•´ì„œ ë¦¬í„´, ì—†ìœ¼ë©´ ìœ ì € í”„ë¡œí•„ì„ ì €ì¥ í›„ í† í° + í•´ì„œ ë¦¬í„´</li></ol><h2 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h2><p>jwtëŠ” <a href="https://www.npmjs.com/package/jsonwebtoken">jsonwebtoken</a>ì„ í†µí•´ ì‰½ê²Œ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> secret = <span class="string">&#x27;nyancat (=^ï½¥ï½ªï½¥^=))ï¾‰å½¡â˜†&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> jwt í† í° ìƒì„±</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>ì‚¬ìš© ì•Œê³ ë¦¬ì¦˜ì€ hmac sha256ì´ë¼ê³  í•¨</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>id ë„£ê³ ì‹¶ì€ í•´ì‹œ ê°’, ì§€ê¸ˆì€ ê± ì•„ë””ë¡œ.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> makeToken = <span class="function">(<span class="params">id</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> payload = &#123; id &#125;;</span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    issuer: <span class="string">&#x27;delryn&#x27;</span>, <span class="comment">// ë°œí–‰ì</span></span><br><span class="line">    expiresIn: <span class="string">&#x27;12h&#x27;</span>, <span class="comment">// ë‚ ì§œëŠ” @d ì‹œê°„ì€ @h, ë¶„ì€ @m ê·¸ëƒ¥ ìˆ«ìë§Œ ë„£ìœ¼ë©´ msë‹¨ìœ„</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> jwt.sign(payload, secret, options);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ê²€ì¦ ë¯¸ë“¤ì›¨ì–´</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">req</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">res</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">next</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> verify = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> checksum = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    jwt.verify(req.body.token, secret, <span class="function">(<span class="params">err, decode</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">      <span class="keyword">return</span> resolve(decode);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> checksum.then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">    req.decode = result;</span><br><span class="line">    <span class="keyword">return</span> next();</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err.message);</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">401</span>).send(<span class="string">&#x27;jwt verify fail&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.makeToken = makeToken;</span><br><span class="line"><span class="built_in">exports</span>.verify = verify;</span><br></pre></td></tr></table></figure><p>payloadì—ëŠ” ì‰½ê²Œ ë§í•´ ì„¸ì…˜ì— ë‹´ì„ êº¼ ë„£ì–´ì£¼ë©´ ë¨.</p><p>optionì—ëŠ” issuer, expiresIn ì´ì™¸ì—ë„ ë„£ì„ ìˆ˜ ì‡ëŠ” ê·œì¹™ì´ ì‡ëŠ”ë° ì´ê±´ ê³µí™ˆì— ã„±</p><p>signì„ í†µí•´ ì¼ì¢…ì˜ hash ê°’ì´ ìƒê¸´ë‹¤.</p><p>verifyëŠ” ë¯¸ë“¤ì›¨ì–´ë¡œ ì‘ì„±ì„ í•œê±´ë° ê¸°íƒ€ ë‹¤ë¥¸ APIë¥¼ ìš”ì²­ì˜¬ ë•Œ í† í°ì„ ì½ì–´ì„œ ë³µí˜¸í™” í›„</p><p>ìœ ì € ì„¸ì…˜ì„ ë³´ëŠ” ìš©ë„.</p><p>í•œ ê°€ì§€ ì•Œì•„ë‘ì–´ì•¼ í•  ì ì€ ë§Œë£Œëœ í† í°ì˜ ê²½ìš°ë„ ì—ëŸ¬ë¡œ ë°›ëŠ”ë‹¤. ì ì ˆí•˜ê²Œ ì˜ˆì™¸ ì²˜ë¦¬ ìš”ë§.</p><h2 id="í˜ì´ìŠ¤ë¶"><a href="#í˜ì´ìŠ¤ë¶" class="headerlink" title="í˜ì´ìŠ¤ë¶"></a>í˜ì´ìŠ¤ë¶</h2><p>í´ë¼ì´ì–¸íŠ¸ëŠ” ê·€ì°¬ì•„ì„œ íŒ¨ìŠ¤</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;./jwt&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> redisClient = redis.createClient();</span><br><span class="line"><span class="keyword">const</span> FACEBOOK_URL = <span class="string">&#x27;https://graph.facebook.com/v3.2/&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; FACEBOOK_APP_TOKEN &#125; = process.env;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ì—‘ì„¸ìŠ¤ í† í° ê²€ì¦ ì²´í¬</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>userId í˜ì´ìŠ¤ë¶ì—ì„œ ë°œê¸‰í•œ ìœ ì € ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>accessToken í˜ì´ìŠ¤ë¶ì—ì„œ ë°œê¸‰í•œ ì—‘ì„¸ìŠ¤ í† í°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> accessTokenVerify = <span class="function">(<span class="params">userId, accessToken</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> requestURL = <span class="string">`<span class="subst">$&#123;FACEBOOK_URL&#125;</span>debug_token?input_token=<span class="subst">$&#123;accessToken&#125;</span>&amp;access_token=<span class="subst">$&#123;FACEBOOK_APP_TOKEN&#125;</span>`</span>;</span><br><span class="line">  axios.get(requestURL).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> body = response.data;</span><br><span class="line">    <span class="keyword">if</span> (body.data.is_valid &amp;&amp; body.data.user_id === userId) <span class="keyword">return</span> resolve();</span><br><span class="line">    <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;facebook verify fail&#x27;</span>));</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> reject(err));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> í˜ì´ìŠ¤ë¶ ìœ ì € í”„ë¡œí•„ ê°€ì§€ê³  ì˜¤ê¸°.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>accessToken í˜ì´ìŠ¤ë¶ì—ì„œ ë°œê¸‰í•œ ì—‘ì„¸ìŠ¤ í† í°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getFaceebookProfile = <span class="function">(<span class="params">accessToken</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> requestUrl = <span class="string">`<span class="subst">$&#123;FACEBOOK_URL&#125;</span>me?fields=id,name,picture&amp;access_token=<span class="subst">$&#123;accessToken&#125;</span>`</span>;</span><br><span class="line">  axios.get(requestUrl).then(<span class="function">(<span class="params">response</span>) =&gt;</span> resolve(response.data)).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> reject(err));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> redisì— ìœ ì € ë°ì´í„° ì €ì¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>userId í˜ì´ìŠ¤ë¶ì—ì„œ ë°œê¸‰í•œ ìœ ì € ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>userData ìœ ì € í˜ì´ìŠ¤ë¶ í”„ë¡œí•„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> setUser = <span class="function">(<span class="params">userId, userData</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  redisClient.hset(<span class="string">&#x27;profile&#x27;</span>, userId, <span class="built_in">JSON</span>.stringify(userData), <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">    <span class="keyword">return</span> resolve();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> redisì— ì €ì¥ëœ ìœ ì € í”„ë¡œí•„ ê°€ì§€ê³  ì˜¤ê¸°.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>userId í˜ì´ìŠ¤ë¶ì—ì„œ ë°œê¸‰í•œ ìœ ì € ID</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> getUser = <span class="function">(<span class="params">userId</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  redisClient.hget(<span class="string">&#x27;profile&#x27;</span>, userId, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">    <span class="keyword">if</span> (!data) <span class="keyword">return</span> resolve();</span><br><span class="line">    <span class="keyword">return</span> resolve(<span class="built_in">JSON</span>.parse(data));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ë¡œê·¸ì¸ ì²˜ë¦¬ í›„ JWT í† í° ë°œê¸‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>userId í˜ì´ìŠ¤ë¶ì—ì„œ ë°œê¸‰í•œ ìœ ì € ID</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>accessToken í˜ì´ìŠ¤ë¶ì—ì„œ ë°œê¸‰í•œ ì—‘ì„¸ìŠ¤ í† í°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> login = <span class="function">(<span class="params">userId, accessToken</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  accessTokenVerify(userId, accessToken).then(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> userData = <span class="keyword">await</span> getUser(userId);</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> userData !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line">        userData.token = jwt.makeToken(userId);</span><br><span class="line">        <span class="keyword">return</span> resolve(userData);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> facebookProfile = <span class="keyword">await</span> getFaceebookProfile(accessToken);</span><br><span class="line">      <span class="keyword">await</span> setUser(userId, facebookProfile);</span><br><span class="line">      facebookProfile.token = jwt.makeToken(userId);</span><br><span class="line">      <span class="keyword">return</span> resolve(facebookProfile);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> reject(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> reject(err));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = login;</span><br></pre></td></tr></table></figure><h3 id="í˜ì´ìŠ¤ë¶-API-ì‘ë‹µ"><a href="#í˜ì´ìŠ¤ë¶-API-ì‘ë‹µ" class="headerlink" title="í˜ì´ìŠ¤ë¶ API ì‘ë‹µ"></a>í˜ì´ìŠ¤ë¶ API ì‘ë‹µ</h3><p>í˜ì´ìŠ¤ë¶ APIì˜ ì‘ë‹µë„ ì •ë¦¬ í•´ë†“ëŠ”ë‹¤.</p><h3 id="ì—‘ì„¸ìŠ¤-í† í°ì´-ë§Œë£Œ-ëœ-ê²½ìš°"><a href="#ì—‘ì„¸ìŠ¤-í† í°ì´-ë§Œë£Œ-ëœ-ê²½ìš°" class="headerlink" title="ì—‘ì„¸ìŠ¤ í† í°ì´ ë§Œë£Œ ëœ ê²½ìš°"></a>ì—‘ì„¸ìŠ¤ í† í°ì´ ë§Œë£Œ ëœ ê²½ìš°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">data</span>:</span><br><span class="line">   &#123; <span class="attr">app_id</span>: <span class="string">&#x27;ë‚´ í˜ë¶ ì•± ì•„ì´ë””&#x27;</span>,</span><br><span class="line">     type: <span class="string">&#x27;USER&#x27;</span>,</span><br><span class="line">     application: <span class="string">&#x27;ë‚´ í˜ë¶ ì•± ì´ë¦„&#x27;</span>,</span><br><span class="line">     data_access_expires_at: <span class="number">1551621795</span>,</span><br><span class="line">     error:</span><br><span class="line">      &#123; <span class="attr">code</span>: <span class="number">190</span>,</span><br><span class="line">        message: <span class="string">&#x27;Error validating access token: Session has expired on Monday, 03-Dec-1808:00:00 PST. The current time is Tuesday, 04-Dec-18 06:17:26 PST.&#x27;</span>,</span><br><span class="line">        subcode: <span class="number">463</span> &#125;,</span><br><span class="line">     expires_at: <span class="number">1543852800</span>,</span><br><span class="line">     is_valid: <span class="literal">false</span>,</span><br><span class="line">     scopes: [ <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;public_profile&#x27;</span> ],</span><br><span class="line">     user_id: <span class="string">&#x27;ì´ ì•±ì˜ ë‚´ ìœ ì € ID&#x27;</span> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ì—‘ì„¸ìŠ¤-í† í°-ì •ìƒì¸-ê²½ìš°"><a href="#ì—‘ì„¸ìŠ¤-í† í°-ì •ìƒì¸-ê²½ìš°" class="headerlink" title="ì—‘ì„¸ìŠ¤ í† í° ì •ìƒì¸ ê²½ìš°"></a>ì—‘ì„¸ìŠ¤ í† í° ì •ìƒì¸ ê²½ìš°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">data</span>:</span><br><span class="line">   &#123; <span class="attr">app_id</span>: <span class="string">&#x27;ë‚´ í˜ë¶ ì•± ì•„ì´ë””&#x27;</span>,</span><br><span class="line">     type: <span class="string">&#x27;USER&#x27;</span>,</span><br><span class="line">     application: <span class="string">&#x27;ë‚´ íŒ¨ë¶ ì•± ì´ë¦„&#x27;</span>,</span><br><span class="line">     data_access_expires_at: <span class="number">1551621795</span>,</span><br><span class="line">     expires_at: <span class="number">1543939200</span>,</span><br><span class="line">     is_valid: <span class="literal">true</span>,</span><br><span class="line">     scopes: [ <span class="string">&#x27;email&#x27;</span>, <span class="string">&#x27;public_profile&#x27;</span> ],</span><br><span class="line">     user_id: <span class="string">&#x27;ì´ ì•±ì˜ ë‚´ ìœ ì € ID&#x27;</span> &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="í”„ë¡œí•„"><a href="#í”„ë¡œí•„" class="headerlink" title="í”„ë¡œí•„"></a>í”„ë¡œí•„</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attr">id</span>: <span class="string">&#x27;ì´ ì•±ì˜ ë‚´ ìœ ì € ID&#x27;</span>,</span><br><span class="line">  name: <span class="string">&#x27;ë‚´ ì´ë¦„&#x27;</span>,</span><br><span class="line">  picture:</span><br><span class="line">   &#123; <span class="attr">data</span>:</span><br><span class="line">      &#123; <span class="attr">height</span>: <span class="number">50</span>,</span><br><span class="line">        is_silhouette: <span class="literal">false</span>,</span><br><span class="line">        url: <span class="string">&#x27;ë‚´ í”„ë¡œí•„ ì‚¬ì§„ url&#x27;</span>,</span><br><span class="line">        width: <span class="number">50</span> &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Auth </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js crypto ëª¨ë“ˆ ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2018/11/11/nodejs-crypto/"/>
      <url>/2018/11/11/nodejs-crypto/</url>
      
        <content type="html"><![CDATA[<h2 id="sha512"><a href="#sha512" class="headerlink" title="sha512"></a>sha512</h2><p>ì£¼ë¡œ ìœ ì € ë¹„ë°€ë²ˆí˜¸ ì €ì¥í•  ë–„ ì‚¬ìš©, ë‹¨ë°©í–¥ì´ë¼ì„œ ë³µí˜¸í™”ë¥¼ í•  ìˆ˜ ì—…ìŒ.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> key = <span class="string">&#x27;delryn&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> sha512 í•´ì‹± ì•Œê³ ë¦¬ì¦˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>ë‹¨ë°©í–¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>text ì•”í˜¸í™”í•  í‰ë¬¸.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> sha512 = <span class="function">(<span class="params">text</span>) =&gt;</span> crypto.createHash(<span class="string">&#x27;sha512&#x27;</span>).update(key + text).digest(<span class="string">&#x27;base64&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="hmac"><a href="#hmac" class="headerlink" title="hmac"></a>hmac</h2><p>ì£¼ë¡œ ì›¹ api í†µì‹ í•  ë•Œ ì‚¬ìš©ì ê²€ì¦ìœ¼ë¡œ ì‚¬ìš©, ë³µí˜¸í™” ë¶ˆê°€</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> key = <span class="string">&#x27;delryn&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> hmac í•´ì‹± ì•Œê³ ë¦¬ì¦˜</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>ë‹¨ë°©í–¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>text ì•”í˜¸í™”í•  í‰ë¬¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> hmac = <span class="function">(<span class="params">text</span>) =&gt;</span> crypto.createHmac(<span class="string">&#x27;sha256&#x27;</span>, key).update(text).digest(<span class="string">&#x27;hex&#x27;</span>);</span><br></pre></td></tr></table></figure><h2 id="aes256"><a href="#aes256" class="headerlink" title="aes256"></a>aes256</h2><p>ì›¹ api í†µì‹ ì—ì„œ ì•”í˜¸í™”í•˜ì—¬ ì „ì†¡ -&gt; ë°›ëŠ” ìª½ì€ ë³µí˜¸í™”í•´ì„œ ì‚¬ìš©</p><p>ì„œë¡œ í‚¤ê°€ ë‹¬ë¼ì§€ë©´ ì•ˆë¨, í‚¤ì˜ ê¸¸ì´ ì¡°ê±´ë³´ë‹¤ ë‚®ìœ¼ë©´ ë¶ˆê°€í•¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> aes256 key ë§Œë“¤ê¸° 16byte</span></span><br><span class="line"><span class="keyword">const</span> makeAes256Key = crypto.randomBytes(<span class="number">16</span>).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> aes256 iv ë§Œë“¤ê¸° 8byte</span></span><br><span class="line"><span class="keyword">const</span> makeIv = crypto.randomBytes(<span class="number">8</span>).toString(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> AES 256 ì•”í˜¸í™”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>ì–‘ë°©í–¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>aesKey aes256 key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>aesIv aes256 IV</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>text ì•”í˜¸í™”í•  í‰ë¬¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> aes256Encrypt = <span class="function">(<span class="params">aesKey, aesIv, text</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> cipher = crypto.createCipheriv(<span class="string">&#x27;aes-256-cbc&#x27;</span>, aesKey, aesIv);</span><br><span class="line">    <span class="keyword">let</span> result = cipher.update(text, <span class="string">&#x27;utf8&#x27;</span>, <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">    result += cipher.final(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">return</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> AES 256 ë³µí˜¸í™”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>ì–‘ë°©í–¥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>aesKey aes256 key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>aesIv aes256 IV</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>cryptogram ì•”í˜¸ë¬¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> aes256Decrypt = <span class="function">(<span class="params">aesKey, aesIv, cryptogram</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> decipher = crypto.createDecipheriv(<span class="string">&#x27;aes-256-cbc&#x27;</span>, aesKey, aesIv);</span><br><span class="line">    <span class="keyword">let</span> result = decipher.update(cryptogram, <span class="string">&#x27;base64&#x27;</span>, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">    result += decipher.final(<span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="keyword">return</span> error;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS S3ì— ì—…ë¡œë“œ í•´ë³´ê¸°</title>
      <link href="/2018/10/03/nodejs-s3-upload/"/>
      <url>/2018/10/03/nodejs-s3-upload/</url>
      
        <content type="html"><![CDATA[<h2 id="s3-ë²„ì¼“-ìƒì„±"><a href="#s3-ë²„ì¼“-ìƒì„±" class="headerlink" title="s3 ë²„ì¼“ ìƒì„±"></a>s3 ë²„ì¼“ ìƒì„±</h2><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013185/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.58.02_d4xeun.png" alt="s3 ìƒì„±"></p><h2 id="s3-ì„¤ì •"><a href="#s3-ì„¤ì •" class="headerlink" title="s3 ì„¤ì •"></a>s3 ì„¤ì •</h2><p>IAM keyë¡œ í•˜ë ¤ë©´ ì„¤ì •ì„ ì¢€ í•´ì•¼ í•œë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013186/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.38.15_skc7zy.png" alt="ì„¤ì •"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013185/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.35.56_trmkje.png" alt="ë²„í‚·ì •ì±…"></p><p>ARN: ì´í›„ ë‚´ìš©ì„ ë³µì‚¬ í•œë‹¤ìŒì— ì •ì±… ìƒì„±ê¸°ë¥¼ ëˆ„ë¥¸ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013185/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.35.47_pbx5gw.png" alt="ì •ì±… ìƒì„±ê¸°"></p><p>ì„œë¹„ìŠ¤ëŠ” ë‹¹ì—°íˆ s3ì´ê³  ì•¡ì…˜ì€ getObjectë§Œ í•œë‹¤ (ì½ê¸°ë§Œ ê°€ëŠ¥)</p><p>ê·¸ë¦¬ê³  ì•„ê¹Œ ë³µì‚¬í•´ë‘” ARNë‚´ìš©ì„ ê¸°ì…í›„ Add Stagement ë…¸ë€ ë°•ìŠ¤ë¥¼ ëˆŒëŸ¬ ì¤€ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013885/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.31.04_zufxpf.png" alt="ì •ì±… ìƒì„±ê¸° - 2"></p><p>Generate Policy ë²„íŠ¼ì„ í´ë¦­</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013186/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.36.40_mtijxz.png" alt="ì •ì±… ìƒì„± ê²°ê³¼"></p><p>ë³µì‚¬ í•´ì„œ s3 ë²„í‚· ì •ì±… í¸ì§‘ê¸°ì— ë¶™ì—¬ë„£ê¸° í•˜ë©´ ëœë‹¤.</p><p>ë¶™ì—¬ë„£ê¸° í•˜ê³  ë‚˜ì„œ ê¼­ Resource ë’¤ì— /*ë¥¼ ë¶™ì—¬ì¤€ë‹¤. ì €ì¥ í•˜ë©´ ì„¤ì • ë</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013186/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.36.56_ru084c.png" alt="ì •ì±… ìƒì„± ê²°ê³¼ - 2"></p><h2 id="json-ì—…ë¡œë“œ"><a href="#json-ì—…ë¡œë“œ" class="headerlink" title="json ì—…ë¡œë“œ"></a>json ì—…ë¡œë“œ</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">    region: <span class="string">&#x27;&#x27;</span>, <span class="comment">// ì„œìš¸ ë¦¬ì „</span></span><br><span class="line">    accessKeyId: <span class="string">&#x27;&#x27;</span>, <span class="comment">// IAM</span></span><br><span class="line">    secretAccessKey:<span class="string">&#x27;&#x27;</span> <span class="comment">// IAM</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s3 = <span class="keyword">new</span> AWS.S3();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DATA = &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    title: <span class="string">&#x27;ë˜ì „ì—ì„œ ë§Œë‚¨ì„ ì¶”êµ¬í•˜ë©´ ì•ˆë ê¹Œ 2ê¸°&#x27;</span>,</span><br><span class="line">    body: &#123;</span><br><span class="line">        start: <span class="string">&#x27;2019ë…„ 3ë¶„ê¸°&#x27;</span>,</span><br><span class="line">        develop: <span class="string">&#x27;J.C.STAFF&#x27;</span>,</span><br><span class="line">        broadcast: <span class="string">&#x27;ë„ì¿„ MX&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">    Bucket: <span class="string">&#x27;delryn-upload-test&#x27;</span>, <span class="comment">// ë²„ì¼“ ì´ë¦„</span></span><br><span class="line">    Key: <span class="string">&#x27;test.json&#x27;</span>, <span class="comment">// íŒŒì¼ëª… í™•ì¥ìë„ í•„ìš”í•¨.</span></span><br><span class="line">    ACL: <span class="string">&#x27;public-read&#x27;</span>, <span class="comment">// ì•¡ì„¸ìŠ¤ ì œì–´ ëª©ë¡ ì½ê¸° ê¶Œí•œë§Œ.</span></span><br><span class="line">    Body: <span class="built_in">JSON</span>.stringify(DATA), <span class="comment">// ë³´ë‚¼ ë°ì´í„°</span></span><br><span class="line">    ContentType: <span class="string">&quot;application/json&quot;</span> <span class="comment">// ì»¨í…ì¸  íƒ€ì…</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">s3.putObject(params, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;success&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563014938/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.48.35_ega16r.png" alt="ê²°ê³¼"></p><p>ì‹¤í–‰í•˜ë©´ ì˜ ì˜¬ë¼ê°.</p><h2 id="ì´ë¯¸ì§€-ì˜¬ë¦¬ê¸°"><a href="#ì´ë¯¸ì§€-ì˜¬ë¦¬ê¸°" class="headerlink" title="ì´ë¯¸ì§€ ì˜¬ë¦¬ê¸°"></a>ì´ë¯¸ì§€ ì˜¬ë¦¬ê¸°</h2><p>ê°„ë‹¨í•˜ê²Œ <a href="https://www.npmjs.com/package/multer">multer</a>, <a href="https://www.npmjs.com/package/multer-s3">multer-s3</a>ë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤.</p><h3 id="html"><a href="#html" class="headerlink" title="html"></a>html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/form-upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;upload1&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ì „ì†¡&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="ì—…ë¡œë“œ-ì½”ë“œ"><a href="#ì—…ë¡œë“œ-ì½”ë“œ" class="headerlink" title="ì—…ë¡œë“œ ì½”ë“œ"></a>ì—…ë¡œë“œ ì½”ë“œ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multerS3 = <span class="built_in">require</span>(<span class="string">&#x27;multer-s3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">    region: <span class="string">&#x27;&#x27;</span>, <span class="comment">// s3 ë¦¬ì „</span></span><br><span class="line">    accessKeyId: <span class="string">&#x27;&#x27;</span>, <span class="comment">// IAM</span></span><br><span class="line">    secretAccessKey: <span class="string">&#x27;&#x27;</span> <span class="comment">// IAM</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s3 = <span class="keyword">new</span> AWS.S3();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.sendFile(__dirname + <span class="string">&#x27;/index.html&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> upload = multer(&#123;</span><br><span class="line">    storage: multerS3(&#123;</span><br><span class="line">        s3: s3,</span><br><span class="line">        bucket: <span class="string">&#x27;delryn-upload-test&#x27;</span>, <span class="comment">// ë²„í‚· ì´ë¦„</span></span><br><span class="line">        metadata: <span class="function"><span class="keyword">function</span> (<span class="params">req, file, cb</span>) </span>&#123; <span class="comment">// ë©”íƒ€ë°ì´í„° ì„¤ì •, ì´ê±° ë”±íˆ ì•ˆ ì“°ëŠ”ë°.. ë¬´ì‹œ..</span></span><br><span class="line">            <span class="comment">// console.log(&#x27;file&#x27;, file)</span></span><br><span class="line">            cb(<span class="literal">null</span>, &#123; <span class="attr">fieldName</span>: file.fieldname &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        key: <span class="function"><span class="keyword">function</span> (<span class="params">req, file, cb</span>) </span>&#123; <span class="comment">// íŒŒì¼ ì´ë¦„. í™•ì¥ìë¥¼ ì—­ì‹œ ë¶™ì—¬ì¤˜ì•¼ í•œë‹¤.</span></span><br><span class="line">            <span class="comment">// ì—…ë¡œë“œí•  ë–„ íŒŒì¼ëª…ì´ ê²¹ì¹˜ë©´ ë®ì–´ì“°ê¸° ë•œì— ë°”ê¿”ì¤˜ì•¼ í•¨.</span></span><br><span class="line">            <span class="comment">// ì›ë³¸ íŒŒì¼ëª…ì„ ì•Œê³  ì‹¶ìœ¼ë©´ req.fileì„ ì°ìœ¼ë©´ ë‚˜ì˜´.</span></span><br><span class="line">            <span class="keyword">let</span> extension = file.mimetype.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">            cb(<span class="literal">null</span>, <span class="string">`<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>.<span class="subst">$&#123;extension&#125;</span>`</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        ACL: <span class="string">&#x27;public-read&#x27;</span>, <span class="comment">// ëª¨ë‘ ì½ê¸°</span></span><br><span class="line">        contentType: multerS3.AUTO_CONTENT_TYPE <span class="comment">// ì»¨í…ì¸  íƒ€ì…ì€ ìë™ ì™„ì„± API ì“°ì.</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/form-upload&#x27;</span>, upload.single(<span class="string">&#x27;upload1&#x27;</span>), <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;upload success&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`server listening on port <span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563015864/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.03.13_h6tgcn.png" alt="ì‹¤í–‰ ê²°ê³¼"></p><p>í…ŒìŠ¤íŠ¸ í•´ë³´ë©´ ì˜ ì˜¬ë¼ê°„ë‹¤.</p>]]></content>
      
      
      
        <tags>
            
            <tag> AWS </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vscodeì—ì„œ eslint, eslint-airbnb-base ì ìš©í•˜ëŠ” ë²•</title>
      <link href="/2018/08/17/etc-vscode-use-eslint/"/>
      <url>/2018/08/17/etc-vscode-use-eslint/</url>
      
        <content type="html"><![CDATA[<h2 id="lintë¥¼-ì‚¬ìš©í•˜ëŠ”-ì´ìœ "><a href="#lintë¥¼-ì‚¬ìš©í•˜ëŠ”-ì´ìœ " class="headerlink" title="lintë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ "></a>lintë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ </h2><p>eslintëŠ” ECMAScript ë˜ëŠ” JavaScriptì˜ ì½”ë“œ ì¼ê´€ì„±(ì‚¬ëŒë§ˆë‹¤ ì§œëŠ” ìŠ¤íƒ€ì¼ì´ ë‹¤ë¦„)ì„ ìœ ì§€í•˜ê³  ë²„ê·¸ë¥¼ í”¼í•˜ê¸° ìœ„í•œ ë„êµ¬ë¼ê³  ê³µí™ˆì—ì„œ ì„¤ëª…í•´ì¤€ë‹¤.</p><h2 id="eslint-ì„¤ì¹˜"><a href="#eslint-ì„¤ì¹˜" class="headerlink" title="eslint ì„¤ì¹˜"></a>eslint ì„¤ì¹˜</h2><p>vscodeì˜ extensionì—ì„œ eslintë¥¼ ê²€ìƒ‰ í›„ ì„¤ì¹˜ë¥¼ í•œë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1558862348/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-05-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.07.58_io7xml.png" alt="vscode extension"></p><p>ì‚¬ìš©í•  í”„ë¡œì íŠ¸ í´ë”ì— eslintë¥¼ ì„¤ì¹˜ë¥¼ ê°œë°œ ì˜ì¡´ì„±ìœ¼ë¡œ ì„¤ì¹˜ë¥¼ í•˜ì (ë¼ì´ë¸Œì—ì„  í•„ìš” ì—…ìœ¼ë‹ˆ).</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add eslint --dev</span><br></pre></td></tr></table></figure><p>mac ê¸°ì¤€ìœ¼ë¡œ cmd + shift + pë¥¼ ëˆ„ë¥´ë©´ í•´ë‹¹ í”„ë¡œì íŠ¸ í´ë”ì— lint initì„ í¸í•˜ê²Œ í•  ìˆ˜ ì‡ë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1566023233/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-17_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.26.55_gjx4to.png" alt="lint create"></p><p>ê·¸ëŸ¼ ì´ì œ ì„¤ì • ì°½ì´ í„°ë¯¸ë„ì— ë‚˜ì˜¬í…ë° ë³¸ì¸ì˜ ìŠ¤íƒ€ì¼ëŒ€ë¡œ ë§Œë“ ë‹¤. ì•„ë˜ëŠ” ë‚´ê°€ ì“°ëŠ” ì„¤ì • ìŠ¤íƒ€ì¼.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1558862663/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-05-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.15.11_jqdfkt.png" alt="create-1"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1558862810/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-05-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.15.39_dezlae.png" alt="create-2"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1558862831/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-05-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.15.53_lohwsl.png" alt="create-3"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1558862988/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-05-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.16.08_hsnqun.png" alt="create-4"></p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1558863044/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-05-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.16.25_w9vqho.png" alt="create-5"></p><p>ë‹¤ ì…ë ¥í•˜ë©´ í´ë”ì— .eslintrc.jsonì´ ìƒê¸´ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1558863101/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-05-26_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_6.31.26_t3rajg.png" alt="lintrc"></p><h2 id="airbnb-í”ŒëŸ¬ê·¸ì¸-ì„¤ì¹˜"><a href="#airbnb-í”ŒëŸ¬ê·¸ì¸-ì„¤ì¹˜" class="headerlink" title="airbnb í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜"></a>airbnb í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜</h2><p>ì½”ë”© ìŠ¤íƒ€ì¼ì„ ì¢€ ë°”ê¾¸ê³  ì‹¶ì–´ì„œ ì°¾ì•„ë³´ë˜ ì¤‘ì— <a href="https://github.com/airbnb/javascript">airbnb javascript guide</a>ë¼ëŠ” ê¸€ì„ ë³´ê³  ì˜¤ ì—ì–´ë¹„ì•¤ë¹„ í”„ë¡œê·¸ë˜ë¨¸ë“¤ì˜ ìŠ¤íƒ€ì¼ì— ê°íƒ„ í•˜ë©° ì œê³µí•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€ë¡œ ì„¤ì¹˜ë¥¼ í–‡ë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add eslint-config-airbnb-base eslint-plugin-import --dev</span><br></pre></td></tr></table></figure><p>ì„¤ì¹˜ê°€ ë‹¤ ë˜ì—‡ìœ¼ë©´ .eslintrc.jsonì—ì„œ extendsë¥¼ airbnb-baseë¡œ ë°”ê¿”ì£¼ë©´ ëœë‹¤.</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;env&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;commonjs&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;es6&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;node&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;extends&quot;</span>: <span class="string">&quot;airbnb-base&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;globals&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;Atomics&quot;</span>: <span class="string">&quot;readonly&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;SharedArrayBuffer&quot;</span>: <span class="string">&quot;readonly&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;parserOptions&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;ecmaVersion&quot;</span>: <span class="number">2018</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;rules&quot;</span>: &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ëŸ° í”ŒëŸ¬ê·¸ì¸ì€ airbnb ë§ê³ ë„ <a href="https://www.npmjs.com/package/eslint-config-google">google</a>, <a href="https://www.npmjs.com/package/eslint-config-naver">naver</a> ë“± ì—¬ëŸ¬ íšŒì‚¬ë“¤ì´ ê³µê°œë¥¼ í–‡ìœ¼ë¯€ë¡œ ë³¸ì¸ ì·¨í–¥ì— ë§ê²Œ ì“°ë©´ ëœë‹¤.</p>]]></content>
      
      
      
        <tags>
            
            <tag> ETC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Promise, Async/Await ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2018/08/06/nodejs-promise/"/>
      <url>/2018/08/06/nodejs-promise/</url>
      
        <content type="html"><![CDATA[<h2 id="ê¸°ë³¸-ì‚¬ìš©ë²•"><a href="#ê¸°ë³¸-ì‚¬ìš©ë²•" class="headerlink" title="ê¸°ë³¸ ì‚¬ìš©ë²•"></a>ê¸°ë³¸ ì‚¬ìš©ë²•</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="function">(<span class="params">_param</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (_param &lt; <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;10ë³´ë‹¤ ì‘ë‹¤&#x27;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> resolve(<span class="string">&#x27;10ë³´ë‹¤ í¬ë‹¤.&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">a(<span class="number">10</span>).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;result&#x27;</span>, result);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, e);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ê°€ ë˜ì—‡ì„ ë• resolve()ì—, ì—ëŸ¬ ë“± ì²˜ë¦¬ëŠ” reject()ë¡œ ë„˜ê¸°ë©´ ëœë‹¤.</p><p>ê¸°ì¡´ ì½œë°± ë°©ì‹ë³´ë‹¤ ì½”ë“œ ì½ê¸°ë„ í¸í•˜ê³ , ì—ëŸ¬ ì²˜ë¦¬ë„ í¸í•´ì„œ ê¹”ë”í•˜ë‹¤ê³  ëŠë‚€ë‹¤.</p><h2 id="ìˆœì°¨ì ì¸-ì²˜ë¦¬-ë°©ë²•"><a href="#ìˆœì°¨ì ì¸-ì²˜ë¦¬-ë°©ë²•" class="headerlink" title="ìˆœì°¨ì ì¸ ì²˜ë¦¬ ë°©ë²•."></a>ìˆœì°¨ì ì¸ ì²˜ë¦¬ ë°©ë²•.</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="function">(<span class="params">_param</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(_param);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="function">(<span class="params">_param</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(_param + <span class="number">10</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="function">(<span class="params">_param</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(_param + <span class="number">100</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì´ëŸ° í•¨ìˆ˜ê°€ ì‡ì„ ë•Œ í˜¸ì¶œí•˜ëŠ” ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬ë¥¼ í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì“°ë©´ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a(<span class="number">1</span>).then(<span class="function">(<span class="params">A</span>) =&gt;</span> b(A).then(<span class="function">(<span class="params">B</span>) =&gt;</span> c(B).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;result&#x27;</span>, result);</span><br><span class="line">&#125;)));</span><br></pre></td></tr></table></figure><p>ì§€ê¸ˆì´ì•¼ ëª‡ê°œ ì—…ì§€ë§Œì„œë„ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜ê°€ ë” ì¶”ê°€ ë˜ë©´ ì½”ë“œ ì½ê¸°ê°€ ë¶ˆí¸í•  êº¼ ê°™ë‹¤.</p><p>ì´ëŸ° ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ async/awaitë¥¼ ì‚¬ìš© í•˜ë©´ ì¢€ ë” ê°„ë‹¨í•˜ê²Œ ì‘ì„± í•  ìˆ˜ ì‡ë‹¤.</p><p>ìœ„ì™€ ë™ì¼í•œ ì½”ë“œì´ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a(<span class="number">10</span>).then(<span class="keyword">async</span> (A) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> B = <span class="keyword">await</span> b(A);</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> c(B);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;result&#x27;</span>, result);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;e&#x27;</span>, e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ìµœìƒë‹¨ì— asyncë€ í‚¤ì›Œë“œê°€ ì‡ì–´ì•¼ awaitë¥¼ ì‚¬ìš©í•  ìˆ˜ ì‡ë‹¤. ê¸°ì¡´ì˜ .then(), .catch()ê°€ ì—…ì–´ì§€ê³ </p><p>ë³€ìˆ˜ì— ê° ìƒí™©ì— ë”°ë¼ í• ë‹¹ì´ ë˜ë¯€ë¡œ try / catch êµ¬ë¬¸ìœ¼ë¡œ ì²˜ë¦¬ë¥¼ í•´ì•¼ í•œë‹¤. í˜„ì¬ ì˜ˆì—ì„œëŠ” ì—ëŸ¬ê°€ ë°œìƒí•  ì¼ì€ ì—…ê²Ÿì§€ë§Œ..</p><h2 id="ë³‘ë ¬-ì²˜ë¦¬"><a href="#ë³‘ë ¬-ì²˜ë¦¬" class="headerlink" title="ë³‘ë ¬ ì²˜ë¦¬"></a>ë³‘ë ¬ ì²˜ë¦¬</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">10</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">100</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="number">1000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([a(), b(), c()]).then(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;results - 1&#x27;</span>, results);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> x = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> results = <span class="keyword">await</span> <span class="built_in">Promise</span>.all([a(), b(), c()]);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;results - 2&#x27;</span>, results);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">x();</span><br></pre></td></tr></table></figure><p>Promise.all()ì„ ì‚¬ìš© í•˜ë©´ ëœë‹¤. ê²°ê³¼ëŠ” ë°°ì—´ë¡œ ë°›ê²Œ ëœë‹¤.</p><p>ë§ˆì°¬ê°€ì§€ë¡œ ìƒìœ„ í•¨ìˆ˜ì— asyncê°€ ë¶™ì–´ì•¼ awaitë¡œ í•¨ìˆ˜ë¥¼ ì‹¤í–‰ í•  ìˆ˜ ì‡ë‹¤.</p><h3 id="race"><a href="#race" class="headerlink" title="race"></a>race</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> random = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">3</span>) + <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;a&#x27;</span>, <span class="number">10</span>);</span><br><span class="line">    resolve(<span class="number">10</span>);</span><br><span class="line">  &#125;, random);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> random = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">3</span>) + <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;b&#x27;</span>, <span class="number">100</span>);</span><br><span class="line">    resolve(<span class="number">100</span>);</span><br><span class="line">  &#125;, random);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([a(), b()]).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;result - 1&#x27;</span>, result);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> x = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> <span class="built_in">Promise</span>.race([a(), b()]);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;result - 2&#x27;</span>, result);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;e&#x27;</span>, e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">x();</span><br></pre></td></tr></table></figure><p>ì´ ê¸°ëŠ¥ì€ ì¢€ ì‹ ê¸°í–‡ëŠ”ë° ì•„ì§ ì¼í•˜ë©´ì„œ ì¨ë³´ì§„ ì•Šì•—ë‹¤.</p><p>ì–´ë– í•œê±°ëƒë©´ allì²˜ëŸ¼ ë™ì‹œì— ì‹¤í–‰ì„ í•˜ëŠ”ë° ë¨¼ì € ì²˜ë¦¬ëœ í•¨ìˆ˜ì˜ ê²°ê³¼ê°€ ë„˜ì–´ ì˜¨ë‹¤. ê·¸ë ‡ë‹¤ê³  ë‚˜ë¨¸ì§€ í•¨ìˆ˜ê°€ ì‹¤í–‰ì´ ì•ˆë˜ëŠ” ê±´ ì•„ë‹ˆë‹¤. ì•„ì§ì€ ì–´ë–¤ ë•Œ ì‚¬ìš©í•˜ëŠ” ê²Œ ì¢‹ì„ì§€ ìƒê°ì´ ì˜ ì•ˆ ë‚œë‹¤.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Guide/Using_promises">mozila promise doc</a></li><li><a href="https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Statements/async_function">mozila async doc</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSON Arrayë¥¼ CSVë¡œ ë³€í™˜í•˜ê¸°</title>
      <link href="/2018/07/22/nodejs-json-array-to-csv/"/>
      <url>/2018/07/22/nodejs-json-array-to-csv/</url>
      
        <content type="html"><![CDATA[<p>ë³€í™˜í•  json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;test1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;0101112222&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;test2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span>: <span class="number">25</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;test4&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span>: <span class="number">15</span>,</span><br><span class="line">    <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;545343123&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;team&quot;</span>: <span class="string">&quot;home&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;test3&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span>: <span class="number">42</span>,</span><br><span class="line">    <span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;0101112222&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ë³€í™˜í•˜ëŠ” ì½”ë“œ.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> data = <span class="built_in">require</span>(<span class="string">&#x27;./sample.json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  <span class="doctag">TODO:</span> csv í—¤ë” ë§Œë“¤ê¸°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> makeHeader = <span class="function">() =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> length = [];</span><br><span class="line">    data.forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      length.push(<span class="built_in">Object</span>.keys(item).length);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> index = length.indexOf(<span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, length)); <span class="comment">// json Arrayì—ì„œ ì œì¼ í”„ë¡œí¼í‹°ê°€ ë§ì€ ê±°ë¥¼ í—¤ë”ë¡œ ì •í•¨.</span></span><br><span class="line">    <span class="keyword">return</span> resolve(<span class="built_in">Object</span>.keys(data[index]));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> reject(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> csv ëª¸í†µ ë§Œë“¤ê¸°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>header csv í—¤ë”</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> makeBody = <span class="function">(<span class="params">header</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> body = [];</span><br><span class="line">    data.forEach(<span class="function">(<span class="params">x</span>) =&gt;</span> &#123;</span><br><span class="line">      header.forEach(<span class="function">(<span class="params">y</span>) =&gt;</span> &#123;</span><br><span class="line">        body.push(<span class="keyword">typeof</span> x[y] !== <span class="string">&#x27;undefined&#x27;</span> ? x[y] : <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> headerLen = header.length;</span><br><span class="line">    <span class="keyword">let</span> result = header.join();</span><br><span class="line">    result += <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// í—¤ë” ë’¤ì— ì¤„ ë°”ê¿ˆ.</span></span><br><span class="line">    body.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">      result += item;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">Number</span>(index + <span class="number">1</span>) % headerLen === <span class="number">0</span>) &#123; <span class="comment">// csv ì–‘ì‹ìœ¼ë¡œ ë§Œë“ ë‹¤.</span></span><br><span class="line">        result += <span class="string">&#x27;\n&#x27;</span>; <span class="comment">// í—¤ë”ë§Œí¼ ë‹¤ ìˆìœ¼ë©´ ì¤„ ë°”ê¿ˆ.</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        result += <span class="string">&#x27;,&#x27;</span>; <span class="comment">// ì—…ìœ¼ë©´ ì½¤ë§ˆ</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> resolve(result);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> reject(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> íŒŒì¼ ì“°ê¸°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>csv csv ë°ì´í„°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> saveFile = <span class="function">(<span class="params">csv</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  fs.writeFile(<span class="string">&#x27;test.csv&#x27;</span>, csv, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> reject(err);</span><br><span class="line">    <span class="keyword">return</span> resolve(<span class="string">&#x27;write success&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">makeHeader().then(<span class="keyword">async</span> (header) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> csv = <span class="keyword">await</span> makeBody(header);</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> saveFile(csv);</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ë³€í™˜í•œ ê²°ê³¼</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1532254149/makecsv_coh3ad.png" alt="ê²°ê³¼"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.jsì—ì„œ Email ë°œì†¡í•´ë³´ê¸°</title>
      <link href="/2018/07/13/nodejs-send-email/"/>
      <url>/2018/07/13/nodejs-send-email/</url>
      
        <content type="html"><![CDATA[<h2 id="mailtrap"><a href="#mailtrap" class="headerlink" title="mailtrap"></a>mailtrap</h2><p><a href="https://mailtrap.io/">mailtrap</a>ì€ email ë°œì†¡, ìˆ˜ì‹ ì´ ì œëŒ€ë¡œ ë˜ì—ˆëŠ”ì§€ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³¼ ìˆ˜ ì‡ëŠ” SMTPë¥¼ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë‹¤.</p><p>ê°€ì… í•  ë•Œ í¬ë ˆë”§ ì¹´ë“œ ë“±ë¡ ê°™ì€ ê±° ì—…ì–´ì„œ ë¶€ë‹´ì´ ì—…ìŒ.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1552833110/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-03-17_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_11.24.49_lhx7cl.png" alt="mailtrap"></p><p>ëŒ€ì‹œë³´ë“œì—ì„œ ì € ë³´ë¼ìƒ‰ í‘œì‹œí•œ ë¶€ë¶„ì„ í´ë¦­í•´ì„œ ë“¤ì–´ê°€ê²Œ ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í™”ë©´ì„ ë³¸ë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1552834511/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-03-17_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_11.24.15_oazyui.png" alt="mailtrap - 2"></p><p>ì„œë¹„ìŠ¤ì˜ ì¥ì  ì¤‘ í•˜ë‚˜ê°€ ì—¬ëŸ¬ ì–¸ì–´ì˜ ìƒ˜í”Œ ì½”ë“œë„ ë³´ì—¬ì¤€ë‹¤ëŠ” ì .</p><h2 id="nodemailer"><a href="#nodemailer" class="headerlink" title="nodemailer"></a>nodemailer</h2><p>ì´ì œ í”„ë¡œê·¸ë¨ ìƒì—ì„œ ë©”ì¼ í´ë¼ì´ì–¸íŠ¸ ëª¨ë“ˆì„ ë°›ì•„ì„œ ì „ì†¡ì„ í•´ë³´ì.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add nodemailer <span class="comment"># ë˜ëŠ” npm i nodemailer -S</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nodemailer = <span class="built_in">require</span>(<span class="string">&#x27;nodemailer&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> transporter = nodemailer.createTransport(&#123;</span><br><span class="line">    host: <span class="string">&#x27;smtp.mailtrap.io&#x27;</span>,</span><br><span class="line">    port: <span class="number">2525</span>,</span><br><span class="line">    secure: <span class="literal">false</span>, <span class="comment">// <span class="doctag">NOTE:</span> port ê°€ 465ì¼ ë•Œë§Œ true</span></span><br><span class="line">    auth: &#123;</span><br><span class="line">        user: <span class="string">&#x27;ë°œê¸‰ ë°›ì€ Username&#x27;</span>,</span><br><span class="line">        pass: <span class="string">&#x27;ë°œê¸‰ ë°›ì€ Password&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> title = <span class="string">`í˜„ì¬ ë©”ì¼ì€ í…ŒìŠ¤íŠ¸ ì…ë‹ˆë‹¤.`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> contents = <span class="string">`ì•„ë¬´ë§ ëŒ€ì”ì¹˜ ã…ã…ã…`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> html = <span class="string">`</span></span><br><span class="line"><span class="string">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="string">&lt;html&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;/&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;ì•ˆë‚´ ë©”ì¼&lt;/title&gt;</span></span><br><span class="line"><span class="string">    &lt;style type=&quot;text/css&quot;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        #outlook a &#123;padding:0;&#125;</span></span><br><span class="line"><span class="string">        body&#123;width:100% !important; -webkit-text-size-adjust:100%; -ms-text-size-adjust:100%; margin:0; padding:0;&#125;</span></span><br><span class="line"><span class="string">        .ExternalClass &#123;width:100%;&#125;</span></span><br><span class="line"><span class="string">        .ExternalClass, .ExternalClass p, .ExternalClass span, .ExternalClass font, .ExternalClass td, .ExternalClass div &#123;line-height: 100%;&#125;</span></span><br><span class="line"><span class="string">        #backgroundTable &#123;margin:0; padding:0; width:100% !important; line-height: 100% !important;&#125;</span></span><br><span class="line"><span class="string">        img &#123;outline:none; text-decoration:none; -ms-interpolation-mode: bicubic;&#125;</span></span><br><span class="line"><span class="string">        a img &#123;border:none;display:inline-block;&#125;</span></span><br><span class="line"><span class="string">        .image_fix &#123;display:block;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        h1, h2, h3, h4, h5, h6 &#123;color: black !important;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        h1 a, h2 a, h3 a, h4 a, h5 a, h6 a &#123;color: blue !important;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        h1 a:active, h2 a:active,  h3 a:active, h4 a:active, h5 a:active, h6 a:active &#123;</span></span><br><span class="line"><span class="string">            color: red !important;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        h1 a:visited, h2 a:visited,  h3 a:visited, h4 a:visited, h5 a:visited, h6 a:visited &#123;</span></span><br><span class="line"><span class="string">            color: purple !important;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        table td &#123;border-collapse: collapse;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        table &#123; border-collapse:collapse; mso-table-lspace:0pt; mso-table-rspace:0pt; &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        a &#123;color: #000;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @media only screen and (max-device-width: 480px) &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            a[href^=&quot;tel&quot;], a[href^=&quot;sms&quot;] &#123;</span></span><br><span class="line"><span class="string">                text-decoration: none;</span></span><br><span class="line"><span class="string">                color: black; /* or whatever your want */</span></span><br><span class="line"><span class="string">                pointer-events: none;</span></span><br><span class="line"><span class="string">                cursor: default;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            .mobile_link a[href^=&quot;tel&quot;], .mobile_link a[href^=&quot;sms&quot;] &#123;</span></span><br><span class="line"><span class="string">                text-decoration: default;</span></span><br><span class="line"><span class="string">                color: orange !important; /* or whatever your want */</span></span><br><span class="line"><span class="string">                pointer-events: auto;</span></span><br><span class="line"><span class="string">                cursor: default;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        @media only screen and (min-device-width: 768px) and (max-device-width: 1024px) &#123;</span></span><br><span class="line"><span class="string">            a[href^=&quot;tel&quot;], a[href^=&quot;sms&quot;] &#123;</span></span><br><span class="line"><span class="string">                text-decoration: none;</span></span><br><span class="line"><span class="string">                color: blue; /* or whatever your want */</span></span><br><span class="line"><span class="string">                pointer-events: none;</span></span><br><span class="line"><span class="string">                cursor: default;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            .mobile_link a[href^=&quot;tel&quot;], .mobile_link a[href^=&quot;sms&quot;] &#123;</span></span><br><span class="line"><span class="string">                text-decoration: default;</span></span><br><span class="line"><span class="string">                color: orange !important;</span></span><br><span class="line"><span class="string">                pointer-events: auto;</span></span><br><span class="line"><span class="string">                cursor: default;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        p &#123;</span></span><br><span class="line"><span class="string">            margin:0;</span></span><br><span class="line"><span class="string">            color:#555;</span></span><br><span class="line"><span class="string">            font-family:Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="string">            font-size:16px;</span></span><br><span class="line"><span class="string">            line-height:160%;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        a.link2&#123;</span></span><br><span class="line"><span class="string">            text-decoration:none;</span></span><br><span class="line"><span class="string">            font-family:Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="string">            font-size:16px;</span></span><br><span class="line"><span class="string">            color:#fff;</span></span><br><span class="line"><span class="string">            border-radius:4px;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        h2&#123;</span></span><br><span class="line"><span class="string">            color:#181818;</span></span><br><span class="line"><span class="string">            font-family:Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="string">            font-size:22px;</span></span><br><span class="line"><span class="string">            font-weight: normal;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        .bgItem&#123;</span></span><br><span class="line"><span class="string">            background:#F4A81C;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        .bgBody&#123;</span></span><br><span class="line"><span class="string">            background:#ffffff;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string">&lt;!-- Wrapper/Container Table: Use a wrapper table to control the width and the background color consistently of your email. Use this approach instead of setting attributes on the body tag. --&gt;</span></span><br><span class="line"><span class="string">  &lt;table cellpadding=&quot;0&quot; width=&quot;100%&quot; cellspacing=&quot;0&quot; border=&quot;0&quot; id=&quot;backgroundTable&quot; class=&#x27;bgBody&#x27;&gt;</span></span><br><span class="line"><span class="string">      &lt;tr&gt;</span></span><br><span class="line"><span class="string">          &lt;td&gt;</span></span><br><span class="line"><span class="string">    &lt;!-- Tables are the most common way to format your email consistently. Set your table widths inside cells and in most cases reset cellpadding, cellspacing, and border to zero. Use nested tables as a way to space effectively in your message. --&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; border=&quot;0&quot; align=&quot;center&quot; width=&quot;100%&quot; style=&quot;border-collapse:collapse;&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;tr&gt;</span></span><br><span class="line"><span class="string">        &lt;td class=&#x27;movableContentContainer&#x27;&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          &lt;div class=&#x27;movableContent&#x27;&gt;</span></span><br><span class="line"><span class="string">            &lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; border=&quot;0&quot; align=&quot;center&quot; width=&quot;600&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;tr height=&quot;40&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;200&quot;&gt;&amp;nbsp;&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;200&quot;&gt;&amp;nbsp;&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;200&quot;&gt;&amp;nbsp;&lt;/td&gt;</span></span><br><span class="line"><span class="string">              &lt;/tr&gt;</span></span><br><span class="line"><span class="string">              &lt;tr&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;200&quot; valign=&quot;top&quot;&gt;&amp;nbsp;&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;200&quot; valign=&quot;top&quot; align=&quot;center&quot;&gt;</span></span><br><span class="line"><span class="string">                  &lt;div class=&quot;contentEditableContainer contentTextEditable&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;contentEditable&quot; &gt;</span></span><br><span class="line"><span class="string">                      &lt;img src=&quot;https://avatars1.githubusercontent.com/u/29791348?s=460&amp;v=4&quot; width=&quot;155&quot; height=&#x27;155&#x27; alt=&#x27;Logo&#x27;/&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                  &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;200&quot; valign=&quot;top&quot;&gt;&amp;nbsp;&lt;/td&gt;</span></span><br><span class="line"><span class="string">              &lt;/tr&gt;</span></span><br><span class="line"><span class="string">              &lt;tr height=&quot;25&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;200&quot;&gt;&amp;nbsp;&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;200&quot;&gt;&amp;nbsp;&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;200&quot;&gt;&amp;nbsp;&lt;/td&gt;</span></span><br><span class="line"><span class="string">              &lt;/tr&gt;</span></span><br><span class="line"><span class="string">            &lt;/table&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">          &lt;div class=&#x27;movableContent&#x27;&gt;</span></span><br><span class="line"><span class="string">            &lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; border=&quot;0&quot; align=&quot;center&quot; width=&quot;600&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;tr&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;100%&quot; colspan=&quot;3&quot; align=&quot;center&quot; style=&quot;padding-bottom:10px;padding-top:25px;&quot;&gt;</span></span><br><span class="line"><span class="string">                  &lt;div class=&quot;contentEditableContainer contentTextEditable&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;contentEditable&quot; &gt;</span></span><br><span class="line"><span class="string">                      &lt;h2 &gt;`</span>+ title + <span class="string">`&lt;/h2&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                  &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/td&gt;</span></span><br><span class="line"><span class="string">              &lt;/tr&gt;</span></span><br><span class="line"><span class="string">              &lt;tr&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;100&quot;&gt;&amp;nbsp;&lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;400&quot; align=&quot;center&quot; style=&quot;padding-bottom:5px;&quot;&gt;</span></span><br><span class="line"><span class="string">                  &lt;div class=&quot;contentEditableContainer contentTextEditable&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;contentEditable&quot; &gt;</span></span><br><span class="line"><span class="string">                      &lt;p &gt;`</span>+ contents + <span class="string">`&lt;/p&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                  &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/td&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;100&quot;&gt;&amp;nbsp;&lt;/td&gt;</span></span><br><span class="line"><span class="string">              &lt;/tr&gt;</span></span><br><span class="line"><span class="string">            &lt;/table&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;</span></span><br><span class="line"><span class="string">          &lt;div class=&#x27;movableContent&#x27;&gt;</span></span><br><span class="line"><span class="string">            &lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; border=&quot;0&quot; align=&quot;center&quot; width=&quot;600&quot;&gt;</span></span><br><span class="line"><span class="string">              &lt;tr&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;100%&quot; colspan=&quot;2&quot; style=&quot;padding-top:65px;&quot;&gt;</span></span><br><span class="line"><span class="string">                  &lt;hr style=&quot;height:1px;border:none;color:#333;background-color:#ddd;&quot; /&gt;</span></span><br><span class="line"><span class="string">                &lt;/td&gt;</span></span><br><span class="line"><span class="string">              &lt;/tr&gt;</span></span><br><span class="line"><span class="string">              &lt;tr&gt;</span></span><br><span class="line"><span class="string">                &lt;td width=&quot;60%&quot; height=&quot;70&quot; valign=&quot;middle&quot; style=&quot;padding-bottom:20px;&quot;&gt;</span></span><br><span class="line"><span class="string">                  &lt;div class=&quot;contentEditableContainer contentTextEditable&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class=&quot;contentEditable&quot; &gt;</span></span><br><span class="line"><span class="string">                      &lt;span style=&quot;font-size:13px;color:#181818;font-family:Helvetica, Arial, sans-serif;line-height:200%;&quot;&gt;Copyright Â© 2019 delryn&lt;/span&gt;</span></span><br><span class="line"><span class="string">                    &lt;/div&gt;</span></span><br><span class="line"><span class="string">                  &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;/td&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">              &lt;/tr&gt;</span></span><br><span class="line"><span class="string">            &lt;/table&gt;</span></span><br><span class="line"><span class="string">          &lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &lt;/td&gt;</span></span><br><span class="line"><span class="string">      &lt;/tr&gt;</span></span><br><span class="line"><span class="string">    &lt;/table&gt;</span></span><br><span class="line"><span class="string">&lt;!-- END BODY --&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  &lt;/td&gt;</span></span><br><span class="line"><span class="string">&lt;/tr&gt;</span></span><br><span class="line"><span class="string">&lt;/table&gt;</span></span><br><span class="line"><span class="string">&lt;!-- End of wrapper table --&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mailOptions = &#123;</span><br><span class="line">    <span class="keyword">from</span>: <span class="string">&#x27;&quot;delryn ğŸ˜Š&quot; &lt;admin@hidelryn.github.io&gt;&#x27;</span>, <span class="comment">// ë³´ë‚´ëŠ” ì‚¬ëŒ</span></span><br><span class="line">    to: <span class="string">&quot;hidelryn@gmail.com&quot;</span>, <span class="comment">// <span class="doctag">NOTE:</span> ë°›ëŠ” ì‚¬ëŒë“¤ ì—¬ëŸ¬ ëª…ì¸ ê²½ìš° aa@gmail.com, bb@gmail.com ì´ë ‡ê²Œ ,ë¡œ ì´ì–´ì„œ.</span></span><br><span class="line">    subject: title, <span class="comment">// ì œëª©</span></span><br><span class="line">    <span class="comment">// text: &quot;Hello world?&quot;, // <span class="doctag">NOTE:</span> ë‹¨ìˆœíˆ í…ìŠ¤íŠ¸ë§Œ ë³´ë‚¼ ê²½ìš°.</span></span><br><span class="line">    html: html <span class="comment">// <span class="doctag">NOTE:</span> HTML ë³´ë‚¼ ê²½ìš°.</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">transporter.sendMail(mailOptions, <span class="function">(<span class="params">err, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(res);</span><br><span class="line">    &#125;</span><br><span class="line">    transporter.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ë³„ë¡œ ì–´ë ¤ìš´ê²Œ ì—…ë‹¤. ì½”ë“œë¥¼ ì‹¤í–‰ì„ í•´ë³´ë©´ ì•„ë˜ì²˜ëŸ¼ mailtrapì—ì„œ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.</p><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1552833575/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-03-17_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_11.38.51_lg0nml.png" alt="mailtrap - 3"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> SMS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js cheerio ëª¨ë“ˆ ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2018/07/13/nodejs-cheerio/"/>
      <url>/2018/07/13/nodejs-cheerio/</url>
      
        <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>); <span class="comment">// request ê°™ì€ ëª¨ë“ˆ.</span></span><br><span class="line"><span class="keyword">const</span> cheerio = <span class="built_in">require</span>(<span class="string">&#x27;cheerio&#x27;</span>); <span class="comment">// node.jsì—ì„œ ì œì´ì¿¼ë¦¬ ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ëª¨ë“ˆ.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> title = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> pageNum = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> run = <span class="function">(<span class="params">callback</span>) =&gt;</span> &#123;</span><br><span class="line">  axios.get(<span class="string">&#x27;https://delryn.herokuapp.com/paging&#x27;</span>, &#123;</span><br><span class="line">    params: &#123;</span><br><span class="line">      page: <span class="built_in">Number</span>(pageNum), <span class="comment">// get ì¿¼ë¦¬ìŠ¤íŠ¸ë§ íŒŒë¼ë¯¸í„°ì„.</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">    .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> $ = cheerio.load(res.data); <span class="comment">// HTML domì„ ì œì´ì¿¼ë¦¬ë¡œ ì½ê²Œ í•´ì¤€ë‹¤.</span></span><br><span class="line">      <span class="keyword">const</span> table = $(<span class="string">&#x27;table &gt; tbody  &gt; tr &gt; td&#x27;</span>);</span><br><span class="line">      <span class="keyword">if</span> (pageNum &gt; <span class="number">3</span>) &#123;</span><br><span class="line">        callback();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        table.each(<span class="function">(<span class="params">idx, item</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (idx % <span class="number">2</span> === <span class="number">0</span>) &#123; <span class="comment">// ì œëª©ë§Œ.</span></span><br><span class="line">            title += <span class="string">`<span class="subst">$&#123;$(item).text()&#125;</span>\n`</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        pageNum += <span class="number">1</span>;</span><br><span class="line">        run(callback); <span class="comment">// ì¬ê·€.</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      callback(err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">run(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(title);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì •ë¦¬í•˜ìë©´ http clientë¡œ ì›¹ í˜ì´ì§€(HTML)ì„ ì½ì–´ì„œ jQueryë¡œ ì›í•˜ëŠ” ë°ì´í„° ì •ë¦¬ë¥¼ í•œë‹¤.</p><p>ì´ëŸ¬í•œ ê±¸ ì›¹ í¬ë¡¤ë§ì´ë¼ê³  í•œë‹¤. node.jsì—ì„œ jQuery ë¬¸ë²•ì„ ì“¸ ì¼ì´ ì‡ì„ì¤„ì´ì•¼..</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Expressì—ì„œ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ ì´ìš©í•œ í˜ì´ì§• êµ¬í˜„ í•´ë³´ê¸°</title>
      <link href="/2018/06/24/nodejs-paging/"/>
      <url>/2018/06/24/nodejs-paging/</url>
      
        <content type="html"><![CDATA[<p>dbëŠ” mysql, view ì˜ì—­ì€ ejsë¡œ ê°„ë‹¨í•˜ê²Œ ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì„ ì´ìš©í•œ í˜ì´ì§• êµ¬í˜„ì„ ì •ë¦¬ í•œë‹¤.</p><h2 id="ì„œë²„"><a href="#ì„œë²„" class="headerlink" title="ì„œë²„"></a>ì„œë²„</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/views`</span>);</span><br><span class="line">app.set(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> connection = mysql.createConnection(&#123; <span class="comment">// <span class="doctag">NOTE:</span> mysql connection</span></span><br><span class="line">  host: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  user: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  database: <span class="string">&#x27;paging_test&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> pageNum = <span class="built_in">Number</span>(req.query.pageNum) || <span class="number">1</span>; <span class="comment">// <span class="doctag">NOTE:</span> ì¿¼ë¦¬ìŠ¤íŠ¸ë§ìœ¼ë¡œ ë°›ì„ í˜ì´ì§€ ë²ˆí˜¸ ê°’, ê¸°ë³¸ê°’ì€ 1</span></span><br><span class="line">  <span class="keyword">const</span> contentSize = <span class="number">10</span>; <span class="comment">// <span class="doctag">NOTE:</span> í˜ì´ì§€ì—ì„œ ë³´ì—¬ì¤„ ì»¨í…ì¸  ìˆ˜.</span></span><br><span class="line">  <span class="keyword">const</span> pnSize = <span class="number">10</span>; <span class="comment">// <span class="doctag">NOTE:</span> í˜ì´ì§€ë„¤ì´ì…˜ ê°œìˆ˜ ì„¤ì •.</span></span><br><span class="line">  <span class="keyword">const</span> skipSize = (pageNum - <span class="number">1</span>) * contentSize; <span class="comment">// <span class="doctag">NOTE:</span> ë‹¤ìŒ í˜ì´ì§€ ê°ˆ ë•Œ ê±´ë„ˆë›¸ ë¦¬ìŠ¤íŠ¸ ê°œìˆ˜.</span></span><br><span class="line"></span><br><span class="line">  connection.query(<span class="string">&#x27;SELECT count(*) as `count` FROM `articles`&#x27;</span>, <span class="function">(<span class="params">countQueryErr, countQueryResult</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (countQueryErr) <span class="keyword">throw</span> countQueryErr;</span><br><span class="line">    <span class="keyword">const</span> totalCount = <span class="built_in">Number</span>(countQueryResult[<span class="number">0</span>].count); <span class="comment">// <span class="doctag">NOTE:</span> ì „ì²´ ê¸€ ê°œìˆ˜.</span></span><br><span class="line">    <span class="keyword">const</span> pnTotal = <span class="built_in">Math</span>.ceil(totalCount / contentSize); <span class="comment">// <span class="doctag">NOTE:</span> í˜ì´ì§€ë„¤ì´ì…˜ì˜ ì „ì²´ ì¹´ìš´íŠ¸</span></span><br><span class="line">    <span class="keyword">const</span> pnStart = ((<span class="built_in">Math</span>.ceil(pageNum / pnSize) - <span class="number">1</span>) * pnSize) + <span class="number">1</span>; <span class="comment">// <span class="doctag">NOTE:</span> í˜„ì¬ í˜ì´ì§€ì˜ í˜ì´ì§€ë„¤ì´ì…˜ ì‹œì‘ ë²ˆí˜¸.</span></span><br><span class="line">    <span class="keyword">let</span> pnEnd = (pnStart + pnSize) - <span class="number">1</span>; <span class="comment">// <span class="doctag">NOTE:</span> í˜„ì¬ í˜ì´ì§€ì˜ í˜ì´ì§€ë„¤ì´ì…˜ ë ë²ˆí˜¸.</span></span><br><span class="line">    connection.query(<span class="string">&#x27;SELECT * FROM `articles` ORDER BY id DESC LIMIT ?, ?&#x27;</span>, [skipSize, contentSize], <span class="function">(<span class="params">contentQueryErr, contentQueryResult</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (contentQueryErr) <span class="keyword">throw</span> contentQueryErr;</span><br><span class="line">      <span class="keyword">if</span> (pnEnd &gt; pnTotal) pnEnd = pnTotal; <span class="comment">// <span class="doctag">NOTE:</span> í˜ì´ì§€ë„¤ì´ì…˜ì˜ ë ë²ˆí˜¸ê°€ í˜ì´ì§€ë„¤ì´ì…˜ ì „ì²´ ì¹´ìš´íŠ¸ë³´ë‹¤ ë†’ì„ ê²½ìš°.</span></span><br><span class="line">      <span class="keyword">const</span> result = &#123;</span><br><span class="line">        pageNum,</span><br><span class="line">        pnStart,</span><br><span class="line">        pnEnd,</span><br><span class="line">        pnTotal,</span><br><span class="line">        contents: contentQueryResult,</span><br><span class="line">      &#125;;</span><br><span class="line">      res.render(<span class="string">&#x27;index&#x27;</span>, &#123;</span><br><span class="line">        articles: result,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/view/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; id &#125; = req.params;</span><br><span class="line">  connection.query(<span class="string">&#x27;SELECT * FROM `articles` WHERE id = ?&#x27;</span>, [id], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    res.render(<span class="string">&#x27;view&#x27;</span>, &#123;</span><br><span class="line">      article: results[<span class="number">0</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`express is running on port <span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="í´ë¼ì´ì–¸íŠ¸"><a href="#í´ë¼ì´ì–¸íŠ¸" class="headerlink" title="í´ë¼ì´ì–¸íŠ¸"></a>í´ë¼ì´ì–¸íŠ¸</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;ko&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>nodejs-paging-example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&#x27;https://fonts.googleapis.com/css?family=Audiowide|Iceland|Monoton|Pacifico|Press+Start+2P|Vampiro+One&#x27;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">rel</span>=<span class="string">&#x27;stylesheet&#x27;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://fonts.googleapis.com/icon?family=Material+Icons&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;bordered&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>ì œëª©<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>ê¸€<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span> (<span class="attr">articles.contents.length</span> != <span class="string">0)</span> &#123; %&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">%</span> <span class="attr">articles.contents.forEach</span>(<span class="attr">function</span>(<span class="attr">Article</span>)&#123; %&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/view/&lt;%=Article.id%&gt;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">%=Article.title%</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/view/&lt;%=Article.id%&gt;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">%=Article.text%</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">%</span> &#125;); %&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">%</span> &#125; <span class="attr">else</span> &#123; %&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>ë“±ë¡ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span> (<span class="attr">articles.contents.length</span> != <span class="string">0)</span> &#123; %&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;pagination&quot;</span>&gt;</span></span><br><span class="line">      &lt;li &lt;%if(articles.pageNum == 1)&#123;%&gt; class=&quot;disabled&quot; &lt;%&#125;else&#123;%&gt;class=&quot;waves-effect&quot; &lt;%&#125;%&gt; &gt;</span><br><span class="line">       &lt;a &lt;%if(articles.pageNum &gt; 1)&#123;%&gt; href=&quot;?pageNum=&lt;%=articles.pageNum-1%&gt;&quot; &lt;%&#125;%&gt;&gt;</span><br><span class="line">         <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;material-icons&quot;</span>&gt;</span>chevron_left<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &lt;% for(var i=articles.pnStart; i&lt;=articles.pnEnd; i++)&#123; %&gt; &lt;li &lt;%if(i===articles.pageNum)&#123;%&gt; class=&quot;active&quot;</span><br><span class="line">        <span class="tag">&lt;<span class="name">%&#125;%</span>&gt;</span>&gt;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;?pageNum=&lt;%=i%&gt;&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">%=i%</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">      &lt;li &lt;%if(articles.pageNum == articles.pnTotal)&#123;%&gt; class=&quot;disabled&quot; &lt;%&#125;else&#123;%&gt; class=&quot;waves-effect&quot; &lt;%&#125;%&gt;&gt;</span><br><span class="line">       &lt;a &lt;%if(articles.pageNum &lt; articles.pnTotal)&#123;%&gt; href=&quot;?pageNum=&lt;%=articles.pageNum+1%&gt;&quot; &lt;%&#125;%&gt; class=&quot;waves-effect&quot;&gt;</span><br><span class="line">       <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;material-icons&quot;</span>&gt;</span>chevron_right<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ìŠ¤í¬ë¡¤ í˜ì´ì§•ì´ë‚˜ ajaxë¡œ í˜ì´ì§•ì„ êµ¬í˜„ì„ í•˜ëŠ” ê±´ ì„œë²„ëŠ” ê±°ì˜ ë˜‘ê°™ê³  í´ë¼ì´ì–¸íŠ¸ë§Œ ë°”ê¾¸ë©´ ë¨.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://okky.kr/article/282819">í˜ì´ì§•(Paging)ì— ëŒ€í•œ ì´í•´</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
            <tag> Pagination </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Expressì—ì„œ multerë¥¼ ì´ìš©í•œ ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ êµ¬í˜„</title>
      <link href="/2018/06/20/nodejs-upload/"/>
      <url>/2018/06/20/nodejs-upload/</url>
      
        <content type="html"><![CDATA[<h2 id="ê°œìš”"><a href="#ê°œìš”" class="headerlink" title="ê°œìš”"></a>ê°œìš”</h2><ol><li>í´ë¼ì´ì–¸íŠ¸ì—ì„œ form input fileì— ì´ë¯¸ì§€ë¥¼ ë“±ë¡ í›„ ì„œë²„ì— ì „ì†¡</li><li>ì„œë²„ì—ì„œëŠ” multerë¥¼ í†µí•´ file ì •ë³´ë¥¼ ë°›ì•„ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ dbì— ì €ì¥</li><li>ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì—¬ëŸ¬ ì´ë¯¸ì§€ì˜ ê²½ìš° zipìœ¼ë¡œ ë¬¶ì–´ì„œ, ì•„ë‹ˆë©´ ê± ë‹¤ìš´ë¡œë“œ</li></ol><h2 id="í´ë¼ì´ì–¸íŠ¸"><a href="#í´ë¼ì´ì–¸íŠ¸" class="headerlink" title="í´ë¼ì´ì–¸íŠ¸"></a>í´ë¼ì´ì–¸íŠ¸</h2><p>ì¤‘ìš”í•œ ê±´ form íƒœê·¸ì˜ enctype=â€multipart/form-dataâ€ê°€ ìˆì–´ì•¼ í•¨.</p><p>input file íƒœê·¸ëŠ” ì›í•˜ëŠ” ê°œìˆ˜ì— ë§ê²Œ ì¶”ê°€í•˜ê±°ë‚˜ multiple ì˜µì…˜ì„ ì£¼ë©´ ë¨.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;&quot;</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;field&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>title<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;title&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;field&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;file is-primary has-name&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;file-label&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">&quot;file-input&quot;</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;attachment&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;file-cta&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;file-icon&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-image&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;file-label&quot;</span>&gt;</span></span><br><span class="line">            Choose a imageâ€¦</span><br><span class="line">          <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;field is-grouped&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top:30px;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button is-primary&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span> <span class="attr">class</span>=<span class="string">&quot;button is-primary is-outlined&quot;</span>&gt;</span>Cancel<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ì—…ë¡œë“œ-ë‹¤ìš´ë¡œë“œ-ë¡œì§"><a href="#ì—…ë¡œë“œ-ë‹¤ìš´ë¡œë“œ-ë¡œì§" class="headerlink" title="ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ ë¡œì§"></a>ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ ë¡œì§</h2><p>express í˜¼ìì„œëŠ” multipart/form-data ë°ì´í„°ë¥¼ í•¸ë“¤ë§ í• ìˆ˜ê°€ ì—…ê¸° ë•Œë¬¸ì— </p><p><a href="https://www.npmjs.com/package/multer">multer</a>ë¼ëŠ” ëª¨ë“ˆì„ ì‚¬ìš© í•œë‹¤.</p><p>zip ë‹¤ìš´ë¡œë“œì˜ ê²½ìš° <a href="https://www.npmjs.com/package/node-zip">node-zip</a>ì„ ì‚¬ìš©.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable no-new-require */</span></span><br><span class="line"><span class="comment">/* eslint-disable new-cap */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;../../config/config&#x27;</span>); <span class="comment">// í™˜ê²½ ì„¤ì •</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> uploadFolder = <span class="string">&#x27;/upload/&#x27;</span>; <span class="comment">// <span class="doctag">NOTE:</span> ì—…ë¡œë“œí•œ ì´ë¯¸ìê°€ ì‡ì„ express static folder</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ë””ë ‰í† ë¦¬ê°€ ì¡´ì¬í•˜ëŠ”ì§€ ì²´í¬</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>ì ˆëŒ€ ê²½ë¡œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> dirExists = <span class="function">(<span class="params">absolutePath</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fs.statSync(absolutePath).isDirectory();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;dirExists err&#x27;, err); // <span class="doctag">NOTE:</span> í´ë”ê°€ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ &#x27;ENOENT&#x27; ì—ëŸ¬ë¥¼ ë°˜í™˜í•¨.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> íŒŒì¼ì´ ìˆëŠ”ì§€ ì²´í¬</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>ì ˆëŒ€ ê²½ë¡œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> fileExists = <span class="function">(<span class="params">files</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; files.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      fs.statSync(files[i]).isFile();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="comment">// console.log(&#x27;fileExists err&#x27;, err);</span></span><br><span class="line">      result = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> multer ê¸°ë³¸ ì„¸íŒ…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;String&#125;</span> </span>ì—…ë¡œë“œí•  í´ë”ëª…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> multerInit = <span class="function">(<span class="params">folder</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!folder) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">const</span> storage = multer.diskStorage(&#123;</span><br><span class="line">    destination: <span class="function">(<span class="params">req, file, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> uploadRoot = path.join(config.root, <span class="string">&#x27;/public/upload/&#x27;</span>); <span class="comment">// ì‹œìŠ¤í…œ ì ˆëŒ€ ê²½ë¡œ</span></span><br><span class="line">      <span class="keyword">const</span> uploadPath = path.join(config.root, <span class="string">`/public/upload/<span class="subst">$&#123;folder&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">if</span> (!dirExists(uploadRoot)) fs.mkdirSync(uploadRoot); <span class="comment">// <span class="doctag">NOTE:</span> ì—…ë¡œë“œ í´ë” ì²´í¬ í›„ ìƒì„±.</span></span><br><span class="line">      <span class="keyword">if</span> (!dirExists(uploadPath)) fs.mkdirSync(uploadPath); <span class="comment">// <span class="doctag">NOTE:</span> ì—…ë¡œë“œ í´ë” ì²´í¬ í›„ ìƒì„±.</span></span><br><span class="line">      callback(<span class="literal">null</span>, uploadPath);</span><br><span class="line">    &#125;,</span><br><span class="line">    filename: <span class="function">(<span class="params">req, file, callback</span>) =&gt;</span> &#123; <span class="comment">// <span class="doctag">NOTE:</span> íŒŒì¼ëª… ë³€í™˜</span></span><br><span class="line">      callback(<span class="literal">null</span>, <span class="string">`<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>.<span class="subst">$&#123;file.mimetype.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">1</span>]&#125;</span>`</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> multer(&#123;</span><br><span class="line">    storage,</span><br><span class="line">    limits: &#123; <span class="attr">fileSize</span>: <span class="number">2097152</span> &#125;, <span class="comment">// <span class="doctag">NOTE:</span> ì—…ë¡œë“œ íŒŒì¼ì€ 2mb ì œí•œ</span></span><br><span class="line">    fileFilter: <span class="function">(<span class="params">req, file, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (file.mimetype.indexOf(<span class="string">&#x27;image&#x27;</span>) === <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥&#x27;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> callback(<span class="literal">null</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> dbì— ì €ì¥í•  path ë§Œë“¤ê¸°.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>multerì—ì„œ ì£¼ëŠ” pathëŠ” ì‹œìŠ¤í…œ ê²½ë¡œì´ê¸° ë•Œë¬¸ì— ê·¸ëŒ€ë¡œ ì €ì¥í•˜ë©´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ viewë¡œ ì“¸ìˆ˜ ì—…ìŒ.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">filePath</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> changeDBPath = <span class="function">(<span class="params">filePath</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> origin = filePath;</span><br><span class="line">  <span class="keyword">const</span> start = origin.match(uploadFolder).index;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = start; i &lt; origin.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    result += origin[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> dbì— ì €ì¥ëœ pathë¥¼ ì‹¤ì œ ì—…ë¡œë“œ pathë¡œ ë³€ê²½.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>dbpathëŠ” client viewìš© (express static) ê²½ë¡œ ì´ê¸° ë•Œë¬¸ì— ì‹œìŠ¤í…œ ê²½ë¡œë¡œ ë°”ê¿”ì¤˜ì•¼ ë‹¤ìš´ë¡œë“œê°€ ì§„í–‰ì´ ë¨.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">dbPath</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> changeUploadPath = <span class="function">(<span class="params">dbPath</span>) =&gt;</span> path.join(config.root, <span class="string">`/public<span class="subst">$&#123;dbPath&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> req.filesì—ì„œ path, name, originalNameë§Œ ê°€ì§€ê³  ì˜¤ê¸°</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description </span>db ì €ì¥ìš©</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>files req.files</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> convertMulterData = <span class="function">(<span class="params">files</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (files.length === <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> uploadPaths = files.map(<span class="function">(<span class="params">file</span>) =&gt;</span> changeDBPath(file.path));</span><br><span class="line">    <span class="keyword">const</span> fileName = files.map(<span class="function">(<span class="params">file</span>) =&gt;</span> file.filename);</span><br><span class="line">    <span class="keyword">const</span> fileOriginalName = files.map(<span class="function">(<span class="params">file</span>) =&gt;</span> file.originalname);</span><br><span class="line">    <span class="keyword">return</span> &#123; uploadPaths, fileName, fileOriginalName &#125;;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;convertMulterData err&#x27;</span>, err);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">TODO:</span> ì—¬ëŸ¬ íŒŒì¼ì„ ë‹¤ìš´ë°›ì•„ì•¼ í•  ê²½ìš°ì—” zipìœ¼ë¡œ ë¬¶ì–´ì„œ ë„˜ê¸´ë‹¤.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>uploadPath dbì— ì €ì¥ëœ ì—…ë¡œë“œ ê²½ë¡œ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Array&#125;</span> </span>originalname dbì— ì €ì¥ëœ ì›ë˜ íŒŒì¼ëª…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> zipDownload = <span class="function">(<span class="params">dbPath, originalname</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!dbPath || !originalname) <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;ë‹¤ìš´ë¡œë“œì— í•„ìš”í•œ íŒŒë¼ë¯¸í„° ëˆ„ë½&#x27;</span>));</span><br><span class="line">  <span class="keyword">if</span> (dbPath.length !== originalname.length) <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;ë‹¤ìš´ë¡œë“œ íŒŒë¦¬ë¯¸í„° í™•ì¸&#x27;</span>));</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">Array</span>.isArray(dbPath) || !<span class="built_in">Array</span>.isArray(originalname)) <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;ë‹¤ìš´ë¡œë“œ íŒŒì¼ íƒ€ì… ì²´í¬&#x27;</span>));</span><br><span class="line">  <span class="keyword">const</span> uploadPath = dbPath.map(<span class="function">(<span class="params">p</span>) =&gt;</span> changeUploadPath(p)); <span class="comment">// <span class="doctag">NOTE:</span> dbpath -&gt; uploadpath</span></span><br><span class="line">  <span class="keyword">if</span> (!fileExists(uploadPath)) <span class="keyword">return</span> reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;ì—…ë¡œë“œëœ íŒŒì¼ì´ ì¡´ì¬ í•˜ì§€ ì•ŠìŒ&#x27;</span>));</span><br><span class="line">  <span class="keyword">const</span> zip = <span class="keyword">new</span> <span class="built_in">require</span>(<span class="string">&#x27;node-zip&#x27;</span>)();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; uploadPath.length; i += <span class="number">1</span>) &#123;</span><br><span class="line">    zip.file(originalname[i], fs.readFileSync(uploadPath[i]));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> zipDownloadRoot = path.join(config.root, <span class="string">&#x27;/public/upload/zip&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!dirExists(zipDownloadRoot)) fs.mkdirSync(zipDownloadRoot); <span class="comment">// <span class="doctag">NOTE:</span> zip ë§Œë“¤ í´ë” ì²´í¬ í›„ ìƒì„±.</span></span><br><span class="line">  <span class="keyword">const</span> zipPath = <span class="string">`<span class="subst">$&#123;zipDownloadRoot&#125;</span>/<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>_<span class="subst">$&#123;crypto.randomBytes(<span class="number">8</span>).toString(<span class="string">&#x27;hex&#x27;</span>)&#125;</span>.zip`</span>;</span><br><span class="line">  <span class="keyword">const</span> addZip = zip.generate(&#123; <span class="attr">base64</span>: <span class="literal">false</span>, <span class="attr">compression</span>: <span class="string">&#x27;DEFLATE&#x27;</span> &#125;); <span class="comment">// <span class="doctag">NOTE:</span> zip íŒŒì¼ ìƒì„±.</span></span><br><span class="line">  fs.writeFileSync(zipPath, addZip, <span class="string">&#x27;binary&#x27;</span>); <span class="comment">// <span class="doctag">NOTE:</span> zip íŒŒì¼ ì €ì¥</span></span><br><span class="line">  <span class="keyword">return</span> resolve(zipPath);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.changeDBPath = changeDBPath;</span><br><span class="line"><span class="built_in">exports</span>.changeUploadPath = changeUploadPath;</span><br><span class="line"><span class="built_in">exports</span>.multerInit = multerInit;</span><br><span class="line"><span class="built_in">exports</span>.convertMulterData = convertMulterData;</span><br><span class="line"><span class="built_in">exports</span>.zipDownload = zipDownload;</span><br></pre></td></tr></table></figure><h2 id="db"><a href="#db" class="headerlink" title="db"></a>db</h2><p>dbëŠ” mongodbë¡œ view, ë‹¤ìš´ë¡œë“œì— í•„ìš”í•œ ì •ë³´ë¥¼ ì €ì¥ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Example model</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Schema &#125; = mongoose;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> uploadsSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  title: <span class="built_in">String</span>, <span class="comment">// ê¸€ ì œëª©</span></span><br><span class="line">  uploadImagePath: <span class="built_in">Array</span>, <span class="comment">// view ì´ë¯¸ì§€ ê²½ë¡œ</span></span><br><span class="line">  uploadImageName: <span class="built_in">Array</span>, <span class="comment">// view ì´ë¯¸ì§€ íŒŒì¼ëª…</span></span><br><span class="line">  imageOriginalName: <span class="built_in">Array</span>, <span class="comment">// download ì›ë˜ íŒŒì¼ëª…</span></span><br><span class="line">  create_at: &#123;</span><br><span class="line">    type: <span class="built_in">Date</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="built_in">Date</span>.now(),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">mongoose.model(<span class="string">&#x27;uploads&#x27;</span>, uploadsSchema);</span><br></pre></td></tr></table></figure><h2 id="ì—…ë¡œë“œ-ë‹¤ìš´ë¡œë“œ-route"><a href="#ì—…ë¡œë“œ-ë‹¤ìš´ë¡œë“œ-route" class="headerlink" title="ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ route"></a>ì—…ë¡œë“œ, ë‹¤ìš´ë¡œë“œ route</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>).Router();</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> upload = <span class="built_in">require</span>(<span class="string">&#x27;../lib/local_upload_util&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UploadModel = mongoose.model(<span class="string">&#x27;uploads&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">app</span>) =&gt;</span> &#123;</span><br><span class="line">  app.use(<span class="string">&#x27;/&#x27;</span>, router);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  UploadModel.find(<span class="function">(<span class="params">err, lists</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);</span><br><span class="line">    <span class="keyword">return</span> res.render(<span class="string">&#x27;list&#x27;</span>, &#123;</span><br><span class="line">      title: <span class="string">&#x27;ì—…ë¡œë“œí•œ ë¦¬ìŠ¤íŠ¸&#x27;</span>,</span><br><span class="line">      lists,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ì´ë¯¸ì§€ 1ê°œ ì—…ë¡œë“œ (ì‹±ê¸€)</span></span><br><span class="line">router.get(<span class="string">&#x27;/single&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.render(<span class="string">&#x27;single&#x27;</span>, &#123;</span><br><span class="line">    title: <span class="string">&#x27;ì´ë¯¸ì§€ 1ê°œ ì—…ë¡œë“œ form&#x27;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ì´ë¯¸ì§€ 1ê°œ ì—…ë¡œë“œ (ì‹±ê¸€) ì²˜ë¦¬</span></span><br><span class="line">router.post(<span class="string">&#x27;/single&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> uploadInit = upload.multerInit(<span class="string">&#x27;images&#x27;</span>).single(<span class="string">&#x27;attachment&#x27;</span>);</span><br><span class="line">  uploadInit(req, res, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);</span><br><span class="line">    <span class="keyword">const</span> uploadData = <span class="keyword">new</span> UploadModel(&#123;</span><br><span class="line">      title: req.body.title,</span><br><span class="line">      uploadImagePath: [upload.changeDBPath(req.file.path)],</span><br><span class="line">      uploadImageName: [req.file.filename],</span><br><span class="line">      imageOriginalName: [req.file.originalname],</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> uploadData.save(<span class="function">(<span class="params">saveErr</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (saveErr) <span class="keyword">return</span> next(saveErr);</span><br><span class="line">      <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ì´ë¯¸ì§€ ì—¬ëŸ¬ê°œ ì—…ë¡œë“œ (Array)</span></span><br><span class="line">router.get(<span class="string">&#x27;/array&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.render(<span class="string">&#x27;array&#x27;</span>, &#123;</span><br><span class="line">    title: <span class="string">&#x27;ì´ë¯¸ì§€ ì—¬ëŸ¬ê°œ ì—…ë¡œë“œ form&#x27;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ì´ë¯¸ì§€ ì—¬ëŸ¬ê°œ ì—…ë¡œë“œ (Array) ì²˜ë¦¬</span></span><br><span class="line">router.post(<span class="string">&#x27;/array&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> uploadInit = upload.multerInit(<span class="string">&#x27;images&#x27;</span>).array(<span class="string">&#x27;attachment&#x27;</span>);</span><br><span class="line">  uploadInit(req, res, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);</span><br><span class="line">    <span class="keyword">const</span> convertMulterData = upload.convertMulterData(req.files);</span><br><span class="line">    <span class="keyword">if</span> (!convertMulterData) <span class="keyword">return</span> next(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;ì—…ë¡œë“œëœ íŒŒì¼ë“¤ì˜ ì •ë³´ë¥¼ ë³€í™˜í•  ìˆ˜ ì—…ìŒ&#x27;</span>));</span><br><span class="line">    <span class="keyword">const</span> uploadData = <span class="keyword">new</span> UploadModel(&#123;</span><br><span class="line">      title: req.body.title,</span><br><span class="line">      uploadImagePath: convertMulterData.uploadPaths,</span><br><span class="line">      uploadImageName: convertMulterData.fileName,</span><br><span class="line">      imageOriginalName: convertMulterData.fileOriginalName,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> uploadData.save(<span class="function">(<span class="params">saveErr</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (saveErr) <span class="keyword">return</span> next(saveErr);</span><br><span class="line">      <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ì§€ì •ëœ ì´ë¯¸ì§€ input ì—…ë¡œë“œ (fields)</span></span><br><span class="line">router.get(<span class="string">&#x27;/fields&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.render(<span class="string">&#x27;fields&#x27;</span>, &#123;</span><br><span class="line">    title: <span class="string">&#x27;ì´ë¯¸ì§€ ê°ê° í…ŒìŠ¤íŠ¸ form&#x27;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ì´ë¯¸ì§€ ê°ê° ì—…ë¡œë“œ (fields) ì²˜ë¦¬</span></span><br><span class="line">router.post(<span class="string">&#x27;/fields&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> uploadInit = upload.multerInit(<span class="string">&#x27;images&#x27;</span>).fields([&#123; <span class="attr">name</span>: <span class="string">&#x27;attachment1&#x27;</span>, <span class="attr">maxCount</span>: <span class="number">1</span> &#125;, &#123; <span class="attr">name</span>: <span class="string">&#x27;attachment2&#x27;</span>, <span class="attr">maxCount</span>: <span class="number">1</span> &#125;]);</span><br><span class="line">  uploadInit(req, res, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);</span><br><span class="line">    <span class="keyword">const</span> uploadData = <span class="keyword">new</span> UploadModel(&#123;</span><br><span class="line">      title: req.body.title,</span><br><span class="line">      uploadImagePath: [upload.changeDBPath(req.files.attachment1[<span class="number">0</span>].path), upload.changeDBPath(req.files.attachment2[<span class="number">0</span>].path)],</span><br><span class="line">      uploadImageName: [req.files.attachment1[<span class="number">0</span>].filename, req.files.attachment2[<span class="number">0</span>].filename],</span><br><span class="line">      imageOriginalName: [req.files.attachment1[<span class="number">0</span>].originalname, req.files.attachment2[<span class="number">0</span>].originalname],</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> uploadData.save(<span class="function">(<span class="params">saveErr</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (saveErr) <span class="keyword">return</span> next(saveErr);</span><br><span class="line">      <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/download&#x27;</span>, <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// eslint-disable-next-line no-underscore-dangle</span></span><br><span class="line">  UploadModel.findOne(&#123; <span class="attr">_id</span>: req.query._id &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">return</span> next(err);</span><br><span class="line">    <span class="keyword">if</span> (data.uploadImagePath.length === <span class="number">1</span>) &#123; <span class="comment">// <span class="doctag">NOTE:</span> ì—…ë¡œë“œ í•œê°œëŠ” ê·¸ëƒ¥ ë°”ë¡œ ë‹¤ìš´ë¡œë“œ.</span></span><br><span class="line">      res.cookie(<span class="string">&#x27;isDownload&#x27;</span>, <span class="string">&#x27;complete&#x27;</span>, &#123; <span class="comment">// <span class="doctag">NOTE:</span> ë¡œë”© ë°”ë¥¼ ìœ„í•œ ì¿ í‚¤ ê°’.</span></span><br><span class="line">        maxAge: <span class="number">10000</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      res.setHeader(<span class="string">&#x27;Content-disposition&#x27;</span>, <span class="string">&#x27;attachment&#x27;</span>); <span class="comment">// <span class="doctag">NOTE:</span> ì»¨í…ì¸  íƒ€ì… ì²¨ë¶€íŒŒì¼ë¡œ ì„¤ì •.</span></span><br><span class="line">      <span class="keyword">return</span> res.download(upload.changeUploadPath(data.uploadImagePath[<span class="number">0</span>]), data.imageOriginalName[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> upload.zipDownload(data.uploadImagePath, data.imageOriginalName).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">      res.cookie(<span class="string">&#x27;isDownload&#x27;</span>, <span class="string">&#x27;complete&#x27;</span>, &#123; <span class="comment">// <span class="doctag">NOTE:</span> ë¡œë”© ë°”ë¥¼ ìœ„í•œ ì¿ í‚¤ ê°’.</span></span><br><span class="line">        maxAge: <span class="number">10000</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      res.setHeader(<span class="string">&#x27;Content-disposition&#x27;</span>, <span class="string">&#x27;attachment&#x27;</span>); <span class="comment">// <span class="doctag">NOTE:</span> ì»¨í…ì¸  íƒ€ì… ì²¨ë¶€íŒŒì¼ë¡œ ì„¤ì •.</span></span><br><span class="line">      <span class="keyword">return</span> res.download(result);</span><br><span class="line">    &#125;).catch(<span class="function">(<span class="params">zipDownloadErr</span>) =&gt;</span> next(zipDownloadErr));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì‹±ê¸€(í•˜ë‚˜ì˜ íŒŒì¼)ì¸ ê²½ìš°ì—” req.file, ë‚˜ë¨¸ì§€ëŠ” req.filesì— íŒŒì¼ ì •ë³´ê°€ ë„˜ì–´ ì˜¨ë‹¤.</p><ul><li>fieldname: input file íƒœê·¸ ì´ë¦„</li><li>originalname: íŒŒì¼ì˜ ì›ë³¸ ì´ë¦„</li><li>encoding: íŒŒì¼ì˜ ì¸ì½”ë”©</li><li>mimetype: íŒŒì¼ì˜ í™•ì¥ì</li><li>size: íŒŒì¼ í¬ê¸°</li><li>filename: disk storage ì—ë§Œ í•´ë‹¹í•˜ëŠ” í”„ë¡œí¼í‹°ë¡œ ëª¨ë“ˆì—ì„œ ì‘ì„±í•œ ë°”ë€ íŒŒì¼ëª…</li><li>path: disk storage ì—ë§Œ í•´ë‹¹í•˜ëŠ” í”„ë¡œí¼í‹°ë¡œ ì„ì‹œ ì €ì¥ëœ íŒŒì¼ì˜ ì‹œìŠ¤í…œ ê²½ë¡œ</li></ul><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1568264595/ezgif.com-video-to-gif_ae3dpi.gif" alt="ë™ì‘ ì§¤"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js Mongoose ì‚¬ìš©í•´ë³´ê¸° - 2</title>
      <link href="/2018/06/18/nodejs-express-use-mongoose-2/"/>
      <url>/2018/06/18/nodejs-express-use-mongoose-2/</url>
      
        <content type="html"><![CDATA[<p>node.jsì—ì„œ mongooseë¡œ mongodb update, delete, join, group ì •ë¦¬í•œ ê¸€</p><h2 id="ë¬¸ì„œ-ê°±ì‹ "><a href="#ë¬¸ì„œ-ê°±ì‹ " class="headerlink" title="ë¬¸ì„œ ê°±ì‹ "></a>ë¬¸ì„œ ê°±ì‹ </h2><p>ë¬¸ì„œë¥¼ ì—…ë°ì´íŠ¸ í•˜ëŠ” ë°©ë²•ì´ ëª‡ ê°œ ì‡ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/update1&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.findOne(&#123; <span class="attr">userName</span>: <span class="string">&#x27;ë‚ ê°•ë‘&#x27;</span> &#125;, <span class="function">(<span class="params">err, User</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (User.length == <span class="number">0</span>) &#123;</span><br><span class="line">            res.json(<span class="string">&#x27;ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            User.position = <span class="string">&#x27;ë¨¹íŠ€&#x27;</span>;</span><br><span class="line">            User.save(<span class="function">(<span class="params">err, UpdateUser</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                    req.json(err);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    res.json(UpdateUser);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>findOneì—ì„œ ë¬¸ì„œë¥¼ ì¡°íšŒ í›„ ì½œë°± ë°›ì€ ë°ì´í„°ì— ë°”ê¿€ êº¼ ë„£ê³  ì„¸ì´ë¸Œ í•˜ë©´ ê°±ì‹  ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c41cc2a822207ecb315e8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">  <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ë¨¹íŠ€&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">  <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì´ì „ì—” update í•˜ë‚˜ ì—¿ëŠ”ë° updateOne, updateManyë¡œ ë°”ë€Œì—‡ë‹¤ -_-</p><p>ë­”ê°€ sqlì˜ update set â€¦ ëŠë‚Œ ë‚˜ëŠ” ë°©ë²•ìœ¼ë¡œë„ ê°±ì‹  í•  ìˆ˜ ì‡ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> í†µìƒì ì¸ update</span></span><br><span class="line">router.get(<span class="string">&#x27;/update2&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.updateOne(</span><br><span class="line">        &#123; <span class="attr">userName</span>: <span class="string">&#x27;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">$set</span>: &#123; <span class="attr">userMail</span>: <span class="string">&#x27;ë¨¹íŠ€@ìœ ë²¤íˆ¬ìŠ¤.com&#x27;</span> &#125; &#125;,</span><br><span class="line">        (err) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                res.json(err);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.json(<span class="string">&#x27;update success&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>updateOneì€ ë­ ì¡°ê±´ì— ë§ëŠ” ë°ì´í„° ì¤‘ ì²« ë²ˆì§¸ ë°ì´í„°ë§Œ ê°±ì‹  í•œë‹¤ëŠ” ê²ƒ.</p><p>ê·¸ë¦¬ê³  ì´ê±°ëŠ” ë”°ë¡œ ê°±ì‹ ëœ ë°ì´í„°ë¥¼ ì½œë°±ìœ¼ë¡œ ëª» ë°›ëŠ”ë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565279067/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-09_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_12.44.10_ezlq9k.png" alt="ê²°ê³¼"></p><p>ì—¬ëŸ¬ ë¬¸ì„œë¥¼ ê°±ì‹ í• ë ¤ë©´ updateManyë¥¼ ì“°ë©´ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/ @TODO: í†µìƒì ì¸ update</span><br><span class="line">router.get(<span class="string">&#x27;/update3&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.updateMany(</span><br><span class="line">        &#123; <span class="attr">position</span>: <span class="string">&#x27;ê³µê²©ìˆ˜&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">$set</span>: &#123; <span class="attr">userNum</span>: <span class="number">999</span> &#125; &#125;,</span><br><span class="line">        (err) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                res.json(err);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.json(<span class="string">&#x27;update success&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ë§ˆì°¬ê°€ì§€ë¡œ ì½œë°± ë°›ëŠ” ë°ì´í„°ê°€ ì—…ìŒ.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565279206/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-09_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_12.46.31_itnhiu.png" alt="ê²°ê³¼"></p><p>ì–´íœ´ ë§ë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•˜ëŠ” ê±° í•˜ë‚˜ ë” ì ìŒ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/update4&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.findOneAndUpdate(</span><br><span class="line">        &#123; <span class="attr">userName</span>: <span class="string">&#x27;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">$set</span>: &#123; <span class="attr">userMail</span>: <span class="string">&#x27;ì˜ˆì „ìš°ë¦¬í˜•@ìœ ë²¤íˆ¬ìŠ¤.com&#x27;</span> &#125; &#125;,</span><br><span class="line">        &#123; <span class="attr">new</span>: <span class="literal">true</span> &#125;, <span class="comment">// new: trueë¥¼ ê¼­ ì ì–´ì¤˜ì•¼ ê²°ê³¼ ë°˜í™˜ì´ ë¨</span></span><br><span class="line">        (err, data) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                res.json(err);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.json(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì¡°ê±´ì— ë§ëŠ” ë°ì´í„° ì¤‘ì— ì²« ë²ˆì§¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ê°±ì‹ ì„ í•¨. ë‚˜ë¦„ í¸ë¦¬í•˜ë‹¤.</p><p>ê²°ê³¼ë„ ì½œë°±ìœ¼ë¡œ ë°›ì•„ ë³¼ìˆ˜ë„ ì‡ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c41cc2a822207ecb315e8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">  <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ë¨¹íŠ€&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ì˜ˆì „ìš°ë¦¬í˜•@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">  <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ê·¼ë° ì˜ˆì „ ë²„ì „ì—ì„  ì•ˆ ë–³ëŠ”ë° ì•„ë§ˆ 5.Xë¶€í„° ìƒê²»ë‚˜ë´„. deprecated ì–´ì©Œêµ¬ê°€ ëœ¬ë‹¤.</p><p>í•´ê²° ë°©ë²•ì€ mongoose connectì—ì„œ í•˜ë‚˜ ì¶”ê°€ í•´ì£¼ë©´ ì•ˆ ëœ¸.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongodb = mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/localtest&#x27;</span>, &#123;</span><br><span class="line">    useNewUrlParser: <span class="literal">true</span>,</span><br><span class="line">    useFindAndModify: <span class="literal">false</span> <span class="comment">// ì´ê±° ì¶”ê°€ í•˜ê³  falseë¡œ í•˜ë©´ ëœë‹¤.</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><p>ì´ì „ì—” removeë¡œ í–ˆëŠ”ë° ë¬¸ì„œ ë³´ë‹ˆ ì–˜ë„ deleteOne, deleteManyê°€ ìƒê¹€ã…‹ ì»¨ì…‰ì¸ê°€?!</p><p>ì•”íŠ¼ í•´ë³´ì.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> ì¡°ê±´ì— ë§ëŠ” ì²« ë²ˆì§¸ ë¬¸ì„œë¥¼ ì‚­ì œí•  ë•Œ. ìƒˆë¡œ ìƒê²»êµ°...</span></span><br><span class="line">router.get(<span class="string">&#x27;/deleteOne&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.deleteOne(&#123; <span class="attr">userName</span>: <span class="string">&#x27;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&#x27;</span> &#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(<span class="string">&#x27;ì‚­ì œë¨.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ë­ ì¡°ê±´ì— ë§ëŠ” ì²« ë²ˆì§¸ ë°ì´í„° ì‚­ì œì„. ë¡œì»¬ì— ì‡ëŠ” ë‚ ê°•ë‘ ë¬¸ì„œê°€ ì‚­ì œë˜ì—‡ë‹¤.</p><p>deleteManyëŠ” ë­ ì—¬ëŸ¬ ê°œ ì‚­ì œí•˜ëŠ”ê±°ê²Ÿì§€..</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> ì¡°ê±´ì— ë§ëŠ” ì—¬ëŸ¬ ë°ì´í„°ë¥¼ ì‚­ì œ í•  ë•Œ. ì´ê±°ë„ ë§ˆì°¬ê°€ì§€ë¡œ ìƒˆë¡œ ìƒê²»êµ¬ë¨¼..</span></span><br><span class="line">router.get(<span class="string">&#x27;/deleteMany&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.deleteMany(&#123;&#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(<span class="string">&#x27;ì‚­ì œë¨.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì¡°ê±´ ë¹¼ê³  ì§€ì›Œë´£ë”ë‹ˆ ë‹¤ ì§€ì›Œì§€ë„¤. ã…‡ã…‹</p><h2 id="join"><a href="#join" class="headerlink" title="join"></a>join</h2><p>mongodbëŠ” nosqlì´ë¼ ì¼ë‹¨ ê´€ê³„ë¥¼ ì§€ì–‘ í•˜ëŠ”ë° ê·¸ë˜ë„ í•„ìš”? í•  ë•Œ ì“°ë¼ê³  ë§Œë“ ê±° ê°™ìŒ.</p><p>populateë‘ lookup ìœ¼ë¡œ ì´ì „ì— ì¡°ì¸ì„ í–‡ì—‡ëŠ”ë° ì§€ê¸ˆë„ ì˜ ë˜ëŠ”ì§€ í™•ì¸ í•´ë³´ì.</p><p>ì¡°ì¸ì„ í•˜ê¸° ìœ„í•´ íŒ€ ë°ì´í„°ë¥¼ ì €ì¥í•  ì»¬ë ‰ì…˜ì„ í•˜ë‚˜ ë¯¸ë¦¬ ë§Œë“œëŸ¿ì—‡ìŒ. </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> teamSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    teamName: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">&#x27;teams&#x27;</span>, teamSchema);</span><br></pre></td></tr></table></figure><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565279445/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-09_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_12.50.29_y23dip.png" alt="ë”ë¯¸"></p><p>ê·¼ë° ì¡°ì¸ì„ í• ë ¤ë©´ ë­”ê°€ ë°ì´í„°ê°€ ì‡ì–´ì•¼ í•˜ë‹ˆ ë¯¸ë¦¬ ë”ë¯¸ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ ë‘ì—‡ê³ </p><p>ì €ë²ˆì— ìœ ì € ë„íë¨¼íŠ¸ë¥¼ ë§Œë“¤ ë•Œ ìœ„ì˜ ìƒì„± ê°’ìœ¼ë¡œ ë„£ì–´ì¤€ê±°ì„.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> Schema(&#123; <span class="comment">// ìœ ì € ìŠ¤í‚¤ë§ˆ ì •ì˜</span></span><br><span class="line">    userName: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required: [<span class="literal">true</span>, <span class="string">&#x27;ì•„ì´ë””ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.&#x27;</span>] <span class="comment">// í•„ìˆ˜ ê°’ validation</span></span><br><span class="line">    &#125;,</span><br><span class="line">    userNum: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        required: [<span class="literal">true</span>, <span class="string">&#x27;ë“±ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.&#x27;</span>] <span class="comment">// í•„ìˆ˜ ê°’ validation</span></span><br><span class="line">    &#125;,</span><br><span class="line">    position: <span class="built_in">String</span>,</span><br><span class="line">    userMail: <span class="built_in">String</span>,</span><br><span class="line">    team: &#123;</span><br><span class="line">        type: Schema.Types.ObjectId, <span class="comment">// populateë¥¼ ì´ìš©í•˜ê¸° ìœ„í•œ íƒ€ì… ì²˜ë¦¬</span></span><br><span class="line">        ref: <span class="string">&#x27;teams&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    createAt: &#123;</span><br><span class="line">        type: <span class="built_in">Date</span>,</span><br><span class="line">        <span class="keyword">default</span>: <span class="built_in">Date</span>.now() <span class="comment">// ê¸°ë³¸ ê°’ ì˜¤ëŠ˜ë‚ ì§œë¡œ ì„¤ì •</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">&#x27;users&#x27;</span>, userSchema);</span><br></pre></td></tr></table></figure><p>ì €ë²ˆ ê¸€ì— ì ì€ ìœ ì € ìŠ¤í‚¤ë§ˆì— teamì´ë¼ëŠ” í”„ë¡œí¼í‹°ê°€ rdbì—ì„œ fk ì„¤ì • í•˜ë“¯ì´ </p><p>ê·¸ëŸ° ëŠë‚Œì¸ë° typeì€ mongoì˜ ê³ ìœ  ID, ì°¸ì¡° í…Œì´ë¸”ì€ íŒ€ í…Œì´ë¸”ì´ë‹¤.</p><p>ì¦‰ teams ì»¬ë ‰ì…˜ì˜ ê³ ìœ  ì•„ë””ë¥¼ fkë¡œ.</p><p>í›„ ì´ì œ populateë¥¼ ì´ìš©í•´ joinì´ ëœ ê²°ê³¼ë¥¼ ë³´ì.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/populate&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.find(&#123;&#125;).populate(<span class="string">&#x27;team&#x27;</span>).exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ê²°ê³¼ëŠ” ì´ëŸ¬ í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c4428ebc6bc081f7a83c1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">      <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ìœ ë²¤íˆ¬ìŠ¤&quot;</span>,</span><br><span class="line">      <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c442debc6bc081f7a83c2&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ëª¨í•˜ë©”ë“œ ì‚´ë¼&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565e&quot;</span>,</span><br><span class="line">      <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ë¦¬ë²„í’€&quot;</span>,</span><br><span class="line">      <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ì´ì§‘íŠ¸ë©”ì‹œ@ë¦¬ë²„í’€.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c442debc6bc081f7a83c3&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í”¼ì—ë¥´ì—ë©”ë¦­ ì˜¤ë°”ë©”ì–‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">17</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">      <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ì•„ìŠ¤ë‚ &quot;</span>,</span><br><span class="line">      <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë“ì ì™•@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c442debc6bc081f7a83c4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ë©”ìˆ˜íŠ¸ ì™¸ì§ˆ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ë¯¸ë“œí•„ë”&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">      <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ì•„ìŠ¤ë‚ &quot;</span>,</span><br><span class="line">      <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë…¸ë‘ë¨¸ë¦¬@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ì„ ìˆ˜ ë°‘ì— íŒ€ì´ ë‹¤ ì¢…ì†ìœ¼ë¡œ ë“¤ì–´ê°€ ìˆë‹¤.</p><p>ì•”íŠ¼ populateë¥¼ ì“°ë ¤ë©´ ë¯¸ë¦¬ ìŠ¤í‚¤ë§ˆì—ì„œ join í•˜ê¸° ì „ì— íƒ€ì…ì„ ì •í•´ë†”ì•¼ í•˜ê³ , </p><p>íƒ€ì…ì„ objectId ì™¸ì—ëŠ” ì‚¬ìš©í•  ìˆ˜ê°€ ì—†ë‹¤.</p><p>ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì¢€ ì „ì˜ ì¡°ì¸ì„ ë°˜ëŒ€ë¡œ í•´ë³´ì.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/lookup&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    teamModel.aggregate([</span><br><span class="line">        <span class="comment">// &#123;</span></span><br><span class="line">        <span class="comment">//     &quot;$match&quot;: &#123; // ì¡°ê±´ì ˆ ì“°ê³  ì‹¶ìœ¼ë©´ ì—¬ê¸°ì—.</span></span><br><span class="line">        <span class="comment">//         </span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">// &#125;,</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;$sort&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;_id&quot;</span>: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;$lookup&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;localField&quot;</span>: <span class="string">&quot;_id&quot;</span>,</span><br><span class="line">                <span class="string">&quot;from&quot;</span>: <span class="string">&quot;users&quot;</span>,</span><br><span class="line">                <span class="string">&quot;foreignField&quot;</span>: <span class="string">&quot;team&quot;</span>,</span><br><span class="line">                <span class="string">&quot;as&quot;</span>: <span class="string">&quot;users&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]).exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ê²°ê³¼ëŠ” ì´ëŸ¬í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">    <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ìœ ë²¤íˆ¬ìŠ¤&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;users&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c4428ebc6bc081f7a83c1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">        <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ë¦¬ë²„í’€&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;users&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c442debc6bc081f7a83c2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ëª¨í•˜ë©”ë“œ ì‚´ë¼&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">        <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">        <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565e&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ì´ì§‘íŠ¸ë©”ì‹œ@ë¦¬ë²„í’€.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ì•„ìŠ¤ë‚ &quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;users&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c442debc6bc081f7a83c3&quot;</span>,</span><br><span class="line">        <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í”¼ì—ë¥´ì—ë©”ë¦­ ì˜¤ë°”ë©”ì–‘&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userNum&quot;</span>: <span class="number">17</span>,</span><br><span class="line">        <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">        <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë“ì ì™•@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c442debc6bc081f7a83c4&quot;</span>,</span><br><span class="line">        <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ë©”ìˆ˜íŠ¸ ì™¸ì§ˆ&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">        <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ë¯¸ë“œí•„ë”&quot;</span>,</span><br><span class="line">        <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë…¸ë‘ë¨¸ë¦¬@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>lookupì´ ì›ë˜ ê´€ê³„ë¥¼ ë§ºìœ¼ë¼ê³  ë‚˜ì˜¨ ê¸°ëŠ¥ì´ ì•„ë‹ˆê³  ì§‘ê³„ ê´€ë ¨ìœ¼ë¡œ ì•Œê³  ì‡ëŠ”ë°</p><p>ë­ ì•”íŠ¼ ê´€ê³„ëŠ” ì™ ë§Œ í•˜ë©´ ì“°ì§€ ë§ì. </p><p>ì•„ ì¶”ê°€ë¡œ ìœ„ì— $lookup ë°‘ì—</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">&quot;$unwind&quot;</span>: <span class="string">&quot;$users&quot;</span> &#125;</span><br></pre></td></tr></table></figure><p>ì¶”ê°€í•˜ë©´ ì•„ìŠ¤ë‚  ì²˜ëŸ¼ ë°°ì—´ì— ì‡ë˜ ì• ë“¤ì˜ ê²°ê³¼ê°€ ë¶„ë¦¬ëœë‹¤. ë­ ì“¸ ì¼ì´ ì–¸ì  ê°€ ì‡ì„ë˜ë‚˜?</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">    <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ìœ ë²¤íˆ¬ìŠ¤&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;users&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c4428ebc6bc081f7a83c1&quot;</span>,</span><br><span class="line">      <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">      <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">      <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ë¦¬ë²„í’€&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;users&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c442debc6bc081f7a83c2&quot;</span>,</span><br><span class="line">      <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ëª¨í•˜ë©”ë“œ ì‚´ë¼&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">      <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565e&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ì´ì§‘íŠ¸ë©”ì‹œ@ë¦¬ë²„í’€.com&quot;</span>,</span><br><span class="line">      <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ì•„ìŠ¤ë‚ &quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;users&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c442debc6bc081f7a83c3&quot;</span>,</span><br><span class="line">      <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í”¼ì—ë¥´ì—ë©”ë¦­ ì˜¤ë°”ë©”ì–‘&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userNum&quot;</span>: <span class="number">17</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">      <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë“ì ì™•@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">      <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;teamName&quot;</span>: <span class="string">&quot;ì•„ìŠ¤ë‚ &quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">&quot;users&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c442debc6bc081f7a83c4&quot;</span>,</span><br><span class="line">      <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:42:53.213Z&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ë©”ìˆ˜íŠ¸ ì™¸ì§ˆ&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ë¯¸ë“œí•„ë”&quot;</span>,</span><br><span class="line">      <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">      <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë…¸ë‘ë¨¸ë¦¬@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">      <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="ê·¸ë£¹"><a href="#ê·¸ë£¹" class="headerlink" title="ê·¸ë£¹"></a>ê·¸ë£¹</h2><p>aggregateì— ë‚´ì¥ë˜ì–´ ìˆëŠ” ë©”ì†Œë“œ ì¤‘ì— groupì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/group&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.aggregate([</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;$group&quot;</span>: &#123; <span class="comment">// ê³ ì •ëœ í˜•ì‹.</span></span><br><span class="line">                <span class="string">&quot;_id&quot;</span>: &#123; <span class="string">&quot;position&quot;</span>: <span class="string">&quot;$position&quot;</span> &#125;, <span class="comment">// &#123; &#x27;alias ( ê²°ê³¼ í•„ë“œëª… )&#x27;: &#x27;$ì‚¬ìš©í•  í•„ë“œëª…&#x27; &#125;</span></span><br><span class="line">                <span class="string">&quot;count&quot;</span>: &#123; <span class="string">&quot;$sum&quot;</span>: <span class="number">1</span> &#125; <span class="comment">// ì§‘ê³„ ë©”ì†Œë“œ ë”°ë¡œ Countê°€ ì—…ìŒ.</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]).exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ê²°ê³¼ëŠ” ì´ëŸ¬í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ë¯¸ë“œí•„ë”&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;count&quot;</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;count&quot;</span>: <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ì—¬ê¸°ì„œì˜ _idëŠ” $groupì´ ì‚¬ìš©í•˜ëŠ” ê³ ì •ëœ í˜•ì‹. ë°”ê¾¸ë©´ ì—ëŸ¬ ë‚œë‹¤..</p><p>ì´ ë°–ì—ë„ aggregateëŠ” ë‹¤ì–‘í•œ í•¨ìˆ˜ë“¤ì´ ìˆìœ¼ë‹ˆ ì°¨ì°¨ í•„ìš” í•  ë•Œë§ˆë‹¤</p><p>ë²ˆì—­ê¸°ë¥¼ ëŒë ¤ì„œ ë¬¸ì„œë¥¼ ë´ì•¼ê² ë‹¤..</p><p>íœ´ ë.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="https://mongoosejs.com/docs/">mongoose doc</a></li><li><a href="https://docs.mongodb.com/manual/crud/">mongodb doc</a></li><li><a href="https://github.com/hidelryn/mongoose-example">ì‘ì„±í•œ ì½”ë“œ</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
            <tag> ORM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js Mongoose ì‚¬ìš©í•´ë³´ê¸° - 1</title>
      <link href="/2018/06/17/nodejs-express-use-mongoose-1/"/>
      <url>/2018/06/17/nodejs-express-use-mongoose-1/</url>
      
        <content type="html"><![CDATA[<p>mongodb ì„¤ì¹˜, mongooseë¡œ mongodb ì—°ê²° ë° ìŠ¤í‚¤ë§ˆ ì •ì˜, create, readê¹Œì§€ ì •ë¦¬í•œ ê¸€</p><h2 id="mongodb-ì„¤ì¹˜"><a href="#mongodb-ì„¤ì¹˜" class="headerlink" title="mongodb ì„¤ì¹˜"></a>mongodb ì„¤ì¹˜</h2><p>mac ê¸°ì¤€ homebrewë¡œ í¸í•˜ê²Œ ã„±ã„±</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">brew install mongodb</span><br><span class="line">sudo mkdir -p /data/db</span><br><span class="line">whoami <span class="comment"># ì‚¬ìš©ìëª… ì¶œë ¥</span></span><br><span class="line">sudo chown í„°ë¯¸ë„ì— ë‚˜ì˜¨ ì‚¬ìš©ìëª… /data/db</span><br><span class="line">brew services start mongo</span><br></pre></td></tr></table></figure><p>ì‚¬ìš©í•œ mongoose ë²„ì „ì€ 5.6.8ì´ë‹¤. ë²„ì „ ì•ì´ ë°”ë€Œì—‡êµ¬ë¨¼ í—ˆí—ˆ</p><p>ì½”ë“œëŠ” ê·€ì°¬ìœ¼ë‹ˆ mongoose ìª½ ë¶€ë¶„ë§Œ.</p><h2 id="ì—°ê²°-ì„¤ì •"><a href="#ì—°ê²°-ì„¤ì •" class="headerlink" title="ì—°ê²° ì„¤ì •"></a>ì—°ê²° ì„¤ì •</h2><p>ì—°ê²°ì€ 4.X.Xë‘ ì•„ì£¼ ìª¼ê¸ˆ ë°”ë€Œì—‡ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line">mongoose.Promise = <span class="built_in">global</span>.Promise;</span><br><span class="line"><span class="keyword">const</span> mongodb = mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/localtest&#x27;</span>, &#123;</span><br><span class="line">    useNewUrlParser: <span class="literal">true</span> <span class="comment">// ì´ ë¶€ë¶„ì´ ë‹¤ë¥¸ê±¸ë¡œ ë°”ë€œ</span></span><br><span class="line">&#125;);</span><br><span class="line">mongodb.then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;mongodb has been connected&#x27;</span>);</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;mongodb connect err&#x27;</span>, err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ìŠ¤í‚¤ë§ˆ-ì •ì˜"><a href="#ìŠ¤í‚¤ë§ˆ-ì •ì˜" class="headerlink" title="ìŠ¤í‚¤ë§ˆ ì •ì˜"></a>ìŠ¤í‚¤ë§ˆ ì •ì˜</h2><p>ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•´ë‘ë©´ ì§ì ‘ db ì•ˆì„ ì•ˆ ë´ë„ êµ¬ì¡°ê°€ ì–´ë– ì¼€ ìƒê²¨ë¨¹ì—‡ëŠ”ì§€ ì•Œ ìˆ˜ê°€ ì‡ê³ </p><p>ì—°ê²°ì´ ì˜ ë˜ì–´ ì‡ìœ¼ë©´ ì‹¤ì œ ì»¬ë ‰ì…˜ì— ë°ì´í„° ì‚½ì…í•  ë–„ ì •ì˜í•œëŒ€ë¡œ ì»¬ë ‰ì…˜ ìƒì„±ì„ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> Schema(&#123; <span class="comment">// ìœ ì € ìŠ¤í‚¤ë§ˆ ì •ì˜</span></span><br><span class="line">    userName: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required: [<span class="literal">true</span>, <span class="string">&#x27;ì•„ì´ë””ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.&#x27;</span>] <span class="comment">// í•„ìˆ˜ ê°’ validation</span></span><br><span class="line">    &#125;,</span><br><span class="line">    userNum: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        required: [<span class="literal">true</span>, <span class="string">&#x27;ë“±ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.&#x27;</span>] <span class="comment">// í•„ìˆ˜ ê°’ validation</span></span><br><span class="line">    &#125;,</span><br><span class="line">    position: <span class="built_in">String</span>,</span><br><span class="line">    userMail: <span class="built_in">String</span>,</span><br><span class="line">    user: &#123;</span><br><span class="line">        type: Schema.Types.ObjectId, <span class="comment">// populateë¥¼ ì´ìš©í•˜ê¸° ìœ„í•œ íƒ€ì… ì²˜ë¦¬</span></span><br><span class="line">        ref: <span class="string">&#x27;teams&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    createAt: &#123;</span><br><span class="line">        type: <span class="built_in">Date</span>,</span><br><span class="line">        <span class="keyword">default</span>: <span class="built_in">Date</span>.now() <span class="comment">// ê¸°ë³¸ ê°’ ì˜¤ëŠ˜ë‚ ì§œë¡œ ì„¤ì •</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">&#x27;users&#x27;</span>, userSchema); <span class="comment">// user == ì»¬ë ‰ì…˜ëª…</span></span><br></pre></td></tr></table></figure><p>ì—¬ì „íˆ ì»¬ë ‰ì…˜ì„ ìƒì„± í•  ë•Œ user ì´ëŸ°ì‹ìœ¼ë¡œ ì •ì˜í•˜ë©´ ë³µìˆ˜í˜•ì¸ usersë¡œ ìë™ ë³€í™˜ ëœë‹¤.</p><p>ìŠ¤í‚¤ë§ˆì—ì„œ ì“¸ ìˆ˜ ì‡ëŠ” ë°ì´í„° íƒ€ì…ì€ ì •ë¦¬ë¥¼ í•´ë‘ì.</p><ul><li>String = ë¬¸ìì—´</li><li>Number = ìˆ«ì</li><li>Date = ë‚ ì§œí˜•</li><li>Boolean = true / false</li><li>Mixed = ì¡ì¢…, ì–´ë–¤ í˜•ì´ë“  ë‹¤ ê°€ëŠ¥.</li><li>ObjectId = mongodbì—ì„œ ì“°ëŠ” ê³ ìœ  ì•„ë”” í˜•ì‹ ê°™ìŒ.</li><li>Array = ë°°ì—´</li></ul><h2 id="document-ìƒì„±"><a href="#document-ìƒì„±" class="headerlink" title="document ìƒì„±"></a>document ìƒì„±</h2><p>mongodbëŠ” í•˜ë‚˜ì˜ documentê°€ mysqlì—ì„œ í•˜ë‚˜ì˜ rowì™€ ê°™ìŒ.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> userModel = <span class="built_in">require</span>(<span class="string">&#x27;../models/users&#x27;</span>); <span class="comment">// ì •ì˜í•œ ìŠ¤í‚¤ë§ˆ</span></span><br><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> 1 document ìƒì„±</span></span><br><span class="line">router.get(<span class="string">&#x27;/create&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> user = <span class="keyword">new</span> userModel(&#123; <span class="comment">// ìƒˆ ê°ì²´ì— ë„£ì„ ë°ì´í„° ì“´ë‹¤.</span></span><br><span class="line">        userName: <span class="string">&#x27;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&#x27;</span>,</span><br><span class="line">        userNum: <span class="number">7</span>,</span><br><span class="line">        position: <span class="string">&#x27;ê³µê²©ìˆ˜&#x27;</span>,</span><br><span class="line">        team: <span class="string">&#x27;5d4c412caf60c707c225565d&#x27;</span>, <span class="comment">// ì¼ë‹¨ ë¬´ì‹œ ì¡°ì¸í•  ë•Œ ì„¤ëª….</span></span><br><span class="line">        userMail: <span class="string">&#x27;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    user.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123; <span class="comment">// .save()ë¥¼ í˜¸ì¶œí•˜ë©´ ë.</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ì‡ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c41cc2a822207ecb315e8&quot;</span>, <span class="comment">// mongo ê³ ìœ  ID</span></span><br><span class="line">  <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">  <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">  <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ì—¬ëŸ¬-ê°œ-document-ìƒì„±"><a href="#ì—¬ëŸ¬-ê°œ-document-ìƒì„±" class="headerlink" title="ì—¬ëŸ¬ ê°œ document ìƒì„±"></a>ì—¬ëŸ¬ ê°œ document ìƒì„±</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> 2ê°œ ì´ìƒì˜ documentë¥¼ ìƒì„±.</span></span><br><span class="line">router.get(<span class="string">&#x27;/manyCreate&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> users = [</span><br><span class="line">        &#123;</span><br><span class="line">            userName: <span class="string">&#x27;ëª¨í•˜ë©”ë“œ ì‚´ë¼&#x27;</span>,</span><br><span class="line">            userNum: <span class="number">11</span>,</span><br><span class="line">            position: <span class="string">&#x27;ê³µê²©ìˆ˜&#x27;</span>,</span><br><span class="line">            team: <span class="string">&#x27;5d4c412caf60c707c225565e&#x27;</span>, <span class="comment">// ì¼ë‹¨ ë¬´ì‹œ.</span></span><br><span class="line">            userMail: <span class="string">&#x27;ì´ì§‘íŠ¸ë©”ì‹œ@ë¦¬ë²„í’€.com&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            userName: <span class="string">&#x27;í”¼ì—ë¥´ì—ë©”ë¦­ ì˜¤ë°”ë©”ì–‘&#x27;</span>,</span><br><span class="line">            userNum: <span class="number">17</span>,</span><br><span class="line">            position: <span class="string">&#x27;ê³µê²©ìˆ˜&#x27;</span>,</span><br><span class="line">            team: <span class="string">&#x27;5d4c412caf60c707c225565f&#x27;</span>,</span><br><span class="line">            userMail: <span class="string">&#x27;ë“ì ì™•@ì•„ìŠ¤ë‚ .com&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            userName: <span class="string">&#x27;ë©”ìˆ˜íŠ¸ ì™¸ì§ˆ&#x27;</span>,</span><br><span class="line">            userNum: <span class="number">11</span>,</span><br><span class="line">            position: <span class="string">&#x27;ë¯¸ë“œí•„ë”&#x27;</span>,</span><br><span class="line">            team: <span class="string">&#x27;5d4c412caf60c707c225565f&#x27;</span>,</span><br><span class="line">            userMail: <span class="string">&#x27;ë…¸ë‘ë¨¸ë¦¬@ì•„ìŠ¤ë‚ .com&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    ];</span><br><span class="line">    userModel.insertMany(users, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ë°°ì—´ ì•ˆì— objectë¡œ ì‚½ì…í•  ë°ì´í„°ë¥¼ ì ì–´ë‘ê³  insertManyë¥¼ í˜¸ì¶œí•˜ë©´ ë.</p><p>ì•„ ì˜ˆì „ì— ì¤‘ê°„ì— ë°ì´í„°ê°€ ë¹ ì ¸ì„œ ì—¿ë‚˜.. ê·¸ ë°– ì—¬ëŸ¬ ìš”ì¸ìœ¼ë¡œ ì¸í•´ ì •ìƒì ì¸ ì²˜ë¦¬ê°€ ì•ˆë˜ì—‡ì„ ë•Œ</p><p>ì»¬ë ‰ì…˜ì— ìˆëŠ” ë°ì´í„°ë“¤ì´ ì•„ì£¼ ê°œíŒì´ ë˜ì—‡ë˜ ì ì´ ì‡ì—‡ë˜ ê±¸ë¡œ ê¸°ì–µ í•œë‹¤ ì•”íŠ¼ ì¡°ì‹¬.</p><p>mongooseëŠ” ì‚½ì…í•˜ë©´ ë°”ë¡œë°”ë¡œ ë­ê°€ ë“¤ì–´ê°„ì§€ ë¦¬í„´ì´ ë˜ì„œ ì°¸ í¸í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315e9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ëª¨í•˜ë©”ë“œ ì‚´ë¼&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ì´ì§‘íŠ¸ë©”ì‹œ@ë¦¬ë²„í’€.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315ea&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í”¼ì—ë¥´ì—ë©”ë¦­ ì˜¤ë°”ë©”ì–‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">17</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë“ì ì™•@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315eb&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ë©”ìˆ˜íŠ¸ ì™¸ì§ˆ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ë¯¸ë“œí•„ë”&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë…¸ë‘ë¨¸ë¦¬@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ì•„ ê·¸ë¦¬ê³  ì•„ê¹Œ ìŠ¤í‚¤ë§ˆì— ì •ì˜ í•´ë†“ì€ requiredì— ëŒ€í•œ ì²˜ë¦¬ëŠ” ì–´ë–»ê²Œ í•˜ëŠ”ì§€ ì ì–´ë‘”ë‹¤.</p><p>ìƒˆë¡œ ìƒì„±í•˜ëŠ” documentì— requiredë¥¼ ê±¸ì–´ë…¼ í‚¤ì˜ ë°ì´í„°ë¥¼ ë¹¼ë¨¹ê³  ì‹¤í–‰í•´ë³´ì.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> mongoose validation</span></span><br><span class="line">router.get(<span class="string">&#x27;/validation&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> user = <span class="keyword">new</span> userModel(&#123;</span><br><span class="line">        userName: <span class="string">&#x27;í•´ë¦¬ ë§¥ê³¼ì´ì–´&#x27;</span>,</span><br><span class="line">        userNum: <span class="literal">null</span>,</span><br><span class="line">        position: <span class="string">&#x27;ìˆ˜ë¹„ìˆ˜&#x27;</span>,</span><br><span class="line">        userMail: <span class="string">&#x27;ë¹„ì‹¼ëª¸@ë§¨ìœ .com&#x27;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">let</span> validateErr = user.validateSync(); <span class="comment">// err return </span></span><br><span class="line">    user.save(<span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result &amp;&amp; !validateErr) &#123;</span><br><span class="line">            res.json(result);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(validateErr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>requiredì— ê±¸ë¦¬ë¯€ë¡œ ì—ëŸ¬ë¥¼ í• ë‹¹ ë°›ëŠ”ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;errors&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ë“±ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ValidatorError&quot;</span>,</span><br><span class="line">      <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ë“±ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.&quot;</span>,</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;required&quot;</span>,</span><br><span class="line">        <span class="string">&quot;path&quot;</span>: <span class="string">&quot;userNum&quot;</span>,</span><br><span class="line">        <span class="string">&quot;value&quot;</span>: <span class="literal">null</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="string">&quot;kind&quot;</span>: <span class="string">&quot;required&quot;</span>,</span><br><span class="line">      <span class="string">&quot;path&quot;</span>: <span class="string">&quot;userNum&quot;</span>,</span><br><span class="line">      <span class="string">&quot;value&quot;</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;_message&quot;</span>: <span class="string">&quot;users validation failed&quot;</span>,</span><br><span class="line">  <span class="string">&quot;message&quot;</span>: <span class="string">&quot;users validation failed: userNum: ë“±ë²ˆí˜¸ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ValidationError&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ë¬¸ì„œ-ì½ê¸°"><a href="#ë¬¸ì„œ-ì½ê¸°" class="headerlink" title="ë¬¸ì„œ ì½ê¸°"></a>ë¬¸ì„œ ì½ê¸°</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> ì¡°íšŒ &#123;&#125; ì˜¤ë¸Œì íŠ¸ ì•ˆì— ì¡°ê±´ì´ ë“¤ì–´ê°.</span></span><br><span class="line">router.get(<span class="string">&#x27;/find&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.find(&#123;&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>findë¥¼ í˜¸ì¶œí•˜ë©´ ëœë‹¤ {} ì•ˆì´ where ì ˆì´ë‹¤. ë‹¤ì–‘í•œ ì¡°ê±´ì„ ê±¸ ìˆ˜ê°€ ì´ì”€.</p><p>í˜„ì¬ëŠ” ì¡°ê±´ì´ ì—…ìœ¼ë‹ˆ ëª¨ë‘ ì¶œë ¥ í•œë‹¤. ê·¸ë¦¬ê³  findë¥˜ëŠ” ëª¨ë‘ Arrayíƒ€ì…ìœ¼ë¡œ ë¦¬í„´ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c41cc2a822207ecb315e8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315e9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ëª¨í•˜ë©”ë“œ ì‚´ë¼&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ì´ì§‘íŠ¸ë©”ì‹œ@ë¦¬ë²„í’€.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315ea&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í”¼ì—ë¥´ì—ë©”ë¦­ ì˜¤ë°”ë©”ì–‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">17</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë“ì ì™•@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315eb&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ë©”ìˆ˜íŠ¸ ì™¸ì§ˆ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ë¯¸ë“œí•„ë”&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë…¸ë‘ë¨¸ë¦¬@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>where ì¡°ê±´ì´ ë­ë­ ì‡ëŠ”ì§€ ì ì–´ë‘ì.</p><ul><li>$eqëŠ” ==</li><li>$gtëŠ” &gt;</li><li>$gteëŠ” &gt;=</li><li>$inì€ Arrayíƒ€ì… ì‹œ í•´ë‹¹ ë°ì´í„°ê°€ ì•ˆì— í¬í•¨ë˜ì—‡ëŠ”ì§€</li><li>$ltëŠ” &lt;</li><li>$lteëŠ” &lt;=</li><li>$neëŠ” !=</li><li>$ninì€ Arrayíƒ€ì… ì‹œ í•´ë‹¹ ë°ì´í„°ê°€ ì•ˆì— í¬í•¨ ì•ˆë˜ì–´ì‡ëŠ”ì§€</li></ul><p>ì¡°ê±´ì ˆì€ ë‹¤ ì¼ì¼íˆ ì ê¸´ ê·€ì°¬ìœ¼ë‹ˆê¹Œ í•˜ë‚˜ë§Œ ì˜ˆë¡œ.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> ì¡°ê±´ì ˆ ì˜ˆì‹œ ì•„ë˜ëŠ” or</span></span><br><span class="line">router.get(<span class="string">&#x27;/or&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.find(&#123;</span><br><span class="line">        $or: [&#123; <span class="attr">userName</span>: <span class="string">&#x27;ë©”ìˆ˜íŠ¸ ì™¸ì§ˆ&#x27;</span> &#125;, &#123; <span class="attr">userName</span>: <span class="string">&#x27;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&#x27;</span> &#125;]</span><br><span class="line">    &#125;).exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ìŒ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c41cc2a822207ecb315e8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315eb&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ë©”ìˆ˜íŠ¸ ì™¸ì§ˆ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ë¯¸ë“œí•„ë”&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë…¸ë‘ë¨¸ë¦¬@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>íŠ¹ì • í•„ë“œë§Œ ë°›ì„ ê²½ìš°ëŠ” ì•„ë˜ ì²˜ëŸ¼ í•˜ë©´ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> íŠ¹ì • í•„ë“œë§Œ ì½ê³  ì‹¶ì„ ë•Œ.</span></span><br><span class="line">router.get(<span class="string">&#x27;/find-attr&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.find(&#123;&#125;).select(<span class="string">&#x27;userName userMail&#x27;</span>)</span><br><span class="line">        .exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                res.json(err);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                res.json(data);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì•„ sqlì˜ select username, userMail from â€¦ ë­ ì´ëŸ° ê±°.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c41cc2a822207ecb315e8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315e9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ëª¨í•˜ë©”ë“œ ì‚´ë¼&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ì´ì§‘íŠ¸ë©”ì‹œ@ë¦¬ë²„í’€.com&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315ea&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í”¼ì—ë¥´ì—ë©”ë¦­ ì˜¤ë°”ë©”ì–‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë“ì ì™•@ì•„ìŠ¤ë‚ .com&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315eb&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ë©”ìˆ˜íŠ¸ ì™¸ì§ˆ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë…¸ë‘ë¨¸ë¦¬@ì•„ìŠ¤ë‚ .com&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>sqlì˜ like ê°™ì€ ê¸°ëŠ¥ì´ mongoì—ì„  regexë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> ì¡°ê±´ìœ¼ë¡œ ì •ê·œì‹ ì‚¬ìš©, sql likeê³¼ ê°™ì€ ê¸°ëŠ¥.</span></span><br><span class="line">router.get(<span class="string">&#x27;/regex&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;  </span><br><span class="line">    userModel.find(&#123; <span class="attr">userName</span>: &#123; <span class="attr">$regex</span>: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;ë‚ ê°•ë‘&#x27;</span>, <span class="string">&#x27;i&#x27;</span>) &#125; &#125;).exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ë‚ ê°•ë‘ê°€ í¬í•¨í•œ ì´ë¦„ì„ ê²€ìƒ‰í•˜ëŠ”ê±´ë° ì•„ì§ ìì£¼ ì•ˆì¨ë´ì„œ ì¢€.. likeë¬¸ë„ ê¸°ì–µì´ ì˜..</p><p><a href="https://docs.mongodb.com/manual/reference/operator/query/regex/">mongodb regex</a></p><p>í•„ìš”í•  ë• ê³µì‹ ë¬¸ì„œë¥¼ ë²ˆì—­ê¸°ë¡œ ëŒë ¤ë³´ì ì•”íŠ¼ ê²°ê³¼ëŠ” ì´ëŸ¬í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c41cc2a822207ecb315e8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ë¦¬í„´ ë°›ëŠ” ê°œìˆ˜ë¥¼ ì •í•´ì„œ ë°›ê³  ì‹¶ìœ¼ë©´ ì•„ë˜ ì²˜ëŸ¼ í•˜ë©´ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> ê°œìˆ˜ ì œí•œ.</span></span><br><span class="line">router.get(<span class="string">&#x27;/limit&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.find(&#123;&#125;).limit(<span class="number">2</span>).exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>sqlì—ì„œ select top 2 â€¦ ë˜ëŠ” select * â€¦ limit 2; ì´ëŸ° ê±°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c41cc2a822207ecb315e8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315e9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ëª¨í•˜ë©”ë“œ ì‚´ë¼&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565e&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ì´ì§‘íŠ¸ë©”ì‹œ@ë¦¬ë²„í’€.com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ì¡°íšŒ í–‡ì„ ì‹œ í•´ë‹¹ ìˆ«ìë§Œí¼ ê±´ë„ˆë›°ë ¤ë©´ ì•„ë˜ ì²˜ëŸ¼ í•˜ë©´ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> í•´ë‹¹ ìˆ«ìë§Œí¼ ê±´ë„ˆë›°ê³  ì¡°íšŒ ê²°ê³¼ ë¦¬í„´.</span></span><br><span class="line">router.get(<span class="string">&#x27;/skip&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.find(&#123;&#125;).skip(<span class="number">2</span>).exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ê¸€ì„ ì´ê±° í˜ì´ì§• êµ¬í˜„í•  ë•Œ ë§ê³¤ ì¨ ë³¸ ê¸°ì–µì´ ì—…ë‹¤</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315ea&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í”¼ì—ë¥´ì—ë©”ë¦­ ì˜¤ë°”ë©”ì–‘&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">17</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë“ì ì™•@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c42242a822207ecb315eb&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;ë©”ìˆ˜íŠ¸ ì™¸ì§ˆ&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userNum&quot;</span>: <span class="number">11</span>,</span><br><span class="line">    <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ë¯¸ë“œí•„ë”&quot;</span>,</span><br><span class="line">    <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565f&quot;</span>,</span><br><span class="line">    <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë…¸ë‘ë¨¸ë¦¬@ì•„ìŠ¤ë‚ .com&quot;</span>,</span><br><span class="line">    <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ì•„ ì •ë ¬ì´ ì—…êµ°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> ì •ë ¬.</span></span><br><span class="line">router.get(<span class="string">&#x27;/sort&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.find(&#123;&#125;).sort(&#123; <span class="attr">id</span>: <span class="number">-1</span> &#125;).exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>í•„ë“œ: 1ì´ë©´ ì˜¤ë¦„ì°¨ìˆœ, í•„ë“œ: -1ì´ë©´ ë‚´ë¦¼ì°¨ìˆœì´ë‹¤.</p><p>ì •ë ¬ í•  í•„ë“œ ê¸°ì¤€ì´ ì—¬ëŸ¬ ê°œë©´ {í•„ë“œ: 1, í•„ë“œ: -1 â€¦} ì´ëŸ°ì‹ìœ¼ë¡œ ì¶”ê°€ë¥¼ í•˜ë©´ ë˜ëŠ”ë° </p><p>ì •ë ¬ ìˆœë„ ì—­ì‹œ ì íŒëŒ€ë¡œ ì•ì— êº¼ ë¶€í„° ë¨¼ì € ì •ë ¬ í›„ ê·¸ ë’¤ì— ë‹¤ìŒ ì •ë ¬ì„.</p><p>ì•„ ì¡°ê±´ì— ë§ê²Œ ì¡°íšŒí–ˆì„ ë•Œ ì²« ë²ˆì§¸ ë¬¸ì„œë§Œ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ì´ ë”°ë¡œ ì‡ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @<span class="doctag">TODO:</span> ì¡°ê±´ì— ë§ëŠ” ë°ì´í„° ì¡°íšŒ í•´ì„œ ì²« ë²ˆì§¸ ë¬¸ì„œë§Œ ë¦¬í„´.</span></span><br><span class="line">router.get(<span class="string">&#x27;/findOne&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    userModel.findOne(&#123; <span class="attr">userName</span>: <span class="string">&#x27;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&#x27;</span> &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            res.json(err);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.json(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>íŠ¹ì´ì ì€ findë¥˜ëŠ” ë‹¤ Array ì•ˆì— Objectê°€ í¬í•¨ì´ì§€ë§Œ ì–˜ëŠ” ë‹¨ë… Objectë¡œ ë„˜ì–´ì˜´.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;createAt&quot;</span>: <span class="string">&quot;2019-08-08T15:37:45.028Z&quot;</span>,</span><br><span class="line">  <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;5d4c41cc2a822207ecb315e8&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userName&quot;</span>: <span class="string">&quot;í¬ë¦¬ìŠ¤í‹°ì•„ëˆ„ ë‚ ê°•ë‘&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userNum&quot;</span>: <span class="number">7</span>,</span><br><span class="line">  <span class="string">&quot;position&quot;</span>: <span class="string">&quot;ê³µê²©ìˆ˜&quot;</span>,</span><br><span class="line">  <span class="string">&quot;userMail&quot;</span>: <span class="string">&quot;ë‚ ê°•ë‘@ìœ ë²¤íˆ¬ìŠ¤.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;team&quot;</span>: <span class="string">&quot;5d4c412caf60c707c225565d&quot;</span>,</span><br><span class="line">  <span class="string">&quot;__v&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ì—‡ ê¸€ì´ ë„ˆë¬´ ê¸¸ì–´ì§„ë‹¤. ë‚˜ëˆ ì„œ ë‚´ì¼ 2í¸ì„ ì‘ì„± í•˜ì.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
            <tag> ORM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js async ëª¨ë“ˆ ì‚¬ìš©í•´ë³´ê¸°</title>
      <link href="/2018/06/16/nodejs-async-lib/"/>
      <url>/2018/06/16/nodejs-async-lib/</url>
      
        <content type="html"><![CDATA[<p>ìš”ì¦˜ì—ëŠ” node.jsì—ì„œ async/await, promiseë¥¼ ì§€ì›í•´ì¤˜ì„œ ì£¼ë¡œ ì“°ì§€ë§Œ ì²˜ìŒ ì…ë¬¸í•˜ì—¿ì„ ë• ì§€ì›ì´ ì•ˆ ë˜ì„œ <a href="https://www.npmjs.com/package/async">async</a> ëª¨ë“ˆì„ ì£¼ë¡œ ì»ì—‡ë‹¤. ì§€ê¸ˆë„ ì¢…ì¢… ì• ìš©í•˜ëŠ” ì¤‘</p><h2 id="ìˆœì°¨ì -ì²˜ë¦¬"><a href="#ìˆœì°¨ì -ì²˜ë¦¬" class="headerlink" title="ìˆœì°¨ì  ì²˜ë¦¬"></a>ìˆœì°¨ì  ì²˜ë¦¬</h2><p>series, waterfallì´ ì‡ë‹¤.</p><h3 id="series"><a href="#series" class="headerlink" title="series"></a>series</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">&#x27;async&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">4000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="number">3</span>);</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span>.series([a, b, c], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;results&#x27;</span>, results);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>í•¨ìˆ˜ì˜ ì‹¤í–‰ ì‹œê°„ì— ìƒê´€ ì—…ì´ í˜¸ì¶œí•œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ ê²°ê³¼ë¥¼ ë°°ì—´ì— ë°›ëŠ”ë‹¤.</p><p>í•¨ìˆ˜ì˜ ì½œë°±ì„ í˜¸ì¶œí•  ë•Œ ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í•  ê²½ìš° ì—ëŸ¬ëŠ” ì²« ì¸ìì—, ê²°ê³¼ëŠ” ë‘ ë²ˆì§¸ ì¸ìì— ë„£ì–´ì•¼ í•œë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">results [ 1, 2, 3 ]</span><br></pre></td></tr></table></figure><h3 id="waterfall"><a href="#waterfall" class="headerlink" title="waterfall"></a>waterfall</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">&#x27;async&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">4000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="function">(<span class="params">data, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, data + <span class="number">2</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="function">(<span class="params">data, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, data + <span class="number">3</span>);</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span>.waterfall([a, b, c], <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;result&#x27;</span>, result);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>waterfallë„ í•¨ìˆ˜ì˜ ì‹¤í–‰ ì‹œê°„ê³¼ ìƒê´€ ì—…ì´ í˜¸ì¶œí•œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ì„ í•˜ëŠ”ë°</p><p>seriesì™€ ë‹¤ë¥¸ ì ì€ ê° í•¨ìˆ˜ì˜ ê²°ê³¼ë¥¼ ë‹¤ìŒ í•¨ìˆ˜ì— íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸¸ ìˆ˜ê°€ ì‡ë‹¤.</p><p>ë§ˆì°¬ê°€ì§€ë¡œ ê° í•¨ìˆ˜ì˜ ì½œë°±ì˜ ì²« ì¸ìëŠ” ì—ëŸ¬, ë‘ ë²ˆì§¸ ì¸ìëŠ” ë„˜ê¸¸ ë°ì´í„°ì´ë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result 6</span><br></pre></td></tr></table></figure><h2 id="ë³‘ë ¬-ì²˜ë¦¬"><a href="#ë³‘ë ¬-ì²˜ë¦¬" class="headerlink" title="ë³‘ë ¬ ì²˜ë¦¬"></a>ë³‘ë ¬ ì²˜ë¦¬</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">&#x27;async&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line">  &#125;, <span class="number">3000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span>.parallel([a, b], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;results&#x27;</span>, results);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ë™ì‹œì— í˜¸ì¶œí•œ í•¨ìˆ˜ë“¤ì´ ëª¨ë‘ ì™„ë£Œë˜ì–´ì•¼ í˜¸ì¶œí•œ ìˆœì„œëŒ€ë¡œ ì‘ë‹µì„ ë°°ì—´ë¡œ ë°›ëŠ”ë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">results [ 1, 2 ]</span><br></pre></td></tr></table></figure><h2 id="ë°˜ë³µ"><a href="#ë°˜ë³µ" class="headerlink" title="ë°˜ë³µ"></a>ë°˜ë³µ</h2><p>eachì™€ eachSeriesê°€ ì‡ë‹¤.</p><h3 id="each"><a href="#each" class="headerlink" title="each"></a>each</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">&#x27;async&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// eslint-disable-next-line no-plusplus</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  arr.push(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="function">(<span class="params">_param, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> random = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">3</span>) + <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(_param);</span><br><span class="line">  &#125;, random);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> results = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span>.each(arr, <span class="function">(<span class="params">item, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  a(item, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    results.push(data);</span><br><span class="line">    callback();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;results&#x27;</span>, results);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>eachëŠ” ë°˜ë³µí•  í•¨ìˆ˜ì˜ ì‹¤í–‰ ì‹œê°„ì— ë”°ë¼ ë¹¨ë¦¬ ì²˜ë¦¬ë˜ëŠ” ìˆœì„œëŒ€ë¡œ ì‘ë‹µì„ í•œë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">results [ 0, 6, 7, 8, 1, 4, 5, 2, 3, 9 ]</span><br></pre></td></tr></table></figure><h3 id="eachSeries"><a href="#eachSeries" class="headerlink" title="eachSeries"></a>eachSeries</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">&#x27;async&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// eslint-disable-next-line no-plusplus</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  arr.push(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="function">(<span class="params">_param, cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> random = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">3</span>) + <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(_param);</span><br><span class="line">  &#125;, random);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> results = [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span>.eachSeries(arr, <span class="function">(<span class="params">item, callback</span>) =&gt;</span> &#123;</span><br><span class="line">  a(item, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    results.push(data);</span><br><span class="line">    callback();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;results&#x27;</span>, results);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>eachSeriesëŠ” ë¬´ì¡°ê±´ ë°˜ë³µí•  í•¨ìˆ˜ì˜ ì‹¤í–‰ ì‹œê°„ê³¼ ìƒê´€ ì—…ì´ ìš”ì²­í•œ ìˆœì„œëŒ€ë¡œ ì‘ë‹µì„ í•œë‹¤.</p><p>ë‹¨ ê·¸ ë§Œí¼ ë°ì´í„°ê°€ í´ ìˆ˜ë¡ ì‹¤í–‰ ì‹œê°„ì´ ëŠ˜ì–´ë‚œë‹¤.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">results [ 0, 1, 2, 3, 4, 5, 6, 7, 8, 9 ]</span><br></pre></td></tr></table></figure><p>ì—¬ê¸° ì ì€ ê±´ ë‚´ê°€ ì£¼ë¡œ ì“°ë˜ ê±°ë“¤ì´ê³  ì´ì™¸ì—ë„ ë§ì€ <a href="https://caolan.github.io/async/v3/">ê¸°ëŠ¥</a>ë“±ì´ ì‡ìœ¼ë¯€ë¡œ í•œ ë²ˆì”© ë´ë‘ë„ë¡ í•˜ì.</p><h2 id="ì£¼ì˜ì "><a href="#ì£¼ì˜ì " class="headerlink" title="ì£¼ì˜ì "></a>ì£¼ì˜ì </h2><p>ì˜ˆë¡œ seriesë¥¼ ì“¸ ë•Œ ì´ëŸ¬í•œ ê²½ìš°ê°€ ì‡ì„ ìˆ˜ ì‡ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">async</span> = <span class="built_in">require</span>(<span class="string">&#x27;async&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> x = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    x += <span class="number">10</span>;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="number">1</span>);</span><br><span class="line">  &#125;, <span class="number">4000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;ã… ã… &#x27;</span>));</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> c = <span class="function">(<span class="params">cb</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    cb(<span class="literal">null</span>, <span class="number">3</span>);</span><br><span class="line">  &#125;, <span class="number">2000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span>.series([a, b, c], <span class="function">(<span class="params">err, results</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;err&#x27;</span>, err, <span class="string">&#x27;x&#x27;</span>, x);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;results&#x27;</span>, results);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì²« í•¨ìˆ˜ëŠ” ì˜ ë™ì‘í–‡ì§€ë§Œ ë‘ë²ˆ ì§¸ í•¨ìˆ˜ì—ì„  ì²˜ë¦¬ ì¤‘ì— ì—ëŸ¬ê°€ ë°œìƒí–‡ë‹¤ê³  ì¹˜ì.</p><p>ì´ëŸ¬ë©´ ì‹¤í–‰ ê²°ê³¼ê°€ ì–´ë– ì¼€ ë ê¹Œ?</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">err Error: ã… ã… </span><br><span class="line">    at Timeout.setTimeout [as _onTimeout] (/Volumes/Seagate Slim Drive/project/nodejs/async-example/error.js:15:8)</span><br><span class="line">    at ontimeout (timers.js:436:11)</span><br><span class="line">    at tryOnTimeout (timers.js:300:5)</span><br><span class="line">    at listOnTimeout (timers.js:263:5)</span><br><span class="line">    at Timer.processTimers (timers.js:223:10) x 110</span><br></pre></td></tr></table></figure><p>ê·¸ë ‡ë‹¤. ì²« í•¨ìˆ˜ëŠ” ì •ìƒì ìœ¼ë¡œ ì‘ë™ë˜ì—‡ê¸°ì— xëŠ” ì¦ê°€ê°€ ë˜ë²„ë ·ë‹¤.</p><p>ë§Œì•½ ê° í•¨ìˆ˜ë§ˆë‹¤ dbì— ë­”ê°€ ê°±ì‹ ì„ í•˜ëŠ” ì½”ë“œë¼ë©´ ì¢€ ê³¨ì¹˜ê°€ ì•„íŒŒì§ˆìˆ˜ë„ ì‡ë‹¤.</p><p>ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ì˜ ìƒê°í•˜ì.</p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js Passport ëª¨ë“ˆì„ ì´ìš©í•œ ì†Œì…œ ë¡œê·¸ì¸ êµ¬í˜„</title>
      <link href="/2018/06/15/nodejs-sns-signin/"/>
      <url>/2018/06/15/nodejs-sns-signin/</url>
      
        <content type="html"><![CDATA[<p>ì†Œì…œë¡œê·¸ì¸ì€ ë³´í†µ OAuth2(íŠ¸ìœ„í„° ë¹¼ê³  -_-)ë¼ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ì„ í•˜ëŠ”ë° êµ¬í˜„í•˜ê¸° ì „ì— <a href="https://d2.naver.com/helloworld/24942">OAuthì™€ ì¶¤ì„</a>ì´ë¼ëŠ” ê¸€ì„ ì½ì–´ë‘ë©´ ì¢‹ë‹¤.</p><p>ì†Œì…œ ë¡œê·¸ì¸ì€ ë³´í†µ ê° ê·¸ íšŒì‚¬ë“¤ sdkë‚˜ api docì´ ì˜ ì •ë¦¬ë˜ì–´ ì‡ëŠ”ë° ë§‰ìƒ ê·¸ëŒ€ë¡œ êµ¬í˜„í•˜ë ¤ë©´</p><p>ë§¤ìš° ê·€ì°¬ë‹¤. ë§ˆì°¬ê°€ì§€ë¡œ ê·¸ ê·€ì°¬ìŒì„ ì¢€ ëœì–´ë‚´ê³ ì íŒ¨ìŠ¤í¬íŠ¸ ëª¨ë“ˆì„ ì‚¬ìš©í•œ ë¡œê·¸ì¸ì´ë‹¤.</p><p>í´ë¼ì´ì–¸íŠ¸ëŠ” ì´ì „ ê¸€ì—ì„œ ì“°ë˜ ê±° ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³  ì‡ë‹¤.</p><p>HTMLì„ ë³´ë©´ í˜ë¶, íŠ¸ìœ„í„°, êµ¬ê¸€ ì´ 3ê°œì˜ ì•„ì´ì½˜ì´ ê·¸ë ¤ì ¸ ì‡ëŠ”ë° 3ê°œ ë‹¤ íŒ¨ìŠ¤í¬íŠ¸ë¡œ í•˜ë©´ ë¹„ìŠ·í•˜ë¯€ë¡œ íŠ¸ìœ„í„° í•˜ë‚˜ë§Œ ì˜ˆë¡œ ì ì–´ë‘ì.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add passport-twitter</span><br></pre></td></tr></table></figure><p>ì´ì „ì— íŒ¨ìŠ¤í¬íŠ¸ëŠ” ì„¤ì¹˜í–‡ìœ¼ë¯€ë¡œ ìƒëµí•˜ê³  íŒ¨ìŠ¤í¬íŠ¸ íŠ¸ìœ„í„°ë¥¼ ì„¤ì¹˜í•˜ì ì½”ë“œëŠ” ì´ëŸ¬í•˜ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">&#x27;passport&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> TwitterStrategy = <span class="built_in">require</span>(<span class="string">&#x27;passport-twitter&#x27;</span>).Strategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> íŠ¸ìœ„í„° ì²˜ë¦¬.</span></span><br><span class="line">passport.use(<span class="keyword">new</span> TwitterStrategy(&#123;</span><br><span class="line">  consumerKey: process.env.TWITTER_API_KEY, <span class="comment">// ì´í•˜ ì•„ë˜ëŠ” twitter developerì—ì„œ ë°œê¸‰.</span></span><br><span class="line">  consumerSecret: process.env.TWITTER_SECRET_KEY,</span><br><span class="line">  callbackURL: process.env.TWITTER_CALLBACK_URL,</span><br><span class="line">  includeEmail: <span class="literal">true</span>,</span><br><span class="line">&#125;, <span class="function">(<span class="params">token, tokenSecret, profile, done</span>) =&gt;</span> &#123;</span><br><span class="line">  UserModel.findOne(&#123; <span class="attr">email</span>: profile.emails[<span class="number">0</span>].value &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123; <span class="keyword">return</span> done(err); &#125;</span><br><span class="line">    <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">      <span class="keyword">const</span> user = <span class="keyword">new</span> UserModel(&#123;</span><br><span class="line">        email: profile.emails[<span class="number">0</span>].value,</span><br><span class="line">        password: security.randomHash(<span class="number">10</span>),</span><br><span class="line">        name: profile.displayName,</span><br><span class="line">        image: profile.photos[<span class="number">0</span>].value,</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="keyword">return</span> user.save(<span class="function">(<span class="params">saveErr, saveUser</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (saveErr) &#123; <span class="keyword">return</span> done(saveErr); &#125;</span><br><span class="line">        <span class="keyword">return</span> done(<span class="literal">null</span>, saveUser);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> done(<span class="literal">null</span>, data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/twitter&#x27;</span>, passport.authenticate(<span class="string">&#x27;twitter&#x27;</span>));</span><br><span class="line">router.get(<span class="string">&#x27;/twitter/callback&#x27;</span>, passport.authenticate(<span class="string">&#x27;twitter&#x27;</span>, &#123;</span><br><span class="line">  successRedirect: <span class="string">&#x27;/success&#x27;</span>, <span class="comment">// ì²˜ë¦¬ ì„±ê³µ ì‹œ</span></span><br><span class="line">  failureRedirect: <span class="string">&#x27;/&#x27;</span>, <span class="comment">// ì²˜ë¦¬ ì‹¤íŒ¨ ì‹œ</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">passport.serializeUser(<span class="function">(<span class="params">user, done</span>) =&gt;</span> &#123;</span><br><span class="line">  done(<span class="literal">null</span>, user);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">passport.deserializeUser(<span class="function">(<span class="params">user, done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = user;</span><br><span class="line">  <span class="keyword">delete</span> data.password;</span><br><span class="line">  done(<span class="literal">null</span>, data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì´ì „ ê¸€ì˜ íŒ¨ìŠ¤í¬íŠ¸ ë¡œê·¸ì¸ êµ¬í˜„í•˜ê³  ë‹¤ë¥¸ ê²Œ ê±°ì˜ ì—…ë‹¤. </p><p>TwitterStrategyë¥¼ í†µí•´ ìœ ì € ì •ë³´ë¥¼ ë°›ì•„ ì˜¤ë©´ ë‚´ dbì—ì„œ ì²´í¬í•˜ê³  doneìœ¼ë¡œ.</p><p>ì•„ ì†Œì…œ ë¡œê·¸ì¸ ê°™ì€ ê²½ìš° ë¹„ë°€ë²ˆí˜¸ëŠ” ì—…ìœ¼ë¯€ë¡œ ê·¸ëƒ¥ ì„ì˜ì˜ í•´ì‹œ ê°’ì„ ì ë‹¹í•˜ê²Œ ë„£ì–´ ì¤€ë‹¤.</p><p>í™˜ê²½ ë³€ìˆ˜ ê°’ì„ ìƒì„± í•˜ë ¤ë©´ ì†Œì…œ ë¡œê·¸ì¸ì„ í•´ì£¼ëŠ” íšŒì‚¬ë§ˆë‹¤ ê° developer ì‚¬ì´íŠ¸ë¥¼ ìš´ì˜ì„ í•˜ëŠ”ë° ì˜ˆë¡œ íŠ¸ìœ„í„°ì˜ ê²½ìš°ëŠ” <a href="https://developer.twitter.com/">twitter developer</a>ì— ì ‘ì†í•´ì„œ ë¡œê·¸ì¸ í›„ ì•±ì„ í•˜ë‚˜ ìƒì„±ì„ í•´ì•¼ í•œë‹¤. ì´ ë¶€ë¶„ì´ ì œì¼ ê·€ì°¬ìŒ</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565872962/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_9.42.17_zd4wm6.png" alt="íŠ¸ìœ„í„° ë””ë²¨ë¡œí¼"></p><p>ì´ëŸ° ì‹ìœ¼ë¡œ ë‚´ìš©ì„ ëŒ€ì¶© ê°€ë¼ë¡œ ì¨ì„œ ë§Œë“ ë‹¤. ì œëŒ€ë¡œ ì‘ì„±í•´ì•¼ í•˜ëŠ” ë¶€ë¶„ì€ callback urlì¸ë°</p><p>ì´ urlë¡œ íŠ¸ìœ„í„°ì—ì„œ GET methodë¡œ ìœ ì €ë“¤ì˜ ì •ë³´ë¥¼ ë³´ë‚´ì¤€ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì„œë²„ì—ì„œ ì²˜ë¦¬í•˜ëŠ” urlë¡œ ì ì–´ì¤˜ì•¼ í•œë‹¤. ë‚˜ ê°™ì€ ê²½ìš°ëŠ” /auth/twitter/callbackì´ë‹¤.</p><p>ê·¸ë¦¬ê³  ë‚˜ì„œ í•„ìš”í•œ í‚¤ë“¤ì´ ì–´ì¼€ ìƒê²»ëŠ”ì§€ í™•ì¸ í•´ë³´ì.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565874893/%E3%85%85%E3%84%B1%E3%84%B7%E3%85%85%E3%84%B1%E3%84%B7%E3%85%85%E3%84%B7%E3%84%B1_aa4izr.png" alt="íŠ¸ìœ„í„° í‚¤"></p><p>ì´ì œ api key, api secret key, callback urlì„ í™˜ê²½ ë³€ìˆ˜ë¡œ ë„£ê³  ë¡œê·¸ì¸ ì‹œë„ë¥¼ í•´ë³´ì.</p><p>ì•„ ê·¼ë° íŠ¸ìœ„í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì´ë©”ì¼ì„ ì•ˆ ì¤€ë‹¤. ê·¸ë˜ì„œ ì´ë©”ì¼ì„ ì–»ê¸° ìœ„í•´ì„  ë‹¤ìŒê³¼ ê°™ì€ ì„¤ì •ì„ í•´ì¤˜ì•¼ í•œë‹¤.</p><p>íŠ¸ìœ„í„° ì•±ì˜ Privacy policy URL, Terms of service URLì„ ì¶”ê°€í•´ ì¤€ë‹´ (ëŒ€ì¶© ê°€ë¼ë¡œ)</p><p>ì•„ë˜ ì´ë¯¸ì§€ì²˜ëŸ¼ í¼ë¯¸ì…˜ì—ì„œ ì´ë©”ì¼ ìš”ì²­ì„ í•´ì•¼ëœë‹¤.. ë§í•  íŠ¸ìœ„í„°</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565873860/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-15_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_9.56.49_nidy2i.png" alt="ì´ë©”ì¼ ìš”ì²­"></p><p>ê·¸ëŸ¼ ë™ì‘í•˜ëŠ” ì›ë¦¬ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ íŠ¸ìœ„í„° ì•„ì´ì½˜ì„ í´ë¦­í•´ì„œ /twitterë¡œ ë„˜ì–´ê°€ê²Œ ë˜ë©´</p><p>ì‘ì„±í•œ TwitterStrategyì˜ app key, secretìœ¼ë¡œ ì•Œì•„ì„œ íŒ¨ìŠ¤í¬íŠ¸ê°€ ì•Œì•„ì„œ íŠ¸ìœ„í„°í•œí…Œ</p><p>ìœ ì € ì •ë³´ë¥¼ ë‚´ë†”ë¼ ì´ë ‡ê²Œ ìš”ì²­ì„ í•˜ê²Œ ëœë‹¤. ê·¸ëŸ¬ë©´ íŠ¸ìœ„í„° ì„œë²„ì—ì„œ ìš”ì²­ì„ ë°›ê³  í•´ë‹¹ ìœ ì €</p><p>ì •ë³´ë¥¼ ë‚´ê°€ ì •ì˜í•œ ì½œë°± urlë¡œ ë³´ë‚´ ì¤€ë‹¤. ê·¸ëŸ¼ ì½œë°± urlì— íŒ¨ìŠ¤í¬íŠ¸ ë¯¸ë“¤ì›¨ì–´ê°€</p><p>ìˆ˜ì‹ ì„ í•´ì„œ TwitterStrategy ë¡œì§ëŒ€ë¡œ ì²˜ë¦¬ë¥¼ í•˜ê³  ì„¸ì…˜ì— ë‹´ê²Œ ëœë‹¤.</p><p>í˜„ì¡´í•˜ëŠ” ì†Œì…œ ê±°ì˜ passport-@@ìœ¼ë¡œ ê±°ì˜ êµ¬í˜„ë˜ì–´ ì‡ìœ¼ë‹ˆ ì°¾ì•„ì„œ ë°›ì•„ê°€ì§€ê³  ì¨ë³´ë„ë¡ í•˜ì.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ íŠ¸ìœ„í„° ë¡œê·¸ì¸ ì§¤</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565874232/twiiter_nutggy.gif" alt="íŠ¸ìœ„í„° ë¡œê·¸ì¸"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Auth </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Node.js Passport ëª¨ë“ˆì„ ì´ìš©í•œ ë¡œê·¸ì¸ êµ¬í˜„</title>
      <link href="/2018/06/15/nodejs-signin/"/>
      <url>/2018/06/15/nodejs-signin/</url>
      
        <content type="html"><![CDATA[<p>ì €ë²ˆ ê¸€ì— ì´ì–´ì„œ ì‘ì„±</p><p>ë¡œê·¸ì¸ êµ¬í˜„ì´ ì–´ë µì§„ ì•Šì§€ë§Œ ì€ê·¼ ê·€ì°®ì€ ì‘ì—…ì´ë¼.. íŒ¨ìŠ¤í¬íŠ¸ ëª¨ë“ˆì„ ì“°ë©´ ìª¼ê¸ˆ í¸í•œ ê±° ê°™ì€? ëŠë‚Œì´ë‹¤.</p><p>í•´ì•¼í•  ì‘ì—…ì€ ë¡œê·¸ì¸ì„ í•œ ì´í›„ ìœ ì € ì„¸ì…˜ì„ ë ˆë””ìŠ¤ì— ë„£ì–´ì„œ ì“°ë„ë¡ í•˜ì. (ì´ì „ ê¸€ì—ì„  ê·€ì°¬ì•„ì„œ mongoì— ë„£ì—‡ìŒ)</p><p>ë¨¼ì € í•„ìš”í•œ ëª¨ë“ˆì„ ì„¤ì¹˜í•˜ì ì•„ ë‚œ ìš”ì¦˜ yarnì„ ì“°ê³  ì‡ìŒ.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add passport passport-local cookie-parser express-session redis connect-redis</span><br></pre></td></tr></table></figure><p>ì´ì œ ë¡œê·¸ì¸ì„ êµ¬í˜„ í•´ë³´ì.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">&#x27;passport&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> LocalStrategy = <span class="built_in">require</span>(<span class="string">&#x27;passport-local&#x27;</span>).Strategy;</span><br><span class="line"></span><br><span class="line"><span class="comment">// local Strategy ì„¸íŒ…</span></span><br><span class="line">passport.use(<span class="keyword">new</span> LocalStrategy(&#123;</span><br><span class="line">  usernameField: <span class="string">&#x27;email&#x27;</span>,</span><br><span class="line">  passwordField: <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">  passReqToCallback: <span class="literal">true</span>,</span><br><span class="line">&#125;, <span class="function">(<span class="params">req, email, password, done</span>) =&gt;</span> &#123;</span><br><span class="line">  UserModel.findOne(&#123;</span><br><span class="line">    email: security.xssFilter(email),</span><br><span class="line">    password: security.changeHash(password),</span><br><span class="line">  &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123; <span class="keyword">return</span> done(err); &#125;</span><br><span class="line">    <span class="keyword">if</span> (!data) &#123;</span><br><span class="line">      <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>, <span class="string">&#x27;Either no registered email address or the password is incorrect.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> done(<span class="literal">null</span>, data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> ë¡œê·¸ì¸ ì²˜ë¦¬.</span></span><br><span class="line"><span class="comment">// eslint-disable-next-line no-unused-vars</span></span><br><span class="line">router.post(<span class="string">&#x27;/signIn&#x27;</span>, security.csrfProtection(), <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// eslint-disable-next-line consistent-return</span></span><br><span class="line">  passport.authenticate(<span class="string">&#x27;local&#x27;</span>, <span class="function">(<span class="params">err, user, message</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// console.log(&#x27;user&#x27;, user);</span></span><br><span class="line">    <span class="comment">// console.log(&#x27;message&#x27;, message);</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123; <span class="keyword">return</span> res.status(<span class="number">500</span>).json(err); &#125;</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123; <span class="keyword">return</span> res.status(<span class="number">200</span>).json(&#123; <span class="attr">result</span>: <span class="literal">false</span>, <span class="attr">title</span>: <span class="string">&#x27;error&#x27;</span>, <span class="attr">comment</span>: message &#125;); &#125;</span><br><span class="line">    req.logIn(user, <span class="function">(<span class="params">sessionErr</span>) =&gt;</span> &#123; <span class="comment">// session init</span></span><br><span class="line">      <span class="keyword">if</span> (sessionErr) &#123; <span class="keyword">return</span> next(sessionErr); &#125;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">200</span>).json(&#123; <span class="attr">result</span>: <span class="literal">true</span>, <span class="attr">title</span>: <span class="string">&#x27;success&#x27;</span>, <span class="attr">comment</span>: <span class="string">&#x27;login complete&#x27;</span> &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)(req, res, next);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> profile í˜ì´ì§€</span></span><br><span class="line">router.get(<span class="string">&#x27;/success&#x27;</span>, security.isLogin, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(&#x27;req.user&#x27;, req.user);</span></span><br><span class="line">  res.render(<span class="string">&#x27;profile&#x27;</span>, &#123;</span><br><span class="line">    profile: req.user,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">passport.serializeUser(<span class="function">(<span class="params">user, done</span>) =&gt;</span> &#123;</span><br><span class="line">  done(<span class="literal">null</span>, user);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">passport.deserializeUser(<span class="function">(<span class="params">user, done</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = user;</span><br><span class="line">  <span class="keyword">delete</span> data.password;</span><br><span class="line">  done(<span class="literal">null</span>, data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ìœ„ì—ì„œ ìˆœì„œëŒ€ë¡œ ì„¤ëª…</p><p>LocalStrategyê°€ ë¡œê·¸ì¸ êµ¬í˜„ ë¶€ë¶„ì˜ í•µì‹¬ì´ë‹¤.</p><p>usernameField, passwordFieldëŠ” ë‚´ê°€ ì§€ì€ ê²Œ ì•„ë‹ˆê³  ëª¨ë“ˆì— ì •ì˜ëœ í”„ë¡œí¼í‹°ì´ë‹¤.</p><p>ì—¬ê¸°ì— formì´ë‚˜ ajaxë¡œ ë°ì´í„° ë³´ë‚´ëŠ” ë°ì´í„°ì˜ ID íŒŒë¼ë¯¸í„° ì´ë¦„ì„ ì ì–´ë‘ë©´ ëœë‹¤. </p><p>ì‹¤ì œ ë‚´ HTMLì—ì„œë„ ìœ„ì˜ ì •ì˜í•œ ëŒ€ë¡œ ë˜ì–´ ìˆìŒ.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Email&quot;</span> <span class="attr">required</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;Password&quot;</span> <span class="attr">required</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>passReqToCallbackëŠ” ì•„ë˜ì˜ ì½œë°± ë°ì´í„°ë¡œ ë°›ì„ ê²ƒì¸ê°€ ê·¸ëŸ°ê±´ë° í•­ìƒ trueë¡œ ì¨ ì™“ìŒ. ë”±íˆ falseë¡œ í•´ë³´ì§„ ì•Šì•—ë‹¤.</p><p>ì´ì œ ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ê°€ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë³´ë‚´ì£¼ë©´ ì½œë°± í•¨ìˆ˜ì—ì„œ email, password ì—¬ê¸°ì— ë„˜ì–´ ì˜¨ë‹¤.</p><p>ê·¸ëŸ¼ dbì—ì„œ (ì´ì „ ê¸€ì— ì´ì–´ mongodb) ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ë¡œ ì¡°íšŒ í•´ì„œ (xss, hashëŠ” ì´ì „ ê¸€ì—ì„œ ì„¤ëª… í–‡ìœ¼ë‹ˆ íŒ¨ìŠ¤.) ë‚˜ì˜¨ ê²°ê³¼ì— ë§ê²Œ done()ì„ í˜¸ì¶œì„ í•œë‹¤.</p><p>doneì— ëª‡ê°œ ê¹Œì§€ ë„£ì„ ìˆ˜ ì‡ëŠ”ì§€ëŠ” ì•ˆ í•´ë´£ëŠ”ë° ë³´í†µ ì²« ì¹¸ì´ ì—ëŸ¬, 2ë²ˆì§¸ ì¹¸ì´ ìœ ì € ë°ì´í„°, 3ë²ˆì§¸ ì¹¸ì´ ë„£ê³  ì‹¶ì€ ë©”ì„¸ì§€ ì •ë„ë¡œ ì“´ë‹¤.</p><p>ê·¸ëŸ¼ ì´ doneì´ ì–´ë””ë¡œ ê°€ëƒë©´ passport.serializeUser() ì—¬ê¸°ë¡œ ë„˜ì–´ ê°„ë‹¤. ì—¬ê¸°ê°€ ë¡œê·¸ì¸ í›„ ì„¸ì…˜ì„ ì €ì¥ í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.</p><p>passport.deserializeUser()ëŠ” ì´ì œ ì›¹ í˜ì´ì§€ ì´ë™ ì‹œ í˜¸ì¶œ ë˜ì„œ ì„¸ì…˜ì— ë‹´ì€ ë°ì´í„°ë¥¼ í˜¸ì¶œ í• ìˆ˜ ì‡ê²Œ í•´ ì¤„ ìˆ˜ ì‡ë‹¤.</p><p>ì•„ë˜ì— /successë¡œ ê°€ëŠ” í˜ì´ì§€ì— req.userê°€ ìœ ì €ì˜ ì„¸ì…˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ê²ƒ. (ë‚´ê°€ ì§€ì€ê²Œ ì•„ë‹ˆê³  ëª¨ë“ˆì—ì„œ ì§€ì •í•œ ì´ë¦„)</p><p>ëª¨ë“ˆ ë§Œë“  ì‚¬ëŒì´ serializeUserì—ì„œ ê°€ë³ê²Œ ìœ ì € IDë‚˜ í‚¤ë§Œ ì €ì¥í•˜ê³  deserializeUserì—ì„œëŠ” serializeUserì— ì €ì¥í•œ ìœ ì € IDë‚˜ í‚¤ë¡œ DBì—ì„œ ìœ ì € ë°ì´í„° ì¡°íšŒ í›„ ìƒˆë¡œ ì„¸ì…˜ì„ ê°±ì‹ í•˜ë¼ê³  ì¶”ì²œí•˜ëŠ”ë° ì§€ê¸ˆì€ ê·œëª¨ê°€ ì‘ìœ¼ë‹ˆ íŒ¨ìŠ¤.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ë¡œê·¸ì¸í•  ë•Œ ì²˜ë¦¬í•  ë¼ìš°í„°ì— passport.authenticateë¥¼ ì ì–´ì„œ ìš°ë¦¬ê°€ ì‘ì„±í•œ passport Strategyë¥¼ ì‚¬ìš© í•˜ê²Œ ë” í•˜ë©´ ëœë‹¤.</p><p>req.logInì€ ë‚´ê°€ ë§Œë“  ê²Œ ì•„ë‹ˆê³  ëª¨ë“ˆì—ì„œ ì§€ì›í•˜ëŠ” ê±´ë° ì„¸ì…˜ ì ìš©ì„ í•˜ëŠ” ë¶€ë¶„ì´ë‹¤.</p><p>ë‹¨ìˆœí•˜ê²Œ formìœ¼ë¡œ ë°ì´í„° ì²˜ë¦¬ ì‹œì—ëŠ” passport.authenticateë¥¼ ë¯¸ë“¤ì›¨ì–´ë¡œ ë„£ì–´ì„œ ì²˜ë¦¬í•˜ë©´ ë˜ëŠ”ë° ìœ„ì˜ ì‚¬ë¡€ëŠ” ë¡œê·¸ì¸ì„ ajaxë¡œ ì²˜ë¦¬í•  ë•Œì— ì ìš©í•˜ëŠ” íŒ¨ìŠ¤í¬íŠ¸ ë°©ë²•ì´ë‹¤. ê·¸ë¦¬ê³  successë¡œ ê°€ëŠ” í˜ì´ì§€ì— security.isLogin ì´ ë¶€ë¶„ì— ëŒ€í•´ ì ì.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> ë¡œê·¸ì¸ ì„¸ì…˜ ì²´í¬.</span></span><br><span class="line"><span class="built_in">module</span>.exports.isLogin = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.isAuthenticated()) &#123;</span><br><span class="line">    <span class="keyword">return</span> next();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ìœ ì € ë¡œê·¸ì¸ ì„¸ì…˜ ì²´í¬í•˜ëŠ” ë°©ë²•ì´ë‹¤. íŒ¨ìŠ¤í¬íŠ¸ì—ì„œ ì§€ì›í•¨.</p><p>ê·¸ë¦¬ê³  ì´ê²Œ ëì´ ì•„ë‹ˆê³  ëª‡ ê°€ì§€ ìì§ˆêµ¬ë ˆí•œ ì„¤ì •ì„ expressì— ì¢€ í•´ì¤˜ì•¼ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">&#x27;passport&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&#x27;express-session&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> RedisStore = <span class="built_in">require</span>(<span class="string">&#x27;connect-redis&#x27;</span>)(session);</span><br><span class="line">app.use(cookieParser()); <span class="comment">// ì¿ í‚¤ ì‚¬ìš©</span></span><br><span class="line">app.use(session(&#123; <span class="comment">// ì„¸ì…˜ ì ìš©</span></span><br><span class="line">  secret: <span class="string">&#x27;hi?delryn&#x27;</span>, <span class="comment">// ì•”í˜¸í™”ë¥¼ í•˜ê¸°ìœ„í•œ salt</span></span><br><span class="line">  resave: <span class="literal">false</span>, <span class="comment">// ì„¸ì…˜ ì¬ì €ì¥ ì—¬ë¶€ ì²´í¬</span></span><br><span class="line">  saveUninitialized: <span class="literal">false</span>, <span class="comment">// ì´ˆê¸°í™” ë˜ì§€ ì•Šì€ ì„¸ì…˜ ì €ì¥ ì—¬ë¶€ ì²´í¬</span></span><br><span class="line">  store: <span class="keyword">new</span> RedisStore(&#123; <span class="comment">// ì„¸ì…˜ ì •ë³´ë¥¼ redis ì €ì¥</span></span><br><span class="line">    client: redis.createClient(config.redis),</span><br><span class="line">    host: config.redis.host,</span><br><span class="line">    port: config.redis.port,</span><br><span class="line">    prefix: <span class="string">&#x27;session:&#x27;</span>,</span><br><span class="line">    db: <span class="number">0</span>,</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;));</span><br><span class="line">app.use(passport.initialize()); <span class="comment">// ì•± ì „ì—­ì— passport init</span></span><br><span class="line">app.use(passport.session()); <span class="comment">// ì•± ì „ì—­ì— passport ì„¸ì…˜ ì‚¬ìš©</span></span><br></pre></td></tr></table></figure><p>ì„¸ì…˜ê³¼ íŒ¨ìŠ¤í¬íŠ¸ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì ìš©ì´ë‹¤.</p><p>ì„¸ì…˜ ë˜í•œ ì¿ í‚¤ ê¸°ë°˜ì´ê¸° ë•Œë¬¸ì— cookieParserë¼ëŠ” ëª¨ë“ˆì„ ì¨ì•¼ í•˜ê³  express-sessionê°€ ì´ì œ ì„¸ì…˜ ì„¤ì •í•˜ëŠ” ì½”ë“œë‹¤.</p><p>connect-redisëŠ” ì„¸ì…˜ ë°ì´í„°ë¥¼ ì„œë²„ ë©”ëª¨ë¦¬ê°€ ì•„ë‹Œ redisì— ì €ì¥í•˜ê¸° ì‰½ê²Œ í•´ì£¼ëŠ” ëª¨ë“ˆì´ë‹¤.</p><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ë¡œê·¸ì¸ í•˜ëŠ” ì§¤</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565849447/signup_lmnimt.gif" alt="ë¡œê·¸ì¸"></p><p>ë‹¤ìŒ ê¸€ì—ì„œëŠ” ì†Œì…œë¡œ ë¡œê·¸ì¸í•˜ëŠ” ë²•ì„ ì ì–´ì•¼ ê²Ÿë‹¤.</p><h2 id="ì°¸ê³ "><a href="#ì°¸ê³ " class="headerlink" title="ì°¸ê³ "></a>ì°¸ê³ </h2><ul><li><a href="http://www.passportjs.org/docs/">passport doc</a></li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Auth </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Expressì—ì„œ íšŒì› ê°€ì… ë§Œë“¤ì–´ ë³´ê¸°</title>
      <link href="/2018/06/11/nodejs-user-signup/"/>
      <url>/2018/06/11/nodejs-user-signup/</url>
      
        <content type="html"><![CDATA[<p>í´ë¼ì´ì–¸íŠ¸ HTML, CSSëŠ” <a href="https://www.florin-pop.com/blog/2019/03/double-slider-sign-in-up-form/">FLORIN POP - DOUBLE SLIDER - SIGN IN/UP FORM</a> ì˜ ê¸€ì„ ë³´ê³  ë”°ë¼ í–ˆë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565620242/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-12_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_11.30.03_ln0ffb.png" alt="í´ë¼ì´ì–¸íŠ¸"></p><p>ì‹¤ì œ ì„œë¹„ìŠ¤ëŠ” ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°ë¥¼ ê¸°ì…í•´ì•¼ í•˜ì§€ë§Œ ì§€ê¸ˆì€ ê°€ë³ê²Œ í•˜ê¸° ìœ„í•´ ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸, ì´ë¦„ë§Œ ì ê²Œë” í–ˆë‹¤.</p><p>ê°„ë‹¨í•˜ê²Œ ë¹ˆ ê°’ì— ëŒ€í•œ validationì„ í•œ í›„ ajaxë¡œ íŒŒë¦¬ë¯¸í„°ë“¤ì„ ì „ì†¡í•˜ê²Œ í–‡ë‹¤.</p><p>ì„œë²„ì—ì„  ì–´ë– ì¼€ ì²˜ë¦¬ë¥¼ í•˜ëŠ”ì§€ ì½”ë“œë¥¼ ì ì–´ ë‘ì.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> ê°€ì… í˜ì´ì§€ ëœë”ë§.</span></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, security.csrfProtection(), <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.render(<span class="string">&#x27;index&#x27;</span>, &#123;</span><br><span class="line">    csrfToken: req.csrfToken(),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>security.csrfProtection(), {csrfToken: req.csrfToken()} ì´ ë¶€ë¶„ì— ëŒ€í•´ì„œ ì ì„ë ¤ê³  í•œê±´ë°</p><p>ì € ì½”ë“œê°€ ì‚¬ìš©ëœ ì´ìœ ëŠ” <a href="https://ko.wikipedia.org/wiki/%EC%82%AC%EC%9D%B4%ED%8A%B8_%EA%B0%84_%EC%9A%94%EC%B2%AD_%EC%9C%84%EC%A1%B0">csrf</a> ë¼ëŠ” ì›¹ì‚¬ì´íŠ¸ ì·¨ì•½ì  ê³µê²© ì¤‘ì˜ í•˜ë‚˜ ì¸ë°(ìì„¸í•œ ë‚´ìš©ì€ ë§í¬ ì°¸ì¡°) ëŒ€ë¹„ì±…ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ê¸°ë²•ìœ¼ë¡œ ìì£¼ ë³´ëŠ” npm ì‚¬ì´íŠ¸ì—ë„ ì ìš©ì´ ë˜ì–´ ì‡ë‹¤.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565621372/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-12_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_11.47.11_cxvegq.png" alt="npm csrf"></p><p>ì§ì ‘ ë§Œë“  ê±´ ì•„ë‹ˆê³  <a href="https://www.npmjs.com/package/csurf">csurf</a>ë¼ëŠ” ì¢‹ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì‡ì–´ì„œ ì‚¬ìš©ì„ í–‡ë‹¤.</p><p>ì´ ê¸°ë²•ì´ ì¿ í‚¤ ê¸°ë°˜ì´ë¼ <a href="https://www.npmjs.com/package/cookie-parser">cookie-parser</a>ê°€ í•„ìš”í•¨</p><p>ì´ê±´ ë‹¤ìŒ ê¸€ì˜ ì£¼ì œì¸ ë¡œê·¸ì¸ì— ëŒ€í•´ ì“¸ ë•Œ ì„¸ì…˜ ë•Œë„ ì“°ë¯€ë¡œ ê·¸ ë•Œ ì ì–´ë‘ì. ê·€ì°®ë‹¤..</p><p>ìœ„ì˜ ì € security.csrfProtection()ì˜ ì½”ë“œë¥¼ ë³´ì.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> csrf ê²€ì¦.</span></span><br><span class="line"><span class="built_in">module</span>.exports.csrfProtection = <span class="function">() =&gt;</span> csrf(&#123; <span class="attr">cookie</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure><p>í•œ ì¤„ì´ë©´ ë. ì´ë ‡ê²Œ ëª¨ë“ˆë¡œ ë§Œë“¤ì–´ë‘ê³  ì“°ë©´ í¸ë¦¬í•˜ë”ë¼. ë‚˜ ê°™ì€ ê²½ìš°ì—” html metaì— ë„£ì–´ë‘ì—‡ìŒ.</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565621988/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-08-12_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_11.59.26_ftgggu.png" alt="ì˜ˆì‹œ"></p><p>ìƒˆë¡œ ê³ ì¹¨ì„ í•´ ë³´ë©´ ì´ í† í°ì€ 1íšŒì„± í† í°ì´ê¸° ë•Œë¬¸ì— ê³„ì† ë°”ë€ë‹¤.</p><p>ê·¸ë¦¬ê³  í´ë¼ì´ì–¸íŠ¸ì—ì„œ formì´ë“  ajaxë“  ì„œë²„ì— ë°ì´í„°ë¥¼ ë³´ë‚¼ ë•Œ ì•„ë˜ ì²˜ëŸ¼ ì € í† í° ê°’ì„ ê¼­ ë³´ë‚´ì¤˜ì•¼ ëœë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> csrf = $(<span class="string">&#x27;meta[name=&quot;csrf&quot;]&#x27;</span>).attr(<span class="string">&#x27;content&#x27;</span>);</span><br><span class="line"></span><br><span class="line"> $.ajax(&#123;</span><br><span class="line">          url: <span class="string">`/signUp?_csrf=<span class="subst">$&#123;csrf&#125;</span>`</span>,</span><br><span class="line">          type: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">          data: $(<span class="string">&#x27;#signUpForm&#x27;</span>).serialize(),</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p>ì´ì œ í† í° ê°’ê³¼ í•¨ê»˜ ë°ì´í„°ë¥¼ ë³´ë‚´ë©´ ì„œë²„ì—ì„œ ì²˜ë¦¬ë¥¼ í•´ì•¼ í•œë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> ê°€ì… ì²˜ë¦¬.</span></span><br><span class="line"><span class="comment">// eslint-disable-next-line consistent-return</span></span><br><span class="line">router.post(<span class="string">&#x27;/signUp&#x27;</span>, security.csrfProtection(), <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; email, password, name &#125; = req.body;</span><br><span class="line">  <span class="keyword">if</span> (!email || !password || !name) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">200</span>).json(&#123; <span class="attr">result</span>: <span class="literal">false</span>, <span class="attr">title</span>: <span class="string">&#x27;warning&#x27;</span>, <span class="attr">comment</span>: <span class="string">&#x27;email or password or name is omitted&#x27;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  UserModel.findOne(&#123;</span><br><span class="line">    email: security.xssFilter(email),</span><br><span class="line">    <span class="comment">// eslint-disable-next-line consistent-return</span></span><br><span class="line">  &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123; <span class="keyword">return</span> next(err); &#125;</span><br><span class="line">    <span class="keyword">if</span> (data) &#123; <span class="keyword">return</span> res.json(&#123; <span class="attr">result</span>: <span class="literal">false</span>, <span class="attr">title</span>: <span class="string">&#x27;warning&#x27;</span>, <span class="attr">comment</span>: <span class="string">&#x27;This email has already been signed up.&#x27;</span> &#125;); &#125;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">new</span> UserModel(&#123;</span><br><span class="line">      email: security.xssFilter(email),</span><br><span class="line">      password: security.changeHash(security.xssFilter(password)),</span><br><span class="line">      name,</span><br><span class="line">    &#125;);</span><br><span class="line">    user.save(<span class="function">(<span class="params">saveErr</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (saveErr) &#123; <span class="keyword">return</span> next(saveErr); &#125;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">200</span>).json(&#123; <span class="attr">result</span>: <span class="literal">true</span>, <span class="attr">title</span>: <span class="string">&#x27;Your membership is complete&#x27;</span>, <span class="attr">comment</span>: <span class="string">&#x27;Please sign in.&#x27;</span> &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ì²˜ë¦¬ë¥¼ í•˜ëŠ” ë¼ìš°í„°ì— ë§ˆì°¬ê°€ì§€ë¡œ security.csrfProtection()ë¥¼ ë¯¸ë“¤ì›¨ì–´ë¡œ ë„£ìœ¼ë©´ </p><p>ì´ ì¹œêµ¬ê°€ ì•Œì•„ì„œ ê²€ì¦ì„ í•˜ê¸° ë•Œë¬¸ì— ì •ìƒ í† í° ì´ë©´ ë‹¤ìŒìœ¼ë¡œ ì§„í–‰ì„ í•˜ê³  </p><p>ë¹„ì •ìƒì ì¸ í† í° ê°’ì´ê±°ë‚˜ ë¹„ì–´ì‡ìœ¼ë©´ 403ìœ¼ë¡œ ë¦¬í„´ì„ í–‡ë˜ ê±¸ë¡œ..</p><p>ì‚¬ì‹¤ ì´ê±´ íšŒì› ê°€ì… ë¿ë§Œ ì•„ë‹ˆë¼ ì›¹ ì‚¬ì´íŠ¸ ì „ì²´ ë‚´ì— ì‚¬ìš©ìê°€ ë­”ê°€ ì…ë ¥ì„ í•˜ëŠ” í˜ì´ì§€ì˜ ê°™ì€ ê²½ìš° ë‹¤ ë„£ì–´ì¤˜ì•¼ í•œë‹¤.</p><p>csrfProtection ì½”ë“œë¥¼ ëª¨ë“ˆë¡œ ë§Œë“  ì´ìœ ê°€ ì´ë ‡ê¸° ë•Œë¬¸ì´ë‹¤. íŒ¨ì‹œë¸Œì²˜ëŸ¼ ì¨ì•¼ í•¨.</p><p>ë‚˜ë¨¸ì§€ ê°€ì… êµ¬í˜„ì€ ì‚¬ì‹¤ ìœ„ì˜ ì½”ë“œê°€ ëì´ë‹¤. ì € ì½”ë“œëŠ” DBë¥¼ mongoDBë¥¼ ì“°ê³  ì‡ëŠ”ë° í´ë¼ê°€ ë³´ë‚´ì¤€ emailì„ ìœ ì € ì»¬ë ‰ì…˜ì—ì„œ ì¡°íšŒë¥¼ í•œ í›„ ì¤‘ë³µëœ ì´ë©”ì¼ì¸ì§€ ì²´í¬ë¥¼ í•´ì„œ ìˆìœ¼ë©´ ê±°ì ˆí•˜ê³  ì—…ëŠ” ì´ë©”ì¼ì´ë©´ ì‹ ê·œ ìœ ì €ë¡œ ì¸ì‹ì„ í•˜ê³  ì €ì¥í•˜ëŠ” ê²Œ ëì´ë‹¤.</p><p>ì € ì½”ë“œì—ì„œ ë‚¨ê²¨ë‘˜ë ¤ê³  í•˜ëŠ” ê±´ xssFilter, changeHash ì´ ë¶€ë¶„ì´ë‹¤.</p><p><a href="https://ko.wikipedia.org/wiki/%EC%82%AC%EC%9D%B4%ED%8A%B8_%EA%B0%84_%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8C%85">xss</a>ëŠ” ì´ê±°ë„ ì›¹ì‚¬ì´íŠ¸ ì·¨ì•½ì  ê³µê²© ì¤‘ì˜ í•˜ë‚˜ ì¸ë°(ì—­ì‹œ ì´ê±°ë„ ìì„¸í•œ ë‚´ìš©ì€ ë§í¬ ì°¸ì¡°) ì‰½ê²Œ ì ìë©´ ì‚¬ìš©ìê°€ ì ëŠ” form inputì— ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë„£ëŠ”ë‹¤ëŠ” ì†Œë¦¬ë‹¤.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;aa&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;script&gt;alert(&#x27;ì´ê²Œë­ì—¬&#x27;&lt;/script&gt;&quot;</span></span></span><br></pre></td></tr></table></figure><p>ë­ ì´ëŸ°ì‹ìœ¼ë¡œ í•´ì„œ ë„˜ì–´ì˜¬ ë•Œ ìŠ¤í¬ë¦½íŠ¸ê°€ ë§Œì•½ì— ì‡ë‹¤ë©´ &lt;&gt; ì´ ë¶€ë¶„ë§Œ entity ì½”ë“œë¡œ ì¹˜í™˜ í•´ë²„ë¦¬ë©´ ë¬¸ìë¡œ ì¸ì‹ì´ ë˜ê¸°ì— ìŠ¤í¬ë¦½íŠ¸ê°€ ì‹¤í–‰ì´ ë˜ì§ˆ ì•Šì„ ê²ƒì´ë‹¤.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// <span class="doctag">TODO:</span> ê°„ë‹¨í•œ xss í•„í„°.</span></span><br><span class="line"><span class="built_in">module</span>.exports.xssFilter = <span class="function">(<span class="params">_val</span>) =&gt;</span> _val.replace(<span class="regexp">/&lt;/g</span>, <span class="string">&#x27;&amp;lt;&#x27;</span>).replace(<span class="regexp">/&gt;/g</span>, <span class="string">&#x27;&amp;gt;&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ë§ˆì§€ë§‰ìœ¼ë¡œ changeHashëŠ” <a href="https://d2.naver.com/helloworld/318732">ì•ˆì „í•œ ë¹„ë°€ë²ˆí˜¸ ì €ì¥</a>ì´ë€ ê¸€ì„ ì°¸ê³ í•˜ë©´ ì¢‹ë‹¤.</p><p>ì¦‰ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ì €ì¥ì„ í•˜ë©´ ì•ˆëœë‹¤ëŠ” ì†Œë¦¬. í•´í‚¹ì€ ê³ ì‚¬í•˜ê³  db ì ‘ê·¼ ê¶Œí•œì´ ì‡ëŠ” ì‚¬ëŒì´ ë“¤ì–´ê°€ì„œ ë³´ë©´ ê·¸ ì‚¬ëŒì´ í‰ì†Œì— ì“°ëŠ” ë¹„ë°€ë²ˆí˜¸ë‚˜ ì´ëŸ° ê²Œ ë…¸ì¶œë˜ë²„ë¦¬ê¸° ë•Œë¬¸ì´ë‹¤. ì•…ì˜ì ì¸ í”„ë¡œê·¸ë˜ë¨¸ë¼ë©´ ã…ã… ë§ ì•ˆí•´ë„ ë”ì°í•˜ë‹¤.</p><p>ì•„ ì—¬ë‹´ìœ¼ë¡œ ì˜¬í•´ì— ë¹„ë°€ë²ˆí˜¸ë¥¼ í‰ë¬¸ìœ¼ë¡œ ì €ì¥ì„ í•˜ëŠ” ì½”ë“œì™€ DBë¥¼ ë‚œ ë³¸ ì ì´ ìˆë‹¤. ëª¹ì‹œ ì¶©ê²©ì´ì˜€ìŒâ€¦</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MY_SALT = <span class="string">&#x27;Always back up Hexo articles. :(&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> ë‹¨ë°©í–¥ ì•”í˜¸í™”.</span></span><br><span class="line"><span class="built_in">module</span>.exports.changeHash = <span class="function">(<span class="params">_val</span>) =&gt;</span> crypto.createHash(<span class="string">&#x27;sha512&#x27;</span>).update(_val + MY_SALT).digest(<span class="string">&#x27;base64&#x27;</span>);</span><br></pre></td></tr></table></figure><p>ì•”íŠ¼ changeHashëŠ” nodejsì˜ ë‚´ì¥ëœ íŒ¨í‚¤ì§€ì¸ cryptoë¥¼ ì´ìš©í•´ ë‹¨ë°©í–¥ ì•”í˜¸í™” (=ë³µí˜¸í™”ê°€ ì•ˆë˜ëŠ” ì•”í˜¸í™”)ë¡œ ë³€í™˜ì„ í•˜ëŠ” ì½”ë“œì´ë‹¤.</p><p>ì´ê±¸ ì–´ë– ì¼€ ì‚¬ìš©í•˜ëŠ”ê±°ëƒë©´</p><ol><li>ê°€ì…í•  ë•Œ ì‚¬ìš©ìê°€ ë¹„ë°€ë²ˆí˜¸ë¥¼ 1q2w3e ë­ ì´ë ‡ê²Œ ì…ë ¥í–‡ë‹¤ê³  ì¹˜ì.</li><li>ì„œë²„ì—ì„œ ì‚¬ìš©ìê°€ ë³´ë‚´ì¤€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€í™˜ -&gt; ì˜ˆë¡œ 7eb32f7589 ë­ ì´ëŸ° ì‹ìœ¼ë¡œ ë³€í™˜ ëœë‹¤.</li><li>ê°€ì…ì„ í•  ë•Œ ì € ë³€í™˜ëœ ê°’ì„ DBì— ì €ì¥ì„ í•œë‹¤.</li><li>ì´ì œ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í•  ë•Œ 1q2w3eë¥¼ ì…ë ¥ì„ í•˜ë©´ ì„œë²„ì—ì„  ë˜ ë³€í™˜í•˜ì—¬ DBì— ì €ì¥ëœ ë³€í™˜ëœ ë¹„ë°€ë²ˆí˜¸ì™€ ë™ì¼í•œì§€ ì²´í¬ë¥¼ í•˜ëŠ” ê±°ë‹¤.</li></ol><p>ë§ˆì§€ë§‰ìœ¼ë¡œ ê°€ì…í•˜ëŠ” ì§¤ íˆ¬ì²™</p><p><img src="https://res.cloudinary.com/dwmywmqv6/image/upload/v1565624972/signin_kly4vo.gif" alt="ì˜ˆì‹œ"></p><p>ê°€ì…ì€ ì´ì •ë„ë¡œ ì ì–´ë‘ê³  ë‹¤ìŒ ê¸€ì—ì„œ ë¡œê·¸ì¸, ì†Œì…œ ë¡œê·¸ì¸ì„ ì´ì–´ì„œ ì‘ì„±ì„ í•´ì•¼ ê²Ÿë‹¤.</p><p>ì½”ë“œë¥¼ ì¼ë¶€ë¶„ë§Œ ì ì–´ ë‘¿ìœ¼ë¯€ë¡œ ë§Œì•½ ë§Œì•½ì— ëˆ„ê°€ ë³´ê²Œ ë  ê²½ìš°ì—” <a href="https://github.com/hidelryn/auth-example">ì†ŒìŠ¤ ì½”ë“œ</a>ë¥¼ ì°¸ì¡° ë°”ëë‹ˆë‹¤.</p>]]></content>
      
      
      <categories>
          
          <category> nodejs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Node.js </tag>
            
            <tag> Express </tag>
            
            <tag> Auth </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
