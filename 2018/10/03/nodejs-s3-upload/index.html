<!DOCTYPE html>
<html lang="en">
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="s3 버켓 생성 s3 설정IAM key로 하려면 설정을 좀 해야 한다.   ARN: 이후 내용을 복사 한다음에 정책 생성기를 누른다.  서비스는 당연히 s3이고 액션은 getObject만 한다 (읽기만 가능) 그리고 아까 복사해둔 ARN내용을 기입후 Add Stagement 노란 박스를 눌러 준다.  Generate Policy 버튼을 클릭  복사 해서 s">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS S3에 업로드 해보기">
<meta property="og:url" content="https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/index.html">
<meta property="og:site_name" content="Delryn&#39;s Blog">
<meta property="og:description" content="s3 버켓 생성 s3 설정IAM key로 하려면 설정을 좀 해야 한다.   ARN: 이후 내용을 복사 한다음에 정책 생성기를 누른다.  서비스는 당연히 s3이고 액션은 getObject만 한다 (읽기만 가능) 그리고 아까 복사해둔 ARN내용을 기입후 Add Stagement 노란 박스를 눌러 준다.  Generate Policy 버튼을 클릭  복사 해서 s">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013185/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.58.02_d4xeun.png">
<meta property="og:image" content="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013186/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.38.15_skc7zy.png">
<meta property="og:image" content="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013185/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.35.56_trmkje.png">
<meta property="og:image" content="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013185/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.35.47_pbx5gw.png">
<meta property="og:image" content="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013885/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.31.04_zufxpf.png">
<meta property="og:image" content="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013186/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.36.40_mtijxz.png">
<meta property="og:image" content="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013186/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.36.56_ru084c.png">
<meta property="og:image" content="https://res.cloudinary.com/ddebpn43q/image/upload/v1563014938/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.48.35_ega16r.png">
<meta property="og:image" content="https://res.cloudinary.com/ddebpn43q/image/upload/v1563015864/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.03.13_h6tgcn.png">
<meta property="article:published_time" content="2018-10-03T11:27:28.000Z">
<meta property="article:modified_time" content="2020-09-01T06:36:15.000Z">
<meta property="article:author" content="delryn">
<meta property="article:tag" content="AWS">
<meta property="article:tag" content="Node.js">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013185/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.58.02_d4xeun.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>AWS S3에 업로드 해보기</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
    <link rel="canonical" href="https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/">
<meta name="generator" content="Hexo 5.1.1"><link rel="alternate" href="/atom.xml" title="Delryn's Blog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">tags</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/11/11/nodejs-crypto/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/08/17/etc-vscode-use-eslint/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.facebook.com/sharer.php?u=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/share?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&text=AWS S3에 업로드 해보기"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.linkedin.com/shareArticle?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&title=AWS S3에 업로드 해보기"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&is_video=false&description=AWS S3에 업로드 해보기"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=AWS S3에 업로드 해보기&body=Check out this article: https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://getpocket.com/save?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&title=AWS S3에 업로드 해보기"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://reddit.com/submit?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&title=AWS S3에 업로드 해보기"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.stumbleupon.com/submit?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&title=AWS S3에 업로드 해보기"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://digg.com/submit?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&title=AWS S3에 업로드 해보기"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tumblr.com/share/link?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&name=AWS S3에 업로드 해보기&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://news.ycombinator.com/submitlink?u=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&t=AWS S3에 업로드 해보기"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-%EB%B2%84%EC%BC%93-%EC%83%9D%EC%84%B1"><span class="toc-number">1.</span> <span class="toc-text">s3 버켓 생성</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-%EC%84%A4%EC%A0%95"><span class="toc-number">2.</span> <span class="toc-text">s3 설정</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json-%EC%97%85%EB%A1%9C%EB%93%9C"><span class="toc-number">3.</span> <span class="toc-text">json 업로드</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%98%AC%EB%A6%AC%EA%B8%B0"><span class="toc-number">4.</span> <span class="toc-text">이미지 올리기</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#html"><span class="toc-number">4.1.</span> <span class="toc-text">html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%85%EB%A1%9C%EB%93%9C-%EC%BD%94%EB%93%9C"><span class="toc-number">4.2.</span> <span class="toc-text">업로드 코드</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        AWS S3에 업로드 해보기
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Delryn's Blog</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2018-10-03T11:27:28.000Z" itemprop="datePublished">2018-10-03</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/AWS/" rel="tag">AWS</a>, <a class="tag-link-link" href="/tags/Node-js/" rel="tag">Node.js</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="s3-버켓-생성"><a href="#s3-버켓-생성" class="headerlink" title="s3 버켓 생성"></a>s3 버켓 생성</h2><p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013185/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.58.02_d4xeun.png" alt="s3 생성"></p>
<h2 id="s3-설정"><a href="#s3-설정" class="headerlink" title="s3 설정"></a>s3 설정</h2><p>IAM key로 하려면 설정을 좀 해야 한다.</p>
<p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013186/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.38.15_skc7zy.png" alt="설정"></p>
<p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013185/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.35.56_trmkje.png" alt="버킷정책"></p>
<p>ARN: 이후 내용을 복사 한다음에 정책 생성기를 누른다.</p>
<p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013185/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.35.47_pbx5gw.png" alt="정책 생성기"></p>
<p>서비스는 당연히 s3이고 액션은 getObject만 한다 (읽기만 가능)</p>
<p>그리고 아까 복사해둔 ARN내용을 기입후 Add Stagement 노란 박스를 눌러 준다.</p>
<p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013885/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.31.04_zufxpf.png" alt="정책 생성기 - 2"></p>
<p>Generate Policy 버튼을 클릭</p>
<p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013186/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.36.40_mtijxz.png" alt="정책 생성 결과"></p>
<p>복사 해서 s3 버킷 정책 편집기에 붙여넣기 하면 된다.</p>
<p>붙여넣기 하고 나서 꼭 Resource 뒤에 /*를 붙여준다. 저장 하면 설정 끝</p>
<p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563013186/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.36.56_ru084c.png" alt="정책 생성 결과 - 2"></p>
<h2 id="json-업로드"><a href="#json-업로드" class="headerlink" title="json 업로드"></a>json 업로드</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">    region: <span class="string">&#x27;&#x27;</span>, <span class="comment">// 서울 리전</span></span><br><span class="line">    accessKeyId: <span class="string">&#x27;&#x27;</span>, <span class="comment">// IAM</span></span><br><span class="line">    secretAccessKey:<span class="string">&#x27;&#x27;</span> <span class="comment">// IAM</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s3 = <span class="keyword">new</span> AWS.S3();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> DATA = &#123;</span><br><span class="line">    id: <span class="number">1</span>,</span><br><span class="line">    title: <span class="string">&#x27;던전에서 만남을 추구하면 안될까 2기&#x27;</span>,</span><br><span class="line">    body: &#123;</span><br><span class="line">        start: <span class="string">&#x27;2019년 3분기&#x27;</span>,</span><br><span class="line">        develop: <span class="string">&#x27;J.C.STAFF&#x27;</span>,</span><br><span class="line">        broadcast: <span class="string">&#x27;도쿄 MX&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = &#123;</span><br><span class="line">    Bucket: <span class="string">&#x27;delryn-upload-test&#x27;</span>, <span class="comment">// 버켓 이름</span></span><br><span class="line">    Key: <span class="string">&#x27;test.json&#x27;</span>, <span class="comment">// 파일명 확장자도 필요함.</span></span><br><span class="line">    ACL: <span class="string">&#x27;public-read&#x27;</span>, <span class="comment">// 액세스 제어 목록 읽기 권한만.</span></span><br><span class="line">    Body: <span class="built_in">JSON</span>.stringify(DATA), <span class="comment">// 보낼 데이터</span></span><br><span class="line">    ContentType: <span class="string">&quot;application/json&quot;</span> <span class="comment">// 컨텐츠 타입</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">s3.putObject(params, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;success&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563014938/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_7.48.35_ega16r.png" alt="결과"></p>
<p>실행하면 잘 올라감.</p>
<h2 id="이미지-올리기"><a href="#이미지-올리기" class="headerlink" title="이미지 올리기"></a>이미지 올리기</h2><p>간단하게 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.npmjs.com/package/multer">multer</a>, <a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.npmjs.com/package/multer-s3">multer-s3</a>를 이용하면 된다.</p>
<h3 id="html"><a href="#html" class="headerlink" title="html"></a>html</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/form-upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;upload1&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;전송&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="업로드-코드"><a href="#업로드-코드" class="headerlink" title="업로드 코드"></a>업로드 코드</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> AWS = <span class="built_in">require</span>(<span class="string">&#x27;aws-sdk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multerS3 = <span class="built_in">require</span>(<span class="string">&#x27;multer-s3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line">AWS.config.update(&#123;</span><br><span class="line">    region: <span class="string">&#x27;&#x27;</span>, <span class="comment">// s3 리전</span></span><br><span class="line">    accessKeyId: <span class="string">&#x27;&#x27;</span>, <span class="comment">// IAM</span></span><br><span class="line">    secretAccessKey: <span class="string">&#x27;&#x27;</span> <span class="comment">// IAM</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> PORT = process.env.PORT || <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s3 = <span class="keyword">new</span> AWS.S3();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.sendFile(__dirname + <span class="string">&#x27;/index.html&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> upload = multer(&#123;</span><br><span class="line">    storage: multerS3(&#123;</span><br><span class="line">        s3: s3,</span><br><span class="line">        bucket: <span class="string">&#x27;delryn-upload-test&#x27;</span>, <span class="comment">// 버킷 이름</span></span><br><span class="line">        metadata: <span class="function"><span class="keyword">function</span> (<span class="params">req, file, cb</span>) </span>&#123; <span class="comment">// 메타데이터 설정, 이거 딱히 안 쓰는데.. 무시..</span></span><br><span class="line">            <span class="comment">// console.log(&#x27;file&#x27;, file)</span></span><br><span class="line">            cb(<span class="literal">null</span>, &#123; <span class="attr">fieldName</span>: file.fieldname &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        key: <span class="function"><span class="keyword">function</span> (<span class="params">req, file, cb</span>) </span>&#123; <span class="comment">// 파일 이름. 확장자를 역시 붙여줘야 한다.</span></span><br><span class="line">            <span class="comment">// 업로드할 떄 파일명이 겹치면 덮어쓰기 땜에 바꿔줘야 함.</span></span><br><span class="line">            <span class="comment">// 원본 파일명을 알고 싶으면 req.file을 찍으면 나옴.</span></span><br><span class="line">            <span class="keyword">let</span> extension = file.mimetype.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">1</span>];</span><br><span class="line">            cb(<span class="literal">null</span>, <span class="string">`<span class="subst">$&#123;<span class="built_in">Date</span>.now()&#125;</span>.<span class="subst">$&#123;extension&#125;</span>`</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        ACL: <span class="string">&#x27;public-read&#x27;</span>, <span class="comment">// 모두 읽기</span></span><br><span class="line">        contentType: multerS3.AUTO_CONTENT_TYPE <span class="comment">// 컨텐츠 타입은 자동 완성 API 쓰자.</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&#x27;/form-upload&#x27;</span>, upload.single(<span class="string">&#x27;upload1&#x27;</span>), <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;upload success&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`server listening on port <span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://res.cloudinary.com/ddebpn43q/image/upload/v1563015864/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2019-07-13_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_8.03.13_h6tgcn.png" alt="실행 결과"></p>
<p>테스트 해보면 잘 올라간다.</p>

  </div>
</article>

<script src="https://utteranc.es/client.js" repo="hidelryn/blog-comment" issue-term="title" label="Comment" theme="github-dark-orange" crossorigin="anonymous" async>
  </script>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">tags</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-%EB%B2%84%EC%BC%93-%EC%83%9D%EC%84%B1"><span class="toc-number">1.</span> <span class="toc-text">s3 버켓 생성</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-%EC%84%A4%EC%A0%95"><span class="toc-number">2.</span> <span class="toc-text">s3 설정</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#json-%EC%97%85%EB%A1%9C%EB%93%9C"><span class="toc-number">3.</span> <span class="toc-text">json 업로드</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%98%AC%EB%A6%AC%EA%B8%B0"><span class="toc-number">4.</span> <span class="toc-text">이미지 올리기</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#html"><span class="toc-number">4.1.</span> <span class="toc-text">html</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EC%97%85%EB%A1%9C%EB%93%9C-%EC%BD%94%EB%93%9C"><span class="toc-number">4.2.</span> <span class="toc-text">업로드 코드</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.facebook.com/sharer.php?u=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://twitter.com/share?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&text=AWS S3에 업로드 해보기"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.linkedin.com/shareArticle?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&title=AWS S3에 업로드 해보기"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://pinterest.com/pin/create/bookmarklet/?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&is_video=false&description=AWS S3에 업로드 해보기"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=AWS S3에 업로드 해보기&body=Check out this article: https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://getpocket.com/save?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&title=AWS S3에 업로드 해보기"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://reddit.com/submit?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&title=AWS S3에 업로드 해보기"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.stumbleupon.com/submit?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&title=AWS S3에 업로드 해보기"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://digg.com/submit?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&title=AWS S3에 업로드 해보기"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="http://www.tumblr.com/share/link?url=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&name=AWS S3에 업로드 해보기&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="external nofollow noopener noreferrer" href="https://news.ycombinator.com/submitlink?u=https://hidelryn.github.io/2018/10/03/nodejs-s3-upload/&t=AWS S3에 업로드 해보기"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2018-2021
    delryn
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/tags/">tags</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-104148803-2', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
